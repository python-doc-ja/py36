<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>36.1. optparse — コマンドラインオプション解析器 &#8212; Python 3.6.0 ドキュメント</title>
    
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.6.0 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Python 3.6.0 ドキュメント" href="../contents.html" />
    <link rel="up" title="36. 取って代わられたモジュール群" href="superseded.html" />
    <link rel="next" title="36.2. imp — import 内部へのアクセス" href="imp.html" />
    <link rel="prev" title="36. 取って代わられたモジュール群" href="superseded.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <link rel="canonical" href="https://docs.python.jp/3/library/optparse.html" /><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/optparse.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="../_static/version_switch.js"></script>
    
    
 

  </head>
  <body role="document">  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="imp.html" title="36.2. imp — import 内部へのアクセス"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="superseded.html" title="36. 取って代わられたモジュール群"
             accesskey="P">前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="version_switcher_placeholder">3.6.0</span>
          <a href="../index.html">ドキュメント</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="superseded.html" accesskey="U">36. 取って代わられたモジュール群</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-optparse">
<span id="optparse-parser-for-command-line-options"></span><h1>36.1. <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> &#8212; コマンドラインオプション解析器<a class="headerlink" href="#module-optparse" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/optparse.py">Lib/optparse.py</a></p>
<div class="deprecated">
<p><span class="versionmodified">バージョン 3.2 で撤廃: </span><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> モジュールは廃止予定であり、これ以上の開発は行われません。<a class="reference internal" href="argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal"><span class="pre">argparse</span></code></a> モジュールを使用してください。</p>
</div>
<hr class="docutils" />
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> モジュールは、昔からある <a class="reference internal" href="getopt.html#module-getopt" title="getopt: Portable parser for command line options; support both short and long option names."><code class="xref py py-mod docutils literal"><span class="pre">getopt</span></code></a> よりも簡便で、柔軟性に富み、かつ強力なコマンドライン解析ライブラリです。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> では、より宣言的なスタイルのコマンドライン解析手法、すなわち <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> のインスタンスを作成してオプションを追加してゆき、そのインスタンスでコマンドラインを解析するという手法をとっています。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> を使うと、GNU/POSIX 構文でオプションを指定できるだけでなく、使用法やヘルプメッセージの生成も行えます。</p>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> を使った簡単なスクリプトの例を以下に示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="n">OptionParser</span>
<span class="o">...</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s2">&quot;write report to FILE&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s2">&quot;don&#39;t print status messages to stdout&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
</div>
<p>このようにわずかな行数のコードによって、スクリプトのユーザはコマンドライン上で例えば以下のような「よくある使い方」を実行できるようになります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">yourscript</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">outfile</span> <span class="o">-</span><span class="n">q</span>
</pre></div>
</div>
<p>コマンドライン解析の中で、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はユーザの指定したコマンドライン引数値に応じて <code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> の返す <code class="docutils literal"><span class="pre">options</span></code> の属性値を設定してゆきます。 <code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> がコマンドライン解析から処理を戻したとき、 <code class="docutils literal"><span class="pre">options.filename</span></code> は <code class="docutils literal"><span class="pre">&quot;outfile&quot;</span></code> に、 <code class="docutils literal"><span class="pre">options.verbose</span></code> は <code class="docutils literal"><span class="pre">False</span></code> になっているはずです。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は長い形式と短い形式の両方のオプション表記をサポートしており、短い形式は結合して指定できます。また、様々な形でオプションに引数値を関連付けられます。従って、以下のコマンドラインは全て上の例と同じ意味になります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">yourscript</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">f</span> <span class="n">outfile</span> <span class="o">--</span><span class="n">quiet</span>
<span class="o">&lt;</span><span class="n">yourscript</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">quiet</span> <span class="o">--</span><span class="n">file</span> <span class="n">outfile</span>
<span class="o">&lt;</span><span class="n">yourscript</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">foutfile</span>
<span class="o">&lt;</span><span class="n">yourscript</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">qfoutfile</span>
</pre></div>
</div>
<p>さらに、ユーザが以下のいずれかを実行すると</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">yourscript</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">h</span>
<span class="o">&lt;</span><span class="n">yourscript</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はスクリプトのオプションについて簡単にまとめた内容を出力します:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Usage: &lt;yourscript&gt; [options]

Options:
  -h, --help            show this help message and exit
  -f FILE, --file=FILE  write report to FILE
  -q, --quiet           don&#39;t print status messages to stdout
</pre></div>
</div>
<p><em>yourscript</em> の中身は実行時に決まります (通常は <code class="docutils literal"><span class="pre">sys.argv[0]</span></code> になります)。</p>
<div class="section" id="background">
<span id="optparse-background"></span><h2>36.1.1. 背景<a class="headerlink" href="#background" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は、素直で慣習に則ったコマンドラインインタフェースを備えたプログラムの作成を援助する目的で設計されました。その結果、Unix で慣習的に使われているコマンドラインの構文や機能だけをサポートするに留まっています。こうした慣習に詳しくなければ、よく知っておくためにもこの節を読んでおきましょう。</p>
<div class="section" id="terminology">
<span id="optparse-terminology"></span><h3>36.1.1.1. 用語集<a class="headerlink" href="#terminology" title="このヘッドラインへのパーマリンク">¶</a></h3>
<dl class="docutils">
<dt>引数 (argument)</dt>
<dd><p class="first">コマンドラインでユーザが入力するテキストの塊で、シェルが <code class="docutils literal"><span class="pre">execl</span></code> や <code class="docutils literal"><span class="pre">execv</span></code> に引き渡すものです。Python では、引数は <code class="docutils literal"><span class="pre">sys.argv[1:]</span></code> の要素となります。(<code class="docutils literal"><span class="pre">sys.argv[0]</span></code> は実行しようとしているプログラムの名前です。引数解析に関しては、この要素はあまり重要ではありません。) Unix シェルでは、「語 (word)」という用語も使います。</p>
<p class="last">場合によっては <code class="docutils literal"><span class="pre">sys.argv[1:]</span></code> 以外の引数リストを代入する方が望ましいことがあるので、「引数」は「 <code class="docutils literal"><span class="pre">sys.argv[1:]</span></code> または <code class="docutils literal"><span class="pre">sys.argv[1:]</span></code> の代替として提供される別のリストの要素」と読むべきでしょう。</p>
</dd>
<dt>オプション (option)</dt>
<dd><p class="first">追加的な情報を与えるための引数で、プログラムの実行に対する教示やカスタマイズを行います。オプションには多様な文法が存在します。伝統的な Unix における書法はハイフン (&#8220;-&#8221;) の後ろに一文字が続くもので、例えば <code class="docutils literal"><span class="pre">-x</span></code> や <code class="docutils literal"><span class="pre">-F</span></code> です。また、伝統的な Unix における書法では、複数のオプションを一つの引数にまとめられます。例えば <code class="docutils literal"><span class="pre">-x</span> <span class="pre">-F</span></code> は <code class="docutils literal"><span class="pre">-xF</span></code> と等価です。 GNU プロジェクトでは <code class="docutils literal"><span class="pre">--</span></code> の後ろにハイフンで区切りの語を指定する方法、例えば <code class="docutils literal"><span class="pre">--file</span></code> や <code class="docutils literal"><span class="pre">--dry-run</span></code> も提供しています。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は、これら二種類のオプション書法だけをサポートしています。</p>
<p>他に見られる他のオプション書法には以下のようなものがあります:</p>
<ul class="simple">
<li><p class="first">ハイフンの後ろに数個の文字が続くもので、例えば <code class="docutils literal"><span class="pre">-pf</span></code> (このオプションは複数のオプションを一つにまとめたものとは <em>違います</em>)</p>
</li>
<li><p class="first">ハイフンの後ろに語が続くもので、例えば <code class="docutils literal"><span class="pre">-file</span></code> (これは技術的には上の書式と同じですが、通常同じプログラム上で一緒に使うことはありません)</p>
</li>
<li><p class="first">プラス記号の後ろに一文字、数個の文字、または語を続けたもので、例えば <code class="docutils literal"><span class="pre">+f</span></code>, <code class="docutils literal"><span class="pre">+rgb</span></code></p>
</li>
<li><p class="first">スラッシュ記号の後ろに一文字、数個の文字、または語を続けたもので、例えば <code class="docutils literal"><span class="pre">/f</span></code>, <code class="docutils literal"><span class="pre">/file</span></code></p>
</li>
</ul>
<p class="last">上記のオプション書法は <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> ではサポートしておらず、今後もサポートする予定はありません。これは故意によるものです: 最初の三つはどの環境の標準でもなく、最後の一つは VMS や MS-DOS, そして Windows を対象にしているときにしか意味をなさないからです。</p>
</dd>
<dt>オプション引数 (option argument)</dt>
<dd><p class="first">あるオプションの後ろに続く引数で、そのオプションに密接な関連をもち、オプションと同時に引数リストから取り出されます。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> では、オプション引数は以下のように別々の引数にできます:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>-f foo
--file foo
</pre></div>
</div>
<p>また、一つの引数中にも入れられます:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>-ffoo
--file=foo
</pre></div>
</div>
<p class="last">通常、オプションは引数をとることもとらないこともあります。あるオプションは引数をとることがなく、またあるオプションは常に引数をとります。多くの人々が「オプションのオプション引数」機能を欲しています。これは、あるオプションが引数が指定されている場合には引数をとり、そうでない場合には引数をもたないようにするという機能です。この機能は引数解析をあいまいにするため、議論の的となっています: 例えば、もし <code class="docutils literal"><span class="pre">-a</span></code> がオプション引数をとり、 <code class="docutils literal"><span class="pre">-b</span></code> がまったく別のオプションだとしたら、 <code class="docutils literal"><span class="pre">-ab</span></code> をどうやって解析すればいいのでしょうか？こうした曖昧さが存在するため、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は今のところこの機能をサポートしていません。</p>
</dd>
<dt>位置引数 (positional argument、固定引数)</dt>
<dd><p class="first last">他のオプションが解析される、すなわち他のオプションとその引数が解析されて引数リストから除去された後に引数リストに置かれているものです。</p>
</dd>
<dt>必須のオプション (required option)</dt>
<dd><p class="first last">コマンドラインで与えなければならないオプションです; 「必須のオプション (required option)」という語は、英語では矛盾した言葉です。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> では必須オプションの実装を妨げてはいませんが、とりたてて実装上役立つこともしていません。</p>
</dd>
</dl>
<p>例えば、下記のような架空のコマンドラインを考えてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">prog</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">report</span> <span class="n">report</span><span class="o">.</span><span class="n">txt</span> <span class="n">foo</span> <span class="n">bar</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">-v</span></code> と <code class="docutils literal"><span class="pre">--report</span></code> はどちらもオプションです。<code class="docutils literal"><span class="pre">--report</span></code> オプションが引数をとるとすれば、<code class="docutils literal"><span class="pre">report.txt</span></code> はオプションの引数です。<code class="docutils literal"><span class="pre">foo</span></code> と <code class="docutils literal"><span class="pre">bar</span></code> は固定引数になります。</p>
</div>
<div class="section" id="what-are-options-for">
<span id="optparse-what-options-for"></span><h3>36.1.1.2. オプションとは何か<a class="headerlink" href="#what-are-options-for" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>オプションはプログラムの実行を調整したり、カスタマイズしたりするための補助的な情報を与えるために使います。もっとはっきりいうと、オプションはあくまでもオプション (省略可能)であるということです。本来、プログラムはともかくもオプションなしでうまく実行できてしかるべきです。(Unix やGNU ツールセットのプログラムをランダムにピックアップしてみてください。オプションを全く指定しなくてもちゃんと動くでしょう？例外は <code class="docutils literal"><span class="pre">find</span></code>, <code class="docutils literal"><span class="pre">tar</span></code>, <code class="docutils literal"><span class="pre">dd</span></code> くらいです&#8212;これらの例外は、オプション文法が標準的でなく、インタフェースが混乱を招くと酷評されてきた変種のはみ出しものなのです)</p>
<p>多くの人が自分のプログラムに「必須のオプション」を持たせたいと考えます。しかしよく考えてください。必須なら、それは <em>オプション(省略可能) ではないのです！</em> プログラムを正しく動作させるのに絶対的に必要な情報があるとすれば、そこには固定引数を割り当てるべきなのです。</p>
<p>良くできたコマンドラインインタフェース設計として、ファイルのコピーに使われる <code class="docutils literal"><span class="pre">cp</span></code> ユーティリティのことを考えてみましょう。ファイルのコピーでは、コピー先を指定せずにファイルをコピーするのは無意味な操作ですし、少なくとも一つのコピー元が必要です。従って、<code class="docutils literal"><span class="pre">cp</span></code> は引数無しで実行すると失敗します。とはいえ、<code class="docutils literal"><span class="pre">cp</span></code> はオプションを全く必要としない柔軟で便利なコマンドライン文法を備えています:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">SOURCE</span> <span class="n">DEST</span>
<span class="n">cp</span> <span class="n">SOURCE</span> <span class="o">...</span> <span class="n">DEST</span><span class="o">-</span><span class="n">DIR</span>
</pre></div>
</div>
<p>まだあります。ほとんどの <code class="docutils literal"><span class="pre">cp</span></code> の実装では、ファイルモードや変更時刻を変えずにコピーする、シンボリックリンクの追跡を行わない、すでにあるファイルを上書きする前にユーザに尋ねる、など、ファイルをコピーする方法をいじるための一連のオプションを実装しています。しかし、こうしたオプションは、一つのファイルを別の場所にコピーする、または複数のファイルを別のディレクトリにコピーするという、<code class="docutils literal"><span class="pre">cp</span></code> の中心的な処理を乱すことはないのです。</p>
</div>
<div class="section" id="what-are-positional-arguments-for">
<span id="optparse-what-positional-arguments-for"></span><h3>36.1.1.3. 固定引数とは何か<a class="headerlink" href="#what-are-positional-arguments-for" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>固定引数とは、プログラムを動作させる上で絶対的に必要な情報となる引数です。</p>
<p>よいユーザインタフェースとは、可能な限り少ない固定引数をもつものです。プログラムを正しく動作させるために 17 個もの別個の情報が必要だとしたら、その <em>方法</em> はさして問題にはなりません &#8212;ユーザはプログラムを正しく動作させられないうちに諦め、立ち去ってしまうからです。ユーザインタフェースがコマンドラインでも、設定ファイルでも、GUI やその他の何であっても同じです: 多くの要求をユーザに押し付ければ、ほとんどのユーザはただ音をあげてしまうだけなのです。</p>
<p>要するに、ユーザが絶対に提供しなければならない情報だけに制限する &#8212; そして可能な限りよく練られたデフォルト設定を使うよう試みてください。もちろん、プログラムには適度な柔軟性を持たせたいとも望むはずですが、それこそがオプションの果たす役割です。繰り返しますが、設定ファイルのエントリであろうが、GUI でできた「環境設定」ダイアログ上のウィジェットであろうが、コマンドラインオプションであろうが関係ありません &#8212; より多くのオプションを実装すればプログラムはより柔軟性を持ちますが、実装はより難解になるのです。高すぎる柔軟性はユーザを閉口させ、コードの維持をより難しくするのです。</p>
</div>
</div>
<div class="section" id="tutorial">
<span id="optparse-tutorial"></span><h2>36.1.2. チュートリアル<a class="headerlink" href="#tutorial" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はとても柔軟で強力でありながら、ほとんどの場合には簡単に利用できます。この節では、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> ベースのプログラムで広く使われているコードパターンについて述べます。</p>
<p>まず、<a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> クラスを import しておかなければなりません。次に、プログラムの冒頭で <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> インスタンスを生成しておきます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="n">OptionParser</span>
<span class="o">...</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>
</pre></div>
</div>
<p>これでオプションを定義できるようになりました。基本的な構文は以下の通りです:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="n">opt_str</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>
                  <span class="n">attr</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>各オプションには、 <code class="docutils literal"><span class="pre">-f</span></code> や <code class="docutils literal"><span class="pre">--file</span></code> のような一つまたは複数のオプション文字列と、パーザがコマンドライン上のオプションを見つけた際に、何を準備し、何を行うべきかを <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> に教えるためのオプション属性 (option attribute)がいくつか入ります。</p>
<p>通常、各オプションには短いオプション文字列と長いオプション文字列があります。例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--file&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>オプション文字列は、(ゼロ文字の場合も含め)いくらでも短く、またいくらでも長くできます。ただしオプション文字列は少なくとも一つなければなりません。</p>
<p><a class="reference internal" href="#optparse.OptionParser.add_option" title="optparse.OptionParser.add_option"><code class="xref py py-meth docutils literal"><span class="pre">OptionParser.add_option()</span></code></a> に渡されたオプション文字列は、実際にはこの関数で定義したオプションに対するラベルになります。簡単のため、以後ではコマンドライン上で <em>オプションを見つける</em> という表現をしばしば使いますが、これは実際には <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> がコマンドライン上の <em>オプション文字列</em> を見つけ、対応づけされているオプションを探し出す、という処理に相当します。</p>
<p>オプションを全て定義したら、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> にコマンドラインを解析するように指示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
</div>
<p>(お望みなら、 <code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> に自作の引数リストを渡してもかまいません。とはいえ、実際にはそうした必要はほとんどないでしょう: <code class="xref py py-mod docutils literal"><span class="pre">optionparser</span></code> はデフォルトで <code class="docutils literal"><span class="pre">sys.argv[1:]</span></code> を使うからです。)</p>
<p><code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> は二つの値を返します:</p>
<ul class="simple">
<li><p class="first">全てのオプションに対する値の入ったオブジェクト <code class="docutils literal"><span class="pre">options</span></code> &#8212; 例えば、<code class="docutils literal"><span class="pre">--file</span></code> が単一の文字列引数をとる場合、<code class="docutils literal"><span class="pre">options.file</span></code> はユーザが指定したファイル名になります。オプションを指定しなかった場合には <code class="docutils literal"><span class="pre">None</span></code> になります</p>
</li>
<li><p class="first">オプションの解析後に残った固定引数からなるリスト <code class="docutils literal"><span class="pre">args</span></code></p>
</li>
</ul>
<p>このチュートリアルの節では、最も重要な四つのオプション属性: <a class="reference internal" href="#optparse.Option.action" title="optparse.Option.action"><code class="xref py py-attr docutils literal"><span class="pre">action</span></code></a>, <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a>, <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> (destination), <a class="reference internal" href="#optparse.Option.help" title="optparse.Option.help"><code class="xref py py-attr docutils literal"><span class="pre">help</span></code></a> についてしか触れません。このうち最も重要なのは <a class="reference internal" href="#optparse.Option.action" title="optparse.Option.action"><code class="xref py py-attr docutils literal"><span class="pre">action</span></code></a> です。</p>
<div class="section" id="understanding-option-actions">
<span id="optparse-understanding-option-actions"></span><h3>36.1.2.1. オプション・アクションを理解する<a class="headerlink" href="#understanding-option-actions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>アクション(action)は <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> がコマンドライン上にあるオプションを見つけたときに何をすべきかを指示します。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> には押し着せのアクションのセットがハードコードされています。新たなアクションの追加は上級者向けの話題であり、 <a class="reference internal" href="#optparse-extending-optparse"><span class="std std-ref">optparse の拡張</span></a> で触れます。ほとんどのアクションは、値を何らかの変数に記憶するよう <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> に指示します &#8212; 例えば、文字列をコマンドラインから取り出して、 <code class="docutils literal"><span class="pre">options</span></code> の属性の中に入れる、といった具合にです。</p>
<p>オプション・アクションを指定しない場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> のデフォルトの動作は <code class="docutils literal"><span class="pre">store</span></code> になります。</p>
</div>
<div class="section" id="the-store-action">
<span id="optparse-store-action"></span><h3>36.1.2.2. store アクション<a class="headerlink" href="#the-store-action" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>もっとも良く使われるアクションは <code class="docutils literal"><span class="pre">store</span></code> です。このアクションは次の引数 (あるいは現在の引数の残りの部分) を取り出し、正しい型の値か確かめ、指定した保存先に保存するよう <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> に指示します。</p>
<p>例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--file&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>例えば、以下のように指定しておき、偽のコマンドラインを作成して <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> に解析させてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;foo.txt&quot;</span><span class="p">]</span>
<span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>オプション文字列 <code class="docutils literal"><span class="pre">-f</span></code> を見つけると、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は次の引数である <code class="docutils literal"><span class="pre">foo.txt</span></code> を消費し、その値を <code class="docutils literal"><span class="pre">options.filename</span></code> に保存します。従って、この <code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> 呼び出し後には <code class="docutils literal"><span class="pre">options.filename</span></code> は <code class="docutils literal"><span class="pre">&quot;foo.txt&quot;</span></code> になっています。</p>
<p>オプションの型として、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は他にも <code class="docutils literal"><span class="pre">int</span></code> や <code class="docutils literal"><span class="pre">float</span></code> をサポートしています:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;num&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>このオプションには長い形式のオプション文字列がないため、設定に問題がないということに注意してください。また、デフォルトのアクションは <code class="docutils literal"><span class="pre">store</span></code> なので、ここでは action を明示的に指定していません。</p>
<p>架空のコマンドラインをもう一つ解析してみましょう。今度は、オプション引数をオプションの右側にぴったりくっつけて一緒くたにします: <code class="docutils literal"><span class="pre">-n42</span></code> (一つの引数のみ) は <code class="docutils literal"><span class="pre">-n</span> <span class="pre">42</span></code> (二つの引数からなる) と等価になるので</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s2">&quot;-n42&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
</pre></div>
</div>
<p>は <code class="docutils literal"><span class="pre">42</span></code> を出力します。</p>
<p>型を指定しない場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は引数を <code class="docutils literal"><span class="pre">string</span></code> であると仮定します。デフォルトのアクションが <code class="docutils literal"><span class="pre">store</span></code> であることも併せて考えると、最初の例はもっと短くなります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>保存先 (destination) を指定しない場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はデフォルト値としてオプション文字列から気のきいた名前を設定します: 最初に指定した長い形式のオプション文字列が <code class="docutils literal"><span class="pre">--foo-bar</span></code> であれば、デフォルトの保存先は <code class="docutils literal"><span class="pre">foo_bar</span></code> になります。長い形式のオプション文字列がなければ、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は最初に指定した短い形式のオプション文字列を探します: 例えば、 <code class="docutils literal"><span class="pre">-f</span></code> に対する保存先は <code class="docutils literal"><span class="pre">f</span></code> になります。</p>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> にはビルトインの <code class="docutils literal"><span class="pre">complex</span></code> 型も含まれています。型の追加については <a class="reference internal" href="#optparse-extending-optparse"><span class="std std-ref">optparse の拡張</span></a> で触れています。</p>
</div>
<div class="section" id="handling-boolean-flag-options">
<span id="optparse-handling-boolean-options"></span><h3>36.1.2.3. ブール値 (フラグ) オプションの処理<a class="headerlink" href="#handling-boolean-flag-options" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>フラグオプション&#8212;特定のオプションに対して真または偽の値の値を設定するオプション&#8212; はよく使われます。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> では、二つのアクション、 <code class="docutils literal"><span class="pre">store_true</span></code> および <code class="docutils literal"><span class="pre">store_false</span></code> をサポートしています。例えば、 <code class="docutils literal"><span class="pre">verbose</span></code> というフラグを <code class="docutils literal"><span class="pre">-v</span></code> で有効にして、 <code class="docutils literal"><span class="pre">-q</span></code> で無効にしたいとします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>ここでは二つのオプションに同じ保存先を指定していますが、全く問題ありません (下記のように、デフォルト値の設定を少し注意深く行わなければならないだけです)</p>
<p><code class="docutils literal"><span class="pre">-v</span></code> をコマンドライン上に見つけると、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は <code class="docutils literal"><span class="pre">options.verbose</span></code> を <code class="docutils literal"><span class="pre">True</span></code> に設定します。 <code class="docutils literal"><span class="pre">-q</span></code> を見つければ、 <code class="docutils literal"><span class="pre">options.verbose</span></code> は <code class="docutils literal"><span class="pre">False</span></code> にセットされます。</p>
</div>
<div class="section" id="other-actions">
<span id="optparse-other-actions"></span><h3>36.1.2.4. その他のアクション<a class="headerlink" href="#other-actions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>この他にも、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は以下のようなアクションをサポートしています:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">&quot;store_const&quot;</span></code></dt>
<dd><p class="first last">定数値を保存します</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;append&quot;</span></code></dt>
<dd><p class="first last">オプションの引数を指定のリストに追加します</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;count&quot;</span></code></dt>
<dd><p class="first last">指定のカウンタを 1 増やします</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;callback&quot;</span></code></dt>
<dd><p class="first last">指定の関数を呼び出します</p>
</dd>
</dl>
<p>これらのアクションについては、 <a class="reference internal" href="#optparse-reference-guide"><span class="std std-ref">リファレンスガイド</span></a> 節の「リファレンスガイド」および <a class="reference internal" href="#optparse-option-callbacks"><span class="std std-ref">オプション処理コールバック</span></a> 節で触れます。</p>
</div>
<div class="section" id="default-values">
<span id="optparse-default-values"></span><h3>36.1.2.5. デフォルト値<a class="headerlink" href="#default-values" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>上記の例は全て、何らかのコマンドラインオプションが見つかった時に何らかの変数 (保存先: destination) に値を設定していました。では、該当するオプションが見つからなかった場合には何が起きるのでしょうか？デフォルトは全く与えていないため、これらの値は全て <code class="docutils literal"><span class="pre">None</span></code> になります。たいていはこれで十分ですが、もっときちんと制御したい場合もあります。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> では各保存先に対してデフォルト値を指定し、コマンドラインの解析前にデフォルト値が設定されるようにできます。</p>
<p>まず、 verbose/quiet の例について考えてみましょう。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> に対して、 <code class="docutils literal"><span class="pre">-q</span></code> がない限り <code class="docutils literal"><span class="pre">verbose</span></code> を <code class="docutils literal"><span class="pre">True</span></code> に設定させたいなら、以下のようにします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>デフォルトの値は特定のオプションではなく <em>保存先</em> に対して適用されます。また、これら二つのオプションはたまたま同じ保存先を持っているにすぎないため、上のコードは下のコードと全く等価になります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>下のような場合を考えてみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>やはり <code class="docutils literal"><span class="pre">verbose</span></code> のデフォルト値は <code class="docutils literal"><span class="pre">True</span></code> になります; 特定の目的変数に対するデフォルト値として有効なのは、最後に指定した値だからです。</p>
<p>デフォルト値をすっきりと指定するには、 <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> の <code class="xref py py-meth docutils literal"><span class="pre">set_defaults()</span></code> メソッドを使います。このメソッドは <code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> を呼び出す前ならいつでも使えます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
</div>
<p>前の例と同様、あるオプションの値の保存先に対するデフォルトの値は最後に指定した値になります。コードを読みやすくするため、デフォルト値を設定するときには両方のやり方を混ぜるのではなく、片方だけを使うようにしましょう。</p>
</div>
<div class="section" id="generating-help">
<span id="optparse-generating-help"></span><h3>36.1.2.6. ヘルプの生成<a class="headerlink" href="#generating-help" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> にはヘルプと使い方の説明 (usage text) を生成する機能があり、ユーザに優しいコマンドラインインタフェースを作成する上で役立ちます。やらなければならないのは、各オプションに対する <a class="reference internal" href="#optparse.Option.help" title="optparse.Option.help"><code class="xref py py-attr docutils literal"><span class="pre">help</span></code></a> の値と、必要ならプログラム全体の使用法を説明する短いメッセージを与えることだけです。ユーザフレンドリな (ドキュメント付きの) オプションを追加した <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> を以下に示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">usage</span> <span class="o">=</span> <span class="s2">&quot;usage: %prog [options] arg1 arg2&quot;</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s2">&quot;make lots of noise [default]&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s2">&quot;be vewwy quiet (I&#39;m hunting wabbits)&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--filename&quot;</span><span class="p">,</span>
                  <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;write output to FILE&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;--mode&quot;</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="s2">&quot;intermediate&quot;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s2">&quot;interaction mode: novice, intermediate, &quot;</span>
                       <span class="s2">&quot;or expert [default: </span><span class="si">%d</span><span class="s2">efault]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> がコマンドライン上で <code class="docutils literal"><span class="pre">-h</span></code> や <code class="docutils literal"><span class="pre">--help</span></code> を見つけた場合や、 <code class="xref py py-meth docutils literal"><span class="pre">parser.print_help()</span></code> を呼び出した場合、この <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> は以下のようなメッセージを標準出力に出力します:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Usage: &lt;yourscript&gt; [options] arg1 arg2

Options:
  -h, --help            show this help message and exit
  -v, --verbose         make lots of noise [default]
  -q, --quiet           be vewwy quiet (I&#39;m hunting wabbits)
  -f FILE, --filename=FILE
                        write output to FILE
  -m MODE, --mode=MODE  interaction mode: novice, intermediate, or
                        expert [default: intermediate]
</pre></div>
</div>
<p>(help オプションでヘルプを出力した場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は出力後にプログラムを終了します。)</p>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> ができるだけうまくメッセージを生成するよう手助けするには、他にもまだまだやるべきことがあります:</p>
<ul>
<li><p class="first">スクリプト自体の利用法を表すメッセージを定義します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">usage</span> <span class="o">=</span> <span class="s2">&quot;usage: %prog [options] arg1 arg2&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は <code class="docutils literal"><span class="pre">%prog</span></code> を現在のプログラム名、すなわち <code class="docutils literal"><span class="pre">os.path.basename(sys.argv[0])</span></code> と置き換えます。この文字列は詳細なオプションヘルプの前に展開され出力されます。</p>
<p>usage の文字列を指定しない場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は型どおりとはいえ気の利いたデフォルト値、 <code class="docutils literal"><span class="pre">&quot;Usage:</span> <span class="pre">%prog</span> <span class="pre">[options]&quot;</span></code> を使います。固定引数をとらないスクリプトの場合はこれで十分でしょう。</p>
</li>
<li><p class="first">全てのオプションにヘルプ文字列を定義します。行の折り返しは気にしなくてかまいません &#8212; <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は行の折り返しに気を配り、見栄えのよいヘルプ出力を生成します。</p>
</li>
<li><p class="first">オプションが値をとるということは自動的に生成されるヘルプメッセージの中で分かります。例えば、&#8221;mode&#8221; option の場合にはこのようになります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">m</span> <span class="n">MODE</span><span class="p">,</span> <span class="o">--</span><span class="n">mode</span><span class="o">=</span><span class="n">MODE</span>
</pre></div>
</div>
<p>ここで &#8220;MODE&#8221; はメタ変数 (meta-variable) と呼ばれます: メタ変数は、ユーザが <code class="docutils literal"><span class="pre">-m</span></code>/<code class="docutils literal"><span class="pre">--mode</span></code> に対して指定するはずの引数を表します。デフォルトでは、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は保存先の変数名を大文字だけにしたものをメタ変数に使います。これは時として期待通りの結果になりません &#8212; 例えば、上の例の <code class="docutils literal"><span class="pre">--filename</span></code> オプションでは明示的に <code class="docutils literal"><span class="pre">metavar=&quot;FILE&quot;</span></code> を設定しており、その結果自動生成されたオプション説明テキストは:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">f</span> <span class="n">FILE</span><span class="p">,</span> <span class="o">--</span><span class="n">filename</span><span class="o">=</span><span class="n">FILE</span>
</pre></div>
</div>
<p>この機能の重要さは、単に表示スペースを節約するといった理由にとどまりません: 上の例では、手作業で書いたヘルプテキストの中でメタ変数として <code class="docutils literal"><span class="pre">FILE</span></code> を使っています。その結果、ユーザに対してやや堅苦しい表現の書法 <code class="docutils literal"><span class="pre">-f</span> <span class="pre">FILE</span></code> と、より平易に意味付けを説明した &#8220;write output to FILE&#8221; との間に対応があるというヒントを与えています。これは、エンドユーザにとってより明解で便利なヘルプテキストを作成する単純でありながら効果的な手法なのです。</p>
</li>
<li><p class="first">デフォルト値を持つオプションはヘルプ文字列に <code class="docutils literal"><span class="pre">%default</span></code> を含むことができます&#8212;<a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はそれをオプションのデフォルト値に <a class="reference internal" href="stdtypes.html#str" title="str"><code class="xref py py-func docutils literal"><span class="pre">str()</span></code></a> を適用したもので置き換えます。オプションがデフォルト値を持たない (もしくはデフォルト値が <code class="docutils literal"><span class="pre">None</span></code> である) 場合、 <code class="docutils literal"><span class="pre">%default</span></code> は <code class="docutils literal"><span class="pre">none</span></code> に展開されます。</p>
</li>
</ul>
<div class="section" id="grouping-options">
<h4>36.1.2.6.1. オプションをグループ化する<a class="headerlink" href="#grouping-options" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>たくさんのオプションを扱う場合、オプションをグループ分けするとヘルプ出力が見やすくなります。 <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> は、複数のオプションをまとめたオプショングループを複数持つことができます。</p>
<p>オプションのグループは、 <a class="reference internal" href="#optparse.OptionGroup" title="optparse.OptionGroup"><code class="xref py py-class docutils literal"><span class="pre">OptionGroup</span></code></a> を使って作成します:</p>
<dl class="class">
<dt id="optparse.OptionGroup">
<em class="property">class </em><code class="descclassname">optparse.</code><code class="descname">OptionGroup</code><span class="sig-paren">(</span><em>parser</em>, <em>title</em>, <em>description=None</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionGroup" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>ここでは:</p>
<ul class="simple">
<li><p class="first"><em>parser</em> は、このグループが属する <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> のインスタンスです</p>
</li>
<li><p class="first"><em>title</em> はグループのタイトルです</p>
</li>
<li><p class="first"><em>description</em> はオプションで、グループの長い説明です</p>
</li>
</ul>
</dd></dl>

<p><a class="reference internal" href="#optparse.OptionGroup" title="optparse.OptionGroup"><code class="xref py py-class docutils literal"><span class="pre">OptionGroup</span></code></a> は (<a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> のように) <code class="xref py py-class docutils literal"><span class="pre">OptionContainer</span></code> を継承していて、オプションをグループに追加するために <code class="xref py py-meth docutils literal"><span class="pre">add_option()</span></code> メソッドを利用できます。</p>
<p>全てのオプションを定義したら、 <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> の <code class="xref py py-meth docutils literal"><span class="pre">add_option_group()</span></code> メソッドを使ってグループを定義済みのパーサーに追加します。</p>
<p>前のセクションで定義したパーサーに、続けて <a class="reference internal" href="#optparse.OptionGroup" title="optparse.OptionGroup"><code class="xref py py-class docutils literal"><span class="pre">OptionGroup</span></code></a> を追加します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;Dangerous Options&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Caution: use these options at your own risk.  &quot;</span>
                    <span class="s2">&quot;It is believed that some of them bite.&quot;</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-g&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Group option.&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</pre></div>
</div>
<p>この結果のヘルプ出力は次のようになります:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Usage: &lt;yourscript&gt; [options] arg1 arg2

Options:
  -h, --help            show this help message and exit
  -v, --verbose         make lots of noise [default]
  -q, --quiet           be vewwy quiet (I&#39;m hunting wabbits)
  -f FILE, --filename=FILE
                        write output to FILE
  -m MODE, --mode=MODE  interaction mode: novice, intermediate, or
                        expert [default: intermediate]

  Dangerous Options:
    Caution: use these options at your own risk.  It is believed that some
    of them bite.

    -g                  Group option.
</pre></div>
</div>
<p>さらにサンプルを拡張して、複数のグループを使うようにしてみます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;Dangerous Options&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Caution: use these options at your own risk.  &quot;</span>
                    <span class="s2">&quot;It is believed that some of them bite.&quot;</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-g&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Group option.&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

<span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;Debug Options&quot;</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print debug information&quot;</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--sql&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print all SQL statements executed&quot;</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print every action done&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</pre></div>
</div>
<p>出力結果は次のようになります:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Usage: &lt;yourscript&gt; [options] arg1 arg2

Options:
  -h, --help            show this help message and exit
  -v, --verbose         make lots of noise [default]
  -q, --quiet           be vewwy quiet (I&#39;m hunting wabbits)
  -f FILE, --filename=FILE
                        write output to FILE
  -m MODE, --mode=MODE  interaction mode: novice, intermediate, or expert
                        [default: intermediate]

  Dangerous Options:
    Caution: use these options at your own risk.  It is believed that some
    of them bite.

    -g                  Group option.

  Debug Options:
    -d, --debug         Print debug information
    -s, --sql           Print all SQL statements executed
    -e                  Print every action done
</pre></div>
</div>
<p>もう1つの、特にオプショングループをプログラムから操作するときに利用できるメソッドがあります:</p>
<dl class="method">
<dt id="optparse.OptionParser.get_option_group">
<code class="descclassname">OptionParser.</code><code class="descname">get_option_group</code><span class="sig-paren">(</span><em>opt_str</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.get_option_group" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>短いオプション文字列もしくは長いオプション文字列 <em>opt_str</em> (例。 <code class="docutils literal"><span class="pre">'-o'</span></code> 、 <code class="docutils literal"><span class="pre">'--option'</span></code>) が属する <a class="reference internal" href="#optparse.OptionGroup" title="optparse.OptionGroup"><code class="xref py py-class docutils literal"><span class="pre">OptionGroup</span></code></a> を返します。そのような <a class="reference internal" href="#optparse.OptionGroup" title="optparse.OptionGroup"><code class="xref py py-class docutils literal"><span class="pre">OptionGroup</span></code></a> が無い場合は、 <code class="docutils literal"><span class="pre">None</span></code> を返します。</p>
</dd></dl>

</div>
</div>
<div class="section" id="printing-a-version-string">
<span id="optparse-printing-version-string"></span><h3>36.1.2.7. バージョン番号の出力<a class="headerlink" href="#printing-a-version-string" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> では、使用法メッセージと同様にプログラムのバージョン文字列を出力できます。 <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> の <code class="docutils literal"><span class="pre">version</span></code> 引数に文字列を渡します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s2">&quot;%prog [-f] [-q]&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;%prog 1.0&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">%prog</span></code> は <code class="docutils literal"><span class="pre">usage</span></code> と同じような展開を受けます。その他にも <code class="docutils literal"><span class="pre">version</span></code> には何でも好きな内容を入れられます。 <code class="docutils literal"><span class="pre">version</span></code> を指定した場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は自動的に <code class="docutils literal"><span class="pre">--version</span></code> オプションをパーザに渡します。コマンドライン中に <code class="docutils literal"><span class="pre">--version</span></code> が見つかると、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は <code class="docutils literal"><span class="pre">version</span></code> 文字列を展開して (<code class="docutils literal"><span class="pre">%prog</span></code> を置き換えて) 標準出力に出力し、プログラムを終了します。</p>
<p>例えば、<code class="docutils literal"><span class="pre">/usr/bin/foo</span></code> という名前のスクリプトなら:</p>
<div class="highlight-shell-session"><div class="highlight"><pre><span></span><span class="gp">$</span> /usr/bin/foo --version
<span class="go">foo 1.0</span>
</pre></div>
</div>
<p>以下の2つのメソッドを、<code class="docutils literal"><span class="pre">version</span></code> 文字列を表示するために利用できます:</p>
<dl class="method">
<dt id="optparse.OptionParser.print_version">
<code class="descclassname">OptionParser.</code><code class="descname">print_version</code><span class="sig-paren">(</span><em>file=None</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.print_version" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>現在のプログラムのバージョン (<code class="docutils literal"><span class="pre">self.version</span></code>) を <em>file</em> (デフォルト: stdout) へ表示します。 <a class="reference internal" href="#optparse.OptionParser.print_usage" title="optparse.OptionParser.print_usage"><code class="xref py py-meth docutils literal"><span class="pre">print_usage()</span></code></a> と同じく、 <code class="docutils literal"><span class="pre">self.version</span></code> の中の全ての <code class="docutils literal"><span class="pre">%prog</span></code> が現在のプログラム名に置き換えられます。 <code class="docutils literal"><span class="pre">self.version</span></code> が空文字列だだったり未定義だったときは何もしません。</p>
</dd></dl>

<dl class="method">
<dt id="optparse.OptionParser.get_version">
<code class="descclassname">OptionParser.</code><code class="descname">get_version</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.get_version" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#optparse.OptionParser.print_version" title="optparse.OptionParser.print_version"><code class="xref py py-meth docutils literal"><span class="pre">print_version()</span></code></a> と同じですが、バージョン文字列を表示する代わりに返します。</p>
</dd></dl>

</div>
<div class="section" id="how-optparse-handles-errors">
<span id="optparse-how-optparse-handles-errors"></span><h3>36.1.2.8. <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> のエラー処理法<a class="headerlink" href="#how-optparse-handles-errors" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> を使う場合に気を付けなければならないエラーには、大きく分けてプログラマ側のエラーとユーザ側のエラーという二つの種類があります。プログラマ側のエラーの多くは、例えば不正なオプション文字列や定義されていないオプション属性の指定、あるいはオプション属性を指定し忘れるといった、誤った <a class="reference internal" href="#optparse.OptionParser.add_option" title="optparse.OptionParser.add_option"><code class="xref py py-func docutils literal"><span class="pre">OptionParser.add_option()</span></code></a>, 呼び出しによるものです。こうした誤りは通常通りに処理されます。すなわち、例外(<code class="xref py py-exc docutils literal"><span class="pre">optparse.OptionError</span></code> や <a class="reference internal" href="exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal"><span class="pre">TypeError</span></code></a>) を送出して、プログラムをクラッシュさせます。</p>
<p>もっと重要なのはユーザ側のエラーの処理です。というのも、ユーザの操作エラーというものはコードの安定性に関係なく起こるからです。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は、誤ったオプション引数の指定 (整数を引数にとるオプション <code class="docutils literal"><span class="pre">-n</span></code> に対して <code class="docutils literal"><span class="pre">-n</span> <span class="pre">4x</span></code> と指定してしまうなど) や、引数を指定し忘れた場合 (<code class="docutils literal"><span class="pre">-n</span></code> が何らかの引数をとるオプションであるのに、 <code class="docutils literal"><span class="pre">-n</span></code> が引数の末尾に来ている場合) といった、ユーザによるエラーを自動的に検出します。また、アプリケーション側で定義されたエラー条件が起きた場合、 <code class="xref py py-func docutils literal"><span class="pre">OptionParser.error()</span></code> を呼び出してエラーを通知できます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="o">...</span>
<span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">a</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">b</span><span class="p">:</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;options -a and -b are mutually exclusive&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>いずれの場合にも <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はエラーを同じやり方で処理します。すなわち、プログラムの使用法メッセージとエラーメッセージを標準エラー出力に出力して、終了ステータス 2 でプログラムを終了させます。</p>
<p>上に挙げた最初の例、すなわち整数を引数にとるオプションにユーザが <code class="docutils literal"><span class="pre">4x</span></code> を指定した場合を考えてみましょう:</p>
<div class="highlight-shell-session"><div class="highlight"><pre><span></span><span class="gp">$</span> /usr/bin/foo -n 4x
<span class="go">Usage: foo [options]</span>

<span class="go">foo: error: option -n: invalid integer value: &#39;4x&#39;</span>
</pre></div>
</div>
<p>値を全く指定しない場合には、以下のようになります:</p>
<div class="highlight-shell-session"><div class="highlight"><pre><span></span><span class="gp">$</span> /usr/bin/foo -n
<span class="go">Usage: foo [options]</span>

<span class="go">foo: error: -n option requires an argument</span>
</pre></div>
</div>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は、常にエラーを引き起こしたオプションについて説明の入ったエラーメッセージを生成するよう気を配ります; 従って、 <code class="xref py py-func docutils literal"><span class="pre">OptionParser.error()</span></code> をアプリケーションコードから呼び出す場合にも、同じようなメッセージになるようにしてください。</p>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> のデフォルトのエラー処理動作が気に入らないのなら、 <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> をサブクラス化して、 <code class="xref py py-meth docutils literal"><span class="pre">exit()</span></code> かつ/または <code class="xref py py-meth docutils literal"><span class="pre">error()</span></code> をオーバライドする必要があります。</p>
</div>
<div class="section" id="putting-it-all-together">
<span id="optparse-putting-it-all-together"></span><h3>36.1.2.9. 全てをつなぎ合わせる<a class="headerlink" href="#putting-it-all-together" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> を使ったスクリプトは、通常以下のようになります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="n">OptionParser</span>
<span class="o">...</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="s2">&quot;usage: %prog [options] arg&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;read data from FILENAME&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;incorrect number of arguments&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reading </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
    <span class="o">...</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reference-guide">
<span id="optparse-reference-guide"></span><h2>36.1.3. リファレンスガイド<a class="headerlink" href="#reference-guide" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="creating-the-parser">
<span id="optparse-creating-parser"></span><h3>36.1.3.1. parserを作る<a class="headerlink" href="#creating-the-parser" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> を使う最初の一歩は OptionParser インスタンスを作ることです。</p>
<dl class="class">
<dt id="optparse.OptionParser">
<em class="property">class </em><code class="descclassname">optparse.</code><code class="descname">OptionParser</code><span class="sig-paren">(</span><em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>OptionParser のコンストラクタの引数はどれも必須ではありませんが、いくつものキーワード引数がオプションとして使えます。これらはキーワード引数として渡さなければなりません。すなわち、引数が宣言されている順番に頼ってはいけません。</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">usage</span></code> (デフォルト: <code class="docutils literal"><span class="pre">&quot;%prog</span> <span class="pre">[options]&quot;</span></code>)</dt>
<dd><p class="first last">プログラムが間違った方法で実行されるかまたはヘルプオプションを付けて実行された場合に表示される使用法です。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は使用法の文字列を表示する際に <code class="docutils literal"><span class="pre">%prog</span></code> を <code class="docutils literal"><span class="pre">os.path.basename(sys.argv[0])</span></code> (または <code class="docutils literal"><span class="pre">prog</span></code> キーワード引数が指定されていればその値) に展開します。使用法メッセージを抑制するためには特別な <code class="xref py py-data docutils literal"><span class="pre">optparse.SUPPRESS_USAGE</span></code> という値を指定します。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">option_list</span></code> (デフォルト: <code class="docutils literal"><span class="pre">[]</span></code>)</dt>
<dd><p class="first last">パーザに追加する Option オブジェクトのリストです。 <code class="docutils literal"><span class="pre">option_list</span></code> の中のオプションは <code class="docutils literal"><span class="pre">standard_option_list</span></code> (OptionParser のサブクラスでセットされる可能性のあるクラス属性) の後に追加されますが、バージョンやヘルプのオプションよりは前になります。このオプションの使用は推奨されません。パーザを作成した後で、 <a class="reference internal" href="#optparse.OptionParser.add_option" title="optparse.OptionParser.add_option"><code class="xref py py-meth docutils literal"><span class="pre">add_option()</span></code></a> を使って追加してください。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">option_class</span></code> (デフォルト: optparse.Option)</dt>
<dd><p class="first last"><a class="reference internal" href="#optparse.OptionParser.add_option" title="optparse.OptionParser.add_option"><code class="xref py py-meth docutils literal"><span class="pre">add_option()</span></code></a> でパーザにオプションを追加するときに使用されるクラス。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">version</span></code> (デフォルト: <code class="docutils literal"><span class="pre">None</span></code>)</dt>
<dd><p class="first last">ユーザがバージョンオプションを与えたときに表示されるバージョン文字列です。 <code class="docutils literal"><span class="pre">version</span></code> に真の値を与えると、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は自動的に単独のオプション文字列 <code class="docutils literal"><span class="pre">--version</span></code> とともにバージョンオプションを追加します。部分文字列 <code class="docutils literal"><span class="pre">%prog</span></code> は <code class="docutils literal"><span class="pre">usage</span></code> と同様に展開されます。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">conflict_handler</span></code> (デフォルト: <code class="docutils literal"><span class="pre">&quot;error&quot;</span></code>)</dt>
<dd><p class="first last">オプション文字列が衝突するようなオプションがパーザに追加されたときにどうするかを指定します。 <a class="reference internal" href="#optparse-conflicts-between-options"><span class="std std-ref">オプション間の衝突</span></a> 節を参照して下さい。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">description</span></code> (デフォルト: <code class="docutils literal"><span class="pre">None</span></code>)</dt>
<dd><p class="first last">プログラムの概要を表す一段落のテキストです。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はユーザがヘルプを要求したときにこの概要を現在のターミナルの幅に合わせて整形し直して表示します (<code class="docutils literal"><span class="pre">usage</span></code> の後、オプションリストの前に表示されます)。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">formatter</span></code> (デフォルト: 新しい <code class="xref py py-class docutils literal"><span class="pre">IndentedHelpFormatter</span></code>)</dt>
<dd><p class="first last">ヘルプテキストを表示する際に使われる optparse.HelpFormatter のインスタンスです。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はこの目的のためにすぐ使えるクラスを二つ提供しています。 IndentedHelpFormatter と TitledHelpFormatter がそれです。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">add_help_option</span></code> (デフォルト: <code class="docutils literal"><span class="pre">True</span></code>)</dt>
<dd><p class="first last">もし真ならば、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はパーザにヘルプオプションを (オプション文字列 <code class="docutils literal"><span class="pre">-h</span></code> と <code class="docutils literal"><span class="pre">--help</span></code> とともに)追加します。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">prog</span></code></dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">usage</span></code> や <code class="docutils literal"><span class="pre">version</span></code> の中の <code class="docutils literal"><span class="pre">%prog</span></code> を展開するときに <code class="docutils literal"><span class="pre">os.path.basename(sys.argv[0])</span></code> の代わりに使われる文字列です。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">epilog</span></code> (デフォルト: <code class="docutils literal"><span class="pre">None</span></code>)</dt>
<dd><p class="first last">オプションのヘルプの後に表示されるヘルプテキスト.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="populating-the-parser">
<span id="optparse-populating-parser"></span><h3>36.1.3.2. パーザへのオプション追加<a class="headerlink" href="#populating-the-parser" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>パーザにオプションを加えていくにはいくつか方法があります。推奨するのは <a class="reference internal" href="#optparse-tutorial"><span class="std std-ref">チュートリアル</span></a> 節で示したような <a class="reference internal" href="#optparse.OptionParser.add_option" title="optparse.OptionParser.add_option"><code class="xref py py-meth docutils literal"><span class="pre">OptionParser.add_option()</span></code></a> を使う方法です。 <code class="xref py py-meth docutils literal"><span class="pre">add_option()</span></code> は以下の二つのうちいずれかの方法で呼び出せます:</p>
<ul class="simple">
<li><p class="first">(<code class="xref py py-func docutils literal"><span class="pre">make_option()</span></code> などが返す) <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> インスタンスを渡します</p>
</li>
<li><p class="first"><code class="xref py py-func docutils literal"><span class="pre">make_option()</span></code> に (すなわち <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> のコンストラクタに) 固定引数とキーワード引数の組み合わせを渡して、 <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> インスタンスを生成させます</p>
</li>
</ul>
<p>もう一つの方法は、あらかじめ作成しておいた <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> インスタンスからなるリストを、以下のようにして <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> のコンストラクタに渡すというものです:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">option_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">make_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--filename&quot;</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span><span class="p">),</span>
    <span class="n">make_option</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">option_list</span><span class="o">=</span><span class="n">option_list</span><span class="p">)</span>
</pre></div>
</div>
<p>(<code class="xref py py-func docutils literal"><span class="pre">make_option()</span></code> は <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> インスタンスを生成するファクトリ関数です; 現在のところ、この関数は <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> のコンストラクタの別名にすぎません。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の将来のバージョンでは、 <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> を複数のクラスに分割し、 <code class="xref py py-func docutils literal"><span class="pre">make_option()</span></code> は適切なクラスを選んでインスタンスを生成するようになる予定です。従って、 <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> を直接インスタンス化しないでください。)</p>
</div>
<div class="section" id="defining-options">
<span id="optparse-defining-options"></span><h3>36.1.3.3. オプションの定義<a class="headerlink" href="#defining-options" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>各々の <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> インスタンス、は <code class="docutils literal"><span class="pre">-f</span></code> や <code class="docutils literal"><span class="pre">--file</span></code> といった同義のコマンドラインオプションからなる集合を表現しています。一つの <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> には任意の数のオプションを短い形式でも長い形式でも指定できます。ただし、少なくとも一つは指定しなければなりません。</p>
<p>正しい方法で <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> インスタンスを生成するには、 <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> の <code class="xref py py-meth docutils literal"><span class="pre">add_option()</span></code> を使います。</p>
<dl class="method">
<dt id="optparse.OptionParser.add_option">
<code class="descclassname">OptionParser.</code><code class="descname">add_option</code><span class="sig-paren">(</span><em>option</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.add_option" title="この定義へのパーマリンク">¶</a></dt>
<dt>
<code class="descclassname">OptionParser.</code><code class="descname">add_option</code><span class="sig-paren">(</span><em>*opt_str</em>, <em>attr=value</em>, <em>...</em><span class="sig-paren">)</span></dt>
<dd><p>短い形式のオプション文字列を一つだけ持つようなオプションを生成するには次のようにします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>また、長い形式のオプション文字列を一つだけ持つようなオプションの定義は次のようになります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--foo&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>キーワード引数は新しい <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> オブジェクトの属性を定義します。オプションの属性のうちでもっとも重要なのは <a class="reference internal" href="#optparse.Option.action" title="optparse.Option.action"><code class="xref py py-attr docutils literal"><span class="pre">action</span></code></a> です。この属性は、他のどの属性と関連があるか、そしてどの属性が必要かに大きく作用します。関係のないオプション属性を指定したり、必要な属性を指定し忘れたりすると、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は誤りを解説した <code class="xref py py-exc docutils literal"><span class="pre">OptionError</span></code> 例外を送出します。</p>
<p>コマンドライン上にあるオプションが見つかったときの <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の振舞いを決定しているのは <em>アクション(action)</em> です。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> でハードコードされている標準的なアクションには以下のようなものがあります:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">&quot;store&quot;</span></code></dt>
<dd><p class="first last">オプションの引数を保存します (デフォルトの動作です)</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;store_const&quot;</span></code></dt>
<dd><p class="first last">定数値を保存します</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;store_true&quot;</span></code></dt>
<dd><p class="first last">真 (<a class="reference internal" href="constants.html#True" title="True"><code class="xref py py-const docutils literal"><span class="pre">True</span></code></a>) を保存します</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;store_false&quot;</span></code></dt>
<dd><p class="first last">偽 (<a class="reference internal" href="constants.html#False" title="False"><code class="xref py py-const docutils literal"><span class="pre">False</span></code></a>) を保存します</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;append&quot;</span></code></dt>
<dd><p class="first last">オプションの引数を指定のリストに追加します</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;append_const&quot;</span></code></dt>
<dd><p class="first last">オプションの引数をリストに追加します</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;count&quot;</span></code></dt>
<dd><p class="first last">指定のカウンタを 1 増やします</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;callback&quot;</span></code></dt>
<dd><p class="first last">指定の関数を呼び出します</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;help&quot;</span></code></dt>
<dd><p class="first last">全てのオプションとそのドキュメントの入った使用法メッセージを出力します</p>
</dd>
</dl>
<p>(アクションを指定しない場合、デフォルトは <code class="docutils literal"><span class="pre">&quot;store&quot;</span></code> になります。このアクションでは、 <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> および <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> オプション属性を指定できます。 <a class="reference internal" href="#optparse-standard-option-actions"><span class="std std-ref">標準的なオプション・アクション</span></a> を参照してください。)</p>
</dd></dl>

<p>すでにお分かりのように、ほとんどのアクションはどこかに値を保存したり、値を更新したりします。この目的のために、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は常に特別なオブジェクトを作り出し、それは通常 <code class="docutils literal"><span class="pre">options</span></code> と呼ばれます (<code class="xref py py-class docutils literal"><span class="pre">optparse.Values</span></code> のインスタンスになっています)。オプションの引数 (や、その他の様々な値) は、 <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> (保存先:  destination) オプション属性に従って、 <em>options</em> の属性として保存されます。</p>
<p>例えばこれを呼び出した場合</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
</div>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はまず <code class="docutils literal"><span class="pre">options</span></code> オブジェクトを生成します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="n">Values</span><span class="p">()</span>
</pre></div>
</div>
<p>パーザ中で以下のようなオプションが定義されていて</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--file&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>パーズしたコマンドラインに以下のいずれかが入っていた場合:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">ffoo</span>
<span class="o">-</span><span class="n">f</span> <span class="n">foo</span>
<span class="o">--</span><span class="n">file</span><span class="o">=</span><span class="n">foo</span>
<span class="o">--</span><span class="n">file</span> <span class="n">foo</span>
</pre></div>
</div>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はこのオプションを見つけて、以下と同等の処理を行います</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> および <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> オプション属性は <a class="reference internal" href="#optparse.Option.action" title="optparse.Option.action"><code class="xref py py-attr docutils literal"><span class="pre">action</span></code></a> と同じくらい重要ですが、 <em>全ての</em> オプションで意味をなすのは <a class="reference internal" href="#optparse.Option.action" title="optparse.Option.action"><code class="xref py py-attr docutils literal"><span class="pre">action</span></code></a> だけなのです。</p>
</div>
<div class="section" id="option-attributes">
<span id="optparse-option-attributes"></span><h3>36.1.3.4. オプション属性<a class="headerlink" href="#option-attributes" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>以下のオプション属性は <a class="reference internal" href="#optparse.OptionParser.add_option" title="optparse.OptionParser.add_option"><code class="xref py py-meth docutils literal"><span class="pre">OptionParser.add_option()</span></code></a> へのキーワード引数として渡すことができます。特定のオプションに無関係なオプション属性を渡した場合、または必須のオプションを渡しそこなった場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は <code class="xref py py-exc docutils literal"><span class="pre">OptionError</span></code> を送出します。</p>
<dl class="attribute">
<dt id="optparse.Option.action">
<code class="descclassname">Option.</code><code class="descname">action</code><a class="headerlink" href="#optparse.Option.action" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>(デフォルト: <code class="docutils literal"><span class="pre">&quot;store&quot;</span></code>)</p>
<p>このオプションがコマンドラインにあった場合に <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> に何をさせるかを決めます。取りうるオプションについては <a class="reference internal" href="#optparse-standard-option-actions"><span class="std std-ref">こちら</span></a> を参照してください。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.type">
<code class="descclassname">Option.</code><code class="descname">type</code><a class="headerlink" href="#optparse.Option.type" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>(デフォルト: <code class="docutils literal"><span class="pre">&quot;string&quot;</span></code>)</p>
<p>このオプションに与えられる引数の型 (たとえば <code class="docutils literal"><span class="pre">&quot;string&quot;</span></code> や <code class="docutils literal"><span class="pre">&quot;int&quot;</span></code>) です。取りうるオプションについては <a class="reference internal" href="#optparse-standard-option-types"><span class="std std-ref">こちら</span></a> を参照してください。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.dest">
<code class="descclassname">Option.</code><code class="descname">dest</code><a class="headerlink" href="#optparse.Option.dest" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>(デフォルト: オプション文字列を使う)</p>
<p>このオプションのアクションがある値をどこかに書いたり書き換えたりを意味する場合、これは <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> にその書く場所を教えます。詳しく言えば <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> には <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> がコマンドラインを解析しながら組み立てる <code class="docutils literal"><span class="pre">options</span></code> オブジェクトの属性の名前を指定します。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.default">
<code class="descclassname">Option.</code><code class="descname">default</code><a class="headerlink" href="#optparse.Option.default" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>コマンドラインに指定がなかったときにこのオプションの対象に使われる値です。 <a class="reference internal" href="#optparse.OptionParser.set_defaults" title="optparse.OptionParser.set_defaults"><code class="xref py py-meth docutils literal"><span class="pre">OptionParser.set_defaults()</span></code></a> も参照してください。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.nargs">
<code class="descclassname">Option.</code><code class="descname">nargs</code><a class="headerlink" href="#optparse.Option.nargs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>(デフォルト: 1)</p>
<p>このオプションがあったときに幾つの <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> 型の引数が消費されるべきかを指定します。 1 より大きい場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> に値のタプルを格納します。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.const">
<code class="descclassname">Option.</code><code class="descname">const</code><a class="headerlink" href="#optparse.Option.const" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>定数を格納する動作のための、その定数です。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.choices">
<code class="descclassname">Option.</code><code class="descname">choices</code><a class="headerlink" href="#optparse.Option.choices" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">&quot;choice&quot;</span></code> 型オプションに対してユーザが選べる選択肢となる文字列のリストです。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.callback">
<code class="descclassname">Option.</code><code class="descname">callback</code><a class="headerlink" href="#optparse.Option.callback" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>アクションが <code class="docutils literal"><span class="pre">&quot;callback&quot;</span></code> であるオプションに対し、このオプションがあったときに呼ばれる呼び出し可能オブジェクトです。呼び出し時に渡される引数の詳細については、 <a class="reference internal" href="#optparse-option-callbacks"><span class="std std-ref">オプション処理コールバック</span></a> を参照してください。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.callback_args">
<code class="descclassname">Option.</code><code class="descname">callback_args</code><a class="headerlink" href="#optparse.Option.callback_args" title="この定義へのパーマリンク">¶</a></dt>
<dt id="optparse.Option.callback_kwargs">
<code class="descclassname">Option.</code><code class="descname">callback_kwargs</code><a class="headerlink" href="#optparse.Option.callback_kwargs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">callback</span></code> に渡される標準的な4つのコールバック引数の後ろに追加する、位置指定引数とキーワード引数。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.help">
<code class="descclassname">Option.</code><code class="descname">help</code><a class="headerlink" href="#optparse.Option.help" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>ユーザが <a class="reference internal" href="#optparse.Option.help" title="optparse.Option.help"><code class="xref py py-attr docutils literal"><span class="pre">help</span></code></a> オプション(<code class="docutils literal"><span class="pre">--help</span></code> のような)を指定したときに表示される、使用可能な全オプションのリストの中のこのオプションに関する説明文です。説明文を提供しておかなければ、オプションは説明文なしで表示されます。オプションを隠すには特殊な値 <code class="xref py py-data docutils literal"><span class="pre">optparse.SUPPRESS_HELP</span></code> を使います。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.metavar">
<code class="descclassname">Option.</code><code class="descname">metavar</code><a class="headerlink" href="#optparse.Option.metavar" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>(デフォルト: オプション文字列を使う)</p>
<p>説明文を表示する際にオプションの引数の身代わりになるものです。例は <a class="reference internal" href="#optparse-tutorial"><span class="std std-ref">チュートリアル</span></a> 節を参照してください。</p>
</dd></dl>

</div>
<div class="section" id="standard-option-actions">
<span id="optparse-standard-option-actions"></span><h3>36.1.3.5. 標準的なオプション・アクション<a class="headerlink" href="#standard-option-actions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>様々なオプション・アクションにはどれも互いに少しづつ異なった条件と作用があります。ほとんどのアクションに関連するオプション属性がいくつかあり、値を指定して <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の挙動を操作できます。いくつかのアクションには必須の属性があり、必ず値を指定しなければなりません。</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;store&quot;</span></code> [関連: <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a>, <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a>, <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a>, <a class="reference internal" href="#optparse.Option.choices" title="optparse.Option.choices"><code class="xref py py-attr docutils literal"><span class="pre">choices</span></code></a>]</p>
<p>オプションの後には必ず引数が続きます。引数は <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> に従って値に変換されて <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> に保存されます。 <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a> &gt; 1 の場合、複数の引数をコマンドラインから取り出します。引数は全て <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> に従って変換され、 <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> にタプルとして保存されます。 <a class="reference internal" href="#optparse-standard-option-types"><span class="std std-ref">標準のオプション型</span></a> 節を参照してください。</p>
<p><a class="reference internal" href="#optparse.Option.choices" title="optparse.Option.choices"><code class="xref py py-attr docutils literal"><span class="pre">choices</span></code></a> を(文字列のリストかタプルで) 指定した場合、型のデフォルト値は <code class="docutils literal"><span class="pre">&quot;choice&quot;</span></code> になります。</p>
<p><a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> を指定しない場合、デフォルトの値は <code class="docutils literal"><span class="pre">&quot;string&quot;</span></code> です。</p>
<p><a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> を指定しない場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は保存先を最初の長い形式のオプション文字列から導出します (例えば、 <code class="docutils literal"><span class="pre">--foo-bar</span></code> は <code class="docutils literal"><span class="pre">foo_bar</span></code> になります)。長い形式のオプション文字列がない場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は最初の短い形式のオプションから保存先の変数名を導出します (<code class="docutils literal"><span class="pre">-f</span></code> は <code class="docutils literal"><span class="pre">f</span></code> になります)。</p>
<p>以下はプログラム例です:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>とすると、以下のようなコマンドライン</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">f</span> <span class="n">foo</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1</span> <span class="o">-</span><span class="mf">3.5</span> <span class="mi">4</span> <span class="o">-</span><span class="n">fbar</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>を解析した場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は以下のように設定を行います</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;foo.txt&quot;</span>
<span class="n">options</span><span class="o">.</span><span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
<span class="n">options</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;bar.txt&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;store_const&quot;</span></code> [関連: <a class="reference internal" href="#optparse.Option.const" title="optparse.Option.const"><code class="xref py py-attr docutils literal"><span class="pre">const</span></code></a>; 関連: <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a>]</p>
<p>値 <a class="reference internal" href="#optparse.Option.const" title="optparse.Option.const"><code class="xref py py-attr docutils literal"><span class="pre">const</span></code></a> を <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> に保存します。</p>
<p>以下はプログラム例です:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--noisy&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>とします。 <code class="docutils literal"><span class="pre">--noisy</span></code> が見つかると、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;store_true&quot;</span></code> [関連: <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a>]</p>
<p><code class="docutils literal"><span class="pre">&quot;store_const&quot;</span></code> の特殊なケースで、真 (True) を <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> に保存します。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;store_false&quot;</span></code> [関連: <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a>]</p>
<p><code class="docutils literal"><span class="pre">&quot;store_true&quot;</span></code> と似ていて、偽 (False) を保存します。</p>
<p>以下はプログラム例です:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--clobber&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;clobber&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--no-clobber&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;clobber&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;append&quot;</span></code> [関連: <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a>, <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a>, <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a>, <a class="reference internal" href="#optparse.Option.choices" title="optparse.Option.choices"><code class="xref py py-attr docutils literal"><span class="pre">choices</span></code></a>]</p>
<p>このオプションの後ろには必ず引数が続きます。引数は <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> のリストに追加されます。 <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> のデフォルト値を指定しなかった場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> がこのオプションを最初にみつけた時点で空のリストを自動的に生成します。 <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a> &gt; 1 の場合、複数の引数をコマンドラインから取り出し、長さ <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a> のタプルを生成して <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> に追加します。</p>
<p><a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> および <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> のデフォルト値は <code class="docutils literal"><span class="pre">&quot;store&quot;</span></code> アクションと同じです。</p>
<p>以下はプログラム例です:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;--tracks&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">-t3</span></code> がコマンドライン上で見つかると、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">tracks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">options</span><span class="o">.</span><span class="n">tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>その後、<code class="docutils literal"><span class="pre">--tracks=4</span></code> が見つかると以下を実行します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">append</span></code> アクションは、オプションの現在の値の <code class="docutils literal"><span class="pre">append</span></code> メソッドを呼び出します。これは、どのデフォルト値も <code class="docutils literal"><span class="pre">append</span></code> メソッドを持っていなければならないことを意味します。また、デフォルト値が空でない場合、オプションの解析結果は、そのデフォルトの要素の後ろにコマンドラインからの値が追加されたものになる、ということも意味します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--files&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;~/.mypkg/defaults&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s1">&#39;--files&#39;</span><span class="p">,</span> <span class="s1">&#39;overrides.mypkg&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">opts</span><span class="o">.</span><span class="n">files</span>
<span class="go">[&#39;~/.mypkg/defaults&#39;, &#39;overrides.mypkg&#39;]</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;append_const&quot;</span></code> [関連: <a class="reference internal" href="#optparse.Option.const" title="optparse.Option.const"><code class="xref py py-attr docutils literal"><span class="pre">const</span></code></a>; 関連: <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a>]</p>
<p><code class="docutils literal"><span class="pre">&quot;store_const&quot;</span></code> と同様ですが、 <a class="reference internal" href="#optparse.Option.const" title="optparse.Option.const"><code class="xref py py-attr docutils literal"><span class="pre">const</span></code></a> の値は <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> に追加(append)されます。 <code class="docutils literal"><span class="pre">&quot;append&quot;</span></code> の場合と同じように <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> のデフォルトは <code class="docutils literal"><span class="pre">None</span></code> ですがこのオプションを最初にみつけた時点で空のリストを自動的に生成します。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;count&quot;</span></code> [関連: <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a>]</p>
<p><a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> に保存されている整数値をインクリメントします。 <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> は (デフォルトの値を指定しない限り) 最初にインクリメントを行う前にゼロに設定されます。</p>
<p>以下はプログラム例です:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbosity&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>コマンドライン上で最初に <code class="docutils literal"><span class="pre">-v</span></code> が見つかると、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">options</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>以後、<code class="docutils literal"><span class="pre">-v</span></code> が見つかるたびに</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">options</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;callback&quot;</span></code> [必須: <a class="reference internal" href="#optparse.Option.callback" title="optparse.Option.callback"><code class="xref py py-attr docutils literal"><span class="pre">callback</span></code></a>; 関連: <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a>, <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a>, <a class="reference internal" href="#optparse.Option.callback_args" title="optparse.Option.callback_args"><code class="xref py py-attr docutils literal"><span class="pre">callback_args</span></code></a>, <a class="reference internal" href="#optparse.Option.callback_kwargs" title="optparse.Option.callback_kwargs"><code class="xref py py-attr docutils literal"><span class="pre">callback_kwargs</span></code></a>]</p>
<p><a class="reference internal" href="#optparse.Option.callback" title="optparse.Option.callback"><code class="xref py py-attr docutils literal"><span class="pre">callback</span></code></a> に指定された関数を次のように呼び出します</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">func</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>詳細は、 <a class="reference internal" href="#optparse-option-callbacks"><span class="std std-ref">オプション処理コールバック</span></a> 節を参照してください。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;help&quot;</span></code></p>
<p>現在のオプションパーザ内の全てのオプションに対する完全なヘルプメッセージを出力します。ヘルプメッセージは <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> のコンストラクタに渡した <code class="docutils literal"><span class="pre">usage</span></code>  文字列と、各オプションに渡した <a class="reference internal" href="#optparse.Option.help" title="optparse.Option.help"><code class="xref py py-attr docutils literal"><span class="pre">help</span></code></a> 文字列から生成します。</p>
<p>オプションに <a class="reference internal" href="#optparse.Option.help" title="optparse.Option.help"><code class="xref py py-attr docutils literal"><span class="pre">help</span></code></a> 文字列が指定されていなくても、オプションはヘルプメッセージ中に列挙されます。オプションを完全に表示させないようにするには、特殊な値 <code class="xref py py-data docutils literal"><span class="pre">optparse.SUPPRESS_HELP</span></code> を使ってください。</p>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は全ての <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> に自動的に <a class="reference internal" href="#optparse.Option.help" title="optparse.Option.help"><code class="xref py py-attr docutils literal"><span class="pre">help</span></code></a> オプションを追加するので、通常自分で生成する必要はありません。</p>
<p>以下はプログラム例です:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="n">OptionParser</span><span class="p">,</span> <span class="n">SUPPRESS_HELP</span>

<span class="c1"># usually, a help option is added automatically, but that can</span>
<span class="c1"># be suppressed using the add_help_option argument</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">add_help_option</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="s2">&quot;--help&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;help&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Be moderately verbose&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Input file to read data from&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--secret&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">SUPPRESS_HELP</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> がコマンドライン上に <code class="docutils literal"><span class="pre">-h</span></code> または <code class="docutils literal"><span class="pre">--help</span></code> を見つけると、以下のようなヘルプメッセージを標準出力に出力します (<code class="docutils literal"><span class="pre">sys.argv[0]</span></code> は <code class="docutils literal"><span class="pre">&quot;foo.py&quot;</span></code> だとします):</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Usage: foo.py [options]

Options:
  -h, --help        Show this help message and exit
  -v                Be moderately verbose
  --file=FILENAME   Input file to read data from
</pre></div>
</div>
<p>ヘルプメッセージの出力後、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は <code class="docutils literal"><span class="pre">sys.exit(0)</span></code> でプロセスを終了します。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;version&quot;</span></code></p>
<p><a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> に指定されているバージョン番号を標準出力に出力して終了します。バージョン番号は、実際には <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> の <code class="xref py py-meth docutils literal"><span class="pre">print_version()</span></code> メソッドで書式化されてから出力されます。通常、 <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> のコンストラクタに <code class="docutils literal"><span class="pre">version</span></code> 引数が指定されたときのみ関係のあるアクションです。 <a class="reference internal" href="#optparse.Option.help" title="optparse.Option.help"><code class="xref py py-attr docutils literal"><span class="pre">help</span></code></a> オプションと同様、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はこのオプションを必要に応じて自動的に追加するので、 <code class="docutils literal"><span class="pre">version</span></code> オプションを作成することはほとんどないでしょう。</p>
</li>
</ul>
</div>
<div class="section" id="standard-option-types">
<span id="optparse-standard-option-types"></span><h3>36.1.3.6. 標準のオプション型<a class="headerlink" href="#standard-option-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> には、 <code class="docutils literal"><span class="pre">&quot;string&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;int&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;choice&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;float&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;complex&quot;</span></code> の 5 種類のビルトインのオプション型があります。 新たなオプションの型を追加したければ、 <a class="reference internal" href="#optparse-extending-optparse"><span class="std std-ref">optparse の拡張</span></a> 節を参照してください。</p>
<p>文字列オプションの引数はチェックや変換を一切受けません: コマンドライン上のテキストは保存先にそのまま保存されます (またはコールバックに渡されます)。</p>
<p>整数引数 (<code class="docutils literal"><span class="pre">&quot;int&quot;</span></code> 型) は次のように解析されます:</p>
<ul class="simple">
<li><p class="first">数が <code class="docutils literal"><span class="pre">0x</span></code> から始まるならば、16進数として読み取られます</p>
</li>
<li><p class="first">数が <code class="docutils literal"><span class="pre">0</span></code> から始まるならば、8進数として読み取られます</p>
</li>
<li><p class="first">数が <code class="docutils literal"><span class="pre">0b</span></code> から始まるならば、2進数として読み取られます</p>
</li>
<li><p class="first">それ以外の場合、数は10進数として読み取られます</p>
</li>
</ul>
<p>変換は適切な底 (2, 8, 10, 16 のどれか) とともに <a class="reference internal" href="functions.html#int" title="int"><code class="xref py py-func docutils literal"><span class="pre">int()</span></code></a> を呼び出すことで行なわれます。この変換が失敗した場合 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の処理も失敗に終わりますが、 より役に立つエラーメッセージを出力します。</p>
<p><code class="docutils literal"><span class="pre">&quot;float&quot;</span></code> および <code class="docutils literal"><span class="pre">&quot;complex&quot;</span></code> のオプション引数は直接 <a class="reference internal" href="functions.html#float" title="float"><code class="xref py py-func docutils literal"><span class="pre">float()</span></code></a> や <a class="reference internal" href="functions.html#complex" title="complex"><code class="xref py py-func docutils literal"><span class="pre">complex()</span></code></a> で変換されます。エラーは同様の扱いです。</p>
<p><code class="docutils literal"><span class="pre">&quot;choice&quot;</span></code> オプションは <code class="docutils literal"><span class="pre">&quot;string&quot;</span></code> オプションのサブタイプです。 <a class="reference internal" href="#optparse.Option.choices" title="optparse.Option.choices"><code class="xref py py-attr docutils literal"><span class="pre">choices</span></code></a> オプションの属性 (文字列からなるシーケンス) には、利用できるオプション引数のセットを指定します。 <code class="xref py py-func docutils literal"><span class="pre">optparse.check_choice()</span></code> はユーザの指定したオプション引数とマスタリストを比較して、無効な文字列が指定された場合には <code class="xref py py-exc docutils literal"><span class="pre">OptionValueError</span></code> を送出します。</p>
</div>
<div class="section" id="parsing-arguments">
<span id="optparse-parsing-arguments"></span><h3>36.1.3.7. 引数を解析する<a class="headerlink" href="#parsing-arguments" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>OptionParser を作成してオプションを追加していく上で大事なポイントは、 <code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> メソッドの呼び出しです:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>ここで入力パラメータは</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">args</span></code></dt>
<dd><p class="first last">処理する引数のリスト (デフォルト: <code class="docutils literal"><span class="pre">sys.argv[1:]</span></code>)</p>
</dd>
<dt><code class="docutils literal"><span class="pre">values</span></code></dt>
<dd><p class="first last">オプション引数を格納する <code class="xref py py-class docutils literal"><span class="pre">optparse.Values</span></code> のオブジェクト (デフォルト: 新しい <code class="xref py py-class docutils literal"><span class="pre">Values</span></code> のインスタンス) &#8211; 既存のオブジェクトを指定した場合、オプションのデフォルトは初期化されません</p>
</dd>
</dl>
<p>であり、戻り値は</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">options</span></code></dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">values</span></code> に渡されたものと同じオブジェクト、または <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> によって生成された optparse.Values インスタンス</p>
</dd>
<dt><code class="docutils literal"><span class="pre">args</span></code></dt>
<dd><p class="first last">全てのオプションの処理が終わった後で残った固定引数</p>
</dd>
</dl>
<p>一番普通の使い方は一切キーワード引数を使わないというものです。 <code class="docutils literal"><span class="pre">values</span></code> を指定した場合、それは繰り返される <a class="reference internal" href="functions.html#setattr" title="setattr"><code class="xref py py-func docutils literal"><span class="pre">setattr()</span></code></a> の呼び出し (大雑把に言うと保存される各オプション引数につき一回ずつ) で更新されていき、 <code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> で返されます。</p>
<p><code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> が引数リストでエラーに遭遇した場合、 OptionParser の <code class="xref py py-meth docutils literal"><span class="pre">error()</span></code> メソッドを適切なエンドユーザ向けのエラーメッセージとともに呼び出します。この呼び出しにより、最終的に終了ステータス 2 (伝統的な Unix におけるコマンドラインエラーの終了ステータス) でプロセスを終了させることになります。</p>
</div>
<div class="section" id="querying-and-manipulating-your-option-parser">
<span id="optparse-querying-manipulating-option-parser"></span><h3>36.1.3.8. オプション解析器への問い合わせと操作<a class="headerlink" href="#querying-and-manipulating-your-option-parser" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>オプションパーザのデフォルトの振る舞いは、ある程度カスタマイズすることができます。また、オプションパーザの中を調べることもできます。<a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> は幾つかのヘルパーメソッドを提供しています:</p>
<dl class="method">
<dt id="optparse.OptionParser.disable_interspersed_args">
<code class="descclassname">OptionParser.</code><code class="descname">disable_interspersed_args</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.disable_interspersed_args" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>オプションで無い最初の引数を見つけた時点でパースを止めるように設定します。例えば、 <code class="docutils literal"><span class="pre">-a</span></code> と <code class="docutils literal"><span class="pre">-b</span></code> が両方とも引数を取らないシンプルなオプションだったとすると、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は通常次の構文を受け付け:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">prog</span> <span class="o">-</span><span class="n">a</span> <span class="n">arg1</span> <span class="o">-</span><span class="n">b</span> <span class="n">arg2</span>
</pre></div>
</div>
<p>それを次と同じように扱います</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">prog</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">b</span> <span class="n">arg1</span> <span class="n">arg2</span>
</pre></div>
</div>
<p>この機能を無効にしたいときは、 <a class="reference internal" href="#optparse.OptionParser.disable_interspersed_args" title="optparse.OptionParser.disable_interspersed_args"><code class="xref py py-meth docutils literal"><span class="pre">disable_interspersed_args()</span></code></a> メソッドを呼び出してください。古典的な Unix システムのように、最初のオプションでない引数を見つけたときにオプションの解析を止めるようになります。</p>
<p>別のコマンドを実行するコマンドをプロセッサを作成する際、別のコマンドのオプションと自身のオプションが混ざるのを防ぐために利用することができます。例えば、各コマンドがそれぞれ異なるオプションのセットを持つ場合などに有効です。</p>
</dd></dl>

<dl class="method">
<dt id="optparse.OptionParser.enable_interspersed_args">
<code class="descclassname">OptionParser.</code><code class="descname">enable_interspersed_args</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.enable_interspersed_args" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>オプションで無い最初の引数を見つけてもパースを止めないように設定します。オプションとコマンド引数の順序が混ざっても良いようになります。これはデフォルトの動作です。</p>
</dd></dl>

<dl class="method">
<dt id="optparse.OptionParser.get_option">
<code class="descclassname">OptionParser.</code><code class="descname">get_option</code><span class="sig-paren">(</span><em>opt_str</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.get_option" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>オプション文字列 <em>opt_str</em> に対する <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> インスタンスを返します。該当するオプションがなければ <code class="docutils literal"><span class="pre">None</span></code> を返します。</p>
</dd></dl>

<dl class="method">
<dt id="optparse.OptionParser.has_option">
<code class="descclassname">OptionParser.</code><code class="descname">has_option</code><span class="sig-paren">(</span><em>opt_str</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.has_option" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> に(<code class="docutils literal"><span class="pre">-q</span></code> や <code class="docutils literal"><span class="pre">--verbose</span></code> のような) オプション <em>opt_str</em> がある場合、真を返します。</p>
</dd></dl>

<dl class="method">
<dt id="optparse.OptionParser.remove_option">
<code class="descclassname">OptionParser.</code><code class="descname">remove_option</code><span class="sig-paren">(</span><em>opt_str</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.remove_option" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> に <em>opt_str</em> に対応するオプションがある場合、そのオプションを削除します。該当するオプションに他のオプション文字列が指定されていた場合、それらのオプション文字列は全て無効になります。 <em>opt_str</em> がこの <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> オブジェクトのどのオプションにも属さない場合、 <a class="reference internal" href="exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal"><span class="pre">ValueError</span></code></a> を送出します。</p>
</dd></dl>

</div>
<div class="section" id="conflicts-between-options">
<span id="optparse-conflicts-between-options"></span><h3>36.1.3.9. オプション間の衝突<a class="headerlink" href="#conflicts-between-options" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>注意が足りないと、衝突するオプションを定義してしまうことがあります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--noisy&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>(とりわけ、<a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> から標準的なオプションを備えた自前のサブクラスを定義してしまった場合にはよく起きます。)</p>
<p>ユーザがオプションを追加するたびに、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は既存のオプションとの衝突がないかチェックします。何らかの衝突が見付かると、現在設定されている衝突処理メカニズムを呼び出します。衝突処理メカニズムはコンストラクタ中で呼び出せます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">conflict_handler</span><span class="o">=</span><span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p>個別にも呼び出せます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">set_conflict_handler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p>衝突時の処理をおこなうハンドラ(handler)には、以下のものが利用できます:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal"><span class="pre">&quot;error&quot;</span></code> (デフォルト)</dt>
<dd><p class="first last">オプション間の衝突をプログラム上のエラーとみなし、 <code class="xref py py-exc docutils literal"><span class="pre">OptionConflictError</span></code> を送出します</p>
</dd>
<dt><code class="docutils literal"><span class="pre">&quot;resolve&quot;</span></code></dt>
<dd><p class="first last">オプション間の衝突をインテリジェントに解決します (下記参照)</p>
</dd>
</dl>
</div></blockquote>
<p>一例として、衝突をインテリジェントに解決する <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> を定義し、衝突を起こすようなオプションを追加してみましょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">conflict_handler</span><span class="o">=</span><span class="s2">&quot;resolve&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;do no harm&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--noisy&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;be noisy&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>この時点で、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はすでに追加済のオプションがオプション文字列 <code class="docutils literal"><span class="pre">-n</span></code> を使っていることを検出します。 <code class="docutils literal"><span class="pre">conflict_handler</span></code> が <code class="docutils literal"><span class="pre">&quot;resolve&quot;</span></code> なので、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は既に追加済のオプションリストの方から <code class="docutils literal"><span class="pre">-n</span></code> を除去して問題を解決します。従って、 <code class="docutils literal"><span class="pre">-n</span></code> の除去されたオプションは <code class="docutils literal"><span class="pre">--dry-run</span></code> だけでしか有効にできなくなります。ユーザがヘルプ文字列を要求した場合、問題解決の結果を反映したメッセージが出力されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">Options</span><span class="p">:</span>
  <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span>     <span class="n">do</span> <span class="n">no</span> <span class="n">harm</span>
  <span class="o">...</span>
  <span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="o">--</span><span class="n">noisy</span>   <span class="n">be</span> <span class="n">noisy</span>
</pre></div>
</div>
<p>これまでに追加したオプション文字列を跡形もなく削り去り、ユーザがそのオプションをコマンドラインから起動する手段をなくせます。この場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はオプションを完全に除去してしまうので、こうしたオプションはヘルプテキストやその他のどこにも表示されなくなります。例えば、現在の <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> の場合、以下の操作:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;new dry-run option&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>を行った時点で、最初の <code class="docutils literal"><span class="pre">-n</span></code>/<code class="docutils literal"><span class="pre">--dry-run</span></code> オプションはもはやアクセスできなくなります。このため、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はオプションを消去してしまい、ヘルプテキストだけが残ります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">Options</span><span class="p">:</span>
  <span class="o">...</span>
  <span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="o">--</span><span class="n">noisy</span>   <span class="n">be</span> <span class="n">noisy</span>
  <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span>     <span class="n">new</span> <span class="n">dry</span><span class="o">-</span><span class="n">run</span> <span class="n">option</span>
</pre></div>
</div>
</div>
<div class="section" id="cleanup">
<span id="optparse-cleanup"></span><h3>36.1.3.10. クリーンアップ<a class="headerlink" href="#cleanup" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>OptionParser インスタンスはいくつかの循環参照を抱えています。このことは Python のガーベジコレクタにとって問題になるわけではありませんが、使い終わった OptionParser に対して <code class="xref py py-meth docutils literal"><span class="pre">destroy()</span></code> を呼び出すことでこの循環参照を意図的に断ち切るという方法を選ぶこともできます。この方法は特に長時間実行するアプリケーションで OptionParser から大きなオブジェクトグラフが到達可能になっているような場合に有用です。</p>
</div>
<div class="section" id="other-methods">
<span id="optparse-other-methods"></span><h3>36.1.3.11. その他のメソッド<a class="headerlink" href="#other-methods" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>OptionParser にはその他にも幾つかの公開されたメソッドがあります:</p>
<dl class="method">
<dt id="optparse.OptionParser.set_usage">
<code class="descclassname">OptionParser.</code><code class="descname">set_usage</code><span class="sig-paren">(</span><em>usage</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.set_usage" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>上で説明したコンストラクタの <code class="docutils literal"><span class="pre">usage</span></code> キーワード引数での規則に従った使用法の文字列をセットします。 <code class="docutils literal"><span class="pre">None</span></code> を渡すとデフォルトの使用法文字列が使われるようになり、 <code class="xref py py-data docutils literal"><span class="pre">optparse.SUPPRESS_USAGE</span></code> によって使用法メッセージを抑制できます。</p>
</dd></dl>

<dl class="method">
<dt id="optparse.OptionParser.print_usage">
<code class="descclassname">OptionParser.</code><code class="descname">print_usage</code><span class="sig-paren">(</span><em>file=None</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.print_usage" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>現在のプログラムの使用法メッセージ (<code class="docutils literal"><span class="pre">self.usage</span></code>) を <em>file</em> (デフォルト: stdout) に表示します。<code class="docutils literal"><span class="pre">self.usage</span></code> 内にある全ての <code class="docutils literal"><span class="pre">%prog</span></code> という文字列は現在のプログラム名に置換されます。<code class="docutils literal"><span class="pre">self.usage</span></code> が空もしくは未定義の時は何もしません。</p>
</dd></dl>

<dl class="method">
<dt id="optparse.OptionParser.get_usage">
<code class="descclassname">OptionParser.</code><code class="descname">get_usage</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.get_usage" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#optparse.OptionParser.print_usage" title="optparse.OptionParser.print_usage"><code class="xref py py-meth docutils literal"><span class="pre">print_usage()</span></code></a> と同じですが、使用法メッセージを表示する代わりに文字列として返します。</p>
</dd></dl>

<dl class="method">
<dt id="optparse.OptionParser.set_defaults">
<code class="descclassname">OptionParser.</code><code class="descname">set_defaults</code><span class="sig-paren">(</span><em>dest=value</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#optparse.OptionParser.set_defaults" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>幾つかの保存先に対してデフォルト値をまとめてセットします。 <a class="reference internal" href="#optparse.OptionParser.set_defaults" title="optparse.OptionParser.set_defaults"><code class="xref py py-meth docutils literal"><span class="pre">set_defaults()</span></code></a> を使うのは複数のオプションにデフォルト値をセットする好ましいやり方です。複数のオプションが同じ保存先を共有することがあり得るからです。たとえば幾つかの &#8220;mode&#8221; オプションが全て同じ保存先をセットするものだったとすると、どのオプションもデフォルトをセットすることができ、しかし最後に指定したものだけが有効になります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--advanced&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
                  <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="s2">&quot;advanced&quot;</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="s2">&quot;novice&quot;</span><span class="p">)</span>    <span class="c1"># overridden below</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--novice&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
                  <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="s2">&quot;novice&quot;</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="s2">&quot;advanced&quot;</span><span class="p">)</span>  <span class="c1"># overrides above setting</span>
</pre></div>
</div>
<p>こうした混乱を避けるために <a class="reference internal" href="#optparse.OptionParser.set_defaults" title="optparse.OptionParser.set_defaults"><code class="xref py py-meth docutils literal"><span class="pre">set_defaults()</span></code></a> を使います:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;advanced&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--advanced&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
                  <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="s2">&quot;advanced&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--novice&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
                  <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="s2">&quot;novice&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="option-callbacks">
<span id="optparse-option-callbacks"></span><h2>36.1.4. オプション処理コールバック<a class="headerlink" href="#option-callbacks" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の組み込みのアクションや型が望みにかなったものでない場合、二つの選択肢があります: 一つは <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の拡張、もう一つは callback オプションの定義です。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の拡張は汎用性に富んでいますが、単純なケースに対していささか大げさでもあります。大体は簡単なコールバックで事足りるでしょう。</p>
<p><code class="docutils literal"><span class="pre">callback</span></code> オプションの定義は二つのステップからなります:</p>
<ul class="simple">
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;callback&quot;</span></code> アクションを使ってオプション自体を定義する</p>
</li>
<li><p class="first">コールバックを書く。コールバックは少なくとも後で説明する 4 つの引数をとる関数 (またはメソッド) でなければなりません</p>
</li>
</ul>
<div class="section" id="defining-a-callback-option">
<span id="optparse-defining-callback-option"></span><h3>36.1.4.1. callbackオプションの定義<a class="headerlink" href="#defining-a-callback-option" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>callback オプションを最も簡単に定義するには、 <a class="reference internal" href="#optparse.OptionParser.add_option" title="optparse.OptionParser.add_option"><code class="xref py py-meth docutils literal"><span class="pre">OptionParser.add_option()</span></code></a> メソッドを使います。 <a class="reference internal" href="#optparse.Option.action" title="optparse.Option.action"><code class="xref py py-attr docutils literal"><span class="pre">action</span></code></a> の他に指定しなければならない属性は <code class="docutils literal"><span class="pre">callback</span></code> すなわちコールバックする関数自体です:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">my_callback</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">callback</span></code> は関数 (または呼び出し可能オブジェクト)なので、callback オプションを定義する時にはあらかじめ <code class="docutils literal"><span class="pre">my_callback()</span></code> を定義しておかなければなりません。この単純なケースでは、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は <code class="docutils literal"><span class="pre">-c</span></code> が何らかの引数をとるかどうか判別できず、通常は <code class="docutils literal"><span class="pre">-c</span></code> が引数を伴わないことを意味します &#8212; 知りたいことはただ単に <code class="docutils literal"><span class="pre">-c</span></code> がコマンドライン上に現れたどうかだけです。とはいえ、場合によっては、自分のコールバック関数に任意の個数のコマンドライン引数を消費させたいこともあるでしょう。これがコールバック関数をトリッキーなものにしています; これについてはこの節の後の方で説明します。</p>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は常に四つの引数をコールバックに渡し、その他には <a class="reference internal" href="#optparse.Option.callback_args" title="optparse.Option.callback_args"><code class="xref py py-attr docutils literal"><span class="pre">callback_args</span></code></a> および <a class="reference internal" href="#optparse.Option.callback_kwargs" title="optparse.Option.callback_kwargs"><code class="xref py py-attr docutils literal"><span class="pre">callback_kwargs</span></code></a> で指定した追加引数しか渡しません。従って、最小のコールバック関数シグネチャは:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_callback</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
</pre></div>
</div>
<p>コールバックの四つの引数については後で説明します。</p>
<p>callback オプションを定義する場合には、他にもいくつかオプション属性を指定できます:</p>
<dl class="docutils">
<dt><a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a></dt>
<dd><p class="first last">他で使われているのと同じ意味です: <code class="docutils literal"><span class="pre">&quot;store&quot;</span></code> や <code class="docutils literal"><span class="pre">&quot;append&quot;</span></code> アクションの時と同じく、この属性は <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> に引数を一つ消費して <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> で指定した型に変換させます。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は変換後の値をどこかに保存する代わりにコールバック関数に渡します。</p>
</dd>
<dt><a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a></dt>
<dd><p class="first last">これも他で使われているのと同じ意味です: このオプションが指定されていて、かつ <code class="docutils literal"><span class="pre">nargs</span></code> &gt; 1 である場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a> 個の引数を消費します。このとき各引数は <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> 型に変換できなければなりません。変換後の値はタプルとしてコールバックに渡されます。</p>
</dd>
<dt><a class="reference internal" href="#optparse.Option.callback_args" title="optparse.Option.callback_args"><code class="xref py py-attr docutils literal"><span class="pre">callback_args</span></code></a></dt>
<dd><p class="first last">その他の固定引数からなるタプルで、コールバックに渡されます</p>
</dd>
<dt><a class="reference internal" href="#optparse.Option.callback_kwargs" title="optparse.Option.callback_kwargs"><code class="xref py py-attr docutils literal"><span class="pre">callback_kwargs</span></code></a></dt>
<dd><p class="first last">その他のキーワード引数からなる辞書で、コールバックに渡されます</p>
</dd>
</dl>
</div>
<div class="section" id="how-callbacks-are-called">
<span id="optparse-how-callbacks-called"></span><h3>36.1.4.2. コールバック関数はどのように呼び出されるか<a class="headerlink" href="#how-callbacks-are-called" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>コールバックは全て以下の形式で呼び出されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">func</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>ここでは:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">option</span></code></dt>
<dd><p class="first last">コールバックを呼び出している <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> のインスタンスです</p>
</dd>
<dt><code class="docutils literal"><span class="pre">opt_str</span></code></dt>
<dd><p class="first last">は、コールバック呼び出しのきっかけとなったコマンドライン上のオプション文字列です。(長い形式のオプションに対する省略形が使われている場合、<code class="docutils literal"><span class="pre">opt_str</span></code> は完全な、正式な形のオプション文字列となります &#8212; 例えば、ユーザが <code class="docutils literal"><span class="pre">--foobar</span></code> の短縮形として <code class="docutils literal"><span class="pre">--foo</span></code> をコマンドラインに入力した時には、<code class="docutils literal"><span class="pre">opt_str</span></code> は <code class="docutils literal"><span class="pre">&quot;--foobar&quot;</span></code> となります。)</p>
</dd>
<dt><code class="docutils literal"><span class="pre">value</span></code></dt>
<dd><p class="first last">オプションの引数で、コマンドライン上に見つかったものです。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は、 <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> が設定されている場合、単一の引数しかとりません。 <code class="docutils literal"><span class="pre">value</span></code> の型はオプションの型として指定された型になります。このオプションに対する <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> が <code class="docutils literal"><span class="pre">None</span></code> である(引数なしの) 場合、 <code class="docutils literal"><span class="pre">value</span></code> は <code class="docutils literal"><span class="pre">None</span></code> になります。 <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a> &gt; 1 であれば、 <code class="docutils literal"><span class="pre">value</span></code> は適切な型をもつ値のタプルになります。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">parser</span></code></dt>
<dd><p class="first">現在のオプション解析の全てを駆動している <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> インスタンスです。この変数が有用なのは、この値を介してインスタンス属性としていくつかの興味深いデータにアクセスできるからです:</p>
<dl class="last docutils">
<dt><code class="docutils literal"><span class="pre">parser.largs</span></code></dt>
<dd><p class="first last">現在放置されている引数、すなわち、すでに消費されたものの、オプションでもオプション引数でもない引数からなるリストです。 <code class="docutils literal"><span class="pre">parser.largs</span></code> は自由に変更でき、たとえば引数を追加したりできます (このリストは <code class="docutils literal"><span class="pre">args</span></code> 、すなわち <code class="xref py py-meth docutils literal"><span class="pre">parse_args()</span></code> の二つ目の戻り値になります)</p>
</dd>
<dt><code class="docutils literal"><span class="pre">parser.rargs</span></code></dt>
<dd><p class="first last">現在残っている引数、すなわち、<code class="docutils literal"><span class="pre">opt_str</span></code> および <code class="docutils literal"><span class="pre">value</span></code> があれば除き、それ以外の引数が残っているリストです。<code class="docutils literal"><span class="pre">parser.rargs</span></code> は自由に変更でき、例えばさらに引数を消費したりできます。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">parser.values</span></code></dt>
<dd><p class="first last">オプションの値がデフォルトで保存されるオブジェクト (<code class="docutils literal"><span class="pre">optparse.OptionValues</span></code> のインスタンス) です。この値を使うと、コールバック関数がオプションの値を記憶するために、他の <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> と同じ機構を使えるようにするため、グローバル変数や閉包 (closure) を台無しにしないので便利です。コマンドライン上にすでに現れているオプションの値にもアクセスできます。</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal"><span class="pre">args</span></code></dt>
<dd><p class="first last"><a class="reference internal" href="#optparse.Option.callback_args" title="optparse.Option.callback_args"><code class="xref py py-attr docutils literal"><span class="pre">callback_args</span></code></a> オプション属性で与えられた任意の固定引数からなるタプルです。</p>
</dd>
<dt><code class="docutils literal"><span class="pre">kwargs</span></code></dt>
<dd><p class="first last"><a class="reference internal" href="#optparse.Option.callback_kwargs" title="optparse.Option.callback_kwargs"><code class="xref py py-attr docutils literal"><span class="pre">callback_kwargs</span></code></a> オプション属性で与えられた任意のキーワード引数からなるタプルです。</p>
</dd>
</dl>
</div>
<div class="section" id="raising-errors-in-a-callback">
<span id="optparse-raising-errors-in-callback"></span><h3>36.1.4.3. コールバック中で例外を送出する<a class="headerlink" href="#raising-errors-in-a-callback" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>オプション自体か、あるいはその引数に問題がある場合、コールバック関数は <code class="xref py py-exc docutils literal"><span class="pre">OptionValueError</span></code> を送出しなければなりません。 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> はこの例外をとらえてプログラムを終了させ、ユーザが指定しておいたエラーメッセージを標準エラー出力に出力します。エラーメッセージは明確、簡潔かつ正確で、どのオプションに誤りがあるかを示さなければなりません。さもなければ、ユーザは自分の操作のどこに問題があるかを解決するのに苦労することになります。</p>
</div>
<div class="section" id="callback-example-1-trivial-callback">
<span id="optparse-callback-example-1"></span><h3>36.1.4.4. コールバックの例 1: ありふれたコールバック<a class="headerlink" href="#callback-example-1-trivial-callback" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>引数をとらず、発見したオプションを単に記録するだけのコールバックオプションの例を以下に示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">record_foo_seen</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">saw_foo</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--foo&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">record_foo_seen</span><span class="p">)</span>
</pre></div>
</div>
<p>もちろん、<code class="docutils literal"><span class="pre">&quot;store_true&quot;</span></code> アクションを使っても実現できます。</p>
</div>
<div class="section" id="callback-example-2-check-option-order">
<span id="optparse-callback-example-2"></span><h3>36.1.4.5. コールバックの例 2: オプションの順番をチェックする<a class="headerlink" href="#callback-example-2-check-option-order" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>もう少し面白みのある例を示します: この例では、<code class="docutils literal"><span class="pre">-b</span></code> を発見して、その後で <code class="docutils literal"><span class="pre">-a</span></code> がコマンドライン中に現れた場合にはエラーになります。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_order</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">b</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">OptionValueError</span><span class="p">(</span><span class="s2">&quot;can&#39;t use -a after -b&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">...</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-a&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">check_order</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="callback-example-3-check-option-order-generalized">
<span id="optparse-callback-example-3"></span><h3>36.1.4.6. コールバックの例 3: オプションの順番をチェックする (汎用的)<a class="headerlink" href="#callback-example-3-check-option-order-generalized" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>このコールバック (フラグを立てるが、<code class="docutils literal"><span class="pre">-b</span></code> が既に指定されていればエラーになる) を同様の複数のオプションに対して再利用したければ、もう少し作業する必要があります: エラーメッセージとセットされるフラグを一般化しなければなりません。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_order</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">b</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">OptionValueError</span><span class="p">(</span><span class="s2">&quot;can&#39;t use </span><span class="si">%s</span><span class="s2"> after -b&quot;</span> <span class="o">%</span> <span class="n">opt_str</span><span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-a&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">check_order</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">check_order</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="callback-example-4-check-arbitrary-condition">
<span id="optparse-callback-example-4"></span><h3>36.1.4.7. コールバックの例 4: 任意の条件をチェックする<a class="headerlink" href="#callback-example-4-check-arbitrary-condition" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>もちろん、単に定義済みのオプションの値を調べるだけにとどまらず、コールバックには任意の条件を入れられます。例えば、満月でなければ呼び出してはならないオプションがあるとしましょう。やらなければならないことはこれだけです:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_moon</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_moon_full</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">OptionValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> option invalid when moon is full&quot;</span>
                               <span class="o">%</span> <span class="n">opt_str</span><span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--foo&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">check_moon</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<code class="docutils literal"><span class="pre">is_moon_full()</span></code> の定義は読者への課題としましょう。)</p>
</div>
<div class="section" id="callback-example-5-fixed-arguments">
<span id="optparse-callback-example-5"></span><h3>36.1.4.8. コールバックの例5: 固定引数<a class="headerlink" href="#callback-example-5-fixed-arguments" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>決まった数の引数をとるようなコールパックオプションを定義するなら、問題はやや興味深くなってきます。引数をとるようコールバックに指定するのは、 <code class="docutils literal"><span class="pre">&quot;store&quot;</span></code> や <code class="docutils literal"><span class="pre">&quot;append&quot;</span></code> オプションの定義に似ています。 <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> を定義していれば、そのオプションは引数を受け取ったときに該当する型に変換できなければなりません。さらに <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a> を指定すれば、オプションは <a class="reference internal" href="#optparse.Option.nargs" title="optparse.Option.nargs"><code class="xref py py-attr docutils literal"><span class="pre">nargs</span></code></a> 個の引数を受け取ります。</p>
<p>標準の <code class="docutils literal"><span class="pre">&quot;store&quot;</span></code> アクションをエミュレートする例を以下に示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">store_value</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--foo&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">store_value</span><span class="p">,</span>
                  <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は 3 個の引数を受け取り、それらを整数に変換するところまで面倒をみてくれます。ユーザは単にそれを保存するだけです。 (他の処理もできます; いうまでもなく、この例にはコールバックは必要ありません)</p>
</div>
<div class="section" id="callback-example-6-variable-arguments">
<span id="optparse-callback-example-6"></span><h3>36.1.4.9. コールバックの例6: 可変個の引数<a class="headerlink" href="#callback-example-6-variable-arguments" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>あるオプションに可変個の引数を持たせたいと考えているなら、問題はいささか手強くなってきます。この場合、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> では該当する組み込みのオプション解析機能を提供していないので、自分でコールバックを書かなければなりません。さらに、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> が普段処理している、伝統的な Unix コマンドライン解析における難題を自分で解決しなければなりません。とりわけ、コールバック関数では引数が裸の <code class="docutils literal"><span class="pre">--</span></code> や <code class="docutils literal"><span class="pre">-</span></code> の場合における慣習的な処理規則:</p>
<ul class="simple">
<li>either <code class="docutils literal"><span class="pre">--</span></code> or <code class="docutils literal"><span class="pre">-</span></code> can be option arguments</li>
<li><p class="first">裸の <code class="docutils literal"><span class="pre">--</span></code> (何らかのオプションの引数でない場合): コマンドライン処理を停止し、<code class="docutils literal"><span class="pre">--</span></code> を無視します</p>
</li>
<li><p class="first">裸の <code class="docutils literal"><span class="pre">-</span></code> (何らかのオプションの引数でない場合): コマンドライン処理を停止しますが、<code class="docutils literal"><span class="pre">-</span></code> は残します (<code class="docutils literal"><span class="pre">parser.largs</span></code> に追加します)</p>
</li>
</ul>
<p>オプションが可変個の引数をとるようにさせたいなら、いくつかの巧妙で厄介な問題に配慮しなければなりません。どういう実装をとるかは、アプリケーションでどのようなトレードオフを考慮するかによります (このため、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> では可変個の引数に関する問題を直接的に取り扱わないのです)。</p>
<p>とはいえ、可変個の引数をもつオプションに対するスタブ (stub、仲介インタフェース) を以下に示しておきます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">vararg_callback</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">floatable</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">rargs</span><span class="p">:</span>
        <span class="c1"># stop on --foo like options</span>
        <span class="k">if</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;--&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="c1"># stop on -a, but not on -3 or -3.0</span>
        <span class="k">if</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">floatable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">parser</span><span class="o">.</span><span class="n">rargs</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="o">...</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;--callback&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;vararg_attr&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">vararg_callback</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="extending-optparse">
<span id="optparse-extending-optparse"></span><h2>36.1.5. <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の拡張<a class="headerlink" href="#extending-optparse" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> がコマンドラインオプションをどのように解釈するかを決める二つの重要な要素はそれぞれのオプションのアクションと型なので、拡張の方向は新しいアクションと型を追加することになると思います。</p>
<div class="section" id="adding-new-types">
<span id="optparse-adding-new-types"></span><h3>36.1.5.1. 新しい型の追加<a class="headerlink" href="#adding-new-types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>新しい型を追加するためには、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> クラスのサブクラスを自身で定義する必要があります。このクラスには <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> における型を定義する一対の属性があります。それは <a class="reference internal" href="#optparse.Option.TYPES" title="optparse.Option.TYPES"><code class="xref py py-attr docutils literal"><span class="pre">TYPES</span></code></a> と <a class="reference internal" href="#optparse.Option.TYPE_CHECKER" title="optparse.Option.TYPE_CHECKER"><code class="xref py py-attr docutils literal"><span class="pre">TYPE_CHECKER</span></code></a> です。</p>
<dl class="attribute">
<dt id="optparse.Option.TYPES">
<code class="descclassname">Option.</code><code class="descname">TYPES</code><a class="headerlink" href="#optparse.Option.TYPES" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#optparse.Option.TYPES" title="optparse.Option.TYPES"><code class="xref py py-attr docutils literal"><span class="pre">TYPES</span></code></a> は型名のタプルです。新しく作るサブクラスでは、タプル <a class="reference internal" href="#optparse.Option.TYPES" title="optparse.Option.TYPES"><code class="xref py py-attr docutils literal"><span class="pre">TYPES</span></code></a> を単純に標準のものを利用して新しく定義すると良いでしょう。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.TYPE_CHECKER">
<code class="descclassname">Option.</code><code class="descname">TYPE_CHECKER</code><a class="headerlink" href="#optparse.Option.TYPE_CHECKER" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="xref py py-attr docutils literal"><span class="pre">TYPE_CHECKER</span></code> は辞書で型名を型チェック関数に対応付けるものです。型チェック関数は以下のようなシグネチャを持ちます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_mytype</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>ここで <code class="docutils literal"><span class="pre">option</span></code> は <code class="xref py py-class docutils literal"><span class="pre">Option</span></code> のインスタンスであり、 <code class="docutils literal"><span class="pre">opt</span></code> はオプション文字列(たとえば <code class="docutils literal"><span class="pre">-f</span></code>)で、 <code class="docutils literal"><span class="pre">value</span></code> は望みの型としてチェックされ変換されるべくコマンドラインで与えられる文字列です。 <code class="docutils literal"><span class="pre">check_mytype()</span></code> は想定されている型 <code class="docutils literal"><span class="pre">mytype</span></code> のオブジェクトを返さなければなりません。型チェック関数から返される値は <code class="xref py py-meth docutils literal"><span class="pre">OptionParser.parse_args()</span></code> で返されるOptionValues インスタンスに収められるか、またはコールバックに <code class="docutils literal"><span class="pre">value</span></code> パラメータとして渡されます。</p>
<p>型チェック関数は何か問題に遭遇したら <code class="xref py py-exc docutils literal"><span class="pre">OptionValueError</span></code> を送出しなければなりません。 <code class="xref py py-exc docutils literal"><span class="pre">OptionValueError</span></code> は文字列一つを引数に取り、それはそのまま <a class="reference internal" href="#optparse.OptionParser" title="optparse.OptionParser"><code class="xref py py-class docutils literal"><span class="pre">OptionParser</span></code></a> の <code class="xref py py-meth docutils literal"><span class="pre">error()</span></code> メソッドに渡され、そこでプログラム名と文字列 <code class="docutils literal"><span class="pre">&quot;error:&quot;</span></code> が前置されてプロセスが終了する前に stderr に出力されます。</p>
</dd></dl>

<p>馬鹿馬鹿しい例ですが、Python スタイルの複素数を解析する <code class="docutils literal"><span class="pre">&quot;complex&quot;</span></code> オプション型を作ってみせることにします。(<a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> 1.3 が複素数のサポートを組み込んでしまったため以前にも増して馬鹿らしくなりましたが、気にしないでください。)</p>
<p>最初に必要な import 文を書きます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="n">Option</span><span class="p">,</span> <span class="n">OptionValueError</span>
</pre></div>
</div>
<p>まずは型チェック関数を定義しなければなりません。これは後で(これから定義する Option のサブクラスの <a class="reference internal" href="#optparse.Option.TYPE_CHECKER" title="optparse.Option.TYPE_CHECKER"><code class="xref py py-attr docutils literal"><span class="pre">TYPE_CHECKER</span></code></a> クラス属性の中で) 参照されることになります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_complex</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">OptionValueError</span><span class="p">(</span>
            <span class="s2">&quot;option </span><span class="si">%s</span><span class="s2">: invalid complex value: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
<p>最後に Option のサブクラスです:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyOption</span> <span class="p">(</span><span class="n">Option</span><span class="p">):</span>
    <span class="n">TYPES</span> <span class="o">=</span> <span class="n">Option</span><span class="o">.</span><span class="n">TYPES</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;complex&quot;</span><span class="p">,)</span>
    <span class="n">TYPE_CHECKER</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">Option</span><span class="o">.</span><span class="n">TYPE_CHECKER</span><span class="p">)</span>
    <span class="n">TYPE_CHECKER</span><span class="p">[</span><span class="s2">&quot;complex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_complex</span>
</pre></div>
</div>
<p>(もしここで <a class="reference internal" href="#optparse.Option.TYPE_CHECKER" title="optparse.Option.TYPE_CHECKER"><code class="xref py py-attr docutils literal"><span class="pre">Option.TYPE_CHECKER</span></code></a> に <a class="reference internal" href="copy.html#module-copy" title="copy: Shallow and deep copy operations."><code class="xref py py-func docutils literal"><span class="pre">copy()</span></code></a> を適用しなければ、 <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の Option クラスの <a class="reference internal" href="#optparse.Option.TYPE_CHECKER" title="optparse.Option.TYPE_CHECKER"><code class="xref py py-attr docutils literal"><span class="pre">TYPE_CHECKER</span></code></a> 属性をいじってしまうことになります。 Python の常として、良いマナーと常識以外にそうすることを止めるものはありません。)</p>
<p>これだけです! もう新しいオプション型を使うスクリプトを他の <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> に基づいたスクリプトとまるで同じように書くことができます。ただし、 OptionParser に Option でなく MyOption を使うように指示しなければなければなりません:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">option_class</span><span class="o">=</span><span class="n">MyOption</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>別のやり方として、オプションリストを構築して OptionParser に渡すという方法もあります。 <code class="xref py py-meth docutils literal"><span class="pre">add_option()</span></code> を上でやったように使わないならば、OptionParser にどのクラスを使うのか教える必要はありません:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">option_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyOption</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">)]</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">option_list</span><span class="o">=</span><span class="n">option_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-new-actions">
<span id="optparse-adding-new-actions"></span><h3>36.1.5.2. 新しいアクションの追加<a class="headerlink" href="#adding-new-actions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>新しいアクションの追加はもう少しトリッキーです。というのも <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> が使っている二つのアクションの分類を理解する必要があるからです:</p>
<dl class="docutils">
<dt>&#8220;store&#8221; アクション</dt>
<dd><p class="first last"><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> が値を現在の OptionValues の属性に格納することになるアクションです。この種類のオプションは Option のコンストラクタに <a class="reference internal" href="#optparse.Option.dest" title="optparse.Option.dest"><code class="xref py py-attr docutils literal"><span class="pre">dest</span></code></a> 属性を与えることが要求されます。</p>
</dd>
<dt>&#8220;typed&#8221; アクション</dt>
<dd><p class="first last">コマンドラインから引数を受け取り、それがある型であることが期待されているアクションです。もう少しはっきり言えば、その型に変換される文字列を受け取るものです。この種類のオプションは Option のコンストラクタに <a class="reference internal" href="#optparse.Option.type" title="optparse.Option.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a> 属性を与えることが要求されます。</p>
</dd>
</dl>
<p>この分類には重複する部分があります。デフォルトの &#8220;store&#8221; アクションには <code class="docutils literal"><span class="pre">&quot;store&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;store_const&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;append&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;count&quot;</span></code> などがありますが、デフォルトの &#8220;typed&#8221; オプションは <code class="docutils literal"><span class="pre">&quot;store&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;append&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;callback&quot;</span></code> の三つです。</p>
<p>アクションを追加する際に、以下の Option のクラス属性(全て文字列のリストです) の中の少なくとも一つに付け加えることでそのアクションを分類する必要があります:</p>
<dl class="attribute">
<dt id="optparse.Option.ACTIONS">
<code class="descclassname">Option.</code><code class="descname">ACTIONS</code><a class="headerlink" href="#optparse.Option.ACTIONS" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>全てのアクションは ACTIONS にリストされていなければなりません。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.STORE_ACTIONS">
<code class="descclassname">Option.</code><code class="descname">STORE_ACTIONS</code><a class="headerlink" href="#optparse.Option.STORE_ACTIONS" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>&#8220;store&#8221; アクションはここにもリストされます。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.TYPED_ACTIONS">
<code class="descclassname">Option.</code><code class="descname">TYPED_ACTIONS</code><a class="headerlink" href="#optparse.Option.TYPED_ACTIONS" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>&#8220;typed&#8221; アクションはここにもリストされます。</p>
</dd></dl>

<dl class="attribute">
<dt id="optparse.Option.ALWAYS_TYPED_ACTIONS">
<code class="descclassname">Option.</code><code class="descname">ALWAYS_TYPED_ACTIONS</code><a class="headerlink" href="#optparse.Option.ALWAYS_TYPED_ACTIONS" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>型を取るアクション (つまりそのオプションが値を取る) はここにもリストされます。このことの唯一の効果は <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> が、型の指定が無くアクションが <a class="reference internal" href="#optparse.Option.ALWAYS_TYPED_ACTIONS" title="optparse.Option.ALWAYS_TYPED_ACTIONS"><code class="xref py py-attr docutils literal"><span class="pre">ALWAYS_TYPED_ACTIONS</span></code></a> のリストにあるオプションに、デフォルト型 <code class="docutils literal"><span class="pre">&quot;string&quot;</span></code> を割り当てるということだけです。</p>
</dd></dl>

<p>実際に新しいアクションを実装するには、Option の <code class="xref py py-meth docutils literal"><span class="pre">take_action()</span></code> メソッドをオーバライドしてそのアクションを認識する場合分けを追加しなければなりません。</p>
<p>例えば、<code class="docutils literal"><span class="pre">&quot;extend&quot;</span></code> アクションというのを追加してみましょう。このアクションは標準的な <code class="docutils literal"><span class="pre">&quot;append&quot;</span></code> アクションと似ていますが、コマンドラインから一つだけ値を読み取って既存のリストに追加するのではなく、複数の値をコンマ区切りの文字列として読み取ってそれらで既存のリストを拡張します。すなわち、もし <code class="docutils literal"><span class="pre">--names</span></code> が <code class="docutils literal"><span class="pre">&quot;string&quot;</span></code> 型の <code class="docutils literal"><span class="pre">&quot;extend&quot;</span></code> オプションだとすると、次のコマンドライン</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">names</span><span class="o">=</span><span class="n">foo</span><span class="p">,</span><span class="n">bar</span> <span class="o">--</span><span class="n">names</span> <span class="n">blah</span> <span class="o">--</span><span class="n">names</span> <span class="n">ding</span><span class="p">,</span><span class="n">dong</span>
</pre></div>
</div>
<p>の結果は次のリストになります</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;blah&quot;</span><span class="p">,</span> <span class="s2">&quot;ding&quot;</span><span class="p">,</span> <span class="s2">&quot;dong&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>再び Option のサブクラスを定義します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyOption</span><span class="p">(</span><span class="n">Option</span><span class="p">):</span>

    <span class="n">ACTIONS</span> <span class="o">=</span> <span class="n">Option</span><span class="o">.</span><span class="n">ACTIONS</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;extend&quot;</span><span class="p">,)</span>
    <span class="n">STORE_ACTIONS</span> <span class="o">=</span> <span class="n">Option</span><span class="o">.</span><span class="n">STORE_ACTIONS</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;extend&quot;</span><span class="p">,)</span>
    <span class="n">TYPED_ACTIONS</span> <span class="o">=</span> <span class="n">Option</span><span class="o">.</span><span class="n">TYPED_ACTIONS</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;extend&quot;</span><span class="p">,)</span>
    <span class="n">ALWAYS_TYPED_ACTIONS</span> <span class="o">=</span> <span class="n">Option</span><span class="o">.</span><span class="n">ALWAYS_TYPED_ACTIONS</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;extend&quot;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">take_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;extend&quot;</span><span class="p">:</span>
            <span class="n">lvalue</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">values</span><span class="o">.</span><span class="n">ensure_value</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lvalue</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Option</span><span class="o">.</span><span class="n">take_action</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>
</pre></div>
</div>
<p>注意すべきは次のようなところです:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;extend&quot;</span></code> はコマンドラインの値を予期していると同時にその値をどこかに格納しますので、 <a class="reference internal" href="#optparse.Option.STORE_ACTIONS" title="optparse.Option.STORE_ACTIONS"><code class="xref py py-attr docutils literal"><span class="pre">STORE_ACTIONS</span></code></a> と <a class="reference internal" href="#optparse.Option.TYPED_ACTIONS" title="optparse.Option.TYPED_ACTIONS"><code class="xref py py-attr docutils literal"><span class="pre">TYPED_ACTIONS</span></code></a> の両方に入ります。</p>
</li>
<li><p class="first"><a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> が <code class="docutils literal"><span class="pre">&quot;extend&quot;</span></code> アクションに <code class="docutils literal"><span class="pre">&quot;string&quot;</span></code> 型を割り当てるように <code class="docutils literal"><span class="pre">&quot;extend&quot;</span></code> アクションは <a class="reference internal" href="#optparse.Option.ALWAYS_TYPED_ACTIONS" title="optparse.Option.ALWAYS_TYPED_ACTIONS"><code class="xref py py-attr docutils literal"><span class="pre">ALWAYS_TYPED_ACTIONS</span></code></a> にも入れてあります。</p>
</li>
<li><p class="first"><code class="xref py py-meth docutils literal"><span class="pre">MyOption.take_action()</span></code> にはこの新しいアクション一つの扱いだけを実装してあり、他の標準的な <a class="reference internal" href="#module-optparse" title="optparse: Command-line option parsing library. (撤廃)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> のアクションについては <code class="xref py py-meth docutils literal"><span class="pre">Option.take_action()</span></code> に制御を戻すようにしてあります。</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">values</span></code> は optparse_parser.Values クラスのインスタンスであり、非常に有用な <code class="xref py py-meth docutils literal"><span class="pre">ensure_value()</span></code> メソッドを提供しています。 <code class="xref py py-meth docutils literal"><span class="pre">ensure_value()</span></code> は本質的に安全弁付きの <a class="reference internal" href="functions.html#getattr" title="getattr"><code class="xref py py-func docutils literal"><span class="pre">getattr()</span></code></a> です。次のように呼び出します</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">values</span><span class="o">.</span><span class="n">ensure_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">values</span></code> に <code class="docutils literal"><span class="pre">attr</span></code> 属性が無いか <code class="docutils literal"><span class="pre">None</span></code> だった場合に、 <code class="xref py py-meth docutils literal"><span class="pre">ensure_value()</span></code> は最初に <code class="docutils literal"><span class="pre">value</span></code> をセットし、それから <code class="docutils literal"><span class="pre">value</span></code> を返します。この振る舞いは <code class="docutils literal"><span class="pre">&quot;extend&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;append&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;count&quot;</span></code> のように、データを変数に集積し、またその変数がある型 (最初の二つはリスト、最後のは整数) であると期待されるアクションを作るのにとても使い易いものです。 <code class="xref py py-meth docutils literal"><span class="pre">ensure_value()</span></code> を使えば、作ったアクションを使うスクリプトはオプションに保存先にデフォルト値をセットすることに煩わされずに済みます。デフォルトを <code class="docutils literal"><span class="pre">None</span></code> にしておけば <code class="xref py py-meth docutils literal"><span class="pre">ensure_value()</span></code> がそれが必要になったときに適当な値を返してくれます。</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">36.1. <code class="docutils literal"><span class="pre">optparse</span></code> &#8212; コマンドラインオプション解析器</a><ul>
<li><a class="reference internal" href="#background">36.1.1. 背景</a><ul>
<li><a class="reference internal" href="#terminology">36.1.1.1. 用語集</a></li>
<li><a class="reference internal" href="#what-are-options-for">36.1.1.2. オプションとは何か</a></li>
<li><a class="reference internal" href="#what-are-positional-arguments-for">36.1.1.3. 固定引数とは何か</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tutorial">36.1.2. チュートリアル</a><ul>
<li><a class="reference internal" href="#understanding-option-actions">36.1.2.1. オプション・アクションを理解する</a></li>
<li><a class="reference internal" href="#the-store-action">36.1.2.2. store アクション</a></li>
<li><a class="reference internal" href="#handling-boolean-flag-options">36.1.2.3. ブール値 (フラグ) オプションの処理</a></li>
<li><a class="reference internal" href="#other-actions">36.1.2.4. その他のアクション</a></li>
<li><a class="reference internal" href="#default-values">36.1.2.5. デフォルト値</a></li>
<li><a class="reference internal" href="#generating-help">36.1.2.6. ヘルプの生成</a><ul>
<li><a class="reference internal" href="#grouping-options">36.1.2.6.1. オプションをグループ化する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#printing-a-version-string">36.1.2.7. バージョン番号の出力</a></li>
<li><a class="reference internal" href="#how-optparse-handles-errors">36.1.2.8. <code class="docutils literal"><span class="pre">optparse</span></code> のエラー処理法</a></li>
<li><a class="reference internal" href="#putting-it-all-together">36.1.2.9. 全てをつなぎ合わせる</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-guide">36.1.3. リファレンスガイド</a><ul>
<li><a class="reference internal" href="#creating-the-parser">36.1.3.1. parserを作る</a></li>
<li><a class="reference internal" href="#populating-the-parser">36.1.3.2. パーザへのオプション追加</a></li>
<li><a class="reference internal" href="#defining-options">36.1.3.3. オプションの定義</a></li>
<li><a class="reference internal" href="#option-attributes">36.1.3.4. オプション属性</a></li>
<li><a class="reference internal" href="#standard-option-actions">36.1.3.5. 標準的なオプション・アクション</a></li>
<li><a class="reference internal" href="#standard-option-types">36.1.3.6. 標準のオプション型</a></li>
<li><a class="reference internal" href="#parsing-arguments">36.1.3.7. 引数を解析する</a></li>
<li><a class="reference internal" href="#querying-and-manipulating-your-option-parser">36.1.3.8. オプション解析器への問い合わせと操作</a></li>
<li><a class="reference internal" href="#conflicts-between-options">36.1.3.9. オプション間の衝突</a></li>
<li><a class="reference internal" href="#cleanup">36.1.3.10. クリーンアップ</a></li>
<li><a class="reference internal" href="#other-methods">36.1.3.11. その他のメソッド</a></li>
</ul>
</li>
<li><a class="reference internal" href="#option-callbacks">36.1.4. オプション処理コールバック</a><ul>
<li><a class="reference internal" href="#defining-a-callback-option">36.1.4.1. callbackオプションの定義</a></li>
<li><a class="reference internal" href="#how-callbacks-are-called">36.1.4.2. コールバック関数はどのように呼び出されるか</a></li>
<li><a class="reference internal" href="#raising-errors-in-a-callback">36.1.4.3. コールバック中で例外を送出する</a></li>
<li><a class="reference internal" href="#callback-example-1-trivial-callback">36.1.4.4. コールバックの例 1: ありふれたコールバック</a></li>
<li><a class="reference internal" href="#callback-example-2-check-option-order">36.1.4.5. コールバックの例 2: オプションの順番をチェックする</a></li>
<li><a class="reference internal" href="#callback-example-3-check-option-order-generalized">36.1.4.6. コールバックの例 3: オプションの順番をチェックする (汎用的)</a></li>
<li><a class="reference internal" href="#callback-example-4-check-arbitrary-condition">36.1.4.7. コールバックの例 4: 任意の条件をチェックする</a></li>
<li><a class="reference internal" href="#callback-example-5-fixed-arguments">36.1.4.8. コールバックの例5: 固定引数</a></li>
<li><a class="reference internal" href="#callback-example-6-variable-arguments">36.1.4.9. コールバックの例6: 可変個の引数</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extending-optparse">36.1.5. <code class="docutils literal"><span class="pre">optparse</span></code> の拡張</a><ul>
<li><a class="reference internal" href="#adding-new-types">36.1.5.1. 新しい型の追加</a></li>
<li><a class="reference internal" href="#adding-new-actions">36.1.5.2. 新しいアクションの追加</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="superseded.html"
                        title="前の章へ">36. 取って代わられたモジュール群</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="imp.html"
                        title="次の章へ">36.2. <code class="docutils literal"><span class="pre">imp</span></code> &#8212; <code class="docutils literal"><span class="pre">import</span></code> 内部へのアクセス</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/3.6/Doc/library/optparse.rst"
            rel="nofollow">ソースの表示
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="imp.html" title="36.2. imp — import 内部へのアクセス"
             >次へ</a> |</li>
        <li class="right" >
          <a href="superseded.html" title="36. 取って代わられたモジュール群"
             >前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="version_switcher_placeholder">3.6.0</span>
          <a href="../index.html">ドキュメント</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="superseded.html" >36. 取って代わられたモジュール群</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">Copyright</a> 2001-2017, Python Software Foundation.
    <br />
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
    <br />
    最終更新日時: 2月 23, 2017
    <a href="../bugs.html">バグを見つけたら</a>?
    <br />
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.9 を使って作成されました。
    </div>

  </body>
</html>