<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>21.2. cgi — CGI (ゲートウェイインタフェース規格) のサポート &#8212; Python 3.6.0 ドキュメント</title>
    
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.6.0 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Python 3.6.0 ドキュメント" href="../contents.html" />
    <link rel="up" title="21. インターネットプロトコルとサポート" href="internet.html" />
    <link rel="next" title="21.3. cgitb — CGI スクリプトのトレースバック管理機構" href="cgitb.html" />
    <link rel="prev" title="21.1. webbrowser — 便利なウェブブラウザコントローラー" href="webbrowser.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <link rel="canonical" href="https://docs.python.jp/3/library/cgi.html" /><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/cgi.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="../_static/version_switch.js"></script>
    
    
 

  </head>
  <body role="document">  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="cgitb.html" title="21.3. cgitb — CGI スクリプトのトレースバック管理機構"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="webbrowser.html" title="21.1. webbrowser — 便利なウェブブラウザコントローラー"
             accesskey="P">前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="version_switcher_placeholder">3.6.0</span>
          <a href="../index.html">ドキュメント</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="internet.html" accesskey="U">21. インターネットプロトコルとサポート</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-cgi">
<span id="cgi-common-gateway-interface-support"></span><h1>21.2. <a class="reference internal" href="#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface."><code class="xref py py-mod docutils literal"><span class="pre">cgi</span></code></a> &#8212; CGI (ゲートウェイインタフェース規格) のサポート<a class="headerlink" href="#module-cgi" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><strong>ソースコード:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.6/Lib/cgi.py">Lib/cgi.py</a></p>
<hr class="docutils" id="index-0" />
<p>ゲートウェイインタフェース規格 (CGI) に準拠したスクリプトをサポートするためのモジュールです。</p>
<p>このモジュールでは、Python で CGI スクリプトを書く際に使える様々なユーティリティを定義しています。</p>
<div class="section" id="introduction">
<h2>21.2.1. はじめに<a class="headerlink" href="#introduction" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p id="cgi-intro">CGI スクリプトは、HTTP サーバによって起動され、通常は HTML の <code class="docutils literal"><span class="pre">&lt;FORM&gt;</span></code> または <code class="docutils literal"><span class="pre">&lt;ISINDEX&gt;</span></code> エレメントを通じてユーザが入力した内容を処理します。</p>
<p>ほとんどの場合、CGI スクリプトはサーバ上の特殊なディレクトリ <code class="file docutils literal"><span class="pre">cgi-bin</span></code> の下に置きます。HTTP サーバは、まずスクリプトを駆動するためのシェルの環境変数に、リクエストの全ての情報 (クライアントのホスト名、リクエストされている URL、クエリ文字列、その他諸々) を設定し、スクリプトを実行した後、スクリプトの出力をクライアントに送信します。</p>
<p>スクリプトの入力端もクライアントに接続されていて、この経路を通じてフォームデータを読み込むこともあります。それ以外の場合には、フォームデータは URL の一部分である「クエリ文字列」を介して渡されます。このモジュールでは、上記のケースの違いに注意しつつ、Python スクリプトに対しては単純なインタフェースを提供しています。このモジュールではまた、スクリプトをデバッグするためのユーティリティも多数提供しています。また、最近はフォームを経由したファイルのアップロードをサポートしています (ブラウザ側がサポートしていればです)。</p>
<p>CGI スクリプトの出力は 2 つのセクションからなり、空行で分割されています。最初のセクションは複数のヘッダからなり、後続するデータがどのようなものかをクライアントに通知します。最小のヘッダセクションを生成するための Python のコードは以下のようなものです:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/html&quot;</span><span class="p">)</span>    <span class="c1"># HTML is following</span>
<span class="nb">print</span><span class="p">()</span>                             <span class="c1"># blank line, end of headers</span>
</pre></div>
</div>
<p>二つ目のセクションは通常、ヘッダやインラインイメージ等の付属したテキストをうまくフォーマットして表示できるようにした HTML です。以下に単純な HTML を出力する Python コードを示します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;TITLE&gt;CGI script output&lt;/TITLE&gt;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;H1&gt;This is my first CGI script&lt;/H1&gt;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-cgi-module">
<span id="id1"></span><h2>21.2.2. cgi モジュールを使う<a class="headerlink" href="#using-the-cgi-module" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><code class="docutils literal"><span class="pre">import</span> <span class="pre">cgi</span></code> と記述して開始します。</p>
<p>新たにスクリプトを書く際には、以下の行を付加するかどうか検討してください:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cgitb</span>
<span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</pre></div>
</div>
<p>これによって、特別な例外処理が有効にされ、エラーが発生した際にブラウザ上に詳細なレポートを出力するようになります。ユーザにスクリプトの内部を見せたくないのなら、以下のようにしてレポートをファイルに保存できます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cgitb</span>
<span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;/path/to/logdir&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>スクリプトを開発する際には、この機能はとても役に立ちます。 <a class="reference internal" href="cgitb.html#module-cgitb" title="cgitb: Configurable traceback handler for CGI scripts."><code class="xref py py-mod docutils literal"><span class="pre">cgitb</span></code></a> が生成する報告はバグを追跡するためにかかる時間を大幅に減らせるような情報を提供してくれます。スクリプトをテストし終わり、正確に動作することを確認したら、いつでも <code class="docutils literal"><span class="pre">cgitb</span></code> の行を削除できます。</p>
<p>入力されたフォームデータを取得するには、 <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> クラスを使います。フォームが非 ASCII 文字を含んでいる場合は、 <em>encoding</em> キーワードパラメータを使用してドキュメントに対して定義されたエンコーディングの値を設定してください。それは、通常 HTML ドキュメントの HEAD セクション中の META タグ、あるいは  <em class="mailheader">Content-Type</em> ヘッダーに含まれています。これは、標準入力または環境変数からフォームの内容を読み出します (どちらから読み出すかは、複数の環境変数の値が CGI 標準に従ってどのように設定されているかで決まります)。インスタンスが標準入力を使うかもしれないので、インスタンス生成を行うのは一度だけにしなければなりません。</p>
<p><code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> のインスタンスは Python の辞書型のように添え字アクセスが可能です。 <a class="reference internal" href="../reference/expressions.html#in"><code class="xref std std-keyword docutils literal"><span class="pre">in</span></code></a> を使用することによって要素が含まれているかの判定も出来ますし、標準の辞書メソッド <a class="reference internal" href="stdtypes.html#dict.keys" title="dict.keys"><code class="xref py py-meth docutils literal"><span class="pre">keys()</span></code></a> 及び組み込み関数 <a class="reference internal" href="functions.html#len" title="len"><code class="xref py py-func docutils literal"><span class="pre">len()</span></code></a> もサポートしています。空の文字列を含むフォーム要素は無視され、辞書には現れません。そのような値を保持するには、<code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> のインスタンス作成の際にオプションのキーワードパラメータ <em>keep_blank_values</em> に true を指定してください。</p>
<p>例えば、以下のコード (<em class="mailheader">Content-Type</em> ヘッダと空行はすでに出力された後とします) は <code class="docutils literal"><span class="pre">name</span></code> および <code class="docutils literal"><span class="pre">addr</span></code> フィールドが両方とも空の文字列に設定されていないか調べます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">form</span> <span class="ow">or</span> <span class="s2">&quot;addr&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">form</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;H1&gt;Error&lt;/H1&gt;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please fill in the name and addr fields.&quot;</span><span class="p">)</span>
    <span class="k">return</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;name:&quot;</span><span class="p">,</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;addr:&quot;</span><span class="p">,</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;addr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="o">...</span><span class="n">further</span> <span class="n">form</span> <span class="n">processing</span> <span class="n">here</span><span class="o">...</span>
</pre></div>
</div>
<p>ここで、 <code class="docutils literal"><span class="pre">form[key]</span></code> で参照される各フィールドはそれ自体が <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> (または <code class="xref py py-class docutils literal"><span class="pre">MiniFieldStorage</span></code> 。フォームのエンコードによって変わります) のインスタンスです。インスタンスの属性 <code class="xref py py-attr docutils literal"><span class="pre">value</span></code> の内容は対応するフィールドの値で、文字列になります。 <code class="xref py py-meth docutils literal"><span class="pre">getvalue()</span></code> メソッドはこの文字列値を直接返します。 <code class="xref py py-meth docutils literal"><span class="pre">getvalue()</span></code> の 2 つめの引数にオプションの値を与えると、リクエストされたキーが存在しない場合に返すデフォルトの値になります。</p>
<p>入力されたフォームデータに同じ名前のフィールドが二つ以上あれば、 <code class="docutils literal"><span class="pre">form[key]</span></code> で得られるオブジェクトは <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> や <code class="xref py py-class docutils literal"><span class="pre">MiniFieldStorage</span></code> のインスタンスではなく、そうしたインスタンスのリストになります。この場合、 <code class="docutils literal"><span class="pre">form.getvalue(key)</span></code> も同様に、文字列からなるリストを返します。もしこうした状況が起きうると思うなら (HTML のフォームに同じ名前をもったフィールドが複数含まれているのなら) 、 <a class="reference internal" href="#cgi.FieldStorage.getlist" title="cgi.FieldStorage.getlist"><code class="xref py py-meth docutils literal"><span class="pre">getlist()</span></code></a> メソッドを使ってください。これは常に値のリストを返します (単一要素のケースを特別扱いする必要はありません)。例えば、以下のコードは任意の数のユーザ名フィールドを結合し、コンマで分割された文字列にします:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
<span class="n">usernames</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>フィールドがアップロードされたファイルを表している場合、 <code class="xref py py-attr docutils literal"><span class="pre">value</span></code> 属性や <code class="xref py py-meth docutils literal"><span class="pre">getvalue()</span></code> メソッドを使ってフィールドの値にアクセスすると、ファイルの内容をすべてメモリ上にバイト列として読み込みます。これは場合によっては望ましい動作ではないかもしれません。アップロードされたファイルがあるかどうかは <code class="xref py py-attr docutils literal"><span class="pre">filename</span></code> 属性および <code class="xref py py-attr docutils literal"><span class="pre">file</span></code> 属性のいずれかで調べられます。そして、 <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> インスタンスのガベージコレクションの一部として自動的に閉じられるまでの間に、 <code class="xref py py-attr docutils literal"><span class="pre">file</span></code> 属性から以下のようにデータを読み込むことができます (<a class="reference internal" href="io.html#io.RawIOBase.read" title="io.RawIOBase.read"><code class="xref py py-func docutils literal"><span class="pre">read()</span></code></a> および <a class="reference internal" href="io.html#io.IOBase.readline" title="io.IOBase.readline"><code class="xref py py-func docutils literal"><span class="pre">readline()</span></code></a> メソッドはバイト列を返します):</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">fileitem</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="s2">&quot;userfile&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">fileitem</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
    <span class="c1"># It&#39;s an uploaded file; count lines</span>
    <span class="n">linecount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">fileitem</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> <span class="k">break</span>
        <span class="n">linecount</span> <span class="o">=</span> <span class="n">linecount</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> オブジェクトは <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal"><span class="pre">with</span></code></a> 文での使用にも対応しています。 with 文を使用した場合、オブジェクトは終了時に自動的に閉じられます。</p>
<p>アップロードされたファイルの内容を取得している間にエラーが発生した場合 (例えば、ユーザーが戻るボタンやキャンセルボタンで submit を中断した場合)、そのフィールドのオブジェクトの <code class="xref py py-attr docutils literal"><span class="pre">done</span></code> 属性には -1 が設定されます。</p>
<p>現在ドラフトとなっているファイルアップロードの標準仕様では、一つのフィールドから (再帰的な <em class="mimetype">multipart/*</em> エンコーディングを使って) 複数のファイルがアップロードされる可能性を受け入れています。この場合、アイテムは辞書形式の <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> アイテムとなります。複数ファイルかどうかは <code class="xref py py-attr docutils literal"><span class="pre">type</span></code> 属性が <em class="mimetype">multipart/form-data</em> (または <em class="mimetype">multipart/*</em> にマッチする他の MIME 型) になっているかどうかを調べれば判別できます。この場合、トップレベルのフォームオブジェクトと同様にして再帰的に個別処理できます。</p>
<p>フォームが「古い」形式で入力された場合 (クエリ文字列または単一の <em class="mimetype">application/x-www-form-urlencoded</em> データで入力された場合)、データ要素の実体は <code class="xref py py-class docutils literal"><span class="pre">MiniFieldStorage</span></code> クラスのインスタンスになります。この場合、 <code class="xref py py-attr docutils literal"><span class="pre">list</span></code> 、 <code class="xref py py-attr docutils literal"><span class="pre">file</span></code> 、および <code class="xref py py-attr docutils literal"><span class="pre">filename</span></code> 属性は常に <code class="docutils literal"><span class="pre">None</span></code> になります。</p>
<p>フォームがPOSTによって送信され、クエリー文字列も持っていた場合、 <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> と <code class="xref py py-class docutils literal"><span class="pre">MiniFieldStorage</span></code> の両方が含まれます。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.4 で変更: </span><code class="xref py py-attr docutils literal"><span class="pre">file</span></code> 属性は、それを作成した <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> インスタンスのガベージコレクションによって自動的に閉じられます。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> クラスにコンテキスト管理プロトコルのサポートが追加されました。</p>
</div>
</div>
<div class="section" id="higher-level-interface">
<h2>21.2.3. 高水準インタフェース<a class="headerlink" href="#higher-level-interface" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>前節では CGI フォームデータを <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> クラスを使って読み出す方法について解説しました。この節では、フォームデータを分かりやすく直感的な方法で読み出せるようにするために追加された、より高水準のインタフェースについて記述します。このインタフェースは前節で説明した技術を撤廃するものではありません &#8212; 例えば、前節の技術は依然としてファイルのアップロードを効率的に行う上で便利です。</p>
<p>このインタフェースは 2 つの単純なメソッドからなります。このメソッドを使えば、一般的な方法でフォームデータを処理でき、ある名前のフィールドに入力された値が一つなのかそれ以上なのかを心配する必要がなくなります。</p>
<p>前節では、一つのフィールド名に対して二つ以上の値が入力されるかもしれない場合には、常に以下のようなコードを書くよう学びました:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">item</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
    <span class="c1"># The user is requesting more than one item.</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># The user is requesting only one item.</span>
</pre></div>
</div>
<p>こういった状況は、例えば以下のように、同じ名前を持った複数のチェックボックスからなるグループがフォームに入っているような場合によく起きます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;item&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;item&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="o">/&gt;</span>
</pre></div>
</div>
<p>しかしながら、ほとんどの場合、あるフォーム中で特定の名前を持ったコントロールはただ一つしかないので、その名前に関連付けられた値はただ一つしかないはずだと考えるでしょう。そこで、スクリプトには例えば以下のようなコードを書くでしょう:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</pre></div>
</div>
<p>このコードの問題点は、クライアント側がスクリプトにとって常に有効な入力を提供するとは期待できないところにあります。例えば、もし好奇心旺盛なユーザがもう一つの <code class="docutils literal"><span class="pre">user=foo</span></code> ペアをクエリ文字列に追加したら、 <code class="docutils literal"><span class="pre">getvalue(&quot;user&quot;)</span></code> メソッドは文字列ではなくリストを返すため、このスクリプトはクラッシュするでしょう。リストに対して <a class="reference internal" href="stdtypes.html#str.upper" title="str.upper"><code class="xref py py-meth docutils literal"><span class="pre">upper()</span></code></a> メソッドを呼び出すと、引数が有効でない (リスト型はその名前のメソッドを持っていない) ため、例外 <a class="reference internal" href="exceptions.html#AttributeError" title="AttributeError"><code class="xref py py-exc docutils literal"><span class="pre">AttributeError</span></code></a> を送出します。</p>
<p>従って、フォームデータの値を読み出しには、得られた値が単一の値なのか値のリストなのかを常に調べるコードを使うのが適切でした。これでは煩わしく、より読みにくいスクリプトになってしまいます。</p>
<p>ここで述べる高水準のインタフェースで提供している <a class="reference internal" href="#cgi.FieldStorage.getfirst" title="cgi.FieldStorage.getfirst"><code class="xref py py-meth docutils literal"><span class="pre">getfirst()</span></code></a> や <a class="reference internal" href="#cgi.FieldStorage.getlist" title="cgi.FieldStorage.getlist"><code class="xref py py-meth docutils literal"><span class="pre">getlist()</span></code></a> メソッドを使うと、もっと便利にアプローチできます。</p>
<dl class="method">
<dt id="cgi.FieldStorage.getfirst">
<code class="descclassname">FieldStorage.</code><code class="descname">getfirst</code><span class="sig-paren">(</span><em>name</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#cgi.FieldStorage.getfirst" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>フォームフィールド <em>name</em> に関連付けられた値をつねに一つだけ返す軽量メソッドです。同じ名前で 1 つ以上の値がポストされている場合、このメソッドは最初の値だけを返します。フォームから値を受信する際の値の並び順はブラウザ間で異なる可能性があり、特定の順番であるとは期待できないので注意してください。<a class="footnote-reference" href="#id3" id="id2">[1]</a> 指定したフォームフィールドや値がない場合、このメソッドはオプションの引数 <em>default</em> を返します。このパラメタを指定しない場合、標準の値は <code class="docutils literal"><span class="pre">None</span></code> に設定されます。</p>
</dd></dl>

<dl class="method">
<dt id="cgi.FieldStorage.getlist">
<code class="descclassname">FieldStorage.</code><code class="descname">getlist</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#cgi.FieldStorage.getlist" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このメソッドはフォームフィールド <em>name</em> に関連付けられた値を常にリストにして返します。<em>name</em> に指定したフォームフィールドや値が存在しない場合、このメソッドは空のリストを返します。値が一つだけ存在する場合、要素を一つだけ含むリストを返します。</p>
</dd></dl>

<p>これらのメソッドを使うことで、以下のようにナイスでコンパクトにコードを書けます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cgi</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getfirst</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>    <span class="c1"># This way it&#39;s safe.</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">form</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">):</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="functions">
<span id="functions-in-cgi-module"></span><h2>21.2.4. 関数<a class="headerlink" href="#functions" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>より細かく CGI をコントロールしたり、このモジュールで実装されているアルゴリズムを他の状況で利用したい場合には、以下の関数が便利です。</p>
<dl class="function">
<dt id="cgi.parse">
<code class="descclassname">cgi.</code><code class="descname">parse</code><span class="sig-paren">(</span><em>fp=None</em>, <em>environ=os.environ</em>, <em>keep_blank_values=False</em>, <em>strict_parsing=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cgi.parse" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>環境変数、またはファイルからからクエリを解釈します (ファイルは標準で <code class="docutils literal"><span class="pre">sys.stdin</span></code> になります) <em>keep_blank_values</em> および <em>strict_parsing</em> パラメタはそのまま <a class="reference internal" href="urllib.parse.html#urllib.parse.parse_qs" title="urllib.parse.parse_qs"><code class="xref py py-func docutils literal"><span class="pre">urllib.parse.parse_qs()</span></code></a> に渡されます。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.parse_qs">
<code class="descclassname">cgi.</code><code class="descname">parse_qs</code><span class="sig-paren">(</span><em>qs</em>, <em>keep_blank_values=False</em>, <em>strict_parsing=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cgi.parse_qs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>この関数はこのモジュールでは廃止予定です。 代わりに <a class="reference internal" href="urllib.parse.html#urllib.parse.parse_qs" title="urllib.parse.parse_qs"><code class="xref py py-func docutils literal"><span class="pre">urllib.parse.parse_qs()</span></code></a> を利用してください。 この関数は後方互換性のためだけに残されています。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.parse_qsl">
<code class="descclassname">cgi.</code><code class="descname">parse_qsl</code><span class="sig-paren">(</span><em>qs</em>, <em>keep_blank_values=False</em>, <em>strict_parsing=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cgi.parse_qsl" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>この関数はこのモジュールでは廃止予定です。 代わりに <a class="reference internal" href="urllib.parse.html#urllib.parse.parse_qsl" title="urllib.parse.parse_qsl"><code class="xref py py-func docutils literal"><span class="pre">urllib.parse.parse_qsl()</span></code></a> を利用してください。 この関数は後方互換性のためだけに残されています。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.parse_multipart">
<code class="descclassname">cgi.</code><code class="descname">parse_multipart</code><span class="sig-paren">(</span><em>fp</em>, <em>pdict</em><span class="sig-paren">)</span><a class="headerlink" href="#cgi.parse_multipart" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>(ファイル入力のための) <em class="mimetype">multipart/form-data</em> 型の入力を解釈します。引数は入力ファイルを示す <em>fp</em> と <em class="mailheader">Content-Type</em> ヘッダ内の他のパラメタを含む辞書 <em>pdict</em> です。</p>
<p><a class="reference internal" href="urllib.parse.html#urllib.parse.parse_qs" title="urllib.parse.parse_qs"><code class="xref py py-func docutils literal"><span class="pre">urllib.parse.parse_qs()</span></code></a> と同じく辞書を返します。辞書のキーはフィールド名で、対応する値は各フィールドの値でできたリストです。この関数は簡単に使えますが、数メガバイトのデータがアップロードされると考えられる場合にはあまり適していません &#8212; その場合、より柔軟性のある <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> を代りに使ってください。</p>
<p>マルチパートデータがネストしている場合、各パートを解釈できないので注意してください &#8212; 代りに <code class="xref py py-class docutils literal"><span class="pre">FieldStorage</span></code> を使ってください。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.parse_header">
<code class="descclassname">cgi.</code><code class="descname">parse_header</code><span class="sig-paren">(</span><em>string</em><span class="sig-paren">)</span><a class="headerlink" href="#cgi.parse_header" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>(<em class="mailheader">Content-Type</em> のような) MIME ヘッダを解釈し、ヘッダの主要値と各パラメタからなる辞書にします。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.test">
<code class="descclassname">cgi.</code><code class="descname">test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cgi.test" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>メインプログラムから利用できる堅牢性テストを行う CGI スクリプトです。最小の HTTP ヘッダと、HTML フォームからスクリプトに供給された全ての情報を書式化して出力します。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.print_environ">
<code class="descclassname">cgi.</code><code class="descname">print_environ</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cgi.print_environ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>シェル変数を HTML に書式化して出力します。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.print_form">
<code class="descclassname">cgi.</code><code class="descname">print_form</code><span class="sig-paren">(</span><em>form</em><span class="sig-paren">)</span><a class="headerlink" href="#cgi.print_form" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>フォームを HTML に初期化して出力します。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.print_directory">
<code class="descclassname">cgi.</code><code class="descname">print_directory</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cgi.print_directory" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>現在のディレクトリを HTML に書式化して出力します。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.print_environ_usage">
<code class="descclassname">cgi.</code><code class="descname">print_environ_usage</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cgi.print_environ_usage" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>意味のある (CGI の使う) 環境変数を HTML で出力します。</p>
</dd></dl>

<dl class="function">
<dt id="cgi.escape">
<code class="descclassname">cgi.</code><code class="descname">escape</code><span class="sig-paren">(</span><em>s</em>, <em>quote=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cgi.escape" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列 <em>s</em> 中の文字 <code class="docutils literal"><span class="pre">'&amp;'</span></code>、<code class="docutils literal"><span class="pre">'&lt;'</span></code>、および  <code class="docutils literal"><span class="pre">'&gt;'</span></code> を HTML で正しく表示できる文字列に変換します。それらの文字が中に入っているかもしれないようなテキストを出力する必要があるときに使ってください。オプションの引数 <em>quote</em> の値が真であれば、二重引用符文字 (<code class="docutils literal"><span class="pre">&quot;</span></code>) も変換します; この機能は <code class="docutils literal"><span class="pre">&lt;a</span> <span class="pre">href=&quot;...&quot;&gt;</span></code> のように二重引用符で区切られた HTML の属性値を出力に含めるのに役立ちます。単引用符は変換されないことに注意して下さい。</p>
<div class="deprecated">
<p><span class="versionmodified">バージョン 3.2 で撤廃: </span>この関数は <em>quote</em> がデフォルトで false なので安全ではありません。そのため deprecated になりました。代わりに <a class="reference internal" href="html.html#html.escape" title="html.escape"><code class="xref py py-func docutils literal"><span class="pre">html.escape()</span></code></a> を使ってください。</p>
</div>
</dd></dl>

</div>
<div class="section" id="caring-about-security">
<span id="cgi-security"></span><h2>21.2.5. セキュリティへの配慮<a class="headerlink" href="#caring-about-security" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p id="index-1">重要なルールが一つあります: (関数 <a class="reference internal" href="os.html#os.system" title="os.system"><code class="xref py py-func docutils literal"><span class="pre">os.system()</span></code></a>  または <a class="reference internal" href="os.html#os.popen" title="os.popen"><code class="xref py py-func docutils literal"><span class="pre">os.popen()</span></code></a> 、またはその他の同様の機能によって) 外部プログラムを呼び出すなら、クライアントから受信した任意の文字列をシェルに渡していないことをよく確かめてください。これはよく知られているセキュリティホールであり、これによって Web  のどこかにいる悪賢いハッカーが、だまされやすい CGI スクリプトに任意のシェルコマンドを実行させてしまえます。URL の一部やフィールド名でさえも信用してはいけません。CGI へのリクエストはあなたの作ったフォームから送信されるとは限らないからです！</p>
<p>安全な方法をとるために、フォームから入力された文字をシェルに渡す場合、文字列に入っているのが英数文字、ダッシュ、アンダースコア、およびピリオドだけかどうかを確認してください。</p>
</div>
<div class="section" id="installing-your-cgi-script-on-a-unix-system">
<h2>21.2.6. CGI スクリプトを Unix システムにインストールする<a class="headerlink" href="#installing-your-cgi-script-on-a-unix-system" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>あなたの使っている HTTP サーバのドキュメントを読んでください。そしてローカルシステムの管理者と一緒にどのディレクトリに CGI スクリプトをインストールすべきかを調べてください; 通常これはサーバのファイルシステムツリー内の <code class="file docutils literal"><span class="pre">cgi-bin</span></code> ディレクトリです。</p>
<p>あなたのスクリプトが &#8220;others&#8221; によって読み取り可能および実行可能であることを確認してください; Unix ファイルモードは 8 進表記で <code class="docutils literal"><span class="pre">0o755</span></code> です (<code class="docutils literal"><span class="pre">chmod</span> <span class="pre">0755</span> <span class="pre">filename</span></code> を使ってください)。スクリプトの最初の行の 1 カラム目が、<code class="docutils literal"><span class="pre">#!</span></code> で開始し、その後に Python インタプリタへのパス名が続いていることを確認してください。例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="ch">#!/usr/local/bin/python</span>
</pre></div>
</div>
<p>Python インタプリタが存在し、&#8221;others&#8221; によって実行可能であることを確かめてください。</p>
<p>あなたのスクリプトが読み書きしなければならないファイルが全て &#8220;others&#8221; によって読み出しや書き込み可能であることを確かめてください &#8212; 読み出し可能のファイルモードは <code class="docutils literal"><span class="pre">0o644</span></code> で、書き込み可能のファイルモードは <code class="docutils literal"><span class="pre">0o666</span></code> になるはずです。これは、セキュリティ上の理由から、 HTTP サーバがあなたのスクリプトを特権を全く持たないユーザ &#8220;nobody&#8221; の権限で実行するからです。この権限下では、誰でもが読める (書ける、実行できる) ファイルしか読み出し (書き込み、実行) できません。スクリプト実行時のディレクトリや環境変数のセットもあなたがログインしたときの設定と異なります。特に、実行ファイルに対するシェルの検索パス (<span class="target" id="index-9"></span><code class="xref std std-envvar docutils literal"><span class="pre">PATH</span></code>) や Python のモジュール検索パス (<span class="target" id="index-10"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONPATH"><code class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></code></a>)が何らかの値に設定されていると期待してはいけません。</p>
<p>モジュールを Python の標準設定におけるモジュール検索パス上にないディレクトリからロードする必要がある場合、他のモジュールを取り込む前にスクリプト内で検索パスを変更できます。例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;/usr/home/joe/lib/python&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;/usr/local/lib/python&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(この方法では、最後に挿入されたディレクトリが最初に検索されます！)</p>
<p>非 Unix システムにおける説明は変わるでしょう; あなたの使っている HTTP サーバのドキュメントを調べてください (普通は CGI スクリプトに関する節があります)。</p>
</div>
<div class="section" id="testing-your-cgi-script">
<h2>21.2.7. CGI スクリプトをテストする<a class="headerlink" href="#testing-your-cgi-script" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>残念ながら、CGI スクリプトは普通、コマンドラインから起動しようとしても動きません。また、コマンドラインから起動した場合には完璧に動作するスクリプトが、不思議なことにサーバからの起動では失敗することがあります。しかし、スクリプトをコマンドラインから実行してみなければならない理由が一つあります: もしスクリプトが文法エラーを含んでいれば、Python インタプリタはそのプログラムを全く実行しないため、HTTP サーバはほとんどの場合クライアントに謎めいたエラーを送信するからです。</p>
<p>スクリプトが構文エラーを含まないのにうまく動作しないなら、次の節に読み進むしかありません。</p>
</div>
<div class="section" id="debugging-cgi-scripts">
<h2>21.2.8. CGI スクリプトをデバッグする<a class="headerlink" href="#debugging-cgi-scripts" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p id="index-4">何よりもまず、些細なインストール関連のエラーでないか確認してください &#8212; 上の CGI スクリプトのインストールに関する節を注意深く読めば時間を大いに節約できます。もしインストールの手続きを正しく理解しているか不安なら、このモジュールのファイル (<code class="file docutils literal"><span class="pre">cgi.py</span></code>) をコピーして、CGI スクリプトとしてインストールしてみてください。このファイルはスクリプトとして呼び出すと、スクリプトの実行環境とフォームの内容を HTML 形式で出力します。ファイルに正しいモードを設定するなどして、リクエストを送ってみてください。標準的な <code class="file docutils literal"><span class="pre">cgi-bin</span></code> ディレクトリにインストールされていれば、以下のような URL をブラウザに入力してリクエストを送信できるはずです:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>http://yourhostname/cgi-bin/cgi.py?name=Joe+Blow&amp;addr=At+Home
</pre></div>
</div>
<p>もしタイプ 404 のエラーになるなら、サーバはスクリプトを発見できないでいます &#8211; おそらくあなたはスクリプトを別のディレクトリに入れる必要があるのでしょう。他のエラーになるなら、先に進む前に解決しなければならないインストール上の問題があります。もし実行環境の情報とフォーム内容 (この例では、各フィールドはフィールド名 &#8220;addr&#8221; に対して値 &#8220;At Home&#8221;、およびフィールド名 &#8220;name&#8221; に対して &#8220;Joe Blow&#8221;) が綺麗にフォーマットされて表示されるなら、 <code class="file docutils literal"><span class="pre">cgi.py</span></code> スクリプトは正しくインストールされています。同じ操作をあなたの自作スクリプトに対して行えば、スクリプトをデバッグできるようになるはずです。</p>
<p>次のステップでは <a class="reference internal" href="#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface."><code class="xref py py-mod docutils literal"><span class="pre">cgi</span></code></a> モジュールの <a class="reference internal" href="test.html#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-func docutils literal"><span class="pre">test()</span></code></a> 関数を呼び出すことになります: メインプログラムコードを以下の 1 文と置き換えてください</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">cgi</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>この操作で <code class="file docutils literal"><span class="pre">cgi.py</span></code> ファイル自体をインストールした時と同じ結果を出力するはずです。</p>
<p>通常の Python スクリプトが例外を処理しきれずに送出した場合 (様々な理由: モジュール名のタイプミス、ファイルが開けなかった、など)、Python インタプリタはナイスなトレースバックを出力して終了します。Python インタプリタはあなたの CGI スクリプトが例外を送出した場合にも同様に振舞うので、トレースバックは大抵HTTP サーバのいずれかのログファイルに残るかまったく無視されるかです。</p>
<p>幸運なことに、あなたが自作のスクリプトで <em>何らかの</em> コードを実行できるようになったら、 <a class="reference internal" href="cgitb.html#module-cgitb" title="cgitb: Configurable traceback handler for CGI scripts."><code class="xref py py-mod docutils literal"><span class="pre">cgitb</span></code></a> モジュールを使って簡単にトレースバックをブラウザに送信できます。まだそうでないなら、以下の2行:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cgitb</span>
<span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</pre></div>
</div>
<p>をスクリプトの先頭に追加してください。そしてスクリプトを再度走らせます; 問題が発生すれば、クラッシュの原因を見出せるような詳細な報告を読めます。</p>
<p><a class="reference internal" href="cgitb.html#module-cgitb" title="cgitb: Configurable traceback handler for CGI scripts."><code class="xref py py-mod docutils literal"><span class="pre">cgitb</span></code></a> モジュールのインポートに問題がありそうだと思うなら、(組み込みモジュールだけを使った) もっと堅牢なアプローチを取れます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Content-Type: text/plain&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="o">...</span><span class="n">your</span> <span class="n">code</span> <span class="n">here</span><span class="o">...</span>
</pre></div>
</div>
<p>このコードは Python インタプリタがトレースバックを出力することに依存しています。出力のコンテント型はプレーンテキストに設定されており、全ての HTML 処理を無効にしています。スクリプトがうまく動作する場合、生の HTML コードがクライアントに表示されます。スクリプトが例外を送出する場合、最初の 2 行が出力された後、トレースバックが表示されます。HTML の解釈は行われないので、トレースバックを読めるはずです。</p>
</div>
<div class="section" id="common-problems-and-solutions">
<h2>21.2.9. よくある問題と解決法<a class="headerlink" href="#common-problems-and-solutions" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul class="simple">
<li><p class="first">ほとんどの HTTP サーバはスクリプトの実行が完了するまで CGI からの出力をバッファします。このことは、スクリプトの実行中にクライアントが進捗状況報告を表示できないことを意味します。</p>
</li>
<li><p class="first">上のインストールに関する説明を調べましょう。</p>
</li>
<li><p class="first">HTTP サーバのログファイルを調べましょう。(別のウィンドウで  <code class="docutils literal"><span class="pre">tail</span> <span class="pre">-f</span> <span class="pre">logfile</span></code> を実行すると便利かもしれません！)</p>
</li>
<li><p class="first">常に <code class="docutils literal"><span class="pre">python</span> <span class="pre">script.py</span></code> などとして、スクリプトが構文エラーでないか調べましょう。</p>
</li>
<li><p class="first">スクリプトに構文エラーがないなら、<code class="docutils literal"><span class="pre">import</span> <span class="pre">cgitb;</span> <span class="pre">cgitb.enable()</span></code> をスクリプトの先頭に追加してみましょう。</p>
</li>
<li><p class="first">外部プログラムを起動するときには、スクリプトがそのプログラムを見つけられるようにしましょう。これは通常、絶対パス名を使うことを意味します &#8212; <span class="target" id="index-11"></span><code class="xref std std-envvar docutils literal"><span class="pre">PATH</span></code> は普通、あまり CGI スクリプトにとって便利でない値に設定されています。</p>
</li>
<li><p class="first">外部のファイルを読み書きする際には、CGI スクリプトを動作させるときに使われる userid でファイルを読み書きできるようになっているか確認しましょう: userid は通常、Web サーバを動作させている userid か、Web サーバの <code class="docutils literal"><span class="pre">suexec</span></code> 機能で明示的に指定している userid になります。</p>
</li>
<li><p class="first">CGI スクリプトを set-uid モードにしてはいけません。これはほとんどのシステムで動作せず、セキュリティ上の信頼性もありません。</p>
</li>
</ul>
<p class="rubric">脚注</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td><p class="first last">最近のバージョンの HTML 仕様ではフィールドの値を供給する順番を取り決めてはいますが、ある HTTP リクエストがその取り決めに準拠したブラウザから受信したものかどうか、そもそもブラウザから送信されたものかどうかの判別は退屈で間違いやすいので注意してください。</p>
</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">21.2. <code class="docutils literal"><span class="pre">cgi</span></code> &#8212; CGI (ゲートウェイインタフェース規格) のサポート</a><ul>
<li><a class="reference internal" href="#introduction">21.2.1. はじめに</a></li>
<li><a class="reference internal" href="#using-the-cgi-module">21.2.2. cgi モジュールを使う</a></li>
<li><a class="reference internal" href="#higher-level-interface">21.2.3. 高水準インタフェース</a></li>
<li><a class="reference internal" href="#functions">21.2.4. 関数</a></li>
<li><a class="reference internal" href="#caring-about-security">21.2.5. セキュリティへの配慮</a></li>
<li><a class="reference internal" href="#installing-your-cgi-script-on-a-unix-system">21.2.6. CGI スクリプトを Unix システムにインストールする</a></li>
<li><a class="reference internal" href="#testing-your-cgi-script">21.2.7. CGI スクリプトをテストする</a></li>
<li><a class="reference internal" href="#debugging-cgi-scripts">21.2.8. CGI スクリプトをデバッグする</a></li>
<li><a class="reference internal" href="#common-problems-and-solutions">21.2.9. よくある問題と解決法</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="webbrowser.html"
                        title="前の章へ">21.1. <code class="docutils literal"><span class="pre">webbrowser</span></code> &#8212; 便利なウェブブラウザコントローラー</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="cgitb.html"
                        title="次の章へ">21.3. <code class="docutils literal"><span class="pre">cgitb</span></code> &#8212; CGI スクリプトのトレースバック管理機構</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/3.6/Doc/library/cgi.rst"
            rel="nofollow">ソースの表示
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="cgitb.html" title="21.3. cgitb — CGI スクリプトのトレースバック管理機構"
             >次へ</a> |</li>
        <li class="right" >
          <a href="webbrowser.html" title="21.1. webbrowser — 便利なウェブブラウザコントローラー"
             >前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="version_switcher_placeholder">3.6.0</span>
          <a href="../index.html">ドキュメント</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="internet.html" >21. インターネットプロトコルとサポート</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">Copyright</a> 2001-2017, Python Software Foundation.
    <br />
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
    <br />
    最終更新日時: 3月 08, 2017
    <a href="../bugs.html">バグを見つけたら</a>?
    <br />
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.9 を使って作成されました。
    </div>

  </body>
</html>