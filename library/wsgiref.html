
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>21.4. wsgiref — WSGI ユーティリティとリファレンス実装 &#8212; Python 3.6.5 ドキュメント</title>
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.6.5 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="21.5. urllib — URL を扱うモジュール群" href="urllib.html" />
    <link rel="prev" title="21.3. cgitb — CGI スクリプトのトレースバック管理機構" href="cgitb.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <link rel="canonical" href="https://docs.python.jp/3/library/wsgiref.html" /><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/library/wsgiref.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/version_switch.js"></script>
    
    
 

  </head>
  <body>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="urllib.html" title="21.5. urllib — URL を扱うモジュール群"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="cgitb.html" title="21.3. cgitb — CGI スクリプトのトレースバック管理機構"
             accesskey="P">前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="version_switcher_placeholder">3.6.5</span>
          <a href="../index.html">ドキュメント</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="internet.html" accesskey="U">21. インターネットプロトコルとサポート</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-wsgiref">
<span id="wsgiref-wsgi-utilities-and-reference-implementation"></span><h1>21.4. <a class="reference internal" href="#module-wsgiref" title="wsgiref: WSGI Utilities and Reference Implementation."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref</span></code></a> — WSGI ユーティリティとリファレンス実装<a class="headerlink" href="#module-wsgiref" title="このヘッドラインへのパーマリンク">¶</a></h1>
<hr class="docutils" />
<p>Web Server Gateway Interface (WSGI) は、Web サーバソフトウェアと Python で記述された Web アプリケーションとの標準インターフェースです。標準インターフェースを持つことで、WSGI をサポートするアプリケーションを幾つもの異なる Web サーバで使うことが容易になります。</p>
<p>Web サーバとプログラミングフレームワークの作者だけが、WSGI デザインのあらゆる細部や特例などを知る必要があります。WSGI アプリケーションをインストールしたり、既存のフレームワークを使ったアプリケーションを記述するだけの皆さんは、すべてについて理解する必要はありません。</p>
<p><a class="reference internal" href="#module-wsgiref" title="wsgiref: WSGI Utilities and Reference Implementation."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref</span></code></a> は WSGI 仕様のリファレンス実装で、これは Web サーバやフレームワークに WSGI サポートを加えるのに利用できます。これは WSGI 環境変数やレスポンスヘッダを操作するユーティリティ、 WSGI サーバ実装時のベースクラス、WSGI アプリケーションを提供する  デモ用 HTTP サーバ、それと WSGI サーバとアプリケーションの WSGI 仕様 (<span class="target" id="index-30"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a>) 準拠のバリデーションツールを提供します。</p>
<p><a class="reference external" href="https://wsgi.readthedocs.org/">https://wsgi.readthedocs.org/</a> に、WSGIに関するさらなる情報と、チュートリアルやその他のリソースへのリンクがあります。</p>
<div class="section" id="module-wsgiref.util">
<span id="wsgiref-util-wsgi-environment-utilities"></span><h2>21.4.1. <a class="reference internal" href="#module-wsgiref.util" title="wsgiref.util: WSGI environment utilities."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.util</span></code></a> – WSGI 環境のユーティリティ<a class="headerlink" href="#module-wsgiref.util" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このモジュールは WSGI 環境で使う様々なユーティリティ関数を提供します。 WSGI 環境は <span class="target" id="index-31"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> で記述されているような HTTP リクエスト変数を含む辞書です。すべての <em>environ</em> パラメータを取る関数は WSGI 準拠の辞書を与えられることを期待しています; 細かい仕様については <span class="target" id="index-32"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> を参照してください。</p>
<dl class="function">
<dt id="wsgiref.util.guess_scheme">
<code class="descclassname">wsgiref.util.</code><code class="descname">guess_scheme</code><span class="sig-paren">(</span><em>environ</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.util.guess_scheme" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>environ</em> 辞書の <code class="docutils literal"><span class="pre">HTTPS</span></code> 環境変数を調べることで <code class="docutils literal"><span class="pre">wsgi.url_scheme</span></code> が &quot;http&quot; か &quot;https&quot; のどちらであるべきか推測し、その結果を返します。戻り値は文字列です。</p>
<p>この関数は、CGI や FastCGI のような CGI に似たプロトコルをラップするゲートウェイを作成する場合に便利です。典型的には、それらのプロトコルを提供するサーバが SSL 経由でリクエストを受け取った場合には <code class="docutils literal"><span class="pre">HTTPS</span></code> 変数に値 &quot;1&quot; &quot;yes&quot;、または &quot;on&quot; を持つでしょう。そのため、この関数はそのような値が見つかった場合には &quot;https&quot; を返し、そうでなければ &quot;http&quot; を返します。</p>
</dd></dl>

<dl class="function">
<dt id="wsgiref.util.request_uri">
<code class="descclassname">wsgiref.util.</code><code class="descname">request_uri</code><span class="sig-paren">(</span><em>environ</em>, <em>include_query=True</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.util.request_uri" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>リクエスト URI 全体 (オプションでクエリ文字列を含む) を、 <span class="target" id="index-33"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> の &quot;URL 再構築(URL Reconstruction)&quot; にあるアルゴリズムを使って返します。 <em>include_query</em> が false の場合、クエリ文字列は結果となる文字列には含まれません。</p>
</dd></dl>

<dl class="function">
<dt id="wsgiref.util.application_uri">
<code class="descclassname">wsgiref.util.</code><code class="descname">application_uri</code><span class="sig-paren">(</span><em>environ</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.util.application_uri" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">PATH_INFO</span></code> と <code class="docutils literal"><span class="pre">QUERY_STRING</span></code> 変数が無視されることを除けば <a class="reference internal" href="#wsgiref.util.request_uri" title="wsgiref.util.request_uri"><code class="xref py py-func docutils literal"><span class="pre">request_uri()</span></code></a> に似ています。結果はリクエストによって指定されたアプリケーションオブジェクトのベース URI です。</p>
</dd></dl>

<dl class="function">
<dt id="wsgiref.util.shift_path_info">
<code class="descclassname">wsgiref.util.</code><code class="descname">shift_path_info</code><span class="sig-paren">(</span><em>environ</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.util.shift_path_info" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">PATH_INFO</span></code> から <code class="docutils literal"><span class="pre">SCRIPT_NAME</span></code> に一つの名前をシフトしてその名前を返します。<em>environ</em> 辞書は <em>変更されます</em> 。<code class="docutils literal"><span class="pre">PATH_INFO</span></code> や <code class="docutils literal"><span class="pre">SCRIPT_NAME</span></code> のオリジナルをそのまま残したい場合にはコピーを使ってください。</p>
<p><code class="docutils literal"><span class="pre">PATH_INFO</span></code> にパスセグメントが何も残っていなければ、<code class="docutils literal"><span class="pre">None</span></code> が返されます。</p>
<p>典型的なこのルーチンの使い方はリクエスト URI のそれぞれの要素の処理で、例えばパスを一連の辞書のキーとして取り扱う場合です。このルーチンは、渡された環境を、ターゲット URL で示される別の WSGI アプリケーションの呼び出しに合うように調整します。例えば、 <code class="docutils literal"><span class="pre">/foo</span></code> に WSGI アプリケーションがあったとして、そしてリクエスト URL パスが <code class="docutils literal"><span class="pre">/foo/bar/baz</span></code> で、 <code class="docutils literal"><span class="pre">/foo</span></code> の WSGI アプリケーションが <a class="reference internal" href="#wsgiref.util.shift_path_info" title="wsgiref.util.shift_path_info"><code class="xref py py-func docutils literal"><span class="pre">shift_path_info()</span></code></a> を呼んだ場合、これは &quot;bar&quot; 文字列を受け取り、 environ は <code class="docutils literal"><span class="pre">/foo/bar</span></code> の WSGI アプリケーションへの受け渡しに適するように更新されます。つまり、 <code class="docutils literal"><span class="pre">SCRIPT_NAME</span></code> は <code class="docutils literal"><span class="pre">/foo</span></code> から <code class="docutils literal"><span class="pre">/foo/bar</span></code> に変わって、 <code class="docutils literal"><span class="pre">PATH_INFO</span></code> は <code class="docutils literal"><span class="pre">/bar/baz</span></code> から <code class="docutils literal"><span class="pre">/baz</span></code> に変化するのです。</p>
<p><code class="docutils literal"><span class="pre">PATH_INFO</span></code> が単に &quot;/&quot; の場合、このルーチンは空の文字列を返し、<code class="docutils literal"><span class="pre">SCRIPT_NAME</span></code> の末尾にスラッシュを加えます、これはたとえ空のパスセグメントが通常は無視され、そして <code class="docutils literal"><span class="pre">SCRIPT_NAME</span></code> は通常スラッシュで終わる事が無かったとしてもです。これは意図的な振る舞いで、このルーチンでオブジェクト巡回(object traversal) をした場合に <code class="docutils literal"><span class="pre">/x</span></code> で終わる URI と <code class="docutils literal"><span class="pre">/x/</span></code> で終わるものをアプリケーションが識別できることを保証するためのものです。</p>
</dd></dl>

<dl class="function">
<dt id="wsgiref.util.setup_testing_defaults">
<code class="descclassname">wsgiref.util.</code><code class="descname">setup_testing_defaults</code><span class="sig-paren">(</span><em>environ</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.util.setup_testing_defaults" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>environ</em> をテスト用に自明なデフォルト値で更新します。</p>
<p>このルーチンは WSGI に必要な様々なパラメータを追加します。そのようなパラメータとして <code class="docutils literal"><span class="pre">HTTP_HOST</span></code> 、 <code class="docutils literal"><span class="pre">SERVER_NAME</span></code> 、 <code class="docutils literal"><span class="pre">SERVER_PORT</span></code> 、 <code class="docutils literal"><span class="pre">REQUEST_METHOD</span></code> 、 <code class="docutils literal"><span class="pre">SCRIPT_NAME</span></code> 、 <code class="docutils literal"><span class="pre">PATH_INFO</span></code> 、そして <span class="target" id="index-34"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> で定義されている <code class="docutils literal"><span class="pre">wsgi.*</span></code> 変数群が含まれます。このルーチンはデフォルト値を提供するだけで、これらの変数の既存設定は一切置きかえません。</p>
<p>このルーチンは、ダミー環境をセットアップすることによって WSGI サーバとアプリケーションのユニットテストを容易にすることを意図しています。これは実際の WSGI サーバやアプリケーションで使うべきではありません。なぜならこのデータは偽物なのです！</p>
<p>使用例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wsgiref.util</span> <span class="k">import</span> <span class="n">setup_testing_defaults</span>
<span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="k">import</span> <span class="n">make_server</span>

<span class="c1"># A relatively simple WSGI application. It&#39;s going to print out the</span>
<span class="c1"># environment dictionary after being updated by setup_testing_defaults</span>
<span class="k">def</span> <span class="nf">simple_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">setup_testing_defaults</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>

    <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;200 OK&#39;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain; charset=utf-8&#39;</span><span class="p">)]</span>

    <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
           <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">environ</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="k">with</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="n">simple_app</span><span class="p">)</span> <span class="k">as</span> <span class="n">httpd</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Serving on port 8000...&quot;</span><span class="p">)</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<p>上記の環境用関数に加えて、 <a class="reference internal" href="#module-wsgiref.util" title="wsgiref.util: WSGI environment utilities."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.util</span></code></a> モジュールも以下のようなその他のユーティリティを提供します:</p>
<dl class="function">
<dt id="wsgiref.util.is_hop_by_hop">
<code class="descclassname">wsgiref.util.</code><code class="descname">is_hop_by_hop</code><span class="sig-paren">(</span><em>header_name</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.util.is_hop_by_hop" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>'header_name' が <span class="target" id="index-35"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2616.html"><strong>RFC 2616</strong></a> で定義されている HTTP/1.1 の &quot;Hop-by-Hop&quot; ヘッダの場合に true を返します。</p>
</dd></dl>

<dl class="class">
<dt id="wsgiref.util.FileWrapper">
<em class="property">class </em><code class="descclassname">wsgiref.util.</code><code class="descname">FileWrapper</code><span class="sig-paren">(</span><em>filelike</em>, <em>blksize=8192</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.util.FileWrapper" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>ファイル風オブジェクトをイテレータ(<a class="reference internal" href="../glossary.html#term-iterator"><span class="xref std std-term">iterator</span></a>)に変換するラッパです。結果のオブジェクトは <a class="reference internal" href="../reference/datamodel.html#object.__getitem__" title="object.__getitem__"><code class="xref py py-meth docutils literal"><span class="pre">__getitem__()</span></code></a> と <a class="reference internal" href="../reference/datamodel.html#object.__iter__" title="object.__iter__"><code class="xref py py-meth docutils literal"><span class="pre">__iter__()</span></code></a> 両方をサポートしますが、これは Python 2.1 と Jython の互換性のためです。オブジェクトがイテレートされる間、オプションの <em>blksize</em> パラメータがくり返し <em>filelike</em> オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">read()</span></code> メソッドに渡されて受け渡すバイト文字列を取得します。 <code class="xref py py-meth docutils literal"><span class="pre">read()</span></code> が空バイト文字列を返した場合、イテレーションは終了して再開されることはありません。</p>
<p><em>filelike</em> に <code class="xref py py-meth docutils literal"><span class="pre">close()</span></code> メソッドがある場合、返されたオブジェクトも <code class="xref py py-meth docutils literal"><span class="pre">close()</span></code> メソッドを持ち、これが呼ばれた場合には <em>filelike</em> オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">close()</span></code> メソッドを呼び出します。</p>
<p>使用例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">wsgiref.util</span> <span class="k">import</span> <span class="n">FileWrapper</span>

<span class="c1"># We&#39;re using a StringIO-buffer for as the file-like object</span>
<span class="n">filelike</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;This is an example file-like object&quot;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
<span class="n">wrapper</span> <span class="o">=</span> <span class="n">FileWrapper</span><span class="p">(</span><span class="n">filelike</span><span class="p">,</span> <span class="n">blksize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-wsgiref.headers">
<span id="wsgiref-headers-wsgi-response-header-tools"></span><h2>21.4.2. <a class="reference internal" href="#module-wsgiref.headers" title="wsgiref.headers: WSGI response header tools."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.headers</span></code></a> – WSGI レスポンスヘッダツール群<a class="headerlink" href="#module-wsgiref.headers" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このモジュールは単一のクラス、 <a class="reference internal" href="#wsgiref.headers.Headers" title="wsgiref.headers.Headers"><code class="xref py py-class docutils literal"><span class="pre">Headers</span></code></a> を提供し、WSGI レスポンスヘッダの操作をマップに似たインターフェースで便利にします。</p>
<dl class="class">
<dt id="wsgiref.headers.Headers">
<em class="property">class </em><code class="descclassname">wsgiref.headers.</code><code class="descname">Headers</code><span class="sig-paren">(</span><span class="optional">[</span><em>headers</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.headers.Headers" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>headers</em> をラップするマップ風オブジェクトを生成します。これは <span class="target" id="index-36"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> に定義されるようなヘッダの名前／値のタプルのリストです。 <em>headers</em> のデフォルト値は空のリストです。</p>
<p><a class="reference internal" href="#wsgiref.headers.Headers" title="wsgiref.headers.Headers"><code class="xref py py-class docutils literal"><span class="pre">Headers</span></code></a> オブジェクトは典型的なマッピング操作をサポートし、これには <a class="reference internal" href="../reference/datamodel.html#object.__getitem__" title="object.__getitem__"><code class="xref py py-meth docutils literal"><span class="pre">__getitem__()</span></code></a> 、 <code class="xref py py-meth docutils literal"><span class="pre">get()</span></code> 、 <a class="reference internal" href="../reference/datamodel.html#object.__setitem__" title="object.__setitem__"><code class="xref py py-meth docutils literal"><span class="pre">__setitem__()</span></code></a> 、 <code class="xref py py-meth docutils literal"><span class="pre">setdefault()</span></code> 、 <a class="reference internal" href="../reference/datamodel.html#object.__delitem__" title="object.__delitem__"><code class="xref py py-meth docutils literal"><span class="pre">__delitem__()</span></code></a> 、 <a class="reference internal" href="../reference/datamodel.html#object.__contains__" title="object.__contains__"><code class="xref py py-meth docutils literal"><span class="pre">__contains__()</span></code></a> を含みます。これらメソッドのそれぞれにおいて、キーはヘッダ名で（大文字小文字は区別しません）、値はそのヘッダ名に関連づけられた最初の値です。ヘッダを設定すると既存のヘッダ値は削除され、ラップされたヘッダのリストの末尾に新しい値が加えられます。既存のヘッダの順番は一般に維持され、ラップされたリストの最後に新しいヘッダが追加されます。</p>
<p>辞書とは違って、 <a class="reference internal" href="#wsgiref.headers.Headers" title="wsgiref.headers.Headers"><code class="xref py py-class docutils literal"><span class="pre">Headers</span></code></a> オブジェクトはラップされたヘッダリストに存在しないキーを取得または削除しようとした場合にもエラーを発生しません。単に、存在しないヘッダの取得は <code class="docutils literal"><span class="pre">None</span></code> を返し、存在しないヘッダの削除は何もしません。</p>
<p><a class="reference internal" href="#wsgiref.headers.Headers" title="wsgiref.headers.Headers"><code class="xref py py-class docutils literal"><span class="pre">Headers</span></code></a> オブジェクトは <code class="xref py py-meth docutils literal"><span class="pre">keys()</span></code> 、 <code class="xref py py-meth docutils literal"><span class="pre">values()</span></code> 、 <code class="xref py py-meth docutils literal"><span class="pre">items()</span></code> メソッドもサポートします。複数の値を持つヘッダがある場合には、 <code class="xref py py-meth docutils literal"><span class="pre">keys()</span></code> と <code class="xref py py-meth docutils literal"><span class="pre">items()</span></code> で返されるリストは同じキーを一つ以上含むことがあります。 <a class="reference internal" href="#wsgiref.headers.Headers" title="wsgiref.headers.Headers"><code class="xref py py-class docutils literal"><span class="pre">Headers</span></code></a> オブジェクトの <code class="docutils literal"><span class="pre">len()</span></code> は、その <code class="xref py py-meth docutils literal"><span class="pre">items()</span></code> の長さと同じであり、ラップされたヘッダリストの長さと同じです。実際、 <code class="xref py py-meth docutils literal"><span class="pre">items()</span></code> メソッドは単にラップされたヘッダリストのコピーを返しているだけです。</p>
<p><a class="reference internal" href="#wsgiref.headers.Headers" title="wsgiref.headers.Headers"><code class="xref py py-class docutils literal"><span class="pre">Headers</span></code></a> オブジェクトに対して <code class="docutils literal"><span class="pre">bytes()</span></code> を呼ぶと、HTTP レスポンスヘッダとして送信するのに適した形に整形されたバイト文字列を返します。それぞれのヘッダはコロンとスペースで区切られた値と共に一列に並んでいます。それぞれの行はキャリッジリターンとラインフィードで終了し、バイト文字列は空行で終了しています。</p>
<p>これらのマッピングインターフェースと整形機能に加えて、 <a class="reference internal" href="#wsgiref.headers.Headers" title="wsgiref.headers.Headers"><code class="xref py py-class docutils literal"><span class="pre">Headers</span></code></a> オブジェクトは複数の値を持つヘッダの取得と追加、MIME パラメータでヘッダを追加するための以下のようなメソッド群も持っています:</p>
<dl class="method">
<dt id="wsgiref.headers.Headers.get_all">
<code class="descname">get_all</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.headers.Headers.get_all" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>指定されたヘッダのすべての値のリストを返します。</p>
<p>返されるリストは、元々のヘッダリストに現れる順、またはこのインスタンスに追加された順に並んでいて、重複を含む場合があります。削除されて加えられたフィールドはすべてヘッダリストの末尾に付きます。与えられた name に対するフィールドが何もなければ、空のリストが返ります。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.headers.Headers.add_header">
<code class="descname">add_header</code><span class="sig-paren">(</span><em>name</em>, <em>value</em>, <em>**_params</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.headers.Headers.add_header" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>(複数の値を持つ可能性のある) ヘッダを、キーワード引数を通じて指定するオプションの MIME パラメータと共に追加します。</p>
<p><em>name</em> は追加するヘッダフィールドです。このヘッダフィールドに MIME パラメータを設定するためにキーワード引数を使うことができます。それぞれのパラメータは文字列か <code class="docutils literal"><span class="pre">None</span></code> でなければいけません。パラメータ中のアンダースコアはダッシュ (-) に変換されます。これは、ダッシュが Python の識別子としては不正なのですが、多くの MIME パラメータはダッシュを含むためです。パラメータ値が文字列の場合、これはヘッダ値のパラメータに <code class="docutils literal"><span class="pre">name=&quot;value&quot;</span></code> の形で追加されます。この値がもし <code class="docutils literal"><span class="pre">None</span></code> の場合、パラメータ名だけが追加されます。（これは値なしの MIME パラメータの場合に使われます。）使い方の例は:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">h</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">,</span> <span class="s1">&#39;attachment&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;bud.gif&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>上記はこのようなヘッダを追加します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">Content</span><span class="o">-</span><span class="n">Disposition</span><span class="p">:</span> <span class="n">attachment</span><span class="p">;</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;bud.gif&quot;</span>
</pre></div>
</div>
</dd></dl>

<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span><em>headers</em> 引数が任意になりました。</p>
</div>
</dd></dl>

</div>
<div class="section" id="module-wsgiref.simple_server">
<span id="wsgiref-simple-server-a-simple-wsgi-http-server"></span><h2>21.4.3. <a class="reference internal" href="#module-wsgiref.simple_server" title="wsgiref.simple_server: A simple WSGI HTTP server."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.simple_server</span></code></a> – シンプルな WSGI HTTP サーバ<a class="headerlink" href="#module-wsgiref.simple_server" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このモジュールは WSGI アプリケーションを提供するシンプルな HTTP サーバです (<a class="reference internal" href="http.server.html#module-http.server" title="http.server: HTTP server and request handlers."><code class="xref py py-mod docutils literal"><span class="pre">http.server</span></code></a> がベースです)。個々のサーバインスタンスは単一の WSGI アプリケーションを、特定のホストとポート上で提供します。もし一つのホストとポート上で複数のアプリケーションを提供したいならば、 <code class="docutils literal"><span class="pre">PATH_INFO</span></code> をパースして個々のリクエストでどのアプリケーションを呼び出すか選択するような WSGI アプリケーションを作る必要があります。（例えば、 <a class="reference internal" href="#module-wsgiref.util" title="wsgiref.util: WSGI environment utilities."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.util</span></code></a> から <code class="xref py py-func docutils literal"><span class="pre">shift_path_info()</span></code> を利用します。）</p>
<dl class="function">
<dt id="wsgiref.simple_server.make_server">
<code class="descclassname">wsgiref.simple_server.</code><code class="descname">make_server</code><span class="sig-paren">(</span><em>host</em>, <em>port</em>, <em>app</em>, <em>server_class=WSGIServer</em>, <em>handler_class=WSGIRequestHandler</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.simple_server.make_server" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>host</em> と <em>port</em> 上で待機し、 <em>app</em> へのコネクションを受け付ける  WSGI サーバを作成します。戻り値は与えられた <em>server_class</em> のインスタンスで、指定された <em>handler_class</em> を使ってリクエストを処理します。 <em>app</em> は <span class="target" id="index-37"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> で定義されるところの WSGI アプリケーションでなければいけません。</p>
<p>使用例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="k">import</span> <span class="n">make_server</span><span class="p">,</span> <span class="n">demo_app</span>

<span class="k">with</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="n">demo_app</span><span class="p">)</span> <span class="k">as</span> <span class="n">httpd</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Serving HTTP on port 8000...&quot;</span><span class="p">)</span>

    <span class="c1"># Respond to requests until process is killed</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

    <span class="c1"># Alternative: serve one request, then exit</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">handle_request</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="wsgiref.simple_server.demo_app">
<code class="descclassname">wsgiref.simple_server.</code><code class="descname">demo_app</code><span class="sig-paren">(</span><em>environ</em>, <em>start_response</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.simple_server.demo_app" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>この関数は小規模ながら完全な WSGI アプリケーションで、 &quot;Hello world!&quot; メッセージと、 <em>environ</em> パラメータに提供されているキー／値のペアを含むテキストページを返します。これは WSGI サーバ (<a class="reference internal" href="#module-wsgiref.simple_server" title="wsgiref.simple_server: A simple WSGI HTTP server."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.simple_server</span></code></a> のような) がシンプルな WSGI アプリケーションを正しく実行できるかを確かめるのに便利です。</p>
</dd></dl>

<dl class="class">
<dt id="wsgiref.simple_server.WSGIServer">
<em class="property">class </em><code class="descclassname">wsgiref.simple_server.</code><code class="descname">WSGIServer</code><span class="sig-paren">(</span><em>server_address</em>, <em>RequestHandlerClass</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.simple_server.WSGIServer" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#wsgiref.simple_server.WSGIServer" title="wsgiref.simple_server.WSGIServer"><code class="xref py py-class docutils literal"><span class="pre">WSGIServer</span></code></a> インスタンスを作成します。 <em>server_address</em> は <code class="docutils literal"><span class="pre">(host,port)</span></code> のタプル、そして <em>RequestHandlerClass</em> はリクエストの処理に使われる <a class="reference internal" href="http.server.html#http.server.BaseHTTPRequestHandler" title="http.server.BaseHTTPRequestHandler"><code class="xref py py-class docutils literal"><span class="pre">http.server.BaseHTTPRequestHandler</span></code></a> のサブクラスでなければいけません。</p>
<p><a class="reference internal" href="#wsgiref.simple_server.make_server" title="wsgiref.simple_server.make_server"><code class="xref py py-func docutils literal"><span class="pre">make_server()</span></code></a> が細かい調整をやってくれるので、通常はこのコンストラクタを呼ぶ必要はありません。</p>
<p><a class="reference internal" href="#wsgiref.simple_server.WSGIServer" title="wsgiref.simple_server.WSGIServer"><code class="xref py py-class docutils literal"><span class="pre">WSGIServer</span></code></a> は <a class="reference internal" href="http.server.html#http.server.HTTPServer" title="http.server.HTTPServer"><code class="xref py py-class docutils literal"><span class="pre">http.server.HTTPServer</span></code></a> のサブクラスなので、そのすべてのメソッド (<code class="xref py py-meth docutils literal"><span class="pre">serve_forever()</span></code> や <code class="xref py py-meth docutils literal"><span class="pre">handle_request()</span></code> のような) が利用できます。 <a class="reference internal" href="#wsgiref.simple_server.WSGIServer" title="wsgiref.simple_server.WSGIServer"><code class="xref py py-class docutils literal"><span class="pre">WSGIServer</span></code></a> も以下のような WSGI 固有メソッドを提供します:</p>
<dl class="method">
<dt id="wsgiref.simple_server.WSGIServer.set_app">
<code class="descname">set_app</code><span class="sig-paren">(</span><em>application</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.simple_server.WSGIServer.set_app" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>呼び出し可能 (callable) な <em>application</em> をリクエストを受け取る WSGI アプリケーションとして設定します。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.simple_server.WSGIServer.get_app">
<code class="descname">get_app</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.simple_server.WSGIServer.get_app" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>現在設定されている呼び出し可能 (callable) アプリケーションを返します。</p>
</dd></dl>

<p>しかしながら、通常はこれらの追加されたメソッドを使う必要はありません。 <a class="reference internal" href="#wsgiref.simple_server.WSGIServer.set_app" title="wsgiref.simple_server.WSGIServer.set_app"><code class="xref py py-meth docutils literal"><span class="pre">set_app()</span></code></a> は普通は <a class="reference internal" href="#wsgiref.simple_server.make_server" title="wsgiref.simple_server.make_server"><code class="xref py py-func docutils literal"><span class="pre">make_server()</span></code></a> によって呼ばれ、 <a class="reference internal" href="#wsgiref.simple_server.WSGIServer.get_app" title="wsgiref.simple_server.WSGIServer.get_app"><code class="xref py py-meth docutils literal"><span class="pre">get_app()</span></code></a> は主にリクエストハンドラインスタンスの便宜上存在するからです。</p>
</dd></dl>

<dl class="class">
<dt id="wsgiref.simple_server.WSGIRequestHandler">
<em class="property">class </em><code class="descclassname">wsgiref.simple_server.</code><code class="descname">WSGIRequestHandler</code><span class="sig-paren">(</span><em>request</em>, <em>client_address</em>, <em>server</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.simple_server.WSGIRequestHandler" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>与えられた <em>request</em> （すなわちソケット）の HTTP ハンドラ、 <em>client_address</em> (<code class="docutils literal"><span class="pre">(host,port)</span></code> のタプル)、 <em>server</em> (<a class="reference internal" href="#wsgiref.simple_server.WSGIServer" title="wsgiref.simple_server.WSGIServer"><code class="xref py py-class docutils literal"><span class="pre">WSGIServer</span></code></a> インスタンス) の HTTP ハンドラを作成します。</p>
<p>このクラスのインスタンスを直接生成する必要はありません; これらは必要に応じて <a class="reference internal" href="#wsgiref.simple_server.WSGIServer" title="wsgiref.simple_server.WSGIServer"><code class="xref py py-class docutils literal"><span class="pre">WSGIServer</span></code></a> オブジェクトによって自動的に生成されます。しかしながら、このクラスをサブクラス化し、 <a class="reference internal" href="#wsgiref.simple_server.make_server" title="wsgiref.simple_server.make_server"><code class="xref py py-func docutils literal"><span class="pre">make_server()</span></code></a> 関数に <em>handler_class</em> として与えることは可能でしょう。サブクラスにおいてオーバーライドする意味のありそうなものは:</p>
<dl class="method">
<dt id="wsgiref.simple_server.WSGIRequestHandler.get_environ">
<code class="descname">get_environ</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.simple_server.WSGIRequestHandler.get_environ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>リクエストに対する WSGI 環境を含む辞書を返します。デフォルト実装では <a class="reference internal" href="#wsgiref.simple_server.WSGIServer" title="wsgiref.simple_server.WSGIServer"><code class="xref py py-class docutils literal"><span class="pre">WSGIServer</span></code></a> オブジェクトの <code class="xref py py-attr docutils literal"><span class="pre">base_environ</span></code> 辞書属性のコンテンツをコピーし、それから HTTP リクエスト由来の様々なヘッダを追加しています。このメソッド呼び出し毎に、 <span class="target" id="index-38"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> に指定されている関連する CGI 環境変数をすべて含む新規の辞書を返さなければいけません。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.simple_server.WSGIRequestHandler.get_stderr">
<code class="descname">get_stderr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.simple_server.WSGIRequestHandler.get_stderr" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">wsgi.errors</span></code> ストリームとして使われるオブジェクトを返します。デフォルト実装では単に <code class="docutils literal"><span class="pre">sys.stderr</span></code> を返します。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.simple_server.WSGIRequestHandler.handle">
<code class="descname">handle</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.simple_server.WSGIRequestHandler.handle" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>HTTP リクエストを処理します。デフォルト実装では実際の WGI アプリケーションインターフェースを実装するのに <a class="reference internal" href="#module-wsgiref.handlers" title="wsgiref.handlers: WSGI server/gateway base classes."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.handlers</span></code></a> クラスを使ってハンドラインスタンスを作成します。</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-wsgiref.validate">
<span id="wsgiref-validate-wsgi-conformance-checker"></span><h2>21.4.4. <a class="reference internal" href="#module-wsgiref.validate" title="wsgiref.validate: WSGI conformance checker."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.validate</span></code></a> — WSGI 準拠チェッカー<a class="headerlink" href="#module-wsgiref.validate" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>WSGI アプリケーションのオブジェクト、フレームワーク、サーバまたはミドルウェアの作成時には、その新規のコードを <a class="reference internal" href="#module-wsgiref.validate" title="wsgiref.validate: WSGI conformance checker."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.validate</span></code></a> を使って準拠の検証をすると便利です。このモジュールは WSGI サーバやゲートウェイと WSGI アプリケーションオブジェクト間の通信を検証する WSGI アプリケーションオブジェクトを作成する関数を提供し、双方のプロトコル準拠をチェックします。</p>
<p>このユーティリティは完全な <span class="target" id="index-39"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> 準拠を保証するものでないことは注意してください; このモジュールでエラーが出ないことは必ずしもエラーが存在しないことを意味しません。しかしこのモジュールがエラーを出したならば、ほぼ確実にサーバかアプリケーションのどちらかが 100% 準拠ではありません。</p>
<p>このモジュールは lan Bicking の &quot;Python Paste&quot; ライブラリの <code class="xref py py-mod docutils literal"><span class="pre">paste.lint</span></code> モジュールをベースにしています。</p>
<dl class="function">
<dt id="wsgiref.validate.validator">
<code class="descclassname">wsgiref.validate.</code><code class="descname">validator</code><span class="sig-paren">(</span><em>application</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.validate.validator" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>application</em> をラップし、新しい WSGI アプリケーションオブジェクトを返します。返されたアプリケーションはすべてのリクエストを元々の <em>application</em> に転送し、<em>application</em> とそれを呼び出すサーバの両方が WSGI 仕様と RFC 2616 の両方に準拠しているかをチェックします。</p>
<p>何らかの非準拠が検出されると、 <a class="reference internal" href="exceptions.html#AssertionError" title="AssertionError"><code class="xref py py-exc docutils literal"><span class="pre">AssertionError</span></code></a> 例外が送出されます; しかし、このエラーがどう扱われるかはサーバ依存であることに注意してください。例えば、 <a class="reference internal" href="#module-wsgiref.simple_server" title="wsgiref.simple_server: A simple WSGI HTTP server."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.simple_server</span></code></a> とその他 <a class="reference internal" href="#module-wsgiref.handlers" title="wsgiref.handlers: WSGI server/gateway base classes."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.handlers</span></code></a> ベースのサーバ（エラー処理メソッドが他のことをするようにオーバライドしていないもの）は単純にエラーが発生したというメッセージとトレースバックのダンプを <code class="docutils literal"><span class="pre">sys.stderr</span></code> やその他のエラーストリームに出力します。</p>
<p>このラッパは、疑わしいものの実際には <span class="target" id="index-40"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> で禁止されていないかもしれない挙動を指摘するために <a class="reference internal" href="warnings.html#module-warnings" title="warnings: Issue warning messages and control their disposition."><code class="xref py py-mod docutils literal"><span class="pre">warnings</span></code></a> モジュールを使って出力を生成します。これらは Python のコマンドラインオプションや <a class="reference internal" href="warnings.html#module-warnings" title="warnings: Issue warning messages and control their disposition."><code class="xref py py-mod docutils literal"><span class="pre">warnings</span></code></a> API で抑制されなければ、 <code class="docutils literal"><span class="pre">sys.stderr</span></code> (<code class="docutils literal"><span class="pre">wsgi.errors</span></code> では <em>ありません</em> 。ただし、たまたま同一のオブジェクトだった場合を除く)に書き出されます。</p>
<p>使用例:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wsgiref.validate</span> <span class="k">import</span> <span class="n">validator</span>
<span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="k">import</span> <span class="n">make_server</span>

<span class="c1"># Our callable object which is intentionally not compliant to the</span>
<span class="c1"># standard, so the validator is going to break</span>
<span class="k">def</span> <span class="nf">simple_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;200 OK&#39;</span>  <span class="c1"># HTTP Status</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)]</span>  <span class="c1"># HTTP Headers</span>
    <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="c1"># This is going to break because we need to return a list, and</span>
    <span class="c1"># the validator is going to inform us</span>
    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;Hello World&quot;</span>

<span class="c1"># This is the application wrapped in a validator</span>
<span class="n">validator_app</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">simple_app</span><span class="p">)</span>

<span class="k">with</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="n">validator_app</span><span class="p">)</span> <span class="k">as</span> <span class="n">httpd</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Listening on port 8000....&quot;</span><span class="p">)</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-wsgiref.handlers">
<span id="wsgiref-handlers-server-gateway-base-classes"></span><h2>21.4.5. <a class="reference internal" href="#module-wsgiref.handlers" title="wsgiref.handlers: WSGI server/gateway base classes."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.handlers</span></code></a> – サーバ／ゲートウェイのベースクラス<a class="headerlink" href="#module-wsgiref.handlers" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このモジュールは WSGI サーバとゲートウェイ実装のベースハンドラクラスを提供します。これらのベースクラスは、CGI 風の環境と、それに加えて入力、出力そしてエラーストリームが与えられることで、WSGI アプリケーションとの通信の大部分を処理します。</p>
<dl class="class">
<dt id="wsgiref.handlers.CGIHandler">
<em class="property">class </em><code class="descclassname">wsgiref.handlers.</code><code class="descname">CGIHandler</code><a class="headerlink" href="#wsgiref.handlers.CGIHandler" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">sys.stdin</span></code>、<code class="docutils literal"><span class="pre">sys.stdout</span></code>、<code class="docutils literal"><span class="pre">sys.stderr</span></code> そして <code class="docutils literal"><span class="pre">os.environ</span></code> 経由での CGI ベースの呼び出しです。これは、もしあなたが WSGI アプリケーションを持っていて、これを CGI スクリプトとして実行したい場合に有用です。単に <code class="docutils literal"><span class="pre">CGIHandler().run(app)</span></code> を起動してください。<code class="docutils literal"><span class="pre">app</span></code> はあなたが起動したい WSGI アプリケーションオブジェクトです。</p>
<p>このクラスは <a class="reference internal" href="#wsgiref.handlers.BaseCGIHandler" title="wsgiref.handlers.BaseCGIHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseCGIHandler</span></code></a> のサブクラスで、これは <code class="docutils literal"><span class="pre">wsgi.run_once</span></code> を true、 <code class="docutils literal"><span class="pre">wsgi.multithread</span></code> を false、そして <code class="docutils literal"><span class="pre">wsgi.multiprocess</span></code> を true にセットし、常に <a class="reference internal" href="sys.html#module-sys" title="sys: Access system-specific parameters and functions."><code class="xref py py-mod docutils literal"><span class="pre">sys</span></code></a> と <a class="reference internal" href="os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal"><span class="pre">os</span></code></a> を、必要な CGI ストリームと環境を取得するために使用します。</p>
</dd></dl>

<dl class="class">
<dt id="wsgiref.handlers.IISCGIHandler">
<em class="property">class </em><code class="descclassname">wsgiref.handlers.</code><code class="descname">IISCGIHandler</code><a class="headerlink" href="#wsgiref.handlers.IISCGIHandler" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>(IIS 7 以降の) 設定オプションの allowPathInfo や (IIS 7 より前の) メタベースの allowPathInfoForScriptMappings を設定せずに Microsoft の IIS Web サーバにデプロイするときに使う、 <a class="reference internal" href="#wsgiref.handlers.CGIHandler" title="wsgiref.handlers.CGIHandler"><code class="xref py py-class docutils literal"><span class="pre">CGIHandler</span></code></a> クラス以外の専用の選択肢です。</p>
<p>By default, IIS gives a <code class="docutils literal"><span class="pre">PATH_INFO</span></code> that duplicates the <code class="docutils literal"><span class="pre">SCRIPT_NAME</span></code> at
the front, causing problems for WSGI applications that wish to implement
routing. This handler strips any such duplicated path.</p>
<p>IIS can be configured to pass the correct <code class="docutils literal"><span class="pre">PATH_INFO</span></code>, but this causes
another bug where <code class="docutils literal"><span class="pre">PATH_TRANSLATED</span></code> is wrong. Luckily this variable is
rarely used and is not guaranteed by WSGI. On IIS&lt;7, though, the
setting can only be made on a vhost level, affecting all other script
mappings, many of which break when exposed to the <code class="docutils literal"><span class="pre">PATH_TRANSLATED</span></code> bug.
For this reason IIS&lt;7 is almost never deployed with the fix. (Even IIS7
rarely uses it because there is still no UI for it.)</p>
<p>There is no way for CGI code to tell whether the option was set, so a
separate handler class is provided.  It is used in the same way as
<a class="reference internal" href="#wsgiref.handlers.CGIHandler" title="wsgiref.handlers.CGIHandler"><code class="xref py py-class docutils literal"><span class="pre">CGIHandler</span></code></a>, i.e., by calling <code class="docutils literal"><span class="pre">IISCGIHandler().run(app)</span></code>, where
<code class="docutils literal"><span class="pre">app</span></code> is the WSGI application object you wish to invoke.</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加.</span></p>
</div>
</dd></dl>

<dl class="class">
<dt id="wsgiref.handlers.BaseCGIHandler">
<em class="property">class </em><code class="descclassname">wsgiref.handlers.</code><code class="descname">BaseCGIHandler</code><span class="sig-paren">(</span><em>stdin</em>, <em>stdout</em>, <em>stderr</em>, <em>environ</em>, <em>multithread=True</em>, <em>multiprocess=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseCGIHandler" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#wsgiref.handlers.CGIHandler" title="wsgiref.handlers.CGIHandler"><code class="xref py py-class docutils literal"><span class="pre">CGIHandler</span></code></a> に似ていますが、 <a class="reference internal" href="sys.html#module-sys" title="sys: Access system-specific parameters and functions."><code class="xref py py-mod docutils literal"><span class="pre">sys</span></code></a> と <a class="reference internal" href="os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal"><span class="pre">os</span></code></a> モジュールを使う代わりに CGI 環境と I/O ストリームを明示的に指定します。 <em>multithread</em> と <em>multiprocess</em> の値は、ハンドラインスタンスにより実行されるアプリケーションの <code class="docutils literal"><span class="pre">wsgi.multithread</span></code> と <code class="docutils literal"><span class="pre">wsgi.multiprocess</span></code> フラグの設定に使われます。</p>
<p>このクラスは <a class="reference internal" href="#wsgiref.handlers.SimpleHandler" title="wsgiref.handlers.SimpleHandler"><code class="xref py py-class docutils literal"><span class="pre">SimpleHandler</span></code></a> のサブクラスで、HTTP の &quot;本サーバ&quot; でないソフトウェアと使うことを意図しています。もしあなたが <code class="docutils literal"><span class="pre">Status:</span></code> ヘッダを HTTP ステータスを送信するのに使うようなゲートウェイプロトコルの実装（CGI、FastCGI、SCGIなど）を書いている場合、おそらく <a class="reference internal" href="#wsgiref.handlers.SimpleHandler" title="wsgiref.handlers.SimpleHandler"><code class="xref py py-class docutils literal"><span class="pre">SimpleHandler</span></code></a> ではなくこのクラスをサブクラス化するとよいでしょう。</p>
</dd></dl>

<dl class="class">
<dt id="wsgiref.handlers.SimpleHandler">
<em class="property">class </em><code class="descclassname">wsgiref.handlers.</code><code class="descname">SimpleHandler</code><span class="sig-paren">(</span><em>stdin</em>, <em>stdout</em>, <em>stderr</em>, <em>environ</em>, <em>multithread=True</em>, <em>multiprocess=False</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.SimpleHandler" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#wsgiref.handlers.BaseCGIHandler" title="wsgiref.handlers.BaseCGIHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseCGIHandler</span></code></a> と似ていますが、HTTP の本サーバと使うためにデザインされています。もしあなたが HTTP サーバ実装を書いている場合、おそらく <a class="reference internal" href="#wsgiref.handlers.BaseCGIHandler" title="wsgiref.handlers.BaseCGIHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseCGIHandler</span></code></a> ではなくこのクラスをサブクラス化するとよいでしょう。</p>
<p>このクラスは <a class="reference internal" href="#wsgiref.handlers.BaseHandler" title="wsgiref.handlers.BaseHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseHandler</span></code></a> のサブクラスです。これは <a class="reference internal" href="../reference/datamodel.html#object.__init__" title="object.__init__"><code class="xref py py-meth docutils literal"><span class="pre">__init__()</span></code></a> 、 <code class="xref py py-meth docutils literal"><span class="pre">get_stdin()</span></code> 、 <code class="xref py py-meth docutils literal"><span class="pre">get_stderr()</span></code> 、 <code class="xref py py-meth docutils literal"><span class="pre">add_cgi_vars()</span></code> 、 <code class="xref py py-meth docutils literal"><span class="pre">_write()</span></code> 、 <code class="xref py py-meth docutils literal"><span class="pre">_flush()</span></code> をオーバーライドして、コンストラクタから明示的に環境とストリームを設定するようにしています。与えられた環境とストリームは <code class="xref py py-attr docutils literal"><span class="pre">stdin</span></code> 、 <code class="xref py py-attr docutils literal"><span class="pre">stdout</span></code> 、 <code class="xref py py-attr docutils literal"><span class="pre">stderr</span></code> それに <code class="xref py py-attr docutils literal"><span class="pre">environ</span></code> 属性に保存されています。</p>
<p>The <a class="reference internal" href="io.html#io.BufferedIOBase.write" title="io.BufferedIOBase.write"><code class="xref py py-meth docutils literal"><span class="pre">write()</span></code></a> method of <em>stdout</em> should write
each chunk in full, like <a class="reference internal" href="io.html#io.BufferedIOBase" title="io.BufferedIOBase"><code class="xref py py-class docutils literal"><span class="pre">io.BufferedIOBase</span></code></a>.</p>
</dd></dl>

<dl class="class">
<dt id="wsgiref.handlers.BaseHandler">
<em class="property">class </em><code class="descclassname">wsgiref.handlers.</code><code class="descname">BaseHandler</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>これは WSGI アプリケーションを実行するための抽象ベースクラスです。それぞれのインスタンスは一つの HTTP リクエストを処理します。しかし原理上は複数のリクエスト用に再利用可能なサブクラスを作成することができます。</p>
<p><a class="reference internal" href="#wsgiref.handlers.BaseHandler" title="wsgiref.handlers.BaseHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseHandler</span></code></a> インスタンスは外部から利用されるたった一つのメソッドを持ちます:</p>
<dl class="method">
<dt id="wsgiref.handlers.BaseHandler.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>app</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler.run" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>指定された WSGI アプリケーション、<em>app</em> を実行します。</p>
</dd></dl>

<p>その他のすべての <a class="reference internal" href="#wsgiref.handlers.BaseHandler" title="wsgiref.handlers.BaseHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseHandler</span></code></a> のメソッドはアプリケーション実行プロセスでこのメソッドから呼ばれます。したがって、それらは主にそのプロセスのカスタマイズのために存在しています。</p>
<p>以下のメソッドはサブクラスでオーバーライドされなければいけません:</p>
<dl class="method">
<dt id="wsgiref.handlers.BaseHandler._write">
<code class="descname">_write</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler._write" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>バイト列の <em>data</em> をクライアントへの転送用にバッファします。このメソッドが実際にデータを転送しても OK です: 下部システムが実際にそのような区別をしている場合に効率をより良くするために、 <a class="reference internal" href="#wsgiref.handlers.BaseHandler" title="wsgiref.handlers.BaseHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseHandler</span></code></a> は書き出しとフラッシュ操作を分けているからです。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.handlers.BaseHandler._flush">
<code class="descname">_flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler._flush" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>バッファされたデータをクライアントに強制的に転送します。このメソッドは何もしなくても OK です（すなわち、 <a class="reference internal" href="#wsgiref.handlers.BaseHandler._write" title="wsgiref.handlers.BaseHandler._write"><code class="xref py py-meth docutils literal"><span class="pre">_write()</span></code></a> が実際にデータを送る場合）。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.handlers.BaseHandler.get_stdin">
<code class="descname">get_stdin</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler.get_stdin" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>現在処理中のリクエストの <code class="docutils literal"><span class="pre">wsgi.input</span></code> としての利用に適当な入力ストリームオブジェクトを返します。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.handlers.BaseHandler.get_stderr">
<code class="descname">get_stderr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler.get_stderr" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>現在処理中のリクエストの <code class="docutils literal"><span class="pre">wsgi.errors</span></code> としての利用に適当な出力ストリームオブジェクトを返します。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.handlers.BaseHandler.add_cgi_vars">
<code class="descname">add_cgi_vars</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler.add_cgi_vars" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>現在のリクエストの CGI 変数を <code class="xref py py-attr docutils literal"><span class="pre">environ</span></code> 属性に追加します。</p>
</dd></dl>

<p>オーバーライドされることの多いメソッド及び属性を以下に挙げます。しかし、このリストは単にサマリであり、オーバーライド可能なすべてのメソッドは含んでいません。カスタマイズした <a class="reference internal" href="#wsgiref.handlers.BaseHandler" title="wsgiref.handlers.BaseHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseHandler</span></code></a> サブクラスを作成しようとする前に docstring やソースコードでさらなる情報を調べてください。</p>
<p>WSGI 環境のカスタマイズのための属性とメソッド:</p>
<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.wsgi_multithread">
<code class="descname">wsgi_multithread</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.wsgi_multithread" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">wsgi.multithread</span></code> 環境変数で使われる値。 <a class="reference internal" href="#wsgiref.handlers.BaseHandler" title="wsgiref.handlers.BaseHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseHandler</span></code></a> ではデフォルトが true ですが、別のサブクラスではデフォルトで（またはコンストラクタによって設定されて）異なる値を持つことがあります。</p>
</dd></dl>

<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.wsgi_multiprocess">
<code class="descname">wsgi_multiprocess</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.wsgi_multiprocess" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">wsgi.multiprocess</span></code> 環境変数で使われる値。 <a class="reference internal" href="#wsgiref.handlers.BaseHandler" title="wsgiref.handlers.BaseHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseHandler</span></code></a> ではデフォルトが true ですが、別のサブクラスではデフォルトで（またはコンストラクタによって設定されて）異なる値を持つことがあります。</p>
</dd></dl>

<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.wsgi_run_once">
<code class="descname">wsgi_run_once</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.wsgi_run_once" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">wsgi.run_once</span></code> 環境変数で使われる値。 <a class="reference internal" href="#wsgiref.handlers.BaseHandler" title="wsgiref.handlers.BaseHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseHandler</span></code></a> ではデフォルトが false ですが、 <a class="reference internal" href="#wsgiref.handlers.CGIHandler" title="wsgiref.handlers.CGIHandler"><code class="xref py py-class docutils literal"><span class="pre">CGIHandler</span></code></a> はデフォルトでこれを true に設定します。</p>
</dd></dl>

<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.os_environ">
<code class="descname">os_environ</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.os_environ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>すべてのリクエストの WSGI 環境に含まれるデフォルトの環境変数。デフォルトでは <a class="reference internal" href="#module-wsgiref.handlers" title="wsgiref.handlers: WSGI server/gateway base classes."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.handlers</span></code></a> がインポートされた時点の <code class="docutils literal"><span class="pre">os.environ</span></code> のコピーですが、サブクラスはクラスまたはインスタンスレベルでそれら自身のものを作ることができます。デフォルト値は複数のクラスとインスタンスで共有されるため、この辞書は読み出し専用と考えるべきだという点に注意してください。</p>
</dd></dl>

<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.server_software">
<code class="descname">server_software</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.server_software" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#wsgiref.handlers.BaseHandler.origin_server" title="wsgiref.handlers.BaseHandler.origin_server"><code class="xref py py-attr docutils literal"><span class="pre">origin_server</span></code></a> 属性が設定されている場合、この属性の値がデフォルトの <code class="docutils literal"><span class="pre">SERVER_SOFTWARE</span></code> WSGI 環境変数の設定や HTTP レスポンス中のデフォルトの <code class="docutils literal"><span class="pre">Server:</span></code> ヘッダの設定に使われます。これは (<a class="reference internal" href="#wsgiref.handlers.BaseCGIHandler" title="wsgiref.handlers.BaseCGIHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseCGIHandler</span></code></a> や <a class="reference internal" href="#wsgiref.handlers.CGIHandler" title="wsgiref.handlers.CGIHandler"><code class="xref py py-class docutils literal"><span class="pre">CGIHandler</span></code></a> のような) HTTP オリジンサーバでないハンドラでは無視されます。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.3 で変更: </span>&quot;Python&quot; という語は &quot;CPython&quot; や &quot;Jython&quot; などのような個別実装の語に置き換えられました。</p>
</div>
</dd></dl>

<dl class="method">
<dt id="wsgiref.handlers.BaseHandler.get_scheme">
<code class="descname">get_scheme</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler.get_scheme" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>現在のリクエストで使われている URL スキームを返します。デフォルト実装は <a class="reference internal" href="#module-wsgiref.util" title="wsgiref.util: WSGI environment utilities."><code class="xref py py-mod docutils literal"><span class="pre">wsgiref.util</span></code></a> の <code class="xref py py-func docutils literal"><span class="pre">guess_scheme()</span></code> を使い、現在のリクエストの <code class="xref py py-attr docutils literal"><span class="pre">environ</span></code> 変数に基づいてスキームが&quot;http&quot; か &quot;https&quot; かを推測します。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.handlers.BaseHandler.setup_environ">
<code class="descname">setup_environ</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler.setup_environ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="xref py py-attr docutils literal"><span class="pre">environ</span></code> 属性を、フル実装 (fully-populated) の WSGI 環境に設定します。デフォルトの実装は、上記すべてのメソッドと属性、加えて <a class="reference internal" href="#wsgiref.handlers.BaseHandler.get_stdin" title="wsgiref.handlers.BaseHandler.get_stdin"><code class="xref py py-meth docutils literal"><span class="pre">get_stdin()</span></code></a> 、 <a class="reference internal" href="#wsgiref.handlers.BaseHandler.get_stderr" title="wsgiref.handlers.BaseHandler.get_stderr"><code class="xref py py-meth docutils literal"><span class="pre">get_stderr()</span></code></a> 、 <a class="reference internal" href="#wsgiref.handlers.BaseHandler.add_cgi_vars" title="wsgiref.handlers.BaseHandler.add_cgi_vars"><code class="xref py py-meth docutils literal"><span class="pre">add_cgi_vars()</span></code></a> メソッドと <a class="reference internal" href="#wsgiref.handlers.BaseHandler.wsgi_file_wrapper" title="wsgiref.handlers.BaseHandler.wsgi_file_wrapper"><code class="xref py py-attr docutils literal"><span class="pre">wsgi_file_wrapper</span></code></a> 属性を利用します。これは、キーが存在せず、 <a class="reference internal" href="#wsgiref.handlers.BaseHandler.origin_server" title="wsgiref.handlers.BaseHandler.origin_server"><code class="xref py py-attr docutils literal"><span class="pre">origin_server</span></code></a> 属性が true 値で <a class="reference internal" href="#wsgiref.handlers.BaseHandler.server_software" title="wsgiref.handlers.BaseHandler.server_software"><code class="xref py py-attr docutils literal"><span class="pre">server_software</span></code></a> 属性も設定されている場合に <code class="docutils literal"><span class="pre">SERVER_SOFTWARE</span></code> を挿入します。</p>
</dd></dl>

<p>例外処理のカスタマイズのためのメソッドと属性:</p>
<dl class="method">
<dt id="wsgiref.handlers.BaseHandler.log_exception">
<code class="descname">log_exception</code><span class="sig-paren">(</span><em>exc_info</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler.log_exception" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>exc_info</em> タプルをサーバログに記録します。<em>exc_info</em> は <code class="docutils literal"><span class="pre">(type,</span> <span class="pre">value,</span> <span class="pre">traceback)</span></code> のタプルです。デフォルトの実装は単純にトレースバックをリクエストの <code class="docutils literal"><span class="pre">wsgi.errors</span></code> ストリームに書き出してフラッシュします。サブクラスはこのメソッドをオーバーライドしてフォーマットを変更したり出力先の変更、トレースバックを管理者にメールしたりその他適切と思われるいかなるアクションも取ることができます。</p>
</dd></dl>

<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.traceback_limit">
<code class="descname">traceback_limit</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.traceback_limit" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>デフォルトの <a class="reference internal" href="#wsgiref.handlers.BaseHandler.log_exception" title="wsgiref.handlers.BaseHandler.log_exception"><code class="xref py py-meth docutils literal"><span class="pre">log_exception()</span></code></a> メソッドで出力されるトレースバック出力に含まれる最大のフレーム数です。 <code class="docutils literal"><span class="pre">None</span></code> ならば、すべてのフレームが含まれます。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.handlers.BaseHandler.error_output">
<code class="descname">error_output</code><span class="sig-paren">(</span><em>environ</em>, <em>start_response</em><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler.error_output" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このメソッドは、ユーザに対してエラーページを出力する WSGI アプリケーションです。これはクライアントにヘッダが送出される前にエラーが発生した場合にのみ呼び出されます。</p>
<p>このメソッドは <code class="docutils literal"><span class="pre">sys.exc_info()</span></code> を使って現在のエラー情報にアクセスでき、その情報はこれを呼ぶときに <em>start_response</em> に渡すべきです (<span class="target" id="index-41"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> の &quot;Error Handling&quot; セクションに記述があります)。</p>
<p>デフォルト実装は単に <a class="reference internal" href="#wsgiref.handlers.BaseHandler.error_status" title="wsgiref.handlers.BaseHandler.error_status"><code class="xref py py-attr docutils literal"><span class="pre">error_status</span></code></a> 、 <a class="reference internal" href="#wsgiref.handlers.BaseHandler.error_headers" title="wsgiref.handlers.BaseHandler.error_headers"><code class="xref py py-attr docutils literal"><span class="pre">error_headers</span></code></a> 、 <a class="reference internal" href="#wsgiref.handlers.BaseHandler.error_body" title="wsgiref.handlers.BaseHandler.error_body"><code class="xref py py-attr docutils literal"><span class="pre">error_body</span></code></a> 属性を出力ページの生成に使います。サブクラスではこれをオーバーライドしてもっと動的なエラー出力をすることができます。</p>
<p>しかし、セキュリティの観点からは診断をあらゆるユーザに吐き出すことは推奨されないことに気をつけてください; 理想的には、診断的な出力を有効にするには何らかの特別なことをする必要があるようにすべきで、これがデフォルト実装では何も含まれていない理由です。</p>
</dd></dl>

<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.error_status">
<code class="descname">error_status</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.error_status" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>エラーレスポンスで使われる HTTP ステータスです。これは <span class="target" id="index-42"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> で定義されているステータス文字列です; デフォルトは 500 コードとメッセージです。</p>
</dd></dl>

<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.error_headers">
<code class="descname">error_headers</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.error_headers" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>エラーレスポンスで使われる HTTP ヘッダです。これは <span class="target" id="index-43"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> で述べられているような、 WSGI レスポンスヘッダ (<code class="docutils literal"><span class="pre">(name,</span> <span class="pre">value)</span></code> タプル) のリストであるべきです。デフォルトのリストはコンテントタイプを <code class="docutils literal"><span class="pre">text/plain</span></code> にセットしているだけです。</p>
</dd></dl>

<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.error_body">
<code class="descname">error_body</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.error_body" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>エラーレスポンスボディ。これは HTTP レスポンスのボディバイト文字列であるべきです。これはデフォルトではプレーンテキストで &quot;A server error occurred.  Please contact the administrator.&quot; です。</p>
</dd></dl>

<p><span class="target" id="index-44"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3333"><strong>PEP 3333</strong></a> の &quot;オプションのプラットフォーム固有のファイルハンドリング&quot; 機能のためのメソッドと属性:</p>
<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.wsgi_file_wrapper">
<code class="descname">wsgi_file_wrapper</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.wsgi_file_wrapper" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">wsgi.file_wrapper</span></code> ファクトリ、または <code class="docutils literal"><span class="pre">None</span></code> です。この属性のデフォルト値は <a class="reference internal" href="#wsgiref.util.FileWrapper" title="wsgiref.util.FileWrapper"><code class="xref py py-class docutils literal"><span class="pre">wsgiref.util.FileWrapper</span></code></a> クラスです。</p>
</dd></dl>

<dl class="method">
<dt id="wsgiref.handlers.BaseHandler.sendfile">
<code class="descname">sendfile</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.BaseHandler.sendfile" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>オーバーライドしてプラットフォーム固有のファイル転送を実装します。このメソッドはアプリケーションの戻り値が <a class="reference internal" href="#wsgiref.handlers.BaseHandler.wsgi_file_wrapper" title="wsgiref.handlers.BaseHandler.wsgi_file_wrapper"><code class="xref py py-attr docutils literal"><span class="pre">wsgi_file_wrapper</span></code></a> 属性で指定されたクラスのインスタンスの場合にのみ呼ばれます。これはファイルの転送が成功できた場合には true を返して、デフォルトの転送コードが実行されないようにするべきです。このデフォルトの実装は単に false 値を返します。</p>
</dd></dl>

<p>その他のメソッドと属性:</p>
<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.origin_server">
<code class="descname">origin_server</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.origin_server" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>この属性はハンドラの <a class="reference internal" href="#wsgiref.handlers.BaseHandler._write" title="wsgiref.handlers.BaseHandler._write"><code class="xref py py-meth docutils literal"><span class="pre">_write()</span></code></a> と <a class="reference internal" href="#wsgiref.handlers.BaseHandler._flush" title="wsgiref.handlers.BaseHandler._flush"><code class="xref py py-meth docutils literal"><span class="pre">_flush()</span></code></a> が、特別に <code class="docutils literal"><span class="pre">Status:</span></code> ヘッダに HTTP ステータスを求めるような CGI 風のゲートウェイプロトコル経由でなく、クライアントと直接通信をするような場合には true 値に設定されているべきです。</p>
<p>この属性のデフォルト値は <a class="reference internal" href="#wsgiref.handlers.BaseHandler" title="wsgiref.handlers.BaseHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseHandler</span></code></a> では true ですが、 <a class="reference internal" href="#wsgiref.handlers.BaseCGIHandler" title="wsgiref.handlers.BaseCGIHandler"><code class="xref py py-class docutils literal"><span class="pre">BaseCGIHandler</span></code></a> と <a class="reference internal" href="#wsgiref.handlers.CGIHandler" title="wsgiref.handlers.CGIHandler"><code class="xref py py-class docutils literal"><span class="pre">CGIHandler</span></code></a> では false です。</p>
</dd></dl>

<dl class="attribute">
<dt id="wsgiref.handlers.BaseHandler.http_version">
<code class="descname">http_version</code><a class="headerlink" href="#wsgiref.handlers.BaseHandler.http_version" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#wsgiref.handlers.BaseHandler.origin_server" title="wsgiref.handlers.BaseHandler.origin_server"><code class="xref py py-attr docutils literal"><span class="pre">origin_server</span></code></a> が true の場合、この文字列属性はクライアントへのレスポンスセットの HTTP バージョンの設定に使われます。デフォルトは <code class="docutils literal"><span class="pre">&quot;1.0&quot;</span></code> です。</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="wsgiref.handlers.read_environ">
<code class="descclassname">wsgiref.handlers.</code><code class="descname">read_environ</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wsgiref.handlers.read_environ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Transcode CGI variables from <code class="docutils literal"><span class="pre">os.environ</span></code> to PEP 3333 &quot;bytes in unicode&quot;
strings, returning a new dictionary.  This function is used by
<a class="reference internal" href="#wsgiref.handlers.CGIHandler" title="wsgiref.handlers.CGIHandler"><code class="xref py py-class docutils literal"><span class="pre">CGIHandler</span></code></a> and <a class="reference internal" href="#wsgiref.handlers.IISCGIHandler" title="wsgiref.handlers.IISCGIHandler"><code class="xref py py-class docutils literal"><span class="pre">IISCGIHandler</span></code></a> in place of directly using
<code class="docutils literal"><span class="pre">os.environ</span></code>, which is not necessarily WSGI-compliant on all platforms
and web servers using Python 3 – specifically, ones where the OS’s
actual environment is Unicode (i.e. Windows), or ones where the environment
is bytes, but the system encoding used by Python to decode it is anything
other than ISO-8859-1 (e.g. Unix systems using UTF-8).</p>
<p>If you are implementing a CGI-based handler of your own, you probably want
to use this routine instead of just copying values out of <code class="docutils literal"><span class="pre">os.environ</span></code>
directly.</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="examples">
<h2>21.4.6. 使用例<a class="headerlink" href="#examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>これは動作する &quot;Hello World&quot; WSGIアプリケーションです:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="k">import</span> <span class="n">make_server</span>

<span class="c1"># Every WSGI application must have an application object - a callable</span>
<span class="c1"># object that accepts two arguments. For that purpose, we&#39;re going to</span>
<span class="c1"># use a function (note that you&#39;re not limited to a function, you can</span>
<span class="c1"># use a class for example). The first argument passed to the function</span>
<span class="c1"># is a dictionary containing CGI-style environment variables and the</span>
<span class="c1"># second variable is the callable object (see PEP 333).</span>
<span class="k">def</span> <span class="nf">hello_world_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;200 OK&#39;</span>  <span class="c1"># HTTP Status</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain; charset=utf-8&#39;</span><span class="p">)]</span>  <span class="c1"># HTTP Headers</span>
    <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="c1"># The returned object is going to be printed</span>
    <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;Hello World&quot;</span><span class="p">]</span>

<span class="k">with</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="n">hello_world_app</span><span class="p">)</span> <span class="k">as</span> <span class="n">httpd</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Serving on port 8000...&quot;</span><span class="p">)</span>

    <span class="c1"># Serve until process is killed</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">21.4. <code class="docutils literal"><span class="pre">wsgiref</span></code> — WSGI ユーティリティとリファレンス実装</a><ul>
<li><a class="reference internal" href="#module-wsgiref.util">21.4.1. <code class="docutils literal"><span class="pre">wsgiref.util</span></code> – WSGI 環境のユーティリティ</a></li>
<li><a class="reference internal" href="#module-wsgiref.headers">21.4.2. <code class="docutils literal"><span class="pre">wsgiref.headers</span></code> – WSGI レスポンスヘッダツール群</a></li>
<li><a class="reference internal" href="#module-wsgiref.simple_server">21.4.3. <code class="docutils literal"><span class="pre">wsgiref.simple_server</span></code> – シンプルな WSGI HTTP サーバ</a></li>
<li><a class="reference internal" href="#module-wsgiref.validate">21.4.4. <code class="docutils literal"><span class="pre">wsgiref.validate</span></code> — WSGI 準拠チェッカー</a></li>
<li><a class="reference internal" href="#module-wsgiref.handlers">21.4.5. <code class="docutils literal"><span class="pre">wsgiref.handlers</span></code> – サーバ／ゲートウェイのベースクラス</a></li>
<li><a class="reference internal" href="#examples">21.4.6. 使用例</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="cgitb.html"
                        title="前の章へ">21.3. <code class="docutils literal"><span class="pre">cgitb</span></code> — CGI スクリプトのトレースバック管理機構</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="urllib.html"
                        title="次の章へ">21.5. <code class="docutils literal"><span class="pre">urllib</span></code> — URL を扱うモジュール群</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/3.6/Doc/library/wsgiref.rst"
            rel="nofollow">ソースの表示
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="urllib.html" title="21.5. urllib — URL を扱うモジュール群"
             >次へ</a> |</li>
        <li class="right" >
          <a href="cgitb.html" title="21.3. cgitb — CGI スクリプトのトレースバック管理機構"
             >前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="version_switcher_placeholder">3.6.5</span>
          <a href="../index.html">ドキュメント</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 標準ライブラリ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="internet.html" >21. インターネットプロトコルとサポート</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">Copyright</a> 2001-2018, Python Software Foundation.
    <br />
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
    <br />
    最終更新日時: 4月 22, 2018
    <a href="../bugs.html">バグを見つけたら</a>?
    <br />
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.5 を使って作成されました。
    </div>

  </body>
</html>