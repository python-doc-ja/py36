
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>What’s New in Python 2.7 &#8212; Python 3.6.3 ドキュメント</title>
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.6.3 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="What’s New in Python 2.6" href="2.6.html" />
    <link rel="prev" title="What’s New In Python 3.0" href="3.0.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <link rel="canonical" href="https://docs.python.jp/3/whatsnew/2.7.html" /><script type="text/javascript">
    $(document).ready(function() {
      var base = 'https://docs.python.org/3.6/whatsnew/2.7.html';
      $('a.headerlink').each(function() {
        var html = '<a href="' + base + $(this).attr('href') +
                   '" title="原文へのリンク"><small>(原文)</small></a>';
        $(this).after(html);
      })
    });
    </script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/version_switch.js"></script>
    
    
 

  </head>
  <body>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="2.6.html" title="What’s New in Python 2.6"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="3.0.html" title="What’s New In Python 3.0"
             accesskey="P">前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="version_switcher_placeholder">3.6.3</span>
          <a href="../index.html">ドキュメント</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">What’s New in Python</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="what-s-new-in-python-2-7">
<h1>What’s New in Python 2.7<a class="headerlink" href="#what-s-new-in-python-2-7" title="このヘッドラインへのパーマリンク">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">A.M. Kuchling (amk at amk.ca)</td>
</tr>
</tbody>
</table>
<p>この文書は Python 2.7 の新機能について解説します。Python 2.7 は 2010 年 7 月 3 日にリリースされました。</p>
<p>数値周りの扱いが、浮動小数点数でも <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> クラスでもいろいろな点で改良されました、標準ライブラリにいくつかの有用な追加が行われました。 <a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code></a> モジュールが大幅に改良され、コマンドラインオプション解析の <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal"><span class="pre">argparse</span></code></a> モジュールが追加され、 <a class="reference internal" href="../library/collections.html#module-collections" title="collections: Container datatypes"><code class="xref py py-mod docutils literal"><span class="pre">collections</span></code></a> モジュールに便利な <a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><code class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></code></a> と <a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><code class="xref py py-class docutils literal"><span class="pre">Counter</span></code></a> が追加され、他にもたくさんの改良が行われています。</p>
<p>Python 2.7 は 2.x の最終リリースになることが予定されているので、私たちはこのリリースを長期にわたって良いものになるように努力してきました。Python 3 への移植を助けるため、いくつかの新機能が Python 3.x から Python 2.7 に取り込まれています。</p>
<p>このドキュメントは新機能の完全な詳細を提供するのではなくて、簡易な概要を提供することを目的にしています。完全な詳細が知りたければ、 <a class="reference external" href="https://docs.python.org">https://docs.python.org</a> の Python 2.7 のドキュメントを参照してください。設計と実装の根拠を理解したい場合は、新機能に関する PEP を参照するか、 <a class="reference external" href="https://bugs.python.org">https://bugs.python.org</a> に議論したい機能について登録してください。可能な限り、 &quot;What’s New in Python&quot; は各変更の bug や patch に対してリンクしています。</p>
<div class="section" id="the-future-for-python-2-x">
<span id="whatsnew27-python31"></span><h2>Python 2.x の今後<a class="headerlink" href="#the-future-for-python-2-x" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 2.7 は 2.x シリーズの最後のメジャーリリースになります。Python のメンテナは既に Python 3.x シリーズへの新機能の開発に焦点をシフトしています。Python 2 は今後もバグフィックスを受け容れ、新しいハードウェアやサポートしている OS のバージョンでのビルドが出来るように保つ一方で、言語や標準ライブラリの新しい完全な機能のリリースは行いません。</p>
<p>しかしながら、Python 2.7 と Python 3 の間の共通の大きなサブセットがあって、その共通サブセットあるいは直接的に Python 3 のものへの移行に伴う多くの変更が安全に自動的に行える一方で、その他の変更(Unicode の扱いに関係するものに顕著ですが)入念な検討を必要とし、移行を有効に行うためには堅牢な回帰テストスイートが望まれることでしょう。</p>
<p>これは Python 2.7 が長期間に渡って依然として有効であり、安定性と、Python 3 がいまだに移植されていないような製品システムのベースプラットフォームのサポートを提供し続けることを意味しています。Python 2.7 シリーズに望まれているライフサイクルについての完全な詳細は、 <span class="target" id="index-36"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0373"><strong>PEP 373</strong></a> に記述されています。</p>
<p>2.7 が長期的に重要なリリースになるので、いくつかの結論があります:</p>
<ul class="simple">
<li>上述のように、 2.7 リリースは以前の 2.x バージョンに較べて遥かに長期間のメンテナンスとなります。Python 2.7 は現在では、最低でも 2020 年までコア開発チームによって(セキュリティアップデートやほかのバグフィックスの)サポートがなされ続けることが求められています(最初のリリースから 10 年後です。普通であれば 18–24 ヶ月なのに)。</li>
<li>Python 2.7 標準ライブラリが年老いていくに従い、(直接であれ再配布であれ) Python Package Index の効果的な利用が Python 2 ユーザにとってますます重要になっています。さまざまなタスクをこなすありとあらゆるサードパーティパッケージに加え、Python 2 互換の、Python 3 標準ライブラリからバックポートした新しいモジュールや機能を含むパッケージ、Python 3 への移行を容易にするための様々なツールやライブラリが入手出来ます。<a class="reference external" href="https://packaging.python.org">Python Packaging User Guide</a> は Python Package Index からソフトウェアをダウンロード・インストールする際のガイダンスです。</li>
<li>Python 2 を拡張するための望ましいアプローチは現在では Python Package Index に新しいパッケージを公開することである一方で、このアプローチが全てのケースで求められるわけではありません。特にそれがネットワークセキュリティに関係している場合には。PyPI に新規もしくは更新パッケージを公開することでは十分ではない例外的なケースにおいては、Python 2 標準ライブラリに直接新機能を追加するために Python Enhancement Proposal プロセスが使われるでしょう。そのような追加の全てと、それらが追加されたメンテナンスリリースは、下の方の <a class="reference internal" href="#py27-maintenance-enhancements"><span class="std std-ref">Python 2.7 メンテナンスリリースで追加された新機能</span></a> セクションで言及されます。</li>
</ul>
<p>Python 2 から Python 3 へ乗り換えたいと望むプロジェクトあるいはPython 2 と Python 3 両方のユーザをサポートしたいと願うライブラリやフレームワークの開発者向けに、さまざまなツールやガイドがあります。これらは、相応しいアプローチを決めたりある種複雑な技術的詳細の管理をする手助けとなるでしょう。まず手始めには <a class="reference internal" href="../howto/pyporting.html#pyporting-howto"><span class="std std-ref">Python 2 から Python 3 への移植</span></a> HOWTO ガイドをご覧になることをお奨めします。</p>
</div>
<div class="section" id="changes-to-the-handling-of-deprecation-warnings">
<h2>Deprecation Warnings の扱いの変更<a class="headerlink" href="#changes-to-the-handling-of-deprecation-warnings" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 2.7 では開発者向けの警告をデフォルトで抑止するポリシーが取られました。 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></code></a> とそれを継承した警告は、指定されない限りは無視され、アプリケーションのユーザーがその警告を見ないですむようになりました。この変更は Python 3.2 ブランチにも適用されました。 (stdlib-sig で討議され、 <a class="reference external" href="https://bugs.python.org/issue7319">bpo-7319</a> になりました)</p>
<p>以前のリリースでは、 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></code></a> メッセージはデフォルトで有効になっており、 Python 開発者に、将来のバージョンの Python でそのコードのどこが動かなくなるかを明確に知らせていました。</p>
<p>しかし、 Python で開発されたアプリケーションの利用者であって開発には携わっていない人がどんどん増えてきました。 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></code></a> メッセージはそれらのユーザーには無関係で、彼らをアプリケーションが本当に正しく動いているのか不安にさせ、ユーザーの質問に応えるための開発者の負担も増やしていました。</p>
<p><a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></code></a> メッセージの表示を有効にするには、 <a class="reference internal" href="../using/cmdline.html#cmdoption-w"><code class="xref std std-option docutils literal"><span class="pre">-Wdefault</span></code></a> (短い形式: <a class="reference internal" href="../using/cmdline.html#cmdoption-w"><code class="xref std std-option docutils literal"><span class="pre">-Wd</span></code></a>) スイッチか、Python を実行する前に <span class="target" id="index-37"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONWARNINGS"><code class="xref std std-envvar docutils literal"><span class="pre">PYTHONWARNINGS</span></code></a> 環境変数を <code class="docutils literal"><span class="pre">&quot;default&quot;</span></code>  (か、 <code class="docutils literal"><span class="pre">&quot;d&quot;</span></code>)に設定します。 Python コードから有効にする場合は <code class="docutils literal"><span class="pre">warnings.simplefilter('default')</span></code> とします。</p>
<p><code class="docutils literal"><span class="pre">unittest</span></code> モジュールもテスト実行時に自動的に deprecation warnings を有効にします。</p>
</div>
<div class="section" id="python-3-1-features">
<h2>Python 3.1 の機能<a class="headerlink" href="#python-3-1-features" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 2.6 は Python 3.0 から多くの機能を取り込み、Python 2.7 は Python 3.1 の新しい機能のいくつかを取り込みました。2.x シリーズは 3.x シリーズへの移行のためのツールを提供し続けています。</p>
<p>Python 2.7 に取り込まれた 3.1 の機能の不完全なリスト:</p>
<ul class="simple">
<li>集合のリテラル文法 (<code class="docutils literal"><span class="pre">{1,2,3}</span></code> は mutable set になります)</li>
<li>辞書と集合の内包表記 (<code class="docutils literal"><span class="pre">{i:</span> <span class="pre">i*2</span> <span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">range(3)}</span></code>).</li>
<li>1つの <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal"><span class="pre">with</span></code></a> 文で複数のコンテキストマネージャを扱えるように。</li>
<li><a class="reference internal" href="../library/io.html#module-io" title="io: Core tools for working with streams."><code class="xref py py-mod docutils literal"><span class="pre">io</span></code></a> ライブラリの新バージョン。パフォーマンスのためにC言語で描き直されています。</li>
<li><a class="reference internal" href="#pep-0372"><span class="std std-ref">PEP 372: collections に順序付き辞書を追加</span></a> で解説されている順序付き辞書</li>
<li><a class="reference internal" href="#pep-0378"><span class="std std-ref">PEP 378: 1000区切りのための書式指定子</span></a> で解説されている新しい <code class="docutils literal"><span class="pre">&quot;,&quot;</span></code> フォーマット指定子</li>
<li><a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><code class="xref py py-class docutils literal"><span class="pre">memoryview</span></code></a> オブジェクト</li>
<li><a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal"><span class="pre">importlib</span></code></a> モジュールの小さいサブセット。 <a class="reference external" href="#importlib-section">下に説明があります</a></li>
<li>float <code class="docutils literal"><span class="pre">x</span></code> の <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal"><span class="pre">repr()</span></code></a> が多くの場合に短くなりました。これは <code class="docutils literal"><span class="pre">x</span></code> に戻せることが保証される最小の10進文字列です。以前のバージョンの Python では、 <code class="docutils literal"><span class="pre">float(repr(x))</span></code> が <code class="docutils literal"><span class="pre">x</span></code> になることだけが保証されていました。</li>
<li>float から文字列、文字列から float への変換が正しく丸められるようになりました。 <a class="reference internal" href="../library/functions.html#round" title="round"><code class="xref py py-func docutils literal"><span class="pre">round()</span></code></a> 関数も正しく丸めるようになりました。</li>
<li>拡張モジュールが C API を提供するための、 <a class="reference internal" href="../c-api/capsule.html#c.PyCapsule" title="PyCapsule"><code class="xref c c-type docutils literal"><span class="pre">PyCapsule</span></code></a> 型</li>
<li><a class="reference internal" href="../c-api/long.html#c.PyLong_AsLongAndOverflow" title="PyLong_AsLongAndOverflow"><code class="xref c c-func docutils literal"><span class="pre">PyLong_AsLongAndOverflow()</span></code></a> C API 関数</li>
</ul>
<p>新しい Python3 モード Warning:</p>
<ul class="simple">
<li><code class="xref py py-func docutils literal"><span class="pre">operator.isCallable()</span></code> と <code class="xref py py-func docutils literal"><span class="pre">operator.sequenceIncludes()</span></code> は 3.x ではサポートされず、 warning になります。</li>
<li><code class="xref std std-option docutils literal"><span class="pre">-3</span></code> スイッチは、整数または長整数での古い除算方式を使用した場合に警告を出力するようになる <code class="xref std std-option docutils literal"><span class="pre">-Qwarn</span></code> スイッチを有効にするようになりました。</li>
</ul>
</div>
<div class="section" id="pep-372-adding-an-ordered-dictionary-to-collections">
<span id="pep-0372"></span><h2>PEP 372: collections に順序付き辞書を追加<a class="headerlink" href="#pep-372-adding-an-ordered-dictionary-to-collections" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>通常の Python 辞書は、 key/value ペアを不定の順序でイテレートします。何年にもわたり、いろいろな人が key の挿入順を保存する辞書の別実装を書いてきました。その経験に基づき、 2.7 は <a class="reference internal" href="../library/collections.html#module-collections" title="collections: Container datatypes"><code class="xref py py-mod docutils literal"><span class="pre">collections</span></code></a> モジュールに新しい <a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><code class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></code></a> クラスを追加しました。</p>
<p><a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><code class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></code></a> API は通常の辞書と同じインタフェースを提供していますが、 key/value をイテレートするときに key が最初に挿入された順番になることが保証されています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>                 <span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="gp">... </span>                 <span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="go">[(&#39;first&#39;, 1), (&#39;second&#39;, 2), (&#39;third&#39;, 3)]</span>
</pre></div>
</div>
<p>新しいエントリが既存のエントリを上書きした場合は、元の挿入順序が保持されます。:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="go">[(&#39;first&#39;, 1), (&#39;second&#39;, 4), (&#39;third&#39;, 3)]</span>
</pre></div>
</div>
<p>エントリを削除して再挿入すると、順序は一番最後に移動します。:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="go">[(&#39;first&#39;, 1), (&#39;third&#39;, 3), (&#39;second&#39;, 5)]</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/collections.html#collections.OrderedDict.popitem" title="collections.OrderedDict.popitem"><code class="xref py py-meth docutils literal"><span class="pre">popitem()</span></code></a> メソッドは、オプションの <em>last</em> 引数を持ち、でフォルトで <code class="docutils literal"><span class="pre">True</span></code> になっています。 <em>last</em> が真の場合、一番最近に追加された key が返され、削除されます。偽の場合、最も古い key が選ばれます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">od</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
<span class="go">(19, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
<span class="go">(18, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od</span><span class="o">.</span><span class="n">popitem</span><span class="p">(</span><span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">(0, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od</span><span class="o">.</span><span class="n">popitem</span><span class="p">(</span><span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">(1, 0)</span>
</pre></div>
</div>
<p>2つの順序付き辞書を比較するときは、key/value だけでなく、挿入順も比較されます。:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">od1</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>                   <span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="gp">... </span>                   <span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od2</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;third&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">... </span>                   <span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>                   <span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od1</span> <span class="o">==</span> <span class="n">od2</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Move &#39;third&#39; key to the end</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">od2</span><span class="p">[</span><span class="s1">&#39;third&#39;</span><span class="p">];</span> <span class="n">od2</span><span class="p">[</span><span class="s1">&#39;third&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od1</span> <span class="o">==</span> <span class="n">od2</span>
<span class="go">True</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><code class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></code></a> を通常の辞書と比較すると、挿入順は無視されて単に key/value だけが比較されます。</p>
<p><a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><code class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></code></a> の実装はこうなっています。 key の2重リンクリストを管理し、新しい key が挿入されるときにリストに新しい key を追加します。2つ目の辞書が key を対応するリストノードにマップします。なので、削除時にリンクリストを操作する必要はなく、コストは O(1) に保たれています。</p>
<p>標準ライブラリのいくつかのモジュールで、順序付き辞書の利用がサポートされています。</p>
<ul class="simple">
<li><code class="xref py py-mod docutils literal"><span class="pre">ConfigParser</span></code> モジュールはデフォルトで順序付き辞書を使います。設定ファイルを読み込み、編集した後、元の順序で書きなおすことができます。</li>
<li><a class="reference internal" href="../library/collections.html#collections.namedtuple" title="collections.namedtuple"><code class="xref py py-func docutils literal"><span class="pre">collections.namedtuple()</span></code></a> の <a class="reference internal" href="../library/collections.html#collections.somenamedtuple._asdict" title="collections.somenamedtuple._asdict"><code class="xref py py-meth docutils literal"><span class="pre">_asdict()</span></code></a> メソッドは、タプルの順序と同じ順序の順序付き辞書を返すようになりました。</li>
<li><a class="reference internal" href="../library/json.html#module-json" title="json: Encode and decode the JSON format."><code class="xref py py-mod docutils literal"><span class="pre">json</span></code></a> モジュールのデコーダーが <code class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></code> をビルドするのをサポートするために、 <a class="reference internal" href="../library/json.html#json.JSONDecoder" title="json.JSONDecoder"><code class="xref py py-class docutils literal"><span class="pre">JSONDecoder</span></code></a> クラスのコンストラクタに <em>object_pairs_hook</em> 引数が追加されました。 <a class="reference external" href="http://pyyaml.org/">PyYAML</a> などの外部のライブラリでもサポートされています。</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-38"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0372"><strong>PEP 372</strong></a> - collections に順序付き辞書を追加</dt>
<dd>PEP written by Armin Ronacher and Raymond Hettinger;
implemented by Raymond Hettinger.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-378-format-specifier-for-thousands-separator">
<span id="pep-0378"></span><h2>PEP 378: 1000区切りのための書式指定子<a class="headerlink" href="#pep-378-format-specifier-for-thousands-separator" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>大きい数値に区切り文字を追加して、18446744073709551616 の代わりに 18,446,744,073,709,551,616 と出力すると、プログラムの出力を読みやすくできます。</p>
<p>これを行う一般的な方法は <a class="reference internal" href="../library/locale.html#module-locale" title="locale: Internationalization services."><code class="xref py py-mod docutils literal"><span class="pre">locale</span></code></a> モジュールを使うことで、複数の区切り文字 (北米では &quot;,&quot; で、ヨーロッパでは &quot;.&quot;) を使ったり、複数のグループの大きさを使うことができます。しかし、 <a class="reference internal" href="../library/locale.html#module-locale" title="locale: Internationalization services."><code class="xref py py-mod docutils literal"><span class="pre">locale</span></code></a> の利用方法は複雑ですし、スレッドごとに異なるロケールの出力を行うプログラムでは利用することができません。</p>
<p>そのため、シンプルなカンマによるグループ化機構が <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal"><span class="pre">str.format()</span></code></a> メソッドのミニ言語に追加されました。浮動小数点数をフォーマットする場合、シンプルにカンマを幅と精度の間に置きます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;</span><span class="si">{:20,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">18446744073709551616.0</span><span class="p">)</span>
<span class="go">&#39;18,446,744,073,709,551,616.00&#39;</span>
</pre></div>
</div>
<p>整数をフォーマットする場合は、幅の後にカンマを追加します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;</span><span class="si">{:20,d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">18446744073709551616</span><span class="p">)</span>
<span class="go">&#39;18,446,744,073,709,551,616&#39;</span>
</pre></div>
</div>
<p>この機構は全く柔軟性を持っていません。区切り文字は常にカンマですし、グループは常に数字3つになります。カンマ書式機構は <a class="reference internal" href="../library/locale.html#module-locale" title="locale: Internationalization services."><code class="xref py py-mod docutils literal"><span class="pre">locale</span></code></a> ほど汎用ではありませんが、手軽に使うことができます。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-39"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0378"><strong>PEP 378</strong></a> - 1000区切りのための書式指定子</dt>
<dd>PEP written by Raymond Hettinger; implemented by Eric Smith.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-389-the-argparse-module-for-parsing-command-lines">
<h2>PEP 389: コマンドライン解析のための argparse モジュール<a class="headerlink" href="#pep-389-the-argparse-module-for-parsing-command-lines" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>コマンドライン引数の解析のための <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal"><span class="pre">argparse</span></code></a> モジュールが、 <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> モジュールのより強力な代替として追加されました。</p>
<p>これにより、 Python はコマンドライン引数の解析のために3つの異なるモジュール、 <a class="reference internal" href="../library/getopt.html#module-getopt" title="getopt: Portable parser for command line options; support both short and long option names."><code class="xref py py-mod docutils literal"><span class="pre">getopt</span></code></a>, <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a>, <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal"><span class="pre">argparse</span></code></a> を持つことになります。 <a class="reference internal" href="../library/getopt.html#module-getopt" title="getopt: Portable parser for command line options; support both short and long option names."><code class="xref py py-mod docutils literal"><span class="pre">getopt</span></code></a> モジュールは C言語用ライブラリの <code class="xref c c-func docutils literal"><span class="pre">getopt()</span></code> 関数に似せてあるので、あとで C 言語で書き直すかもしれないプログラムのプロトタイプを Python で書く場合に役に立ちます。 <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> は冗長になってしまいましたが、まだたくさんのスクリプトが利用していて、それらのスクリプトを自動的に更新する手段が無いので、削除される予定はありません。(<a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal"><span class="pre">argparse</span></code></a> API を <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> のインタフェースに適合させる方法も検討されましたが、多くの複雑さと難点のために却下されました)</p>
<p>古いバージョンの Python との互換性を気にすること無く新しいスクリプトを書く時は、 <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> の代わりに <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal"><span class="pre">argparse</span></code></a> を使ってください。</p>
<p>以下はこの使用例です:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Command-line example.&#39;</span><span class="p">)</span>

<span class="c1"># Add optional switches</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;is_verbose&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;produce verbose output&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;output&#39;</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FILE&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;direct output to FILE instead of stdout&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-C&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;context&#39;</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;NUM&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;display NUM lines of added context&#39;</span><span class="p">)</span>

<span class="c1"># Allow any number of additional arguments.</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;input filenames (default is stdin)&#39;</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="nb">print</span> <span class="n">args</span><span class="o">.</span><span class="vm">__dict__</span>
</pre></div>
</div>
<p>オーバーライドしない限り、 <code class="xref std std-option docutils literal"><span class="pre">-h</span></code> と <code class="xref std std-option docutils literal"><span class="pre">--help</span></code> スイッチが自動的に追加され、綺麗にフォーマットした出力を生成します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">-&gt;</span> <span class="o">./</span><span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">argparse</span><span class="o">-</span><span class="n">example</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
<span class="n">usage</span><span class="p">:</span> <span class="n">argparse</span><span class="o">-</span><span class="n">example</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">FILE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">C</span> <span class="n">NUM</span><span class="p">]</span> <span class="p">[</span><span class="n">inputs</span> <span class="p">[</span><span class="n">inputs</span> <span class="o">...</span><span class="p">]]</span>

<span class="n">Command</span><span class="o">-</span><span class="n">line</span> <span class="n">example</span><span class="o">.</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">inputs</span>      <span class="nb">input</span> <span class="n">filenames</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="n">stdin</span><span class="p">)</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">v</span>          <span class="n">produce</span> <span class="n">verbose</span> <span class="n">output</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">FILE</span>     <span class="n">direct</span> <span class="n">output</span> <span class="n">to</span> <span class="n">FILE</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">stdout</span>
  <span class="o">-</span><span class="n">C</span> <span class="n">NUM</span>      <span class="n">display</span> <span class="n">NUM</span> <span class="n">lines</span> <span class="n">of</span> <span class="n">added</span> <span class="n">context</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> と同じく、コマンドラインスイッチと引数は、 <em>dest</em> 引数の名前の属性をもったオブジェクトとして返されます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="o">-&gt;</span> <span class="o">./</span><span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">argparse</span><span class="o">-</span><span class="n">example</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">v</span>
<span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;is_verbose&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
 <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="o">-&gt;</span> <span class="o">./</span><span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">argparse</span><span class="o">-</span><span class="n">example</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">output</span> <span class="o">-</span><span class="n">C</span> <span class="mi">4</span> <span class="n">file1</span> <span class="n">file2</span>
<span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;/tmp/output&#39;</span><span class="p">,</span>
 <span class="s1">&#39;is_verbose&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
 <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
 <span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;file1&#39;</span><span class="p">,</span> <span class="s1">&#39;file2&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal"><span class="pre">argparse</span></code></a> は <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> よりも多くの便利なバリデーションを持っています。引数の正確な数を整数で指定したり、 <code class="docutils literal"><span class="pre">'*'</span></code> で0以上の数を指定したり、 <code class="docutils literal"><span class="pre">'+'</span></code> で1以上の数を指定したり、 <code class="docutils literal"><span class="pre">'?'</span></code> でオプションにしたりできます。トップレベルのパーサーはサブパーサーを持つことができ、 <code class="docutils literal"><span class="pre">svn</span> <span class="pre">commit</span></code>, <code class="docutils literal"><span class="pre">svn</span> <span class="pre">checkout</span></code> のように異なるオプションを持ったサブコマンドを定義できます。引数のタイプに <a class="reference internal" href="../library/argparse.html#argparse.FileType" title="argparse.FileType"><code class="xref py py-class docutils literal"><span class="pre">FileType</span></code></a> を指定することで、自動でファイルを開き、 <code class="docutils literal"><span class="pre">'-'</span></code> が指定されたときに標準入出力だと判断することができます。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal"><span class="pre">argparse</span></code></a> のドキュメント</dt>
<dd>argparse モジュールのドキュメント</dd>
<dt><a class="reference internal" href="../library/argparse.html#upgrading-optparse-code"><span class="std std-ref">optparse からのアップグレード</span></a></dt>
<dd><a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: Command-line option parsing library. (非推奨)"><code class="xref py py-mod docutils literal"><span class="pre">optparse</span></code></a> を使うコードを変換する方法を説明した Python のドキュメントの一部</dd>
<dt><span class="target" id="index-40"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0389"><strong>PEP 389</strong></a> - argparse コマンドライン解析モジュール</dt>
<dd>PEP written and implemented by Steven Bethard.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-391-dictionary-based-configuration-for-logging">
<h2>PEP 391: logging の辞書ベースの設定<a class="headerlink" href="#pep-391-dictionary-based-configuration-for-logging" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="../library/logging.html#module-logging" title="logging: Flexible event logging system for applications."><code class="xref py py-mod docutils literal"><span class="pre">logging</span></code></a> モジュールは非常に柔軟です。アプリケーションは logging のサブシステムのツリーを定義できます。このツリーの各ロガーはいくつかのメッセージをフィルターし、異なるフォーマットを行い、メッセージを沢山の種類のハンドラーに渡します。</p>
<p>この柔軟性は、多くの設定を必要とします。オブジェクトを生成してプロパティを設定する Python コードを書くこともできますが、複雑なセットアップをしようとすると退屈なコードを書かないといけなくなります。 <a class="reference internal" href="../library/logging.html#module-logging" title="logging: Flexible event logging system for applications."><code class="xref py py-mod docutils literal"><span class="pre">logging</span></code></a> は設定ファイルのパースを行う <code class="xref py py-func docutils literal"><span class="pre">fileConfig()</span></code> 関数を提供していますが、このファイルフォーマットはフィルターの設定をサポートしていませんし、プログラムで生成するのはさらに面倒になります。</p>
<p>Python 2.7 は logging の設定のために辞書を使う <code class="xref py py-func docutils literal"><span class="pre">dictConfig()</span></code> 関数を追加しました。いろいろな入力から辞書を作成する方法があります。コードで作ったり、 JSON ファイルをパースしたり、YAMLのパーサーをインストールしてあればそれを使うことができます。詳しい情報は <a class="reference internal" href="../library/logging.config.html#logging-config-api"><span class="std std-ref">環境設定のための関数</span></a> を参照してください。</p>
<p>以下は、2つのロガー、 root logger と &quot;network&quot; という名前の logger を設定する例です。root logger に送られたメッセージは syslog プロトコルを利用してシステムログに送られ、 &quot;network&quot; logger に送られたメッセージは 1 MB ごとにローテートされる
<code class="file docutils literal"><span class="pre">network.log</span></code> ファイルに書きこまれます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">logging.config</span>

<span class="n">configdict</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>    <span class="c1"># Configuration schema in use; must be 1 for now</span>
 <span class="s1">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s1">&#39;standard&#39;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(name)-15s</span><span class="s1"> &#39;</span>
                    <span class="s1">&#39;</span><span class="si">%(levelname)-8s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)}},</span>

 <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;netlog&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;backupCount&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.handlers.RotatingFileHandler&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;/logs/network.log&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;formatter&#39;</span><span class="p">:</span> <span class="s1">&#39;standard&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;maxBytes&#39;</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">},</span>
              <span class="s1">&#39;syslog&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.handlers.SysLogHandler&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;formatter&#39;</span><span class="p">:</span> <span class="s1">&#39;standard&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">}},</span>

 <span class="c1"># Specify all the subordinate loggers</span>
 <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
             <span class="s1">&#39;network&#39;</span><span class="p">:</span> <span class="p">{</span>
                         <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;netlog&#39;</span><span class="p">]</span>
             <span class="p">}</span>
 <span class="p">},</span>
 <span class="c1"># Specify properties of the root logger</span>
 <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;syslog&#39;</span><span class="p">]</span>
 <span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Set up configuration</span>
<span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">configdict</span><span class="p">)</span>

<span class="c1"># As an example, log two error messages</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Database not found&#39;</span><span class="p">)</span>

<span class="n">netlogger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;network&#39;</span><span class="p">)</span>
<span class="n">netlogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Connection failed&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>他にも、 <a class="reference internal" href="../library/logging.html#module-logging" title="logging: Flexible event logging system for applications."><code class="xref py py-mod docutils literal"><span class="pre">logging</span></code></a> モジュールには Vinary Sajip によって実装された 3 つの改良があります。</p>
<ul class="simple">
<li><a class="reference internal" href="../library/logging.handlers.html#logging.handlers.SysLogHandler" title="logging.handlers.SysLogHandler"><code class="xref py py-class docutils literal"><span class="pre">SysLogHandler</span></code></a> クラスは TCP 経由の syslog をサポートします。コンストラクタの <em>socktype</em> 引数は使用するソケットの種類として、 UDP を使う <a class="reference internal" href="../library/socket.html#socket.SOCK_DGRAM" title="socket.SOCK_DGRAM"><code class="xref py py-const docutils literal"><span class="pre">socket.SOCK_DGRAM</span></code></a> と TCP を使う <a class="reference internal" href="../library/socket.html#socket.SOCK_STREAM" title="socket.SOCK_STREAM"><code class="xref py py-const docutils literal"><span class="pre">socket.SOCK_STREAM</span></code></a> のどちらかを取ります。デフォルトはUDPのままです。</li>
<li><a class="reference internal" href="../library/logging.html#logging.Logger" title="logging.Logger"><code class="xref py py-class docutils literal"><span class="pre">Logger</span></code></a> インスタンスに <a class="reference internal" href="../library/logging.html#logging.Logger.getChild" title="logging.Logger.getChild"><code class="xref py py-meth docutils literal"><span class="pre">getChild()</span></code></a>  メソッドが追加されました。これは、相対パスで下位の logger を返します。 例えば、 <code class="docutils literal"><span class="pre">log</span> <span class="pre">=</span> <span class="pre">getLogger('app')</span></code> として logger を取得した後、  <code class="docutils literal"><span class="pre">log.getChild('network.listen')</span></code> は <code class="docutils literal"><span class="pre">getLogger('app.network.listen')</span></code> と同じになります。</li>
<li><a class="reference internal" href="../library/logging.html#logging.LoggerAdapter" title="logging.LoggerAdapter"><code class="xref py py-class docutils literal"><span class="pre">LoggerAdapter</span></code></a> クラスに  meth:<cite>~logging.LoggerAdapter.isEnabledFor</cite> メソッドが追加されました。 <em>level</em> を引数に取り、ベースの logger がその重要度レベルのメッセージを処理するかどうかを返します。</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-41"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0391"><strong>PEP 391</strong></a> - logging の辞書ベースの設定</dt>
<dd>PEP written and implemented by Vinay Sajip.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-3106-dictionary-views">
<h2>PEP 3106: 辞書 View<a class="headerlink" href="#pep-3106-dictionary-views" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>辞書の <a class="reference internal" href="../library/stdtypes.html#dict.keys" title="dict.keys"><code class="xref py py-meth docutils literal"><span class="pre">keys()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#dict.values" title="dict.values"><code class="xref py py-meth docutils literal"><span class="pre">values()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#dict.items" title="dict.items"><code class="xref py py-meth docutils literal"><span class="pre">items()</span></code></a> メソッドは Python 3.x では動作が代わり、完全に実体化されたリストの代わりに、 <em class="dfn">view</em> と呼ばれるオブジェクトを返すようになりました。</p>
<p>Python 2.7 では、 <a class="reference internal" href="../library/stdtypes.html#dict.keys" title="dict.keys"><code class="xref py py-meth docutils literal"><span class="pre">keys()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#dict.values" title="dict.values"><code class="xref py py-meth docutils literal"><span class="pre">values()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#dict.items" title="dict.items"><code class="xref py py-meth docutils literal"><span class="pre">items()</span></code></a> の動作を変えてしまうと、既存の大量のコードが動かなくなってしまうので、Python 3.x と同じ動作に合わせることはできません。なので、 Python 3.x のメソッドと同じ動作をするメソッドを、別の <code class="xref py py-meth docutils literal"><span class="pre">viewkeys()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">viewvalues()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">viewitems()</span></code> という名前で追加しました。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span><span class="o">+</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">26</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{0: &#39;A&#39;, 130: &#39;N&#39;, 10: &#39;B&#39;, 140: &#39;O&#39;, 20: ..., 250: &#39;Z&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span>
<span class="go">dict_keys([0, 130, 10, 140, 20, 150, 30, ..., 250])</span>
</pre></div>
</div>
<p>View はイテレートするだけでなく、set と似た利用をすることもできます。<code class="docutils literal"><span class="pre">&amp;</span></code> 演算子で共通部分集合を、<code class="docutils literal"><span class="pre">|</span></code> 演算子で話集合を取ることができます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span><span class="o">+</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">26</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="o">**.</span><span class="mi">5</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d1</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">d2</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span>
<span class="go">set([0.0, 10.0, 20.0, 30.0])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d1</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span> <span class="o">|</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="go">set([0, 1, 130, 3, 4, 5, 6, ..., 120, 250])</span>
</pre></div>
</div>
<p>view は辞書とその辞書の変化に追随しています。:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">vk</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vk</span>
<span class="go">dict_keys([0, 130, 10, ..., 250])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="mi">260</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vk</span>
<span class="go">dict_keys([0, 130, 260, 10, ..., 250])</span>
</pre></div>
</div>
<p>ただし、view をイテレートしている間に key の追加や削除ができないことに気を付けてください。:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vk</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
<span class="gp">...</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">RuntimeError</span>: <span class="n">dictionary changed size during iteration</span>
</pre></div>
</div>
<p>Python 2.x で view メソッドを利用すると、 2to3 が自動的にそれを通常の <a class="reference internal" href="../library/stdtypes.html#dict.keys" title="dict.keys"><code class="xref py py-meth docutils literal"><span class="pre">keys()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#dict.values" title="dict.values"><code class="xref py py-meth docutils literal"><span class="pre">values()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#dict.items" title="dict.items"><code class="xref py py-meth docutils literal"><span class="pre">items()</span></code></a> メソッドに書き換えてくれます。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-6"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3106"><strong>PEP 3106</strong></a> - Revamping dict.keys(), .values() and .items()</dt>
<dd>PEP written by Guido van Rossum.
Backported to 2.7 by Alexandre Vassalotti; <a class="reference external" href="https://bugs.python.org/issue1967">bpo-1967</a>.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-3137-the-memoryview-object">
<h2>PEP 3137: memoryview オブジェクト<a class="headerlink" href="#pep-3137-the-memoryview-object" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><code class="xref py py-class docutils literal"><span class="pre">memoryview</span></code></a> オブジェクトは、他のオブジェクトのメモリの内容に対する <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal"><span class="pre">bytes</span></code></a> 型のインタフェースに合わせた view を提供します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">string</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">letters</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">&lt;memory at 0x37f850&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>           <span class="c1"># Returns length of underlying object</span>
<span class="go">52</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">25</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span>   <span class="c1"># Indexing returns one byte</span>
<span class="go">(&#39;a&#39;, &#39;z&#39;, &#39;A&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">26</span><span class="p">]</span>         <span class="c1"># Slicing returns another memoryview</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span>
<span class="go">&lt;memory at 0x37f080&gt;</span>
</pre></div>
</div>
<p>view の内容は bytes 型の文字列か整数のリストに変換することができます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
<span class="go">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[97, 98, 99, 100, 101, 102, 103, ... 121, 122]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><code class="xref py py-class docutils literal"><span class="pre">memoryview</span></code></a> オブジェクトは、対象となる背後のオブジェクトが変更可能 (mutable) な場合は、その変更を許可しています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">75</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">cannot modify read-only memory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">letters</span><span class="p">)</span>  <span class="c1"># Creating a mutable object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">bytearray(b&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mb</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>         <span class="c1"># Assign to view, changing the bytearray.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>              <span class="c1"># The bytearray has been changed.</span>
<span class="go">bytearray(b&#39;*bcde&#39;)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-7"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3137"><strong>PEP 3137</strong></a> - Immutable Bytes and Mutable Buffer</dt>
<dd>PEP written by Guido van Rossum.
Implemented by Travis Oliphant, Antoine Pitrou and others.
Backported to 2.7 by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue2396">bpo-2396</a>.</dd>
</dl>
</div>
</div>
<div class="section" id="other-language-changes">
<h2>その他の言語変更<a class="headerlink" href="#other-language-changes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 言語コアに小さな変更がいくつか行われました:</p>
<ul>
<li><p class="first">set リテラルのためのシンタックスが Python 3.x からバックポートされました。内容を波括弧で囲うと mutable set になります。dict リテラルとの区別は、コロンと value が存在しないことで行われます。なので、<code class="docutils literal"><span class="pre">{}</span></code> は引き続き空の dict になります。空の set を作るときには <code class="docutils literal"><span class="pre">set()</span></code> を使ってください。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">}</span>
<span class="go">set([1, 2, 3, 4, 5])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">()</span> <span class="c1"># empty set</span>
<span class="go">set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">{}</span>    <span class="c1"># empty dict</span>
<span class="go">{}</span>
</pre></div>
</div>
<p>Backported by Alexandre Vassalotti; <a class="reference external" href="https://bugs.python.org/issue2335">bpo-2335</a>.</p>
</li>
<li><p class="first">dict と set の内包表記も Python 3.x からバックポートされました。list と generator の内包表記を set と dict にも使えるように一般化させています。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
<span class="go">{0: 0, 1: 1, 2: 4, 3: 9, 4: 16, 5: 25}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">{(</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
<span class="go">set([&#39;&#39;, &#39;a&#39;, &#39;aa&#39;, &#39;aaa&#39;, &#39;aaaa&#39;, &#39;aaaaa&#39;])</span>
</pre></div>
</div>
<p>Backported by Alexandre Vassalotti; <a class="reference external" href="https://bugs.python.org/issue2333">bpo-2333</a>.</p>
</li>
<li><p class="first"><a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal"><span class="pre">with</span></code></a> 文が1つの文で複数のコンテキストマネージャーを使えるようになりました。コンテキストマネージャーは左から右へ処理され、それぞれが新しい <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal"><span class="pre">with</span></code></a> 文の開始となるように扱われます。つまり:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">A</span><span class="p">()</span> <span class="k">as</span> <span class="n">a</span><span class="p">,</span> <span class="n">B</span><span class="p">()</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
    <span class="o">...</span> <span class="n">suite</span> <span class="n">of</span> <span class="n">statements</span> <span class="o">...</span>
</pre></div>
</div>
<p>は、以下と同じです</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">A</span><span class="p">()</span> <span class="k">as</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">B</span><span class="p">()</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
        <span class="o">...</span> <span class="n">suite</span> <span class="n">of</span> <span class="n">statements</span> <span class="o">...</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal"><span class="pre">contextlib.nested()</span></code> 関数は非常に似た機能を提供していたので、もう必要なくなり廃止予定となりました。</p>
<p>(Proposed in <a class="reference external" href="https://codereview.appspot.com/53094">https://codereview.appspot.com/53094</a>; implemented by
Georg Brandl.)</p>
</li>
<li><p class="first">浮動小数点数と文字列の間の変換がほとんどのプラットフォームで正しく丸められるようになりました。この変換はいろいろな場面で発生します: float 型や complex 型に対する <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal"><span class="pre">str()</span></code></a> 関数の適用、 <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal"><span class="pre">float</span></code></a> や <a class="reference internal" href="../library/functions.html#complex" title="complex"><code class="xref py py-class docutils literal"><span class="pre">complex</span></code></a> コンストラクタ、数値フォーマット、 <a class="reference internal" href="../library/marshal.html#module-marshal" title="marshal: Convert Python objects to streams of bytes and back (with different constraints)."><code class="xref py py-mod docutils literal"><span class="pre">marshal</span></code></a>, <a class="reference internal" href="../library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back."><code class="xref py py-mod docutils literal"><span class="pre">pickle</span></code></a>, <a class="reference internal" href="../library/json.html#module-json" title="json: Encode and decode the JSON format."><code class="xref py py-mod docutils literal"><span class="pre">json</span></code></a> モジュールを使ってのシリアライズとデシリアライズ、 Python コード中の float や imaginary リテラルの解析、 <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> から float への変換などです。</p>
<p>これに関連して、浮動小数点数 <em>x</em> の <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal"><span class="pre">repr()</span></code></a> は、 (round-half-to-even 丸めモードで)正しく丸め処理をした場合に元の <em>x</em> に戻せる最小の 10進文字列になりました。以前は <em>x</em> を17桁の10進文字列に丸めていました。</p>
<p>丸めライブラリが、この改善が Windows や gcc, icc, suncc を使った Unix 環境で動かす役目をおっています。このライブラリの正確な動作が保証できない少しの環境があるので、そういったシステムではこのライブラリは利用されません。 <a class="reference internal" href="../library/sys.html#sys.float_repr_style" title="sys.float_repr_style"><code class="xref py py-data docutils literal"><span class="pre">sys.float_repr_style</span></code></a> が <code class="docutils literal"><span class="pre">short</span></code> なら新しいコードが利用されていて、 <code class="docutils literal"><span class="pre">legacy</span></code> なら利用されていません。</p>
<p>Implemented by Eric Smith and Mark Dickinson, using David Gay’s
<code class="file docutils literal"><span class="pre">dtoa.c</span></code> library; <a class="reference external" href="https://bugs.python.org/issue7117">bpo-7117</a>.</p>
</li>
<li><p class="first">多倍長整数や通常の整数から浮動小数点への変換でも丸め処理が変更され、元の数に一番近い浮動小数点値が返されるようになりました。これは浮動小数点へ完全に変換できる小さい整数では問題になりませんが、桁数に対して精度がどうしても足りない場合に関係します。Python 2.7 はより正確に近似するようになりました。例えば、Python 2.6 では次のように計算されていました:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">295147905179352891391</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="go">2.9514790517935283e+20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">-</span> <span class="n">long</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="go">65535L</span>
</pre></div>
</div>
<p>Python 2.7 の浮動小数点への変換結果は元の数値より大きくなりますが、元の値により近くなっています:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">295147905179352891391</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="go">2.9514790517935289e+20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">-</span> <span class="n">long</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="go">-1L</span>
</pre></div>
</div>
<p>(Implemented by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue3166">bpo-3166</a>.)</p>
<p>この丸めの動作により、整数同士の true division (<code class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">division</span></code>) の結果もより正確になりました。 (Also implemented by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue1811">bpo-1811</a>.)</p>
</li>
<li><p class="first">複素数に対する暗黙の型強制は削除されました。インタプリタは complex オブジェクトに対して <code class="xref py py-meth docutils literal"><span class="pre">__coerce__()</span></code> メソッドを呼び出そうとしません。 (Removed by Meador Inge and Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue5211">bpo-5211</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal"><span class="pre">str.format()</span></code></a> メソッドは置換フィールドに対する自動ナンバリングをサポートするようになりました。これにより <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal"><span class="pre">str.format()</span></code></a> をより <code class="docutils literal"><span class="pre">%s</span></code> と同じように使えるようになりました。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">04</span><span class="p">,</span> <span class="s1">&#39;Sunday&#39;</span><span class="p">)</span>
<span class="go">&#39;2009:4:Sunday&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">:</span><span class="si">{day}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;Sunday&#39;</span><span class="p">)</span>
<span class="go">&#39;2009:4:Sunday&#39;</span>
</pre></div>
</div>
<p>自動ナンバリングは左のフィールドから右のフィールドへと行われるので、最初の <code class="docutils literal"><span class="pre">{...}</span></code> 指定は <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal"><span class="pre">str.format()</span></code></a> メソッドの最初の引数を利用し、次の指定は次の引数を利用します。自動ナンバリングと明示的なナンバリングを混ぜて使うことはできず、全ての置換指定に手動でナンバリングするか、全てを自動ナンバリングに任せなければなりません。ただし、上の例の2つめのように、自動ナンバリングと名前フィールドを混ぜて使うことは可能です。 (Contributed by Eric Smith; <a class="reference external" href="https://bugs.python.org/issue5237">bpo-5237</a>.)</p>
<p>複素数が <a class="reference internal" href="../library/functions.html#format" title="format"><code class="xref py py-func docutils literal"><span class="pre">format()</span></code></a> をサポートするようになりました。デフォルトでは右寄せになります。精度やカンマ区切りの指定は、実部と虚部のそれぞれに対して適用されます。アラインの指定は <code class="docutils literal"><span class="pre">1.5+3j</span></code> のような複素数全体に対して適用されます。 (Contributed by Eric Smith; <a class="reference external" href="https://bugs.python.org/issue1588">bpo-1588</a> and <a class="reference external" href="https://bugs.python.org/issue7988">bpo-7988</a>.)</p>
<p>'F' 書式符号は常に大文字を使って出力するようになり、 'INF' や 'NAN' が出力されるようになりました。 (Contributed by Eric Smith; <a class="reference external" href="https://bugs.python.org/issue3382">bpo-3382</a>.)</p>
<p>低レベルな変更: <a class="reference internal" href="../reference/datamodel.html#object.__format__" title="object.__format__"><code class="xref py py-meth docutils literal"><span class="pre">object.__format__()</span></code></a> メソッドは <a class="reference internal" href="../library/exceptions.html#PendingDeprecationWarning" title="PendingDeprecationWarning"><code class="xref py py-exc docutils literal"><span class="pre">PendingDeprecationWarning</span></code></a> を発生させるようになりました。 <a class="reference internal" href="../library/functions.html#object" title="object"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a> に対する <a class="reference internal" href="../reference/datamodel.html#object.__format__" title="object.__format__"><code class="xref py py-meth docutils literal"><span class="pre">__format__()</span></code></a> メソッドはオブジェクトを文字列表現に変換してそれをフォーマットするからです。以前は、このメソッドは書式文字列を受け取り文字列表現を返していましたが、この仕様は Python コードのミスを隠してしまう可能性がありました。アライメントや精度のようなフォーマット指定情報を渡した時、そのなにかそのオブジェクトに合ったフォーマットがあることを期待しているはずなのに、 <a class="reference internal" href="../reference/datamodel.html#object.__format__" title="object.__format__"><code class="xref py py-meth docutils literal"><span class="pre">object.__format__()</span></code></a> メソッドはそれを無視します。 (Fixed by Eric Smith; <a class="reference external" href="https://bugs.python.org/issue7994">bpo-7994</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-func docutils literal"><span class="pre">int()</span></code></a> と <code class="xref py py-func docutils literal"><span class="pre">long()</span></code> 型に <code class="docutils literal"><span class="pre">bit_length</span></code> メソッドが追加されました。このメソッドはその値を2進数で表現したときに何ビット必要になるかを返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">37</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="go">&#39;0b100101&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">123</span><span class="o">-</span><span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<span class="go">123</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<span class="go">124</span>
</pre></div>
</div>
<p>(Contributed by Fredrik Johansson and Victor Stinner; <a class="reference external" href="https://bugs.python.org/issue3439">bpo-3439</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../reference/simple_stmts.html#import"><code class="xref std std-keyword docutils literal"><span class="pre">import</span></code></a> 文が、絶対インポート (例: <code class="docutils literal"><span class="pre">from</span> <span class="pre">.os</span> <span class="pre">import</span> <span class="pre">sep</span></code>)が失敗したときに相対インポートを試さなくなりました。これはバグ修正ですが、いままでたまたま動いていただけの <a class="reference internal" href="../reference/simple_stmts.html#import"><code class="xref std std-keyword docutils literal"><span class="pre">import</span></code></a>  文を動かなくしてしまう可能性があります。(Fixed by Meador Inge; <a class="reference external" href="https://bugs.python.org/issue7902">bpo-7902</a>.)</p>
</li>
<li><p class="first">ビルトインの <code class="xref py py-class docutils literal"><span class="pre">unicode</span></code> 型のサブクラスが <code class="xref py py-meth docutils literal"><span class="pre">__unicode__()</span></code> メソッドをオーバーライドできるようになりました。(Implemented by Victor Stinner; <a class="reference external" href="https://bugs.python.org/issue1583863">bpo-1583863</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal"><span class="pre">bytearray</span></code></a> 型の <a class="reference internal" href="../library/stdtypes.html#bytearray.translate" title="bytearray.translate"><code class="xref py py-meth docutils literal"><span class="pre">translate()</span></code></a> メソッドが第一引数に <code class="docutils literal"><span class="pre">None</span></code> を受け入れるようになりました。 (Fixed by Georg Brandl; <a class="reference external" href="https://bugs.python.org/issue4759">bpo-4759</a>.)</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&#64;classmethod</span></code> や <code class="docutils literal"><span class="pre">&#64;staticmethod</span></code> を使ってクラスメソッドやスタティックメソッドを作成した時、そのラッパーオブジェクトがラップ対象となる関数を <code class="xref py py-attr docutils literal"><span class="pre">__func__</span></code> 属性で公開するようになりました。(Contributed by Amaury Forgeot d’Arc, after a suggestion by George Sakkis; <a class="reference external" href="https://bugs.python.org/issue5982">bpo-5982</a>.)</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">__slots__</span></code> を利用して属性を制限した場合に、設定されていない属性を del したときに <a class="reference internal" href="../library/exceptions.html#AttributeError" title="AttributeError"><code class="xref py py-exc docutils literal"><span class="pre">AttributeError</span></code></a> にならなかったのを修正しました。 (Fixed by Benjamin Peterson; <a class="reference external" href="https://bugs.python.org/issue7604">bpo-7604</a>.)</p>
</li>
<li><p class="first">2つの新しいエンコーディングが追加されました: &quot;cp720&quot; は主にアラビア文字に使われます。 &quot;cp858&quot; は cp850 の一種ですが、ユーロ記号を追加しています。 (CP720 contributed by Alexander Belchenko and Amaury Forgeot d’Arc in <a class="reference external" href="https://bugs.python.org/issue1616979">bpo-1616979</a>; CP858 contributed by Tim Hatch in <a class="reference external" href="https://bugs.python.org/issue8016">bpo-8016</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal"><span class="pre">file</span></code> オブジェクトは、POSIX環境に置いてディレクトリを開こうとした時に発生する <a class="reference internal" href="../library/exceptions.html#IOError" title="IOError"><code class="xref py py-exc docutils literal"><span class="pre">IOError</span></code></a> 例外に <code class="xref py py-attr docutils literal"><span class="pre">filename</span></code> 属性を設定するようになりました。 (noted by Jan Kaliszewski; <a class="reference external" href="https://bugs.python.org/issue4764">bpo-4764</a>) また、読み出し専用のファイルに対する書き込みを、Cライブラリ側のエラー検出・報告に頼るのではなく、明示的にチェックするようになりました。 (fixed by Stefan Krah; <a class="reference external" href="https://bugs.python.org/issue5677">bpo-5677</a>).</p>
</li>
<li><p class="first">Python の字句解析機は改行をそれ自身に変換するようになりました。それにより、組み込みの <a class="reference internal" href="../library/functions.html#compile" title="compile"><code class="xref py py-func docutils literal"><span class="pre">compile()</span></code></a> 関数がどの改行コードを利用したコードでも受け付けるようになりました。また、コードの終端の改行も不要になりました。</p>
</li>
<li><p class="first">関数宣言中の余分な丸括弧は Python 3.x では不正になりました。つまり、 <code class="docutils literal"><span class="pre">def</span> <span class="pre">f((x)):</span> <span class="pre">pass</span></code> はsyntax errorになります。 Python3 警告モードでは、 Python 2.7 はこの利用方法について警告を出すようになりました。 (Noted by James Lingard; <a class="reference external" href="https://bugs.python.org/issue7362">bpo-7362</a>.)</p>
</li>
<li><p class="first">古いスタイルのクラスのオブジェクトに対して弱参照を作れるようになりました。新スタイルクラスには以前から弱参照を利用できます。(Fixed by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue8268">bpo-8268</a>.)</p>
</li>
<li><p class="first">モジュールオブジェクトがGCされたとき、モジュールの辞書は、他にその辞書への参照を持っているものがない場合にのみクリアされるようになりました。(<a class="reference external" href="https://bugs.python.org/issue7140">bpo-7140</a>).</p>
</li>
</ul>
<div class="section" id="interpreter-changes">
<span id="new-27-interpreter"></span><h3>インタプリタの変更<a class="headerlink" href="#interpreter-changes" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>新しい環境変数 <span class="target" id="index-42"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONWARNINGS"><code class="xref std std-envvar docutils literal"><span class="pre">PYTHONWARNINGS</span></code></a> を使って警告を制御できるようになりました。この環境変数には、 <a class="reference internal" href="../using/cmdline.html#cmdoption-w"><code class="xref std std-option docutils literal"><span class="pre">-W</span></code></a> スイッチに使われる警告の設定を、カンマ区切りの文字列として指定します。 (Contributed by Brian Curtin; <a class="reference external" href="https://bugs.python.org/issue7301">bpo-7301</a>.)</p>
<p>例えば、以下の設定は警告が発生するたびにそれを表示しますが、 <code class="xref py py-mod docutils literal"><span class="pre">Cookie</span></code> モジュールからの警告はエラーにします。 (環境変数を設定するための文法はOSとシェルに依存します)</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">PYTHONWARNINGS</span><span class="o">=</span><span class="nb">all</span><span class="p">,</span><span class="n">error</span><span class="p">:::</span><span class="n">Cookie</span><span class="p">:</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="optimizations">
<h3>最適化<a class="headerlink" href="#optimizations" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>いくつかの場面でパフォーマンスが向上しています。</p>
<ul>
<li><p class="first"><a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal"><span class="pre">with</span></code></a> 文の初期セットアップを行うための新しいオペコードが追加されました。 <a class="reference internal" href="../reference/datamodel.html#object.__enter__" title="object.__enter__"><code class="xref py py-meth docutils literal"><span class="pre">__enter__()</span></code></a> と <a class="reference internal" href="../reference/datamodel.html#object.__exit__" title="object.__exit__"><code class="xref py py-meth docutils literal"><span class="pre">__exit__()</span></code></a> メソッドの検索を行います。 (Contributed by Benjamin Peterson.)</p>
</li>
<li><p class="first">たくさんのオブジェクトを開放せずに確保していくという、よくある使い方の 1つにおいて、GCのパフォーマンスが向上しました。以前はこの場合にGCにかかる時間はオブジェクトの数の2乗に比例していました。現在はフルGCの数は増えたヒープ上のオブジェクトの数に比例しています。新しい方式では、3世代中2世代目に対するGCが10回実行されたうえで、 2世代目から3世代目に移ったオブジェクトの数が3世代目のオブジェクトの数の 10%を超えたときにフルGCが発生します。(Suggested by Martin von Löwis and implemented by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue4074">bpo-4074</a>.)</p>
</li>
<li><p class="first">GCが循環参照になりえないシンプルなコンテナ型の追跡を避けるようになりました。 Python 2.7 では、アトミックな型(整数、文字列など)のみを含むタプルと辞書は追跡されません。推移的に、アトミックな型のみを含むタプルを含む辞書も、同じく追跡されません。これにより、GCによって巡回されチェックされるオブジェクトの数が減るので、 GCのコストを減らすことができます。 (Contributed by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue4688">bpo-4688</a>.)</p>
</li>
<li><p class="first">多倍長整数の内部格納方式が、 2**15 ベースと 2**30 ベースのどちらかをビルド時に選択するようになりました。以前は常に 2**15 ベースで格納していました。 2**30 ベースにすると 64bit マシンに置いては確実にパフォーマンスが向上しますが、 32bit マシンではパフォーマンスが向上する場合も低下する場合もあります。なので、デフォルトでは 64bit マシンでは 2**30 ベースで、 32bit マシンでは 2**15 ベースになるようになります。 Unix では新しい configure オプションとして <code class="xref std std-option docutils literal"><span class="pre">--enable-big-digits</span></code> が追加され、このデフォルトの選択をオーバーライドできるようになっています。</p>
<p>この変更はパフォーマンスの向上以外の形ではユーザーに見えないはずですが、 1つだけ例外があります。テストとデバッグを目的として、 <code class="xref py py-data docutils literal"><span class="pre">sys.long_info</span></code> というデータが追加され、内部フォーマットとして digit あたりのビット数と、それに使うCのデータ型のバイト数の情報を提供します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">long_info</span>
<span class="go">sys.long_info(bits_per_digit=30, sizeof_digit=4)</span>
</pre></div>
</div>
<p>(Contributed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue4258">bpo-4258</a>.)</p>
<p>その他の変更により、多倍長整数オブジェクトのサイズは数バイト小さくなりました。 32bit システムでは 2byte, 64bit システムでは 6byte 小さくなりました。 (Contributed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue5260">bpo-5260</a>.)</p>
</li>
<li><p class="first">多倍長整数の除算アルゴリズムが、内部のループの軽量化や乗算からシフト演算への置き換え、不要なイテレーションの削除により高速化されました。いくつかのベンチマークによると、多倍長整数の剰余演算は 50% から 150% 高速化されています。 (Contributed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue5512">bpo-5512</a>.) ビット演算も高速化されています。(initial patch by Gregory Smith; <a class="reference external" href="https://bugs.python.org/issue1087418">bpo-1087418</a>)</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">%</span></code> の実装が、左側のオペランドが文字列型かどうかをチェックしてその場合の処理を特殊化しました。これにより文字列に対して <code class="docutils literal"><span class="pre">%</span></code> を頻繁に使う、テンプレートライブラリなどのアプリケーションのパフォーマンスが1–3%向上します。 (Implemented by Collin Winter; <a class="reference external" href="https://bugs.python.org/issue5176">bpo-5176</a>.)</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">if</span></code> 条件付きのリスト内包表記がより高速なバイトコードにコンパイルされるようになりました。(Patch by Antoine Pitrou, back-ported to 2.7 by Jeffrey Yasskin; <a class="reference external" href="https://bugs.python.org/issue4715">bpo-4715</a>.)</p>
</li>
<li><p class="first">整数や多倍長整数から10進文字列への変換を、任意の基数をサポートした汎用の変換関数を使う代わりに10進数に特殊化した処理を行うことで高速化しました。 (Patch by Gawain Bolton; <a class="reference external" href="https://bugs.python.org/issue6713">bpo-6713</a>.)</p>
</li>
<li><p class="first">文字列等(str, unicode, <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal"><span class="pre">bytearray</span></code></a>) の <code class="xref py py-meth docutils literal"><span class="pre">split()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">replace()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">rindex()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">rpartition()</span></code>, <code class="xref py py-meth docutils literal"><span class="pre">rsplit()</span></code> メソッドが、1文字ずつのスキャンの代わりに高速な逆方向スキャンアルゴリズムを使うようになりました。これにより、場合によっては10倍レベルの高速化になります。(Added by Florent Xicluna; <a class="reference external" href="https://bugs.python.org/issue7462">bpo-7462</a> and <a class="reference external" href="https://bugs.python.org/issue7622">bpo-7622</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back."><code class="xref py py-mod docutils literal"><span class="pre">pickle</span></code></a> と <code class="xref py py-mod docutils literal"><span class="pre">cPickle</span></code> モジュールが、属性名に使われている文字列を自動的にインターンするようになりました。これにより unpickle 後のオブジェクトのメモリ使用量が減ります。(Contributed by Jake McGuire; <a class="reference external" href="https://bugs.python.org/issue5084">bpo-5084</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">cPickle</span></code> モジュールが辞書に対する特殊化を行い、 pickle にかかる時間をおよそ半分に減らしました。 (Contributed by Collin Winter; <a class="reference external" href="https://bugs.python.org/issue5670">bpo-5670</a>.)</p>
</li>
</ul>
</div>
</div>
<div class="section" id="new-and-improved-modules">
<h2>新しいモジュールと改良されたモジュール<a class="headerlink" href="#new-and-improved-modules" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>全てのリリースに置いて、 Python の標準ライブラリはたくさんの改良とバグ修正がされてきました。ここでは一部の注目に値する変更を、モジュール名で辞書順ソートしてリストアップしています。もっと完全な変更リストが見たければ、ソースツリー内の <code class="file docutils literal"><span class="pre">Misc/NEWS</span></code> ファイルか、全ての完全な詳細が入っている Subversion のログを参照してください。</p>
<ul>
<li><p class="first"><a class="reference internal" href="../library/bdb.html#module-bdb" title="bdb: Debugger framework."><code class="xref py py-mod docutils literal"><span class="pre">bdb</span></code></a> モジュールの基底デバッガクラス <a class="reference internal" href="../library/bdb.html#bdb.Bdb" title="bdb.Bdb"><code class="xref py py-class docutils literal"><span class="pre">Bdb</span></code></a> に、モジュールをスキップする機能が追加されました。コンストラクタは <code class="docutils literal"><span class="pre">django.*</span></code> のような glob スタイルのパターンをもった iterable を引数として受け取ります。デバッガはパターンのどれかにマッチするスタックフレームにステップインしません。 (Contributed by Maru Newby after a suggestion by Senthil Kumaran; <a class="reference external" href="https://bugs.python.org/issue5142">bpo-5142</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/binascii.html#module-binascii" title="binascii: Tools for converting between binary and various ASCII-encoded binary representations."><code class="xref py py-mod docutils literal"><span class="pre">binascii</span></code></a> モジュールが buffer API をサポートするようになり、 <a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><code class="xref py py-class docutils literal"><span class="pre">memoryview</span></code></a> インスタンスやその他のバッファオブジェクトともに利用できるようになりました。 (Backported from 3.x by Florent Xicluna; <a class="reference external" href="https://bugs.python.org/issue7703">bpo-7703</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">bsddb</span></code> モジュールが <a class="reference external" href="https://www.jcea.es/programacion/pybsddb.htm">pybsddb パッケージ</a> の 4.7.2devel9 から 4.8.4 に更新されました。新しいバージョンはより Python 3.x との互換性がよくなり、いくつかのバグ修正と、いくつかの新しい BerkeleyDB のフラグとメソッドが追加されています。 (Updated by Jesús Cea Avión; <a class="reference external" href="https://bugs.python.org/issue8156">bpo-8156</a>.  The pybsddb changelog can be read at <a class="reference external" href="http://hg.jcea.es/pybsddb/file/tip/ChangeLog">http://hg.jcea.es/pybsddb/file/tip/ChangeLog</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/bz2.html#module-bz2" title="bz2: Interfaces for bzip2 compression and decompression."><code class="xref py py-mod docutils literal"><span class="pre">bz2</span></code></a> モジュールの <a class="reference internal" href="../library/bz2.html#bz2.BZ2File" title="bz2.BZ2File"><code class="xref py py-class docutils literal"><span class="pre">BZ2File</span></code></a> がコンテキストマネージャープロトコルをサポートするようになりました。これにより、 <code class="docutils literal"><span class="pre">with</span> <span class="pre">bz2.BZ2File(...)</span> <span class="pre">as</span> <span class="pre">f:</span></code> といった書き方ができます。 (Contributed by Hagen Fürstenau; <a class="reference external" href="https://bugs.python.org/issue3860">bpo-3860</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/collections.html#module-collections" title="collections: Container datatypes"><code class="xref py py-mod docutils literal"><span class="pre">collections</span></code></a> モジュールの新しい <a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><code class="xref py py-class docutils literal"><span class="pre">Counter</span></code></a> クラスは、データの数え上げをするときに便利です。 <a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><code class="xref py py-class docutils literal"><span class="pre">Counter</span></code></a> インスタンスは辞書のように振る舞いますが、キーが存在しなかったときに <a class="reference internal" href="../library/exceptions.html#KeyError" title="KeyError"><code class="xref py py-exc docutils literal"><span class="pre">KeyError</span></code></a> 例外を発生させる代わりに 0 を返します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s1">&#39;here is a sample of english text&#39;</span><span class="p">:</span>
<span class="gp">... </span>  <span class="n">c</span><span class="p">[</span><span class="n">letter</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> 
<span class="go">Counter({&#39; &#39;: 6, &#39;e&#39;: 5, &#39;s&#39;: 3, &#39;a&#39;: 2, &#39;i&#39;: 2, &#39;h&#39;: 2,</span>
<span class="go">&#39;l&#39;: 2, &#39;t&#39;: 2, &#39;g&#39;: 1, &#39;f&#39;: 1, &#39;m&#39;: 1, &#39;o&#39;: 1, &#39;n&#39;: 1,</span>
<span class="go">&#39;p&#39;: 1, &#39;r&#39;: 1, &#39;x&#39;: 1})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
<span class="go">0</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><code class="xref py py-class docutils literal"><span class="pre">Counter</span></code></a> には追加の3つのメソッドがあります。 <a class="reference internal" href="../library/collections.html#collections.Counter.most_common" title="collections.Counter.most_common"><code class="xref py py-meth docutils literal"><span class="pre">most_common()</span></code></a> はカウントが最も多い N 要素とそのカウントを返します。 <a class="reference internal" href="../library/collections.html#collections.Counter.elements" title="collections.Counter.elements"><code class="xref py py-meth docutils literal"><span class="pre">elements()</span></code></a> はカウントしている要素を、そのカウント数だけ繰り返すイテレータを返します。 <a class="reference internal" href="../library/collections.html#collections.Counter.subtract" title="collections.Counter.subtract"><code class="xref py py-meth docutils literal"><span class="pre">subtract()</span></code></a> はイテレート可能型を受け取り、その各要素を足すのではなく引いて行きます。引数が辞書か他の <code class="xref py py-class docutils literal"><span class="pre">Counter</span></code> だった場合は、そのカウントが引かれます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">[(&#39; &#39;, 6), (&#39;e&#39;, 5), (&#39;s&#39;, 3), (&#39;a&#39;, 2), (&#39;i&#39;, 2)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">elements</span><span class="p">()</span> <span class="o">-&gt;</span>
<span class="go">   &#39;a&#39;, &#39;a&#39;, &#39; &#39;, &#39; &#39;, &#39; &#39;, &#39; &#39;, &#39; &#39;, &#39; &#39;,</span>
<span class="go">   &#39;e&#39;, &#39;e&#39;, &#39;e&#39;, &#39;e&#39;, &#39;e&#39;, &#39;g&#39;, &#39;f&#39;, &#39;i&#39;, &#39;i&#39;,</span>
<span class="go">   &#39;h&#39;, &#39;h&#39;, &#39;m&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;, &#39;n&#39;, &#39;p&#39;, &#39;s&#39;,</span>
<span class="go">   &#39;s&#39;, &#39;s&#39;, &#39;r&#39;, &#39;t&#39;, &#39;t&#39;, &#39;x&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="s1">&#39;very heavy on the letter e&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span>    <span class="c1"># Count is now lower</span>
<span class="go">-1</span>
</pre></div>
</div>
<p>Contributed by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue1696199">bpo-1696199</a>.</p>
<p>新しいクラス <a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><code class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></code></a> はすでに <a class="reference internal" href="#pep-0372"><span class="std std-ref">PEP 372: collections に順序付き辞書を追加</span></a> で紹介しました。</p>
<p>メソッドが追加されました。<a class="reference internal" href="../library/collections.html#collections.deque" title="collections.deque"><code class="xref py py-class docutils literal"><span class="pre">deque</span></code></a>  データ型の <a class="reference internal" href="../library/collections.html#collections.deque.count" title="collections.deque.count"><code class="xref py py-meth docutils literal"><span class="pre">count()</span></code></a>  メソッドは、引数で指定された <em>x</em> と等しい要素が何個入っているかを返します。 <a class="reference internal" href="../library/collections.html#collections.deque.reverse" title="collections.deque.reverse"><code class="xref py py-meth docutils literal"><span class="pre">reverse()</span></code></a> メソッドは deque 内の要素をインプレースで逆順にします。 <a class="reference internal" href="../library/collections.html#collections.deque" title="collections.deque"><code class="xref py py-class docutils literal"><span class="pre">deque</span></code></a> はまた、最大長を返す読み出し専用の属性 <a class="reference internal" href="../library/collections.html#collections.deque.maxlen" title="collections.deque.maxlen"><code class="xref py py-attr docutils literal"><span class="pre">maxlen</span></code></a> を持ちます。 (Both features added by Raymond Hettinger.)</p>
<p><a class="reference internal" href="../library/collections.html#collections.namedtuple" title="collections.namedtuple"><code class="xref py py-class docutils literal"><span class="pre">namedtuple</span></code></a> クラスにオプションの <em>rename</em> 引数が追加されました。 <em>rename</em> が真のとき、複数回現れたり Python の識別子として許可されないために無効なフィールド名があったとき、フィールドのリスト内での場所に基づく有効なフィールド名に置き換えられます。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">T</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;field1&#39;</span><span class="p">,</span> <span class="s1">&#39;$illegal&#39;</span><span class="p">,</span> <span class="s1">&#39;for&#39;</span><span class="p">,</span> <span class="s1">&#39;field2&#39;</span><span class="p">],</span> <span class="n">rename</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">T</span><span class="o">.</span><span class="n">_fields</span>
<span class="go">(&#39;field1&#39;, &#39;_1&#39;, &#39;_2&#39;, &#39;field2&#39;)</span>
</pre></div>
</div>
<p>(Added by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue1818">bpo-1818</a>.)</p>
<p><code class="xref py py-class docutils literal"><span class="pre">Mapping</span></code> 抽象基底クラスが、他の <code class="xref py py-class docutils literal"><span class="pre">Mapping</span></code> でない型と比較されたときに <a class="reference internal" href="../library/constants.html#NotImplemented" title="NotImplemented"><code class="xref py py-const docutils literal"><span class="pre">NotImplemented</span></code></a> を返すようになりました。(Fixed by Daniel Stutzbach; <a class="reference external" href="https://bugs.python.org/issue8729">bpo-8729</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">ConfigParser</span></code> モジュールのパーサークラスのコンストラクタが <em>allow_no_value</em> 引数を受け取るようになりました。これはデフォルトでは False です。真の場合、値のないオプションが利用できるようになります。例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ConfigParser</span><span class="o">,</span> <span class="nn">StringIO</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sample_config</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">[mysqld]</span>
<span class="gp">... </span><span class="s2">user = mysql</span>
<span class="gp">... </span><span class="s2">pid-file = /var/run/mysqld/mysqld.pid</span>
<span class="gp">... </span><span class="s2">skip-bdb</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">RawConfigParser</span><span class="p">(</span><span class="n">allow_no_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">sample_config</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mysqld&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>
<span class="go">&#39;mysql&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mysqld&#39;</span><span class="p">,</span> <span class="s1">&#39;skip-bdb&#39;</span><span class="p">)</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mysqld&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">NoOptionError</span>: <span class="n">No option &#39;unknown&#39; in section: &#39;mysqld&#39;</span>
</pre></div>
</div>
<p>(Contributed by Mats Kindahl; <a class="reference external" href="https://bugs.python.org/issue7005">bpo-7005</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-func docutils literal"><span class="pre">contextlib.nested()</span></code> 関数が廃止予定になりました。これは1つの <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal"><span class="pre">with</span></code></a> 文で1つ以上のコンテキストマネージャーを扱うためのものでしたが、 <a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal"><span class="pre">with</span></code></a> 文が複数のコンテキストマネージャーをサポートするようになりました。</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">cookielib</span></code> モジュールが不正な、値が整数値ではないバージョンフィールドを持つ cookie を無視するようになりました。(Fixed by John J. Lee; <a class="reference external" href="https://bugs.python.org/issue3924">bpo-3924</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/copy.html#module-copy" title="copy: Shallow and deep copy operations."><code class="xref py py-mod docutils literal"><span class="pre">copy</span></code></a> モジュールの <a class="reference internal" href="../library/copy.html#copy.deepcopy" title="copy.deepcopy"><code class="xref py py-func docutils literal"><span class="pre">deepcopy()</span></code></a> 関数が、束縛ずみインスタンスメソッドを正しくコピーするようになりました。(Implemented by Robert Collins; <a class="reference external" href="https://bugs.python.org/issue1515">bpo-1515</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ctypes.html#module-ctypes" title="ctypes: A foreign function library for Python."><code class="xref py py-mod docutils literal"><span class="pre">ctypes</span></code></a> モジュールが、ポインタとして宣言された引数に対して <code class="docutils literal"><span class="pre">None</span></code> が渡された場合常に C の NULL ポインタに変換するようになりました。(Changed by Thomas Heller; <a class="reference external" href="https://bugs.python.org/issue4606">bpo-4606</a>.) 基盤となっている <a class="reference external" href="https://sourceware.org/libffi/">libffi ライブラリ</a> が 3.0.9 にアップデートされ、いくつかのプラットフォームにおけるいろいろな問題が修正されました。(Updated by Matthias Klose; <a class="reference external" href="https://bugs.python.org/issue8142">bpo-8142</a>.)</p>
</li>
<li><p class="first">新しいメソッド: <a class="reference internal" href="../library/datetime.html#module-datetime" title="datetime: Basic date and time types."><code class="xref py py-mod docutils literal"><span class="pre">datetime</span></code></a> モジュールの <a class="reference internal" href="../library/datetime.html#datetime.timedelta" title="datetime.timedelta"><code class="xref py py-class docutils literal"><span class="pre">timedelta</span></code></a> クラスに <a class="reference internal" href="../library/datetime.html#datetime.timedelta.total_seconds" title="datetime.timedelta.total_seconds"><code class="xref py py-meth docutils literal"><span class="pre">total_seconds()</span></code></a> メソッドが追加されました。これはその期間の秒数を返します。(Contributed by Brian Quinlan; <a class="reference external" href="https://bugs.python.org/issue5788">bpo-5788</a>.)</p>
</li>
<li><p class="first">新しいメソッド: <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> クラスに、浮動小数点数から <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> への正確な変換を行う <a class="reference internal" href="../library/decimal.html#decimal.Decimal.from_float" title="decimal.Decimal.from_float"><code class="xref py py-meth docutils literal"><span class="pre">from_float()</span></code></a> クラスメソッドが追加されました。この正確な変換は、浮動小数点数が示す値に一番近い近似となる10進数を求めます。なので、このメソッドを使ったとしてもある程度の誤差は残ります。例えば、 <code class="docutils literal"><span class="pre">Decimal.from_float(0.1)</span></code> は <code class="docutils literal"><span class="pre">Decimal('0.1000000000000000055511151231257827021181583404541015625')</span></code> を返します。 (Implemented by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue4796">bpo-4796</a>.)</p>
<p><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> のインスタンスと浮動小数点数の比較は、オペランドの値に応じた賢い結果を返すようになりました。以前はこの比較は Python のデフォルトのオブジェクト比較にフォールバックし、オペランドの型に応じて不定な結果が返されていました。ただし、 <code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code> と浮動小数点数を加算などの他の演算で組み合わせることはいまでも許可されていません。浮動小数点数と <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> の間の変換方法を明示的に指定するべきです。(Fixed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue2531">bpo-2531</a>.)</p>
<p><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> のコンストラクタが浮動小数点数を受け入れるようになりました。 (added by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue8257">bpo-8257</a>) また、アラビア・インド数字などの、ヨーロッパ以外の Unicode 文字も受け入れるようになりました。 (contributed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue6595">bpo-6595</a>).</p>
<p><a class="reference internal" href="../library/decimal.html#decimal.Context" title="decimal.Context"><code class="xref py py-class docutils literal"><span class="pre">Context</span></code></a> クラスのほとんどのメソッドが <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> インスタンスと同じく整数を受け入れるようになりました。例外は <a class="reference internal" href="../library/decimal.html#decimal.Context.canonical" title="decimal.Context.canonical"><code class="xref py py-meth docutils literal"><span class="pre">canonical()</span></code></a> と <a class="reference internal" href="../library/decimal.html#decimal.Context.is_canonical" title="decimal.Context.is_canonical"><code class="xref py py-meth docutils literal"><span class="pre">is_canonical()</span></code></a> メソッドだけです。 (Patch by Juan José Conti; <a class="reference external" href="https://bugs.python.org/issue7633">bpo-7633</a>.)</p>
<p><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> インスタンスを文字列の <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><code class="xref py py-meth docutils literal"><span class="pre">format()</span></code></a> メソッドで利用した場合、デフォルトのアライメントが左揃えから、数値型に適した右揃えに変更されました。  (Changed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue6857">bpo-6857</a>.)</p>
<p>signaling NaN (あるいは <code class="docutils literal"><span class="pre">sNAN</span></code>) との比較は、暗黙に比較演算に応じて真偽値を返すのではなく、 <code class="xref py py-const docutils literal"><span class="pre">InvalidOperation</span></code> 例外を発生させるようになりました。 Quiet NaN (あるいは <code class="docutils literal"><span class="pre">NaN</span></code>) はハッシュ可能になりました。 (Fixed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue7279">bpo-7279</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/difflib.html#module-difflib" title="difflib: Helpers for computing differences between objects."><code class="xref py py-mod docutils literal"><span class="pre">difflib</span></code></a> モジュールの出力が、ファイル名を含むヘッダのセパレータにスペースではなくタブ文字を使うようになり、最近の <strong class="command">diff</strong>/<strong class="command">patch</strong> ツールとの互換性が高くなりました。(Fixed by Anatoly Techtonik; <a class="reference external" href="https://bugs.python.org/issue7585">bpo-7585</a>.)</p>
</li>
<li><p class="first">Distutils <code class="docutils literal"><span class="pre">sdist</span></code> コマンドが、 <code class="file docutils literal"><span class="pre">MANIFEST.in</span></code> や <code class="file docutils literal"><span class="pre">setup.py</span></code> ファイルが変更されていなくても、ユーザーが作成したかもしれない新しいファイルが含まれるようにするために、毎回 <code class="file docutils literal"><span class="pre">MANIFEST</span></code> ファイルを再生成するようになりました。 (Fixed by Tarek Ziadé; <a class="reference external" href="https://bugs.python.org/issue8688">bpo-8688</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/doctest.html#module-doctest" title="doctest: Test pieces of code within docstrings."><code class="xref py py-mod docutils literal"><span class="pre">doctest</span></code></a> モジュールの <code class="xref py py-const docutils literal"><span class="pre">IGNORE_EXCEPTION_DETAIL</span></code> フラグが、テストされている例外を含むモジュールの名前を無視するようになりました。 (Patch by Lennart Regebro; <a class="reference external" href="https://bugs.python.org/issue7490">bpo-7490</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal"><span class="pre">email</span></code></a> モジュールの <a class="reference internal" href="../library/email.compat32-message.html#email.message.Message" title="email.message.Message"><code class="xref py py-class docutils literal"><span class="pre">Message</span></code></a> クラスが Uniode値のペイロードを受け入れるようになり、自動的に <code class="xref py py-attr docutils literal"><span class="pre">output_charset</span></code> で指定されたエンコーディングに変換するようになりました。 (Added by R. David Murray; <a class="reference external" href="https://bugs.python.org/issue1368247">bpo-1368247</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><code class="xref py py-class docutils literal"><span class="pre">Fraction</span></code></a> クラスが、コンストラクタの引数として、 1つの float 値、 <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> インスタンス、 2つの有理数を受け入れるようになりました。(Implemented by Mark Dickinson; rationals added in <a class="reference external" href="https://bugs.python.org/issue5812">bpo-5812</a>, and float/decimal in <a class="reference external" href="https://bugs.python.org/issue8294">bpo-8294</a>.)</p>
<p>fraction と complex 数の間の順序比較演算 (<code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code>)が <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal"><span class="pre">TypeError</span></code></a> 例外を発生させるようになりました。これは過失を修正し、 <a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><code class="xref py py-class docutils literal"><span class="pre">Fraction</span></code></a> を他の数値型とマッチさせます。</p>
</li>
<li><p class="first">新しいクラス: <a class="reference internal" href="../library/ftplib.html#ftplib.FTP_TLS" title="ftplib.FTP_TLS"><code class="xref py py-class docutils literal"><span class="pre">FTP_TLS</span></code></a> が <a class="reference internal" href="../library/ftplib.html#module-ftplib" title="ftplib: FTP protocol client (requires sockets)."><code class="xref py py-mod docutils literal"><span class="pre">ftplib</span></code></a> に追加されました。認証とその後の制御・データ転送をTLSカプセル化することでセキュアなFTP接続を提供します。 (Contributed by Giampaolo Rodola; <a class="reference external" href="https://bugs.python.org/issue2054">bpo-2054</a>.)</p>
<p>バイナリデータのアップロードを行う <a class="reference internal" href="../library/ftplib.html#ftplib.FTP.storbinary" title="ftplib.FTP.storbinary"><code class="xref py py-meth docutils literal"><span class="pre">storbinary()</span></code></a> に <em>rest</em> 引数が追加され、アップロードのリスタートができるようになりました。 (patch by Pablo Mouzo; <a class="reference external" href="https://bugs.python.org/issue6845">bpo-6845</a>.)</p>
</li>
<li><p class="first">新しいクラスデコレータ: <a class="reference internal" href="../library/functools.html#module-functools" title="functools: Higher-order functions and operations on callable objects."><code class="xref py py-mod docutils literal"><span class="pre">functools</span></code></a> モジュールに <a class="reference internal" href="../library/functools.html#functools.total_ordering" title="functools.total_ordering"><code class="xref py py-func docutils literal"><span class="pre">total_ordering()</span></code></a>  が追加されました。 <a class="reference internal" href="../reference/datamodel.html#object.__eq__" title="object.__eq__"><code class="xref py py-meth docutils literal"><span class="pre">__eq__()</span></code></a> と、 <a class="reference internal" href="../reference/datamodel.html#object.__lt__" title="object.__lt__"><code class="xref py py-meth docutils literal"><span class="pre">__lt__()</span></code></a>, <a class="reference internal" href="../reference/datamodel.html#object.__le__" title="object.__le__"><code class="xref py py-meth docutils literal"><span class="pre">__le__()</span></code></a>, <a class="reference internal" href="../reference/datamodel.html#object.__gt__" title="object.__gt__"><code class="xref py py-meth docutils literal"><span class="pre">__gt__()</span></code></a>, <a class="reference internal" href="../reference/datamodel.html#object.__ge__" title="object.__ge__"><code class="xref py py-meth docutils literal"><span class="pre">__ge__()</span></code></a> のいづれか1つを定義したクラスを受け取り、残りの比較メソッドを生成します。 <code class="xref py py-meth docutils literal"><span class="pre">__cmp__()</span></code> メソッドが Python 3.x では廃止されたので、順序のあるクラスを定義するのを簡単にするためにこのデコレータがあります。(Added by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue5479">bpo-5479</a>.)</p>
<p>新しい関数: <a class="reference internal" href="../library/functools.html#functools.cmp_to_key" title="functools.cmp_to_key"><code class="xref py py-func docutils literal"><span class="pre">cmp_to_key()</span></code></a> 関数は、古いスタイルの2引数を受け取る比較関数を受け取り、 <a class="reference internal" href="../library/functions.html#sorted" title="sorted"><code class="xref py py-func docutils literal"><span class="pre">sorted()</span></code></a>, <a class="reference internal" href="../library/functions.html#min" title="min"><code class="xref py py-func docutils literal"><span class="pre">min()</span></code></a>, <a class="reference internal" href="../library/functions.html#max" title="max"><code class="xref py py-func docutils literal"><span class="pre">max()</span></code></a> などの <em>key</em> 引数に利用できる呼び出し可能オブジェクトを返します。この関数の主な目的は、古いコードを Python 3.x へ対応させるのを手助けすることです。(Added by Raymond Hettinger.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/gc.html#module-gc" title="gc: Interface to the cycle-detecting garbage collector."><code class="xref py py-mod docutils literal"><span class="pre">gc</span></code></a> モジュールに <a class="reference internal" href="../library/gc.html#gc.is_tracked" title="gc.is_tracked"><code class="xref py py-func docutils literal"><span class="pre">is_tracked()</span></code></a> 関数が追加されました。渡されたオブジェクトがGCに追跡されている場合に True を、そうでない場合に False を返します。 (Contributed by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue4688">bpo-4688</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/gzip.html#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code class="xref py py-mod docutils literal"><span class="pre">gzip</span></code></a> モジュールの <a class="reference internal" href="../library/gzip.html#gzip.GzipFile" title="gzip.GzipFile"><code class="xref py py-class docutils literal"><span class="pre">GzipFile</span></code></a> がコンテキストマネージャープロトコルをサポートしました。 <code class="docutils literal"><span class="pre">with</span> <span class="pre">gzip.GzipFile(...)</span> <span class="pre">as</span> <span class="pre">f:</span></code> と書くことができます。(contributed by Hagen Fürstenau; <a class="reference external" href="https://bugs.python.org/issue3860">bpo-3860</a> また、 <a class="reference internal" href="../library/io.html#io.BufferedIOBase" title="io.BufferedIOBase"><code class="xref py py-class docutils literal"><span class="pre">io.BufferedIOBase</span></code></a> ABC を実装しています。なので、より高速な処理のために <a class="reference internal" href="../library/io.html#io.BufferedReader" title="io.BufferedReader"><code class="xref py py-class docutils literal"><span class="pre">io.BufferedReader</span></code></a> でラップすることができます。 (contributed by Nir Aides; <a class="reference external" href="https://bugs.python.org/issue7471">bpo-7471</a>). さらに、コンストラクタにオプションのタイムスタンプを指定することで、 gzip ファイル内の変更時間レコードをオーバーライドすることができるようになりました。  (Contributed by Jacques Frechet; <a class="reference external" href="https://bugs.python.org/issue4272">bpo-4272</a>.)</p>
<p>gzip ファイルフォーマットのファイルは最後にゼロバイトによるパディングができるようになりました。 <a class="reference internal" href="../library/gzip.html#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code class="xref py py-mod docutils literal"><span class="pre">gzip</span></code></a> モジュールは末尾のゼロバイトを消費します。(Fixed by Tadek Pietraszek and Brian Curtin; <a class="reference external" href="https://bugs.python.org/issue2846">bpo-2846</a>.)</p>
</li>
<li><p class="first">新しい属性: <a class="reference internal" href="../library/hashlib.html#module-hashlib" title="hashlib: Secure hash and message digest algorithms."><code class="xref py py-mod docutils literal"><span class="pre">hashlib</span></code></a> モジュールに <code class="xref py py-attr docutils literal"><span class="pre">algorithms</span></code> 属性が追加されました。これはサポートしているアルゴリズムを含むタプルです。 Python 2.7 では、 <code class="docutils literal"><span class="pre">hashlib.algorithms</span></code> は <code class="docutils literal"><span class="pre">('md5',</span> <span class="pre">'sha1',</span> <span class="pre">'sha224',</span> <span class="pre">'sha256',</span> <span class="pre">'sha384',</span> <span class="pre">'sha512')</span></code> が含まれています。 (Contributed by Carl Chenet; <a class="reference external" href="https://bugs.python.org/issue7418">bpo-7418</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">httplib</span></code> モジュールで使われているデフォルトの <code class="xref py py-class docutils literal"><span class="pre">HTTPResponse</span></code> クラスがバッファリングをサポートし、HTTPレスポンスをより高速に読み込めるようになりました。 (Contributed by Kristján Valur Jónsson; <a class="reference external" href="https://bugs.python.org/issue4879">bpo-4879</a>.)</p>
<p><code class="xref py py-class docutils literal"><span class="pre">HTTPConnection</span></code> と <code class="xref py py-class docutils literal"><span class="pre">HTTPSConnection</span></code> クラスが <em>source_address</em> 引数として <code class="docutils literal"><span class="pre">(host,</span> <span class="pre">port)</span></code> の2要素タプルを受け取るようになりました。これは接続のソースアドレスとして利用されます。 (Contributed by Eldon Ziegler; <a class="reference external" href="https://bugs.python.org/issue3972">bpo-3972</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">ihooks</span></code> モジュールが相対 import をサポートしました。 <code class="xref py py-mod docutils literal"><span class="pre">ihooks</span></code> import をカスタマイズするための古いモジュールで、 Python 2.0 で追加された <code class="xref py py-mod docutils literal"><span class="pre">imputil</span></code> モジュールに取って変わられていることに注意してください。 (Relative import support added by Neil Schemenauer.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/imaplib.html#module-imaplib" title="imaplib: IMAP4 protocol client (requires sockets)."><code class="xref py py-mod docutils literal"><span class="pre">imaplib</span></code></a> モジュールが IPv6 アドレスをサポートするようになりました。 (Contributed by Derek Morr; <a class="reference external" href="https://bugs.python.org/issue1655">bpo-1655</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/inspect.html#module-inspect" title="inspect: Extract information and source code from live objects."><code class="xref py py-mod docutils literal"><span class="pre">inspect</span></code></a> モジュールに <a class="reference internal" href="../library/inspect.html#inspect.getcallargs" title="inspect.getcallargs"><code class="xref py py-func docutils literal"><span class="pre">getcallargs()</span></code></a> 関数が追加されました。 callable とその位置引数、キーワード引数を受け取り、 callable のどの仮引数がどの実引数を受け取るかを計算し、引数名から値へマップする辞書を返します。例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">getcallargs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">pos</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcallargs</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">{&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;pos&#39;: (3,), &#39;named&#39;: {}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcallargs</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">{&#39;a&#39;: 2, &#39;b&#39;: 1, &#39;pos&#39;: (), &#39;named&#39;: {&#39;x&#39;: 4}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcallargs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">f() takes at least 1 argument (0 given)</span>
</pre></div>
</div>
<p>Contributed by George Sakkis; <a class="reference external" href="https://bugs.python.org/issue3135">bpo-3135</a>.</p>
</li>
<li><p class="first">更新されたモジュール: <a class="reference internal" href="../library/io.html#module-io" title="io: Core tools for working with streams."><code class="xref py py-mod docutils literal"><span class="pre">io</span></code></a> ライブラリが、Python 3.1 に同梱されるバージョンに更新されました。 3.1 では、I/O ライブラリは完全に C で書き直され、処理されるタスクに依って 2 から 20 倍速くなりました。元の Python バージョンは <code class="xref py py-mod docutils literal"><span class="pre">_pyio</span></code> モジュールに改名されました。</p>
<p>結果の軽微な変更: <a class="reference internal" href="../library/io.html#io.TextIOBase" title="io.TextIOBase"><code class="xref py py-class docutils literal"><span class="pre">io.TextIOBase</span></code></a> クラスは、エンコーディングやデコーディングのエラーに使われるエラー設定 (<code class="docutils literal"><span class="pre">'strict'</span></code>, <code class="docutils literal"><span class="pre">'replace'</span></code>, <code class="docutils literal"><span class="pre">'ignore'</span></code> のいずれか) を与える <code class="xref py py-attr docutils literal"><span class="pre">errors</span></code> 属性を持つようになりました。</p>
<p><a class="reference internal" href="../library/io.html#io.FileIO" title="io.FileIO"><code class="xref py py-class docutils literal"><span class="pre">io.FileIO</span></code></a> クラスは、無効なファイルディスクリプタを渡されたときに <a class="reference internal" href="../library/exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal"><span class="pre">OSError</span></code></a> を送出するようになりました。(Implemented by Benjamin Peterson; <a class="reference external" href="https://bugs.python.org/issue4991">bpo-4991</a>.) <a class="reference internal" href="../library/io.html#io.IOBase.truncate" title="io.IOBase.truncate"><code class="xref py py-meth docutils literal"><span class="pre">truncate()</span></code></a> メソッドは、ファイル位置を保存するようになりました。以前は、ファイル位置を新しいファイルの末尾に変更しました。(Fixed by Pascal Chambon; <a class="reference external" href="https://bugs.python.org/issue6939">bpo-6939</a>.)</p>
</li>
<li><p class="first">新しい関数: <code class="docutils literal"><span class="pre">itertools.compress(data,</span> <span class="pre">selectors)</span></code> は、2 つのイテレータを取ります。<em>data</em> の要素は、<em>selectors</em> の対応する値が真であれば返されます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="s1">&#39;ABCDEF&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span>
</pre></div>
</div>
<p>新しい関数: <code class="docutils literal"><span class="pre">itertools.combinations_with_replacement(iter,</span> <span class="pre">r)</span></code> は、 <em>iter</em> から、すべての可能な長さ <em>r</em> の要素の組合せを返します。 <a class="reference internal" href="../library/itertools.html#itertools.combinations" title="itertools.combinations"><code class="xref py py-func docutils literal"><span class="pre">combinations()</span></code></a> とは異なり、生成された組合せに個別の要素が繰り返し出現できます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations_with_replacement</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span>
  <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>なお要素は、実際の値ではなく、その入力内での位置に依って一意であるとみなされます。</p>
<p><a class="reference internal" href="../library/itertools.html#itertools.count" title="itertools.count"><code class="xref py py-func docutils literal"><span class="pre">itertools.count()</span></code></a> 関数は、1 以外の値を増分できるように、 <em>step</em> 引数を追加しました。 <a class="reference internal" href="../library/itertools.html#itertools.count" title="itertools.count"><code class="xref py py-func docutils literal"><span class="pre">count()</span></code></a> はまた、キーワード引数に対応し、さらに浮動小数点数や <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> インスタンスのような、非整数の値を使えるようになりました。(Implemented by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue5032">bpo-5032</a>.)</p>
<p><a class="reference internal" href="../library/itertools.html#itertools.combinations" title="itertools.combinations"><code class="xref py py-func docutils literal"><span class="pre">itertools.combinations()</span></code></a> および <a class="reference internal" href="../library/itertools.html#itertools.product" title="itertools.product"><code class="xref py py-func docutils literal"><span class="pre">itertools.product()</span></code></a> は、以前は入力のイテレート可能オブジェクトより大きい <em>r</em> に <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal"><span class="pre">ValueError</span></code></a> を返していました。これは仕様エラーと認められ、空のイテレータを返すようになりました。(Fixed by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue4816">bpo-4816</a>.)</p>
</li>
<li><p class="first">更新されたモジュール: <a class="reference internal" href="../library/json.html#module-json" title="json: Encode and decode the JSON format."><code class="xref py py-mod docutils literal"><span class="pre">json</span></code></a> モジュールが、エンコーディングやデコーディングを高速化する C 拡張を含んだ、 simplejson パッケージのバージョン 2.0.9 にアップグレードされました。 (Contributed by Bob Ippolito; <a class="reference external" href="https://bugs.python.org/issue4136">bpo-4136</a>.)</p>
<p>新しい <a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><code class="xref py py-class docutils literal"><span class="pre">collections.OrderedDict</span></code></a> 型をサポートするために、 <a class="reference internal" href="../library/json.html#json.load" title="json.load"><code class="xref py py-func docutils literal"><span class="pre">json.load()</span></code></a> はオプションとして、任意のオブジェクトリテラルに対して呼び出され、ペアのリストにデコードする <em>object_pairs_hook</em> パラメタを追加しました。(Contributed by Raymond Hettinger; <a class="reference external" href="https://bugs.python.org/issue5381">bpo-5381</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/mailbox.html#module-mailbox" title="mailbox: Manipulate mailboxes in various formats"><code class="xref py py-mod docutils literal"><span class="pre">mailbox</span></code></a> モジュールの <a class="reference internal" href="../library/mailbox.html#mailbox.Maildir" title="mailbox.Maildir"><code class="xref py py-class docutils literal"><span class="pre">Maildir</span></code></a> クラスは、読み込むディレクトリのタイムスタンプを記録し、その後に更新時刻が変わった場合にのみ再読み込みするようになりました。これは不必要なディレクトリ走査を避けることでパフォーマンスを向上させます。(Fixed by A.M. Kuchling and Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue1607951">bpo-1607951</a>, <a class="reference external" href="https://bugs.python.org/issue6896">bpo-6896</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/math.html#module-math" title="math: Mathematical functions (sin() etc.)."><code class="xref py py-mod docutils literal"><span class="pre">math</span></code></a> モジュールは、誤差関数と相補誤差関数 <a class="reference internal" href="../library/math.html#math.erf" title="math.erf"><code class="xref py py-func docutils literal"><span class="pre">erf()</span></code></a> および <a class="reference internal" href="../library/math.html#math.erfc" title="math.erfc"><code class="xref py py-func docutils literal"><span class="pre">erfc()</span></code></a> 、 <code class="docutils literal"><span class="pre">e**x</span> <span class="pre">-</span> <span class="pre">1</span></code> を <a class="reference internal" href="../library/math.html#math.exp" title="math.exp"><code class="xref py py-func docutils literal"><span class="pre">exp()</span></code></a> から 1 を引くのよりも高い精度で計算する <a class="reference internal" href="../library/math.html#math.expm1" title="math.expm1"><code class="xref py py-func docutils literal"><span class="pre">expm1()</span></code></a> 、ガンマ関数 <a class="reference internal" href="../library/math.html#math.gamma" title="math.gamma"><code class="xref py py-func docutils literal"><span class="pre">gamma()</span></code></a> 、そしてガンマ関数の自然対数 <a class="reference internal" href="../library/math.html#math.lgamma" title="math.lgamma"><code class="xref py py-func docutils literal"><span class="pre">lgamma()</span></code></a> を追加しました。 (Contributed by Mark Dickinson and nirinA raseliarison; <a class="reference external" href="https://bugs.python.org/issue3366">bpo-3366</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/multiprocessing.html#module-multiprocessing" title="multiprocessing: Process-based parallelism."><code class="xref py py-mod docutils literal"><span class="pre">multiprocessing</span></code></a> モジュールの <code class="xref py py-class docutils literal"><span class="pre">Manager*</span></code> クラスに、サブプロセスの開始時に呼び出される呼び出し可能オブジェクトと、それに渡される引数群を渡すことができるようになりました。 (Contributed by lekma; <a class="reference external" href="https://bugs.python.org/issue5585">bpo-5585</a>.)</p>
<p>ワーカプロセスのプールを制御する <code class="xref py py-class docutils literal"><span class="pre">Pool</span></code> クラスに、オプションの <em>maxtasksperchild</em> パラメタが追加されました。ワーカプロセスはこれで指定された数のタスクを処理したら、退出して <code class="xref py py-class docutils literal"><span class="pre">Pool</span></code> に新しいワーカーを開始させます。これは、タスクがメモリその他のリソースをリークし得るときや、ワーカをとても大きくしてしまうようなタスクがあるときに便利です。 (Contributed by Charles Cazabon; <a class="reference external" href="https://bugs.python.org/issue6963">bpo-6963</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/nntplib.html#module-nntplib" title="nntplib: NNTP protocol client (requires sockets)."><code class="xref py py-mod docutils literal"><span class="pre">nntplib</span></code></a> モジュールは、IPv6 アドレスをサポートするようになりました。 (Contributed by Derek Morr; <a class="reference external" href="https://bugs.python.org/issue1664">bpo-1664</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal"><span class="pre">os</span></code></a> モジュールは、以下の POSIX システムコールをラップします: real, effective, および saved GID と UID を返す、 <a class="reference internal" href="../library/os.html#os.getresgid" title="os.getresgid"><code class="xref py py-func docutils literal"><span class="pre">getresgid()</span></code></a> と <a class="reference internal" href="../library/os.html#os.getresuid" title="os.getresuid"><code class="xref py py-func docutils literal"><span class="pre">getresuid()</span></code></a> 、 real, effective, および saved GID と UID を新しく設定する、 <a class="reference internal" href="../library/os.html#os.setresgid" title="os.setresgid"><code class="xref py py-func docutils literal"><span class="pre">setresgid()</span></code></a> と <a class="reference internal" href="../library/os.html#os.setresuid" title="os.setresuid"><code class="xref py py-func docutils literal"><span class="pre">setresuid()</span></code></a> 、現在のプロセスにグループアクセスリストを初期化する <a class="reference internal" href="../library/os.html#os.initgroups" title="os.initgroups"><code class="xref py py-func docutils literal"><span class="pre">initgroups()</span></code></a>  。 (GID/UID functions contributed by Travis H.; <a class="reference external" href="https://bugs.python.org/issue6508">bpo-6508</a>. Support for initgroups added by Jean-Paul Calderone; <a class="reference external" href="https://bugs.python.org/issue7333">bpo-7333</a>.)</p>
<p><a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><code class="xref py py-func docutils literal"><span class="pre">os.fork()</span></code></a> 関数は、子プロセス中で import ロックを再初期化するようになりました。これは、Solaris における <a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><code class="xref py py-func docutils literal"><span class="pre">fork()</span></code></a> がスレッドから呼び出された時の問題を修正します。(Fixed by Zsolt Cserna; <a class="reference external" href="https://bugs.python.org/issue7242">bpo-7242</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/os.path.html#module-os.path" title="os.path: Operations on pathnames."><code class="xref py py-mod docutils literal"><span class="pre">os.path</span></code></a> モジュールの、 <a class="reference internal" href="../library/os.path.html#os.path.normpath" title="os.path.normpath"><code class="xref py py-func docutils literal"><span class="pre">normpath()</span></code></a> および <a class="reference internal" href="../library/os.path.html#os.path.abspath" title="os.path.abspath"><code class="xref py py-func docutils literal"><span class="pre">abspath()</span></code></a> 関数は、Unicode を保存するようになりました。入力パスが Unicode なら、戻り値も Unicode 文字列になります。 (<a class="reference internal" href="../library/os.path.html#os.path.normpath" title="os.path.normpath"><code class="xref py py-meth docutils literal"><span class="pre">normpath()</span></code></a> fixed by Matt Giuca in <a class="reference external" href="https://bugs.python.org/issue5827">bpo-5827</a>; <a class="reference internal" href="../library/os.path.html#os.path.abspath" title="os.path.abspath"><code class="xref py py-meth docutils literal"><span class="pre">abspath()</span></code></a> fixed by Ezio Melotti in <a class="reference external" href="https://bugs.python.org/issue3426">bpo-3426</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/pydoc.html#module-pydoc" title="pydoc: Documentation generator and online help system."><code class="xref py py-mod docutils literal"><span class="pre">pydoc</span></code></a> モジュールは、Python が使う様々なシンボルのヘルプを追加しました。例えば、 <code class="docutils literal"><span class="pre">help('&lt;&lt;')</span></code> や <code class="docutils literal"><span class="pre">help('&#64;')</span></code> とできるようになりました。(Contributed by David Laban; <a class="reference external" href="https://bugs.python.org/issue4739">bpo-4739</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/re.html#module-re" title="re: Regular expression operations."><code class="xref py py-mod docutils literal"><span class="pre">re</span></code></a> モジュールの <a class="reference internal" href="../library/re.html#re.split" title="re.split"><code class="xref py py-func docutils literal"><span class="pre">split()</span></code></a>, <a class="reference internal" href="../library/re.html#re.sub" title="re.sub"><code class="xref py py-func docutils literal"><span class="pre">sub()</span></code></a>, および <a class="reference internal" href="../library/re.html#re.subn" title="re.subn"><code class="xref py py-func docutils literal"><span class="pre">subn()</span></code></a> は、モジュールの他の関数との一貫性のため、オプションの <em>flags</em> 引数を受け付けるようになりました。 (Added by Gregory P. Smith.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/runpy.html#module-runpy" title="runpy: Locate and run Python modules without importing them first."><code class="xref py py-mod docutils literal"><span class="pre">runpy</span></code></a> モジュールの <a class="reference internal" href="../library/runpy.html#runpy.run_path" title="runpy.run_path"><code class="xref py py-func docutils literal"><span class="pre">run_path()</span></code></a> は、与えられた <em>path</em> 引数のコードを実行します。 <em>path</em> は Python ソースファイルのパス (<code class="file docutils literal"><span class="pre">example.py</span></code>)、コンパイル済みバイトコードファイル (<code class="file docutils literal"><span class="pre">example.pyc</span></code>)、ディレクトリ (<code class="file docutils literal"><span class="pre">./package/</span></code>)、または zip アーカイブ (<code class="file docutils literal"><span class="pre">example.zip</span></code>) にできます。ディレクトリか zip パスが与えられると、それが <code class="docutils literal"><span class="pre">sys.path</span></code> の最初に加えられ、モジュール <a class="reference internal" href="../library/__main__.html#module-__main__" title="__main__: The environment where the top-level script is run."><code class="xref py py-mod docutils literal"><span class="pre">__main__</span></code></a> が import されます。これは、ディレクトリや zip が <code class="file docutils literal"><span class="pre">__main__.py</span></code> を含むことを期待します。なければ、他の <code class="file docutils literal"><span class="pre">__main__.py</span></code> が <code class="docutils literal"><span class="pre">sys.path</span></code> の後の部分から import されることがあります。これにより、Python のコマンドラインが明示的なパス名を処理する方法を真似たいようなスクリプトに、 <a class="reference internal" href="../library/runpy.html#module-runpy" title="runpy: Locate and run Python modules without importing them first."><code class="xref py py-mod docutils literal"><span class="pre">runpy</span></code></a> のより多くの機構が利用できるようになります。 (Added by Nick Coghlan; <a class="reference external" href="https://bugs.python.org/issue6816">bpo-6816</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/shutil.html#module-shutil" title="shutil: High-level file operations, including copying."><code class="xref py py-mod docutils literal"><span class="pre">shutil</span></code></a> モジュールの <a class="reference internal" href="../library/shutil.html#shutil.make_archive" title="shutil.make_archive"><code class="xref py py-func docutils literal"><span class="pre">make_archive()</span></code></a> は、ファイル名、アーカイブ型 (zip または tar-format)、およびディレクトリパスを取って、そのディレクトリの内容を含むアーカイブを生成します。(Added by Tarek Ziadé.)</p>
<p><a class="reference internal" href="../library/shutil.html#module-shutil" title="shutil: High-level file operations, including copying."><code class="xref py py-mod docutils literal"><span class="pre">shutil</span></code></a> の <a class="reference internal" href="../library/shutil.html#shutil.copyfile" title="shutil.copyfile"><code class="xref py py-func docutils literal"><span class="pre">copyfile()</span></code></a> および <a class="reference internal" href="../library/shutil.html#shutil.copytree" title="shutil.copytree"><code class="xref py py-func docutils literal"><span class="pre">copytree()</span></code></a> 関数は、名前付きパイプのコピーを求められたときに <code class="xref py py-exc docutils literal"><span class="pre">SpecialFileError</span></code> 例外を送出する様になりました。以前は、コードは、名前付きパイプを、通常のファイルのように読み込み用に開いて扱い、いつまでもブロックしていました。 (Fixed by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue3002">bpo-3002</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/signal.html#module-signal" title="signal: Set handlers for asynchronous events."><code class="xref py py-mod docutils literal"><span class="pre">signal</span></code></a> モジュールは、シグナルハンドラを本当に必要でない限り再インストールしなくなりました。これで、EINTR シグナルを確実に捕えられないバグが修正されました。(Fixed by Charles-Francois Natali; <a class="reference external" href="https://bugs.python.org/issue8354">bpo-8354</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/site.html#module-site" title="site: Module responsible for site-specific configuration."><code class="xref py py-mod docutils literal"><span class="pre">site</span></code></a> モジュールの、新しい関数群は様々なサイトおよびユーザに特有のパスを返します。 <a class="reference internal" href="../library/site.html#site.getsitepackages" title="site.getsitepackages"><code class="xref py py-func docutils literal"><span class="pre">getsitepackages()</span></code></a> は、全てのグローバル site-packages ディレクトリを含むリストを返します。 <a class="reference internal" href="../library/site.html#site.getusersitepackages" title="site.getusersitepackages"><code class="xref py py-func docutils literal"><span class="pre">getusersitepackages()</span></code></a> は、ユーザの site-packages ディレクトリのパスを返します。そして、 <a class="reference internal" href="../library/site.html#site.getuserbase" title="site.getuserbase"><code class="xref py py-func docutils literal"><span class="pre">getuserbase()</span></code></a> は、データの保存に使えるディレクトリへのパスを与える、 <span class="target" id="index-43"></span><code class="xref std std-envvar docutils literal"><span class="pre">USER_BASE</span></code> 環境変数の値を返します。 (Contributed by Tarek Ziadé; <a class="reference external" href="https://bugs.python.org/issue6693">bpo-6693</a>.)</p>
<p><a class="reference internal" href="../library/site.html#module-site" title="site: Module responsible for site-specific configuration."><code class="xref py py-mod docutils literal"><span class="pre">site</span></code></a> モジュールは <code class="xref py py-mod docutils literal"><span class="pre">sitecustomize</span></code> モジュールが import されたときに例外を報告するようになり、 <a class="reference internal" href="../library/exceptions.html#KeyboardInterrupt" title="KeyboardInterrupt"><code class="xref py py-exc docutils literal"><span class="pre">KeyboardInterrupt</span></code></a> 例外が捕捉されて飲み込まれることはなくなりました。 (Fixed by Victor Stinner; <a class="reference external" href="https://bugs.python.org/issue3137">bpo-3137</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/socket.html#socket.create_connection" title="socket.create_connection"><code class="xref py py-func docutils literal"><span class="pre">create_connection()</span></code></a> 関数は、接続に使われるソースアドレスを与える <code class="docutils literal"><span class="pre">(host,</span> <span class="pre">port)</span></code> の 2-タプル、 <em>source_address</em> パラメタを追加しました。 (Contributed by Eldon Ziegler; <a class="reference external" href="https://bugs.python.org/issue3972">bpo-3972</a>.)</p>
<p><a class="reference internal" href="../library/socket.html#socket.socket.recv_into" title="socket.socket.recv_into"><code class="xref py py-meth docutils literal"><span class="pre">recv_into()</span></code></a> および <a class="reference internal" href="../library/socket.html#socket.socket.recvfrom_into" title="socket.socket.recvfrom_into"><code class="xref py py-meth docutils literal"><span class="pre">recvfrom_into()</span></code></a> メソッドは、バッファ API をサポートするオブジェクト、最も便利なのは <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal"><span class="pre">bytearray</span></code></a> や <a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><code class="xref py py-class docutils literal"><span class="pre">memoryview</span></code></a> 、に書きこむようになりました。 (Implemented by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue8104">bpo-8104</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">SocketServer</span></code> モジュールの <code class="xref py py-class docutils literal"><span class="pre">TCPServer</span></code> クラスは、ソケットタイムアウトと Nagle アルゴリズムの無効化をサポートするようになりました。 <code class="xref py py-attr docutils literal"><span class="pre">disable_nagle_algorithm</span></code> クラス属性は、デフォルトで <code class="docutils literal"><span class="pre">False</span></code> です。上書きされて真になると、新しいリクエスト接続は、TCP_NODELAY オプションを設定され、一つの TCP パケットにたくさんの小さな送信がバッファリングされることを防ぎます。 <code class="xref py py-attr docutils literal"><span class="pre">timeout</span></code> クラス属性は、リクエストソケットに適用されるタイムアウトを秒で保持できます。その時間内にリクエストが受け付けられなければ、 <code class="xref py py-meth docutils literal"><span class="pre">handle_timeout()</span></code> が呼び出され、 <code class="xref py py-meth docutils literal"><span class="pre">handle_request()</span></code> が返されます。(Contributed by Kristján Valur Jónsson; <a class="reference external" href="https://bugs.python.org/issue6192">bpo-6192</a> and <a class="reference external" href="https://bugs.python.org/issue6267">bpo-6267</a>.)</p>
</li>
<li><p class="first">更新されたモジュール: <a class="reference internal" href="../library/sqlite3.html#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code class="xref py py-mod docutils literal"><span class="pre">sqlite3</span></code></a> モジュールが <a class="reference external" href="https://github.com/ghaering/pysqlite">pysqlite パッケージ</a> のバージョン 2.6.0 にアップデートされました。バージョン 2.6.0 はいくつかのバグ修正を含み、共有ライブラリから SQLite 拡張をロードできるようになりました。拡張を有効にするには <code class="docutils literal"><span class="pre">enable_load_extension(True)</span></code> メソッドを呼び出し、そして特定の共有ライブラリをロードするには <a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.load_extension" title="sqlite3.Connection.load_extension"><code class="xref py py-meth docutils literal"><span class="pre">load_extension()</span></code></a> を呼び出してください。 (Updated by Gerhard Häring.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal"><span class="pre">ssl</span></code></a> モジュールの <a class="reference internal" href="../library/ssl.html#ssl.SSLSocket" title="ssl.SSLSocket"><code class="xref py py-class docutils literal"><span class="pre">SSLSocket</span></code></a> オブジェクトは、バッファ API をサポートするようになりました。これは、テストスイートの障害を修正します (fix by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue7133">bpo-7133</a>)。また、OpenSSL の <code class="xref c c-macro docutils literal"><span class="pre">SSL_MODE_AUTO_RETRY</span></code> を自動的に設定することで、 <code class="xref py py-meth docutils literal"><span class="pre">recv()</span></code> 演算によって SSL 再ネゴシエーションを引き起こすエラーコードが返されるのを防ぎます (fix by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue8222">bpo-8222</a>)。</p>
<p><a class="reference internal" href="../library/ssl.html#ssl.wrap_socket" title="ssl.wrap_socket"><code class="xref py py-func docutils literal"><span class="pre">ssl.wrap_socket()</span></code></a> コンストラクタ関数は、許可される暗号化アルゴリズムを列挙する文字列である <em>ciphers</em> 引数を取るようになりました。この文字列の書式は、 <a class="reference external" href="https://www.openssl.org/docs/apps/ciphers.html#CIPHER-LIST-FORMAT">OpenSSL ドキュメント</a> で解説されています。 (Added by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue8322">bpo-8322</a>.)</p>
<p>その他の変更により、拡張はOpenSSL の全ての暗号とメッセージダイジェストアルゴリズムをロードし、それらすべてが利用できるようにします。SSL 証明書の中には検証できないものもあり、&quot;unknown algorithm&quot; エラーを報告します。 (Reported by Beda Kosata, and fixed by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue8484">bpo-8484</a>.)</p>
<p>OpenSSL の、使われるバージョンは、モジュール属性 <a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION" title="ssl.OPENSSL_VERSION"><code class="xref py py-data docutils literal"><span class="pre">ssl.OPENSSL_VERSION</span></code></a> (文字列)、 <a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION_INFO" title="ssl.OPENSSL_VERSION_INFO"><code class="xref py py-data docutils literal"><span class="pre">ssl.OPENSSL_VERSION_INFO</span></code></a> (5-タプル)、および <a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION_NUMBER" title="ssl.OPENSSL_VERSION_NUMBER"><code class="xref py py-data docutils literal"><span class="pre">ssl.OPENSSL_VERSION_NUMBER</span></code></a> (整数) として利用できるようになりました。 (Added by Antoin Pitrou; <a class="reference external" href="https://bugs.python.org/issue8321">bpo-8321</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/struct.html#module-struct" title="struct: Interpret bytes as packed binary data."><code class="xref py py-mod docutils literal"><span class="pre">struct</span></code></a> モジュールは、値が特定の整数フォーマットコード (<code class="docutils literal"><span class="pre">bBhHiIlLqQ</span></code> のいずれか) に対して大きすぎるときに、オーバーフローエラーを静かに無視しなくなりました。これは必ず <a class="reference internal" href="../library/struct.html#struct.error" title="struct.error"><code class="xref py py-exc docutils literal"><span class="pre">struct.error</span></code></a> 例外を送出するようになりました。 (Changed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue1523">bpo-1523</a>.) <a class="reference internal" href="../library/struct.html#struct.pack" title="struct.pack"><code class="xref py py-func docutils literal"><span class="pre">pack()</span></code></a> 関数は、非整数を変換してパックするのに、 <a class="reference internal" href="../reference/datamodel.html#object.__int__" title="object.__int__"><code class="xref py py-meth docutils literal"><span class="pre">__int__()</span></code></a> メソッドを試したりエラーを報告したりする前に、 <a class="reference internal" href="../reference/datamodel.html#object.__index__" title="object.__index__"><code class="xref py py-meth docutils literal"><span class="pre">__index__()</span></code></a> の使用も試すようになりました。 (Changed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue8300">bpo-8300</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/subprocess.html#module-subprocess" title="subprocess: Subprocess management."><code class="xref py py-mod docutils literal"><span class="pre">subprocess</span></code></a> モジュールの <a class="reference internal" href="../library/subprocess.html#subprocess.check_output" title="subprocess.check_output"><code class="xref py py-func docutils literal"><span class="pre">check_output()</span></code></a> は、指定された引数群でコマンドを実行し、コマンドがエラーを起こさずに実行したらコマンドの出力を文字列として返し、そうでなければ <a class="reference internal" href="../library/subprocess.html#subprocess.CalledProcessError" title="subprocess.CalledProcessError"><code class="xref py py-exc docutils literal"><span class="pre">CalledProcessError</span></code></a> 例外を送出します。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;df&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">])</span>
<span class="go">&#39;Filesystem     Size   Used  Avail Capacity  Mounted on\n</span>
<span class="go">/dev/disk0s2    52G    49G   3.0G    94%    /\n&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;df&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;/bogus&#39;</span><span class="p">])</span>
<span class="go">  ...</span>
<span class="go">subprocess.CalledProcessError: Command &#39;[&#39;df&#39;, &#39;-h&#39;, &#39;/bogus&#39;]&#39; returned non-zero exit status 1</span>
</pre></div>
</div>
<p>(Contributed by Gregory P. Smith.)</p>
<p><a class="reference internal" href="../library/subprocess.html#module-subprocess" title="subprocess: Subprocess management."><code class="xref py py-mod docutils literal"><span class="pre">subprocess</span></code></a> モジュールは、 <code class="xref py py-const docutils literal"><span class="pre">EINTR</span></code> シグナルを受け取り次第内部システムコールを最施行するようになりました。(Reported by several people; final patch by Gregory P. Smith in <a class="reference external" href="https://bugs.python.org/issue1068268">bpo-1068268</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/symtable.html#module-symtable" title="symtable: Interface to the compiler's internal symbol tables."><code class="xref py py-mod docutils literal"><span class="pre">symtable</span></code></a> モジュールの <a class="reference internal" href="../library/symtable.html#symtable.Symbol.is_declared_global" title="symtable.Symbol.is_declared_global"><code class="xref py py-func docutils literal"><span class="pre">is_declared_global()</span></code></a> は、明示的に global と宣言された引数には真、暗示的に global である引数には偽を返します。(Contributed by Jeremy Hylton.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/syslog.html#module-syslog" title="syslog: An interface to the Unix syslog library routines. (Unix)"><code class="xref py py-mod docutils literal"><span class="pre">syslog</span></code></a> モジュールは、識別子として、以前デフォルトであった <code class="docutils literal"><span class="pre">'python'</span></code> の値ではなく、 <code class="docutils literal"><span class="pre">sys.argv[0]</span></code> の値を使うようになりました。 (Changed by Sean Reifschneider; <a class="reference external" href="https://bugs.python.org/issue8451">bpo-8451</a>.)</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">sys.version_info</span></code> の値は、属性名 <code class="xref py py-attr docutils literal"><span class="pre">major</span></code>, <code class="xref py py-attr docutils literal"><span class="pre">minor</span></code>, <code class="xref py py-attr docutils literal"><span class="pre">micro</span></code>, <code class="xref py py-attr docutils literal"><span class="pre">releaselevel</span></code>, および <code class="xref py py-attr docutils literal"><span class="pre">serial</span></code> を持つ名前付きタプルになりました。 (Contributed by Ross Light; <a class="reference external" href="https://bugs.python.org/issue4285">bpo-4285</a>.)</p>
<p><a class="reference internal" href="../library/sys.html#sys.getwindowsversion" title="sys.getwindowsversion"><code class="xref py py-func docutils literal"><span class="pre">sys.getwindowsversion()</span></code></a> もまた、属性名 <code class="xref py py-attr docutils literal"><span class="pre">major</span></code>, <code class="xref py py-attr docutils literal"><span class="pre">minor</span></code>, <code class="xref py py-attr docutils literal"><span class="pre">build</span></code>, <a class="reference internal" href="../library/platform.html#module-platform" title="platform: Retrieves as much platform identifying data as possible."><code class="xref py py-attr docutils literal"><span class="pre">platform</span></code></a>, <code class="xref py py-attr docutils literal"><span class="pre">service_pack</span></code>, <code class="xref py py-attr docutils literal"><span class="pre">service_pack_major</span></code>, <code class="xref py py-attr docutils literal"><span class="pre">service_pack_minor</span></code>, <code class="xref py py-attr docutils literal"><span class="pre">suite_mask</span></code>, および <code class="xref py py-attr docutils literal"><span class="pre">product_type</span></code> を持つ名前付きタプルを返します。(Contributed by Brian Curtin; <a class="reference external" href="https://bugs.python.org/issue7766">bpo-7766</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal"><span class="pre">tarfile</span></code></a> モジュールのデフォルトエラー処理が変更され、致命的なエラーを抑制しないようになりました。デフォルトのエラーレベルは以前は 0 で、エラーはメッセージとしてデバッグログに書き込まれるだけでしたが、デバッグログはデフォルトでは活性化されていないため、エラーは顧みられませんでした。デフォルトのエラーレベルは 1 になり、エラーがあれば例外が送出されます。 (Changed by Lars Gustäbel; <a class="reference external" href="https://bugs.python.org/issue7357">bpo-7357</a>.)</p>
<p><a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal"><span class="pre">tarfile</span></code></a> は、tar ファイルに追加される <a class="reference internal" href="../library/tarfile.html#tarfile.TarInfo" title="tarfile.TarInfo"><code class="xref py py-class docutils literal"><span class="pre">TarInfo</span></code></a> オブジェクトのフィルタリングをサポートするようになりました。 <a class="reference internal" href="../library/tarfile.html#tarfile.TarFile.add" title="tarfile.TarFile.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a> を呼び出したとき、オプションの呼び出し可能オブジェクトである <em>filter</em> 引数を与えることができます。 <em>filter</em> オブジェクトには、ファイルが追加される度に <a class="reference internal" href="../library/tarfile.html#tarfile.TarInfo" title="tarfile.TarInfo"><code class="xref py py-class docutils literal"><span class="pre">TarInfo</span></code></a> を渡され、これを変形して返せます。このオブジェクトが <code class="docutils literal"><span class="pre">None</span></code> を返したら、そのファイルは結果のアーカイブから除かれます。これは既存の <em>exclude</em> 引数より強力で、それゆえこれは非推奨となります。(Added by Lars Gustäbel; <a class="reference external" href="https://bugs.python.org/issue6856">bpo-6856</a>.) <a class="reference internal" href="../library/tarfile.html#tarfile.TarFile" title="tarfile.TarFile"><code class="xref py py-class docutils literal"><span class="pre">TarFile</span></code></a> クラスはまた、コンテキストマネージャプロトコルもサポートするようになりました。(Added by Lars Gustäbel; <a class="reference external" href="https://bugs.python.org/issue7232">bpo-7232</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/threading.html#threading.Event" title="threading.Event"><code class="xref py py-class docutils literal"><span class="pre">threading.Event</span></code></a> クラスの <a class="reference internal" href="../library/threading.html#threading.Event.wait" title="threading.Event.wait"><code class="xref py py-meth docutils literal"><span class="pre">wait()</span></code></a> メソッドは、終了時に内部フラグを返すようになりました。 <a class="reference internal" href="../library/threading.html#threading.Event.wait" title="threading.Event.wait"><code class="xref py py-meth docutils literal"><span class="pre">wait()</span></code></a> は内部フラグが真になるまでブロックすることを想定されているため、この関数は通常真を返すことになります。この戻り値は、タイムアウトが与えられ、オペレーションがタイムアウトした時のみ偽になります。 (Contributed by Tim Lesher; <a class="reference external" href="https://bugs.python.org/issue1674032">bpo-1674032</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/unicodedata.html#module-unicodedata" title="unicodedata: Access the Unicode Database."><code class="xref py py-mod docutils literal"><span class="pre">unicodedata</span></code></a> モジュールに提供される Unicode データベースは、どの文字が数字や空白文字か、または改行を表すかを決定するために、内部で使われるようになりました。このデータベースはまた、 <code class="file docutils literal"><span class="pre">Unihan.txt</span></code> データファイルからの情報も含みます (patch by Anders Chrigström and Amaury Forgeot d’Arc; <a class="reference external" href="https://bugs.python.org/issue1571184">bpo-1571184</a>)。また、バージョン 5.2.0 にアップデートされました (updated by Florent Xicluna; <a class="reference external" href="https://bugs.python.org/issue8024">bpo-8024</a>)。</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">urlparse</span></code> モジュールの <code class="xref py py-func docutils literal"><span class="pre">urlsplit()</span></code> は、未知の URL スキームを <span class="target" id="index-44"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3986.html"><strong>RFC 3986</strong></a> に応じた方法で処理します。 URL が <code class="docutils literal"><span class="pre">&quot;&lt;something&gt;://...&quot;</span></code> の形式なら、 <code class="docutils literal"><span class="pre">://</span></code> の前のテキストを、それがモジュールの知らない作り物のスキームであってさえ、スキームとして扱います。この変更は、古い働きを使って動作していたコードを破壊することがあります。例えば、Python 2.6.4 や 2.5 は以下を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlparse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="s1">&#39;invented://host/filename?query&#39;</span><span class="p">)</span>
<span class="go">(&#39;invented&#39;, &#39;&#39;, &#39;//host/filename?query&#39;, &#39;&#39;, &#39;&#39;)</span>
</pre></div>
</div>
<p>Python 2.7 (や Python 2.6.5) は以下を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlparse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="s1">&#39;invented://host/filename?query&#39;</span><span class="p">)</span>
<span class="go">(&#39;invented&#39;, &#39;host&#39;, &#39;/filename?query&#39;, &#39;&#39;, &#39;&#39;)</span>
</pre></div>
</div>
<p>(Python 2.7 では、これは普通のタプルではなく名前付きタプルを返すので、実際は微妙に異なる出力をします。)</p>
<p><code class="xref py py-mod docutils literal"><span class="pre">urlparse</span></code> モジュールは、 <span class="target" id="index-45"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2732.html"><strong>RFC 2732</strong></a> で定義された IPv6 リテラルアドレスもサポートします (contributed by Senthil Kumaran; <a class="reference external" href="https://bugs.python.org/issue2987">bpo-2987</a>)。</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="s1">&#39;http://[1080::8:800:200C:417A]/foo&#39;</span><span class="p">)</span>
<span class="go">ParseResult(scheme=&#39;http&#39;, netloc=&#39;[1080::8:800:200C:417A]&#39;,</span>
<span class="go">            path=&#39;/foo&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)</span>
</pre></div>
</div>
</li>
<li><p class="first">新しいクラス: <a class="reference internal" href="../library/weakref.html#module-weakref" title="weakref: Support for weak references and weak dictionaries."><code class="xref py py-mod docutils literal"><span class="pre">weakref</span></code></a> モジュールの <a class="reference internal" href="../library/weakref.html#weakref.WeakSet" title="weakref.WeakSet"><code class="xref py py-class docutils literal"><span class="pre">WeakSet</span></code></a> クラスは、その要素の弱参照だけを保持する集合です。要素は、それを指す参照がなくなり次第除去されます。 (Originally implemented in Python 3.x by Raymond Hettinger, and backported to 2.7 by Michael Foord.)</p>
</li>
<li><p class="first">エレメントツリーライブラリ、 <code class="xref py py-mod docutils literal"><span class="pre">xml.etree</span></code> は、 (<code class="docutils literal"><span class="pre">&lt;?xml-stylesheet</span> <span class="pre">href=&quot;#style1&quot;?&gt;</span></code> のような) 命令や (<code class="docutils literal"><span class="pre">&lt;!--</span> <span class="pre">comment</span> <span class="pre">--&gt;</span></code> のような) コメントを処理する XML を出力するとき、アンパサンドや山括弧をエスケープしなくなりました。 (Patch by Neil Muller; <a class="reference external" href="https://bugs.python.org/issue2746">bpo-2746</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">xmlrpclib</span></code> と <code class="xref py py-mod docutils literal"><span class="pre">SimpleXMLRPCServer</span></code> によって提供される XML-RPC クライアントおよびサーバは、HTTP/1.1 keep-alive をサポートし、場合によっては gzip エンコーディングを使って XML の送受を圧縮することで、パフォーマンスが向上しました。gzip 圧縮は <code class="xref py py-class docutils literal"><span class="pre">SimpleXMLRPCRequestHandler</span></code> の <code class="xref py py-attr docutils literal"><span class="pre">encode_threshold</span></code> 属性によって制御されます。これはバイト数で、これより大きな応答は圧縮されます。 (Contributed by Kristján Valur Jónsson; <a class="reference external" href="https://bugs.python.org/issue6267">bpo-6267</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/zipfile.html#module-zipfile" title="zipfile: Read and write ZIP-format archive files."><code class="xref py py-mod docutils literal"><span class="pre">zipfile</span></code></a> モジュールの <a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile" title="zipfile.ZipFile"><code class="xref py py-class docutils literal"><span class="pre">ZipFile</span></code></a> は、コンテキストマネジメントプロトコルをサポートし、 <code class="docutils literal"><span class="pre">with</span> <span class="pre">zipfile.ZipFile(...)</span> <span class="pre">as</span> <span class="pre">f:</span></code> と書けるようになりました。 (Contributed by Brian Curtin; <a class="reference external" href="https://bugs.python.org/issue5511">bpo-5511</a>.)</p>
<p><a class="reference internal" href="../library/zipfile.html#module-zipfile" title="zipfile: Read and write ZIP-format archive files."><code class="xref py py-mod docutils literal"><span class="pre">zipfile</span></code></a> は、空のディレクトリのアーカイブ化をサポートするようになり、これを正しく解凍します。(Fixed by Kuba Wieczorek; <a class="reference external" href="https://bugs.python.org/issue4710">bpo-4710</a>.) アーカイブ内のファイルの読み込みが速くなり、 <a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile.read" title="zipfile.ZipFile.read"><code class="xref py py-meth docutils literal"><span class="pre">read()</span></code></a> および <code class="xref py py-meth docutils literal"><span class="pre">readline()</span></code> の割り込みが正しく働くようになりました。(Contributed by Nir Aides; <a class="reference external" href="https://bugs.python.org/issue7610">bpo-7610</a>.)</p>
<p><a class="reference internal" href="../library/zipfile.html#zipfile.is_zipfile" title="zipfile.is_zipfile"><code class="xref py py-func docutils literal"><span class="pre">is_zipfile()</span></code></a> 関数は、以前受け付けられていたパス名に加え、ファイルオブジェクトも受け付けるようになりました。 (Contributed by Gabriel Genellina; <a class="reference external" href="https://bugs.python.org/issue4756">bpo-4756</a>.)</p>
<p><a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile.writestr" title="zipfile.ZipFile.writestr"><code class="xref py py-meth docutils literal"><span class="pre">writestr()</span></code></a> メソッドは、 <a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile" title="zipfile.ZipFile"><code class="xref py py-class docutils literal"><span class="pre">ZipFile</span></code></a> コンストラクタで指定されたデフォルトの圧縮メソッドをオーバライドする、オプションの <em>compress_type</em> パラメタを追加しました。 (Contributed by Ronald Oussoren; <a class="reference external" href="https://bugs.python.org/issue6003">bpo-6003</a>.)</p>
</li>
</ul>
<div class="section" id="new-module-importlib">
<span id="importlib-section"></span><h3>新しいモジュール: importlib<a class="headerlink" href="#new-module-importlib" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Python 3.1 は、根底の Python の <a class="reference internal" href="../reference/simple_stmts.html#import"><code class="xref std std-keyword docutils literal"><span class="pre">import</span></code></a> 文のロジックの最実装である <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal"><span class="pre">importlib</span></code></a> パッケージを含みます。 <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal"><span class="pre">importlib</span></code></a> は、Python インタプリタの実装者や、import プロセスに関与する新しいインポータを書きたいと願うユーザにとって便利です。 Python 2.7 は <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal"><span class="pre">importlib</span></code></a> パッケージを完全には含みませんが、代わりに 1 つの関数 <a class="reference internal" href="../library/importlib.html#importlib.import_module" title="importlib.import_module"><code class="xref py py-func docutils literal"><span class="pre">import_module()</span></code></a> を含む小さなサブセットがあります。</p>
<p><code class="docutils literal"><span class="pre">import_module(name,</span> <span class="pre">package=None)</span></code> はモジュールを import します。 <em>name</em> はモジュールまたはパッケージの名前を含む文字列です。 <code class="docutils literal"><span class="pre">..utils.errors</span></code> のように <code class="docutils literal"><span class="pre">.</span></code> 文字で始まる文字列を与えることで、相対 import も可能です。相対 import では、 <em>package</em> 引数は必ず与えられなければならず、相対 import のアンカーとして使われるパッケージの名前でなければなりません。 <a class="reference internal" href="../library/importlib.html#importlib.import_module" title="importlib.import_module"><code class="xref py py-func docutils literal"><span class="pre">import_module()</span></code></a> は、 import されたモジュールを <code class="docutils literal"><span class="pre">sys.modules</span></code> に挿入し、モジュールオブジェクトを返すこともします。</p>
<p>ここに例があります:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">importlib</span> <span class="k">import</span> <span class="n">import_module</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">anydbm</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="s1">&#39;anydbm&#39;</span><span class="p">)</span>  <span class="c1"># Standard absolute import</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">anydbm</span>
<span class="go">&lt;module &#39;anydbm&#39; from &#39;/p/python/Lib/anydbm.py&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Relative import</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_util</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="s1">&#39;..file_util&#39;</span><span class="p">,</span> <span class="s1">&#39;distutils.command&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_util</span>
<span class="go">&lt;module &#39;distutils.file_util&#39; from &#39;/python/Lib/distutils/file_util.pyc&#39;&gt;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal"><span class="pre">importlib</span></code></a> は、Brett Cannon によって実装され、 Python 3.1 に導入されました。</p>
</div>
<div class="section" id="new-module-sysconfig">
<h3>新しいモジュール: sysconfig<a class="headerlink" href="#new-module-sysconfig" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal"><span class="pre">sysconfig</span></code></a> モジュールが Distutils パッケージから引き抜かれ、新しいトップレベルモジュールになりました。 <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal"><span class="pre">sysconfig</span></code></a> は、Python のビルドプロセスについての以下の情報を得るための関数群を提供しています。コンパイラスイッチ、インストレーションパス、プラットフォーム名、そして Python がソースディレクトリから実行されているかどうかです。</p>
<p>モジュールの関数のいくつかを紹介すると:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_config_var" title="sysconfig.get_config_var"><code class="xref py py-func docutils literal"><span class="pre">get_config_var()</span></code></a> は、Python の Makefile と <code class="file docutils literal"><span class="pre">pyconfig.h</span></code> ファイルから変数を返します。</li>
<li><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_config_vars" title="sysconfig.get_config_vars"><code class="xref py py-func docutils literal"><span class="pre">get_config_vars()</span></code></a> は、すべての環境設定変数を含む辞書を返します。</li>
<li><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_path" title="sysconfig.get_path"><code class="xref py py-func docutils literal"><span class="pre">get_path()</span></code></a> は、特定のタイプのモジュール、つまり標準ライブラリ、サイト特有のモジュール、プラットフォーム特有のライブフラリなど、への設定されたパスを返します。</li>
<li><a class="reference internal" href="../library/sysconfig.html#sysconfig.is_python_build" title="sysconfig.is_python_build"><code class="xref py py-func docutils literal"><span class="pre">is_python_build()</span></code></a> は、Python ソースツリーからバイナリを起動していれば真を、そうでなければ偽を返します。</li>
</ul>
<p>詳細と関数の完全な一覧は <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal"><span class="pre">sysconfig</span></code></a> ドキュメントを参照してください。</p>
<p>Distutils パッケージと <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal"><span class="pre">sysconfig</span></code></a> は Tarek Ziadé によってメンテナンスされていて、彼は Distutils の新世代版を開発するために Distutils2 パッケージ (source repository at <a class="reference external" href="https://hg.python.org/distutils2/">https://hg.python.org/distutils2/</a>) も開始しました。</p>
</div>
<div class="section" id="ttk-themed-widgets-for-tk">
<h3>ttk: Tk のテーマ付きウィジェット<a class="headerlink" href="#ttk-themed-widgets-for-tk" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Tcl/Tk 8.5 は、基本的な Tk ウィジェットを最実装しながらより自由な外観のカスタマイズが広がり、よりネイティブなプラットフォームのウィジェットに似たテーマ付きウィジェット群を含みます。このウィジェット群は、元は Tile と呼ばれていましたが、Tcl/Tck リリース 8.5 への追加の際に (&quot;themed Tk&quot; を略して) Ttk に改名されました。</p>
<p>詳しく知るには、 <code class="xref py py-mod docutils literal"><span class="pre">ttk</span></code> モジュールのドキュメントをお読みください。 <a class="reference external" href="https://www.tcl.tk/man/tcl8.5/TkCmd/ttk_intro.htm">https://www.tcl.tk/man/tcl8.5/TkCmd/ttk_intro.htm</a> にある、Ttk テーマエンジンを解説した Tcl/Tk マニュアルページを読むのもいいでしょう。 Python/Ttk コードを動かしているスクリーンショットは <a class="reference external" href="http://code.google.com/p/python-ttk/wiki/Screenshots">http://code.google.com/p/python-ttk/wiki/Screenshots</a> にあります。</p>
<p><code class="xref py py-mod docutils literal"><span class="pre">ttk</span></code> モジュールは Guilherme Polo によって書かれ、 <a class="reference external" href="https://bugs.python.org/issue2983">bpo-2983</a> に追加されました。 <code class="docutils literal"><span class="pre">Tile.py</span></code> と呼ばれる別バージョン <code class="docutils literal"><span class="pre">Tile.py</span></code> は、 Martin Franklin によって書かれ、Kevin Walzer によってメンテナンスされているもので、組み込みが <a class="reference external" href="https://bugs.python.org/issue2618">bpo-2618</a> で提案されましたが、著者は Guilherme Polo の作品のほうがより包括的であると主張しました。</p>
</div>
<div class="section" id="updated-module-unittest">
<span id="unittest-section"></span><h3>更新されたモジュール: unittest<a class="headerlink" href="#updated-module-unittest" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code></a> モジュールが大幅に改善されました。多くの新機能が追加されました。それらの機能のほとんどは、特に注釈のない限り、 Michael Foord によって実装されました。このモジュールの改善された版は、 Python バージョン 2.4 から 2.6 で使うために、 <a class="reference external" href="https://pypi.python.org/pypi/unittest2">https://pypi.python.org/pypi/unittest2</a> から <code class="xref py py-mod docutils literal"><span class="pre">unittest2</span></code> パッケージとして別にダウンロードできます。</p>
<p>コマンドラインから使われるとき、このモジュールはテストを自動的に発見します。これは <a class="reference external" href="http://pytest.org">py.test</a> や <a class="reference external" href="http://code.google.com/p/python-nose/">nose</a> ほど派手ではありませんが、テストをパッケージディレクトリに保持されたテストを簡潔に実行する方法を提供します。例えば、以下のコマンドは <code class="file docutils literal"><span class="pre">test/</span></code> サブディレクトリから <code class="docutils literal"><span class="pre">test*.py</span></code> という名前の import できるテストファイル検索します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">discover</span> <span class="o">-</span><span class="n">s</span> <span class="n">test</span>
</pre></div>
</div>
<p>詳細は、 <a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code></a> モジュールのドキュメントを参照してください。 (Developed in <a class="reference external" href="https://bugs.python.org/issue6001">bpo-6001</a>.)</p>
<p><a class="reference internal" href="../library/unittest.html#unittest.main" title="unittest.main"><code class="xref py py-func docutils literal"><span class="pre">main()</span></code></a> 関数は、その他幾つかの新しいオプションを提供します:</p>
<ul>
<li><p class="first"><a class="reference internal" href="../library/unittest.html#cmdoption-unittest-b"><code class="xref std std-option docutils literal"><span class="pre">-b</span></code></a> や <code class="xref std std-option docutils literal"><span class="pre">--buffer</span></code> は、標準出力や標準エラーストリームをそれぞれのテストの間バッファに入れます。テストが通れば、結果の出力は全て捨てられます。失敗したら、バッファに入れられた出力が表示されます。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/unittest.html#cmdoption-unittest-c"><code class="xref std std-option docutils literal"><span class="pre">-c</span></code></a> や <code class="xref std std-option docutils literal"><span class="pre">--catch</span></code> は、control-C による中断をより上品にします。テストプロセスを即座に中断するのではなく、現在実行中のテストは完了させ、中断までの部分的な結果は報告されます。待ちきれなければ、control-C をもう一度押せば、即座に中断されます。</p>
<p>この control-C ハンドラは、コードがテストされているときや、実行されているテストが独自のシグナルハンドラを定義したとき、シグナルハンドラがすでに設定されていてそして呼び出されたということを知らせることで、問題を起こさないようにします。これがまずいなら、 <a class="reference internal" href="../library/unittest.html#unittest.removeHandler" title="unittest.removeHandler"><code class="xref py py-func docutils literal"><span class="pre">removeHandler()</span></code></a> デコレータを使って、テストが control-C ハンドリングを無効にするべきであると示せます。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/unittest.html#cmdoption-unittest-f"><code class="xref std std-option docutils literal"><span class="pre">-f</span></code></a> や <code class="xref std std-option docutils literal"><span class="pre">--failfast</span></code> は、テストが失敗したとき、他のテストを続けるのではなく、テストの実行を即座に停止します。 (Suggested by Cliff Dyer and implemented by Michael Foord; <a class="reference external" href="https://bugs.python.org/issue8074">bpo-8074</a>.)</p>
</li>
</ul>
<p>進捗メッセージは、verbose モードで実行したとき、期待された失敗に 'x' を、期待されない成功に 'u' を表示するようになりました。(Contributed by Benjamin Peterson.)</p>
<p>テストケースは、テストをスキップするために <a class="reference internal" href="../library/unittest.html#unittest.SkipTest" title="unittest.SkipTest"><code class="xref py py-exc docutils literal"><span class="pre">SkipTest</span></code></a> 例外を送出します。(<a class="reference external" href="https://bugs.python.org/issue1034053">bpo-1034053</a>).</p>
<p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></code></a>, <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertTrue" title="unittest.TestCase.assertTrue"><code class="xref py py-meth docutils literal"><span class="pre">assertTrue()</span></code></a>, および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertFalse" title="unittest.TestCase.assertFalse"><code class="xref py py-meth docutils literal"><span class="pre">assertFalse()</span></code></a> 失敗のメッセージは、提供する情報量が増えました。 <a class="reference internal" href="../library/unittest.html#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal"><span class="pre">TestCase</span></code></a> クラスの <a class="reference internal" href="../library/unittest.html#unittest.TestCase.longMessage" title="unittest.TestCase.longMessage"><code class="xref py py-attr docutils literal"><span class="pre">longMessage</span></code></a> 属性を真に設定すると、失敗時に、標準のエラーメッセージと追加して提供したメッセージの両方が表示されます。(Added by Michael Foord; <a class="reference external" href="https://bugs.python.org/issue5663">bpo-5663</a>.)</p>
<p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertRaises" title="unittest.TestCase.assertRaises"><code class="xref py py-meth docutils literal"><span class="pre">assertRaises()</span></code></a> メソッドは、実行する呼び出し可能オブジェクトを与えずに呼び出されたとき、コンテキストハンドラを返すようになりました。例えば、こう書くことができます:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
    <span class="p">{}[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>(Implemented by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue4444">bpo-4444</a>.)</p>
<p>モジュールレベルおよびクラスレベルの設定と、ティアダウンフィクスチャがサポートされました。モジュールは、 <code class="xref py py-func docutils literal"><span class="pre">setUpModule()</span></code> および <code class="xref py py-func docutils literal"><span class="pre">tearDownModule()</span></code> 関数を含むことができます。クラスは <a class="reference internal" href="../library/unittest.html#unittest.TestCase.setUpClass" title="unittest.TestCase.setUpClass"><code class="xref py py-meth docutils literal"><span class="pre">setUpClass()</span></code></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.tearDownClass" title="unittest.TestCase.tearDownClass"><code class="xref py py-meth docutils literal"><span class="pre">tearDownClass()</span></code></a> メソッドを含むことができ、これらは (<code class="docutils literal"><span class="pre">&#64;classmethod</span></code> や透過なものを使って) クラスメソッドとして定義しなければなりません。これらの関数とメソッドは、テストランナーが別のモジュールやクラスのテストケースに切り替えるときに呼び出されます。</p>
<p>メソッド <a class="reference internal" href="../library/unittest.html#unittest.TestCase.addCleanup" title="unittest.TestCase.addCleanup"><code class="xref py py-meth docutils literal"><span class="pre">addCleanup()</span></code></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.doCleanups" title="unittest.TestCase.doCleanups"><code class="xref py py-meth docutils literal"><span class="pre">doCleanups()</span></code></a> が追加されました。 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.addCleanup" title="unittest.TestCase.addCleanup"><code class="xref py py-meth docutils literal"><span class="pre">addCleanup()</span></code></a> で、無条件に呼び出されるクリーンアップ関数を (<a class="reference internal" href="../library/unittest.html#unittest.TestCase.setUp" title="unittest.TestCase.setUp"><code class="xref py py-meth docutils literal"><span class="pre">setUp()</span></code></a> が失敗したら <a class="reference internal" href="../library/unittest.html#unittest.TestCase.setUp" title="unittest.TestCase.setUp"><code class="xref py py-meth docutils literal"><span class="pre">setUp()</span></code></a> の後に、そうでなければ <a class="reference internal" href="../library/unittest.html#unittest.TestCase.tearDown" title="unittest.TestCase.tearDown"><code class="xref py py-meth docutils literal"><span class="pre">tearDown()</span></code></a> の後に) 追加できるようにします。これにより、テスト中のリソースの配置と解放が簡潔になります。(<a class="reference external" href="https://bugs.python.org/issue5679">bpo-5679</a>).</p>
<p>より特化したテストを提供するメソッドがいくつか追加されました。これらのメソッドの多くは、Google のエンジニアたちによってそのテストスイートのために書かれました。Gregory P. Smith, Michael Foord, and GvR が、これを <a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code></a> の Python 版にマージしました。</p>
<ul class="simple">
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIsNone" title="unittest.TestCase.assertIsNone"><code class="xref py py-meth docutils literal"><span class="pre">assertIsNone()</span></code></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIsNotNone" title="unittest.TestCase.assertIsNotNone"><code class="xref py py-meth docutils literal"><span class="pre">assertIsNotNone()</span></code></a> はひとつの式を取り、その結果が <code class="docutils literal"><span class="pre">None</span></code> であるか、またはないかを確かめます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIs" title="unittest.TestCase.assertIs"><code class="xref py py-meth docutils literal"><span class="pre">assertIs()</span></code></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIsNot" title="unittest.TestCase.assertIsNot"><code class="xref py py-meth docutils literal"><span class="pre">assertIsNot()</span></code></a> は、2 つの値を取り、その評価が同一のオブジェクトであるか、またはないかを確かめます。 (Added by Michael Foord; <a class="reference external" href="https://bugs.python.org/issue2578">bpo-2578</a>.)</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIsInstance" title="unittest.TestCase.assertIsInstance"><code class="xref py py-meth docutils literal"><span class="pre">assertIsInstance()</span></code></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotIsInstance" title="unittest.TestCase.assertNotIsInstance"><code class="xref py py-meth docutils literal"><span class="pre">assertNotIsInstance()</span></code></a> は、結果のオブジェクトが特定のクラス、またはタプルにあるクラスのいずれかのインスタンスであるかを調べます。(Added by Georg Brandl; <a class="reference external" href="https://bugs.python.org/issue7031">bpo-7031</a>.)</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertGreater" title="unittest.TestCase.assertGreater"><code class="xref py py-meth docutils literal"><span class="pre">assertGreater()</span></code></a>, <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertGreaterEqual" title="unittest.TestCase.assertGreaterEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertGreaterEqual()</span></code></a>, <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertLess" title="unittest.TestCase.assertLess"><code class="xref py py-meth docutils literal"><span class="pre">assertLess()</span></code></a>, および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertLessEqual" title="unittest.TestCase.assertLessEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertLessEqual()</span></code></a> は、二つの量を比較します。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertMultiLineEqual" title="unittest.TestCase.assertMultiLineEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertMultiLineEqual()</span></code></a> は 2 つの文字列を比較し、等しくなければ、2 文字列の差分をハイライトする有益な比較を表示します。この比較は、Unicode 文字列が <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></code></a> で比較されるときのデフォルトに使われるようになりました。</li>
<li><code class="xref py py-meth docutils literal"><span class="pre">assertRegexpMatches()</span></code> および <code class="xref py py-meth docutils literal"><span class="pre">assertNotRegexpMatches()</span></code> は、第一引数が第二引数として与えられた正規表現にマッチする、またはしない文字列であるかどうかを調べます。 (<a class="reference external" href="https://bugs.python.org/issue8038">bpo-8038</a>)</li>
<li><code class="xref py py-meth docutils literal"><span class="pre">assertRaisesRegexp()</span></code> は、特定の式が送出されるかを調べ、そしてまたその式の文字列表現が与えられた正規表現にマッチするかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIn" title="unittest.TestCase.assertIn"><code class="xref py py-meth docutils literal"><span class="pre">assertIn()</span></code></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotIn" title="unittest.TestCase.assertNotIn"><code class="xref py py-meth docutils literal"><span class="pre">assertNotIn()</span></code></a> は、 <em>first</em> が <em>second</em> に属するか、または属さないかを調べます。</li>
<li><code class="xref py py-meth docutils literal"><span class="pre">assertItemsEqual()</span></code> は、2 つの与えられたシーケンスが同じ要素を含むかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertSetEqual" title="unittest.TestCase.assertSetEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertSetEqual()</span></code></a> は、2 つの集合が等しいか比較し、エラーの場合のみ、集合間の差分を報告します。</li>
<li>同様に、 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertListEqual" title="unittest.TestCase.assertListEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertListEqual()</span></code></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertTupleEqual" title="unittest.TestCase.assertTupleEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertTupleEqual()</span></code></a> は、指定された型を比較し、差分を説明しますが、完全な値を表示するとはかぎりません。これらのメソッドは、リストやタプルを <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></code></a> で比較するときにデフォルトで使われるようになりました。より一般的には、 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertSequenceEqual" title="unittest.TestCase.assertSequenceEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertSequenceEqual()</span></code></a> は 2 つのシーケンスを比較し、必要なら両方のシーケンスが特定の型であるかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertDictEqual" title="unittest.TestCase.assertDictEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertDictEqual()</span></code></a> は、二つの辞書を比較し、差分を報告します。これは、辞書を <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></code></a> で比較するときにデフォルトで使われるようになりました。 <code class="xref py py-meth docutils literal"><span class="pre">assertDictContainsSubset()</span></code> は、 <em>first</em> に属するキー/値の対の全てが <em>second</em> に現れるかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertAlmostEqual" title="unittest.TestCase.assertAlmostEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertAlmostEqual()</span></code></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotAlmostEqual" title="unittest.TestCase.assertNotAlmostEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertNotAlmostEqual()</span></code></a> は、 <em>first</em> と <em>second</em> がほぼ等しいかを判定します。このメソッドは、オプションで指定された <em>places</em> (デフォルトは 7) の数に差を丸めてそれをゼロと比べるか、差が与えられた <em>delta</em> の値より小さいことを要求します。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestLoader.loadTestsFromName" title="unittest.TestLoader.loadTestsFromName"><code class="xref py py-meth docutils literal"><span class="pre">loadTestsFromName()</span></code></a> は、 <a class="reference internal" href="../library/unittest.html#unittest.TestLoader" title="unittest.TestLoader"><code class="xref py py-class docutils literal"><span class="pre">TestLoader</span></code></a> の <a class="reference internal" href="../library/unittest.html#unittest.TestLoader.suiteClass" title="unittest.TestLoader.suiteClass"><code class="xref py py-attr docutils literal"><span class="pre">suiteClass</span></code></a> 属性を適切に受け入れます。(Fixed by Mark Roddy; <a class="reference external" href="https://bugs.python.org/issue6866">bpo-6866</a>.)</li>
<li>新しいフックにより、 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></code></a> メソッドを拡張して新しいデータ型を扱わせられます。 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.addTypeEqualityFunc" title="unittest.TestCase.addTypeEqualityFunc"><code class="xref py py-meth docutils literal"><span class="pre">addTypeEqualityFunc()</span></code></a> メソッドは型オブジェクトと関数を取ります。この関数は、比較される両方のオブジェクトが特定の型であるときに使われます。この関数は、2 つのオブジェクトを比較し、マッチしなければ例外を送出するべきです。この関数が、新しいシーケンス比較メソッドがするように、2 つのオブジェクトがなぜマッチしないのかについて追加の情報を提供するのがいいアイデアです。</li>
</ul>
<p><a class="reference internal" href="../library/unittest.html#unittest.main" title="unittest.main"><code class="xref py py-func docutils literal"><span class="pre">unittest.main()</span></code></a> はオプションの <code class="docutils literal"><span class="pre">exit</span></code> 引数を取るようになりました。偽の場合、 <a class="reference internal" href="../library/unittest.html#unittest.main" title="unittest.main"><code class="xref py py-func docutils literal"><span class="pre">main()</span></code></a> は <a class="reference internal" href="../library/sys.html#sys.exit" title="sys.exit"><code class="xref py py-func docutils literal"><span class="pre">sys.exit()</span></code></a> を呼び出さず、これにより対話型インタプリタから <a class="reference internal" href="../library/unittest.html#unittest.main" title="unittest.main"><code class="xref py py-func docutils literal"><span class="pre">main()</span></code></a> が使えるようになります。(Contributed by J. Pablo Fernández; <a class="reference external" href="https://bugs.python.org/issue3379">bpo-3379</a>.)</p>
<p><a class="reference internal" href="../library/unittest.html#unittest.TestResult" title="unittest.TestResult"><code class="xref py py-class docutils literal"><span class="pre">TestResult</span></code></a> に、テストランの直前と直後に呼び出される <a class="reference internal" href="../library/unittest.html#unittest.TestResult.startTestRun" title="unittest.TestResult.startTestRun"><code class="xref py py-meth docutils literal"><span class="pre">startTestRun()</span></code></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestResult.stopTestRun" title="unittest.TestResult.stopTestRun"><code class="xref py py-meth docutils literal"><span class="pre">stopTestRun()</span></code></a> が追加されました。 (Contributed by Robert Collins; <a class="reference external" href="https://bugs.python.org/issue5728">bpo-5728</a>.)</p>
<p>これら一連の変更により、 <code class="file docutils literal"><span class="pre">unittest.py</span></code> は無様に大きくなったので、モジュールはパッケージとなり、コードは複数のファイルに分割されました (by Benjamin Peterson)。これは、モジュールをインポートして使う方法には影響しません。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.voidspace.org.uk/python/articles/unittest2.shtml">http://www.voidspace.org.uk/python/articles/unittest2.shtml</a></dt>
<dd>Describes the new features, how to use them, and the
rationale for various design decisions.  (By Michael Foord.)</dd>
</dl>
</div>
</div>
<div class="section" id="updated-module-elementtree-1-3">
<span id="elementtree-section"></span><h3>更新されたモジュール: ElementTree 1.3<a class="headerlink" href="#updated-module-elementtree-1-3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Python に同梱される ElementTree ライブラリのバージョンが、バージョン 1.3 にアップデートされました。新機能の一部は:</p>
<ul>
<li><p class="first">様々な解析関数が、使われる <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.XMLParser" title="xml.etree.ElementTree.XMLParser"><code class="xref py py-class docutils literal"><span class="pre">XMLParser</span></code></a> インスタンスを与える <em>parser</em> キーワード引数を取るようになりました。これにより、ファイルの内部エンコーディングをオーバーライドできるようになりました:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;root/&gt;&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>XML を解析するときのエラーは、 <code class="xref py py-exc docutils literal"><span class="pre">ParseError</span></code> 例外を送出するようになりました。この例外のインスタンスは、問題の位置を与える (<em>line</em>, <em>column</em>) タプルを含む <code class="xref py py-attr docutils literal"><span class="pre">position</span></code> 属性を持ちます。</p>
</li>
<li><p class="first">ツリーを文字列に変換する ElementTree のコードが大幅に改善され、多くの場合でおおよそ 2 倍速くなりました。 <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.ElementTree.write" title="xml.etree.ElementTree.ElementTree.write"><code class="xref py py-meth docutils literal"><span class="pre">ElementTree.write()</span></code></a> および <code class="xref py py-meth docutils literal"><span class="pre">Element.write()</span></code> メソッドは、 <em>method</em> パラメタを追加し、これは &quot;xml&quot; (デフォルト), &quot;html&quot;, または &quot;text&quot; にできます。HTML モードは、空の要素を <code class="docutils literal"><span class="pre">&lt;empty/&gt;</span></code> ではなく <code class="docutils literal"><span class="pre">&lt;empty&gt;&lt;/empty&gt;</span></code> として出力し、text モードは要素を無視し、テキストのチャンクのみ出力します。要素の <code class="xref py py-attr docutils literal"><span class="pre">tag</span></code> 属性を <code class="docutils literal"><span class="pre">None</span></code> に設定してその子はそのままにすると、ツリーが書き出されるとき、その要素は省かれるので、それ以上再編成することなく要素を一つ取り除けます。</p>
<p>名前空間の操作も改善されました。すべての <code class="docutils literal"><span class="pre">xmlns:&lt;whatever&gt;</span></code> 宣言は、結果の XML に散らばるのではなく、ルート要素に出力されます。 <code class="xref py py-attr docutils literal"><span class="pre">default_namespace</span></code> 属性を設定することでデフォルトの名前空間を設定でき、 <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.register_namespace" title="xml.etree.ElementTree.register_namespace"><code class="xref py py-meth docutils literal"><span class="pre">register_namespace()</span></code></a> で新しい接頭辞を登録できます。XML モードでは、XML 宣言を抑制するために真/偽の <em>xml_declaration</em> パラメタを使えます。</p>
</li>
<li><p class="first">新しい <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element" title="xml.etree.ElementTree.Element"><code class="xref py py-class docutils literal"><span class="pre">Element</span></code></a>  メソッド: <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.extend" title="xml.etree.ElementTree.Element.extend"><code class="xref py py-meth docutils literal"><span class="pre">extend()</span></code></a>  はシーケンスから項目の子に要素を追加します。要素それ自体はシーケンスのように振る舞うので、子をある要素から別の要素に移すのが簡単です:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xml.etree</span> <span class="k">import</span> <span class="n">ElementTree</span> <span class="k">as</span> <span class="n">ET</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;list&gt;</span>
<span class="s2">  &lt;item&gt;1&lt;/item&gt; &lt;item&gt;2&lt;/item&gt;  &lt;item&gt;3&lt;/item&gt;</span>
<span class="s2">&lt;/list&gt;&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">new</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s1">&#39;&lt;root/&gt;&#39;</span><span class="p">)</span>
<span class="n">new</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># Outputs &lt;root&gt;&lt;item&gt;1&lt;/item&gt;...&lt;/root&gt;</span>
<span class="nb">print</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">新しい <code class="xref py py-class docutils literal"><span class="pre">Element</span></code> メソッド: <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.iter" title="xml.etree.ElementTree.Element.iter"><code class="xref py py-meth docutils literal"><span class="pre">iter()</span></code></a>  は、要素の子をジェネレータとして与えます。また、 <code class="docutils literal"><span class="pre">for</span> <span class="pre">child</span> <span class="pre">in</span> <span class="pre">elem:</span></code> と書いて要素の子に渡ってループできます。既存のメソッド <code class="xref py py-meth docutils literal"><span class="pre">getiterator()</span></code> と、子のリストを構成して返す <code class="xref py py-meth docutils literal"><span class="pre">getchildren()</span></code> は、非推奨になりました。</p>
</li>
<li><p class="first">新しい <code class="xref py py-class docutils literal"><span class="pre">Element</span></code> メソッド: <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.itertext" title="xml.etree.ElementTree.Element.itertext"><code class="xref py py-meth docutils literal"><span class="pre">itertext()</span></code></a>  は、その要素の子孫であるテキストのチャンクを全て与えます。例えば:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;list&gt;</span>
<span class="s2">  &lt;item&gt;1&lt;/item&gt; &lt;item&gt;2&lt;/item&gt;  &lt;item&gt;3&lt;/item&gt;</span>
<span class="s2">&lt;/list&gt;&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Outputs [&#39;\n  &#39;, &#39;1&#39;, &#39; &#39;, &#39;2&#39;, &#39;  &#39;, &#39;3&#39;, &#39;\n&#39;]</span>
<span class="nb">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">itertext</span><span class="p">())</span>
</pre></div>
</div>
</li>
<li><p class="first">非推奨: 要素をブール値として使う (すなわち、 <code class="docutils literal"><span class="pre">if</span> <span class="pre">elem:</span></code>) と、要素が子を持てば真を、子を持たなければ偽を返します。この振る舞いは紛らわしいです – <code class="docutils literal"><span class="pre">None</span></code> は偽、では子を持たない要素は? – ですから、 <a class="reference internal" href="../library/exceptions.html#FutureWarning" title="FutureWarning"><code class="xref py py-exc docutils literal"><span class="pre">FutureWarning</span></code></a> を引き起こすようになりました。コードでは、明示するべきです。子の数に興味があるなら <code class="docutils literal"><span class="pre">len(elem)</span> <span class="pre">!=</span> <span class="pre">0</span></code> と、または <code class="docutils literal"><span class="pre">elem</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></code> と書いてください。</p>
</li>
</ul>
<p>Fredrik Lundh は ElementTree を開発し、1.3 バージョンを作成しました。 1.3 を解説した彼の記事を <a class="reference external" href="http://effbot.org/zone/elementtree-13-intro.htm">http://effbot.org/zone/elementtree-13-intro.htm</a> で読めます。 Florent Xicluna は、python-dev および <a class="reference external" href="https://bugs.python.org/issue6472">bpo-6472</a> での議論の後、 Python に含まれるバージョンをアップデートしました。</p>
</div>
</div>
<div class="section" id="build-and-c-api-changes">
<h2>ビルドならびに C API の変更<a class="headerlink" href="#build-and-c-api-changes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python のビルド過程と C API の変更は以下の通りです:</p>
<ul>
<li><p class="first">GNU デバッガ、GDB 7、の最新のリリースは <a class="reference external" href="https://sourceware.org/gdb/current/onlinedocs/gdb/Python.html">Python を使って書けます</a> 実行可能なプログラム P のデバッグを始めるとき、GDB は <code class="docutils literal"><span class="pre">P-gdb.py</span></code> という名前のファイルをロックし、それを自動的に読み込みます。Dave Malcolm は Python 自体をデバッグするときに便利ないくつかのコマンドを加える <code class="file docutils literal"><span class="pre">python-gdb.py</span></code> に貢献しました。例えば、 <code class="docutils literal"><span class="pre">py-up</span></code> および <code class="docutils literal"><span class="pre">py-down</span></code> は、通常いくつかの C スタックフレームに対応する、 Python のスタックフレームを上がったり下がったりします。 <code class="docutils literal"><span class="pre">py-print</span></code> は、Python 変数の値を表示し、 <code class="docutils literal"><span class="pre">py-bt</span></code> は、 Python スタックトレースを表示します。(Added as a result of <a class="reference external" href="https://bugs.python.org/issue8032">bpo-8032</a>.)</p>
</li>
<li><p class="first">Python に備え付けの <code class="file docutils literal"><span class="pre">.gdbinit</span></code> ファイルを使うと、デバッグされているスレッドが GIL をほじしていないとき、2.7 バージョンの &quot;pyo&quot; マクロが正常に動くようになりました。このマクロは、表示の前にこれを取得するようになりました。 (Contributed by Victor Stinner; <a class="reference external" href="https://bugs.python.org/issue3632">bpo-3632</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../c-api/init.html#c.Py_AddPendingCall" title="Py_AddPendingCall"><code class="xref c c-func docutils literal"><span class="pre">Py_AddPendingCall()</span></code></a> はスレッドセーフになり、ワーカスレッドがメイン Python スレッドに通知を投入することができるようになりました。これは特に、非同時性の IO 処理に便利です。(Contributed by Kristján Valur Jónsson; <a class="reference external" href="https://bugs.python.org/issue4293">bpo-4293</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/code.html#c.PyCode_NewEmpty" title="PyCode_NewEmpty"><code class="xref c c-func docutils literal"><span class="pre">PyCode_NewEmpty()</span></code></a> は、空のコードオブジェクトを生成します。要求されるのは、ファイル名、関数名、そして最初の行番号だけです。これは、より便利なトレースバックスタックを構成しようとする拡張モジュールに便利です。以前は、このような拡張はより多くの引数を必要とする <a class="reference internal" href="../c-api/code.html#c.PyCode_New" title="PyCode_New"><code class="xref c c-func docutils literal"><span class="pre">PyCode_New()</span></code></a> を呼び出す必要がありました。(Added by Jeffrey Yasskin.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/exceptions.html#c.PyErr_NewExceptionWithDoc" title="PyErr_NewExceptionWithDoc"><code class="xref c c-func docutils literal"><span class="pre">PyErr_NewExceptionWithDoc()</span></code></a> は、既存の <a class="reference internal" href="../c-api/exceptions.html#c.PyErr_NewException" title="PyErr_NewException"><code class="xref c c-func docutils literal"><span class="pre">PyErr_NewException()</span></code></a> と同じように新しい例外クラスを生成しますが、新しい例外クラスの docstring を含む、追加の <code class="docutils literal"><span class="pre">char</span> <span class="pre">*</span></code> 引数を取ります。(Added by 'lekma' on the Python bug tracker; <a class="reference external" href="https://bugs.python.org/issue7033">bpo-7033</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/reflection.html#c.PyFrame_GetLineNumber" title="PyFrame_GetLineNumber"><code class="xref c c-func docutils literal"><span class="pre">PyFrame_GetLineNumber()</span></code></a> はフレームオブジェクトを取り、そのフレームが現在実行している行番号を返します。以前は、コードは現在実行しているバイトコード命令のインデクスを得て、それからそのアドレスに対応する行番号を探索する必要がありました。(Added by Jeffrey Yasskin.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/long.html#c.PyLong_AsLongAndOverflow" title="PyLong_AsLongAndOverflow"><code class="xref c c-func docutils literal"><span class="pre">PyLong_AsLongAndOverflow()</span></code></a> および <a class="reference internal" href="../c-api/long.html#c.PyLong_AsLongLongAndOverflow" title="PyLong_AsLongLongAndOverflow"><code class="xref c c-func docutils literal"><span class="pre">PyLong_AsLongLongAndOverflow()</span></code></a> は、C の <code class="xref c c-type docutils literal"><span class="pre">long</span></code> や <code class="xref c c-type docutils literal"><span class="pre">long</span> <span class="pre">long</span></code> のような Python の長整数に近いです。この数が出力型に適合するには大きすぎるなら、 <em>overflow</em> フラグが設定され、呼び出し元に返されます。(Contributed by Case Van Horsen; <a class="reference external" href="https://bugs.python.org/issue7528">bpo-7528</a> and <a class="reference external" href="https://bugs.python.org/issue7767">bpo-7767</a>.)</p>
</li>
<li><p class="first">新しい関数: 文字列から浮動小数点数への変換から由来する、新しい <a class="reference internal" href="../c-api/conversion.html#c.PyOS_string_to_double" title="PyOS_string_to_double"><code class="xref c c-func docutils literal"><span class="pre">PyOS_string_to_double()</span></code></a> 関数が追加されました。古い <code class="xref c c-func docutils literal"><span class="pre">PyOS_ascii_strtod()</span></code> および <code class="xref c c-func docutils literal"><span class="pre">PyOS_ascii_atof()</span></code> は、非推奨となりました。</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/init.html#c.PySys_SetArgvEx" title="PySys_SetArgvEx"><code class="xref c c-func docutils literal"><span class="pre">PySys_SetArgvEx()</span></code></a> は、 <code class="docutils literal"><span class="pre">sys.argv</span></code> の値を設定し、 <em>updatepath</em> に依ってオプションで <code class="docutils literal"><span class="pre">sys.path</span></code> を更新して <code class="docutils literal"><span class="pre">sys.argv[0]</span></code> で指名されたスクリプトを含むディレクトリを含めることができます。</p>
<p>この関数は、Python を埋め込んだアプリケーションのセキュリティホールを塞ぐために追加されました。古い関数 <a class="reference internal" href="../c-api/init.html#c.PySys_SetArgv" title="PySys_SetArgv"><code class="xref c c-func docutils literal"><span class="pre">PySys_SetArgv()</span></code></a> は、必ず <code class="docutils literal"><span class="pre">sys.path</span></code> を更新し、これはカレントディレクトリを追加することがあります。これにより、Python を埋め込んだアプリケーションを別の誰かが制御するディレクトリで実行すると、攻撃者がディレクトリにトロイの木馬モジュール(例えば、 <code class="file docutils literal"><span class="pre">os.py</span></code> という名前のファイル) を仕込み、インポートさせ実行させる事ができました。</p>
<p>Python を埋め込んだ C/C++ アプリケーションを保守しているなら、 <a class="reference internal" href="../c-api/init.html#c.PySys_SetArgv" title="PySys_SetArgv"><code class="xref c c-func docutils literal"><span class="pre">PySys_SetArgv()</span></code></a> を呼び出していないか調べ、 <em>updatepath</em> を偽に設定した <a class="reference internal" href="../c-api/init.html#c.PySys_SetArgvEx" title="PySys_SetArgvEx"><code class="xref c c-func docutils literal"><span class="pre">PySys_SetArgvEx()</span></code></a> を使うべきかよく考えてください。</p>
<p><a class="reference external" href="https://bugs.python.org/issue5753">bpo-5753</a> で <a class="reference external" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-5983">CVE-2008-5983</a> として報告され、Antoine Pitrou によって修正されたたセキュリティ問題です。</p>
</li>
<li><p class="first">新しいマクロ: Python ヘッダファイルは、以下のマクロを定義しました: <code class="xref c c-macro docutils literal"><span class="pre">Py_ISALNUM</span></code>, <code class="xref c c-macro docutils literal"><span class="pre">Py_ISALPHA</span></code>, <code class="xref c c-macro docutils literal"><span class="pre">Py_ISDIGIT</span></code>, <code class="xref c c-macro docutils literal"><span class="pre">Py_ISLOWER</span></code>, <code class="xref c c-macro docutils literal"><span class="pre">Py_ISSPACE</span></code>, <code class="xref c c-macro docutils literal"><span class="pre">Py_ISUPPER</span></code>, <code class="xref c c-macro docutils literal"><span class="pre">Py_ISXDIGIT</span></code>, <code class="xref c c-macro docutils literal"><span class="pre">Py_TOLOWER</span></code>, および <code class="xref c c-macro docutils literal"><span class="pre">Py_TOUPPER</span></code> 。これらすべての関数は、文字を分類する C の標準マクロと類似ですが、Python は文字をロケールに依らず文字を分析したいときがあるため、現在のロケール設定を無視します。(Added by Eric Smith; <a class="reference external" href="https://bugs.python.org/issue5793">bpo-5793</a>.)</p>
</li>
<li><p class="first">取り除かれた関数: <code class="xref c c-macro docutils literal"><span class="pre">PyEval_CallObject</span></code> は、マクロとしてのみ利用できるようになりました。関数版は、ABI リンク互換性を保つために残されましたが、それは 1997 年のことです。今となっては削除するべきです。(Removed by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue8276">bpo-8276</a>.)</p>
</li>
<li><p class="first">新しいフォーマットコード: <code class="xref c c-func docutils literal"><span class="pre">PyFormat_FromString()</span></code>, <code class="xref c c-func docutils literal"><span class="pre">PyFormat_FromStringV()</span></code>, および <a class="reference internal" href="../c-api/exceptions.html#c.PyErr_Format" title="PyErr_Format"><code class="xref c c-func docutils literal"><span class="pre">PyErr_Format()</span></code></a> 関数は、C の <code class="xref c c-type docutils literal"><span class="pre">long</span> <span class="pre">long</span></code> 型を表示する <code class="docutils literal"><span class="pre">%lld</span></code> および <code class="docutils literal"><span class="pre">%llu</span></code> フォーマットを受け付けるようになりました。(Contributed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue7228">bpo-7228</a>.)</p>
</li>
<li><p class="first">スレッドとプロセスのフォークの間の複雑な相互関係が変更されました。以前は、 <a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><code class="xref py py-func docutils literal"><span class="pre">os.fork()</span></code></a> によって生成された子プロセスは失敗していました。これは、子は動作しているスレッド 1 つだけで生成され、そのスレッドが <a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><code class="xref py py-func docutils literal"><span class="pre">os.fork()</span></code></a> を処理するからです。他のスレッドが、Python のインポートロックのような、ロックを保持していたら、フォークが実行されたとき、ロックは新しいプロセスでも &quot;held&quot; としてマークされたままです。しかし、子プロセスでは、他のスレッドは複製されないため、ロックを解放するものは何もないので、子プロセスは import の実行を続けることができません。</p>
<p>Python 2.7 は、 <a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><code class="xref py py-func docutils literal"><span class="pre">os.fork()</span></code></a> を実行する前に import ロックを取得し、また <a class="reference internal" href="../library/threading.html#module-threading" title="threading: Thread-based parallelism."><code class="xref py py-mod docutils literal"><span class="pre">threading</span></code></a> モジュールを使って生成された全てのロックをクリーンアップします。内部ロックを持っていたり、自身で <code class="xref c c-func docutils literal"><span class="pre">fork()</span></code> を呼び出したりするような C 拡張モジュールは、このクリーンアップの恩恵を受けません。</p>
<p>(Fixed by Thomas Wouters; <a class="reference external" href="https://bugs.python.org/issue1590864">bpo-1590864</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../c-api/init.html#c.Py_Finalize" title="Py_Finalize"><code class="xref c c-func docutils literal"><span class="pre">Py_Finalize()</span></code></a> 関数は、内部の <code class="xref py py-func docutils literal"><span class="pre">threading._shutdown()</span></code> 関数を呼び出します。これにより、インタプリタがシャトダウンするときに送出が防がれる例外があります。(Patch by Adam Olsen; <a class="reference external" href="https://bugs.python.org/issue1722344">bpo-1722344</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../c-api/structures.html#c.PyMemberDef" title="PyMemberDef"><code class="xref c c-type docutils literal"><span class="pre">PyMemberDef</span></code></a> 構造を使って型の属性を定義する際、Python はもはや <code class="xref py py-const docutils literal"><span class="pre">T_STRING_INPLACE</span></code> 属性を削除または設定させようとはしません。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ctypes.html#module-ctypes" title="ctypes: A foreign function library for Python."><code class="xref py py-mod docutils literal"><span class="pre">ctypes</span></code></a> によって定義されたグローバルシンボルには、 <code class="docutils literal"><span class="pre">Py</span></code> または <code class="docutils literal"><span class="pre">_ctypes</span></code> が接頭されるようになりました。(Implemented by Thomas Heller; <a class="reference external" href="https://bugs.python.org/issue3102">bpo-3102</a>.)</p>
</li>
<li><p class="first">新しい設定オプション: <code class="xref std std-option docutils literal"><span class="pre">--with-system-expat</span></code> スイッチにより、 <code class="xref py py-mod docutils literal"><span class="pre">pyexpat</span></code> モジュールをビルドして、システム Expat ライブラリを使えます。 (Contributed by Arfrever Frehtes Taifersar Arahesis; <a class="reference external" href="https://bugs.python.org/issue7609">bpo-7609</a>.)</p>
</li>
<li><p class="first">新しい設定オプション: <code class="xref std std-option docutils literal"><span class="pre">--with-valgrind</span></code> オプションは、 Valgrind メモリエラー検出器が正しく分析するのが難しい pymalloc アロケータを無効にするようになりました。ですから Valgrind は、メモリリークやオーバーランをより検出できます。 (Contributed by James Henstridge; <a class="reference external" href="https://bugs.python.org/issue2422">bpo-2422</a>.)</p>
</li>
<li><p class="first">新しい設定オプション: <code class="xref std std-option docutils literal"><span class="pre">--with-dbmliborder=</span></code> に空の文字列を与えて様々な DBM モジュールを全て無効にできます。 (Added by Arfrever Frehtes Taifersar Arahesis; <a class="reference external" href="https://bugs.python.org/issue6491">bpo-6491</a>.)</p>
</li>
<li><p class="first"><strong class="program">configure</strong> スクリプトは、ある種の 32-bit Intel チップ上の浮動小数点丸めバグを調べ、 <code class="xref c c-macro docutils literal"><span class="pre">X87_DOUBLE_ROUNDING</span></code> プリプロセッサ定義を定義します。現在この定義を使うコードはありませんが、使うことを望む人がいたら使えます。(Added by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue2937">bpo-2937</a>.)</p>
<p><strong class="program">configure</strong> はまた、C++ リンクをサポートする <span class="target" id="index-46"></span><code class="xref std std-envvar docutils literal"><span class="pre">LDCXXSHARED</span></code> Makefile を設定するようになりました。 (Contributed by Arfrever Frehtes Taifersar Arahesis; <a class="reference external" href="https://bugs.python.org/issue1222585">bpo-1222585</a>.)</p>
</li>
<li><p class="first">ビルドプロセスは、pkg-config サポートに必要なファイルを生成するようになりました。(Contributed by Clinton Roy; <a class="reference external" href="https://bugs.python.org/issue3585">bpo-3585</a>.)</p>
</li>
<li><p class="first">ビルドプロセスは、Subversion 1.7 をサポートするようになりました。 (Contributed by Arfrever Frehtes Taifersar Arahesis; <a class="reference external" href="https://bugs.python.org/issue6094">bpo-6094</a>.)</p>
</li>
</ul>
<div class="section" id="capsules">
<span id="whatsnew27-capsules"></span><h3>カプセル<a class="headerlink" href="#capsules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Python 3.1 は、拡張モジュールに C API を提供する新しい C データ型 <a class="reference internal" href="../c-api/capsule.html#c.PyCapsule" title="PyCapsule"><code class="xref c c-type docutils literal"><span class="pre">PyCapsule</span></code></a> を追加しました。カプセルは、本質的には C の <code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span></code> ポインタのホルダであり、モジュール属性として利用できるようになります。例えば、 <a class="reference internal" href="../library/socket.html#module-socket" title="socket: Low-level networking interface."><code class="xref py py-mod docutils literal"><span class="pre">socket</span></code></a> モジュールの API は <code class="docutils literal"><span class="pre">socket.CAPI</span></code> として公開されていて、 <a class="reference internal" href="../library/unicodedata.html#module-unicodedata" title="unicodedata: Access the Unicode Database."><code class="xref py py-mod docutils literal"><span class="pre">unicodedata</span></code></a> は <code class="docutils literal"><span class="pre">ucnhash_CAPI</span></code> を公開しています。その他の拡張はモジュールを import し、辞書にアクセスしてカプセルオブジェクトを取得し、そしてモジュールの様々な API 関数へのポインタの配列を指す <code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span></code> ポインタを取得できます。</p>
<p>これに使われる既存のデータ型 <code class="xref c c-type docutils literal"><span class="pre">PyCObject</span></code> がありますが、これは型安全性を提供しません。pure Python で書かれた邪悪なコードは、 <code class="xref c c-type docutils literal"><span class="pre">PyCObject</span></code> をモジュール A から取り、どうにかしてそれをモジュール B の <code class="xref c c-type docutils literal"><span class="pre">PyCObject</span></code> で代えることで、セグメンテーション違反を起こし得ます。カプセルは自身の名前を知っていて、ポインタを得るには名前を提供しなければなりません:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="o">*</span><span class="n">vtable</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyCapsule_IsValid</span><span class="p">(</span><span class="n">capsule</span><span class="p">,</span> <span class="s">&quot;mymodule.CAPI&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">PyErr_SetString</span><span class="p">(</span><span class="n">PyExc_ValueError</span><span class="p">,</span> <span class="s">&quot;argument type invalid&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vtable</span> <span class="o">=</span> <span class="n">PyCapsule_GetPointer</span><span class="p">(</span><span class="n">capsule</span><span class="p">,</span> <span class="s">&quot;mymodule.CAPI&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">vtable</span></code> が期待どおりのものを指すことが保証されます。異なるカプセルが渡されたら、 <a class="reference internal" href="../c-api/capsule.html#c.PyCapsule_IsValid" title="PyCapsule_IsValid"><code class="xref c c-func docutils literal"><span class="pre">PyCapsule_IsValid()</span></code></a> は不適合な名前を検知し、偽を返します。これらのオブジェクトの使用について、より詳しい情報は、 <a class="reference internal" href="../extending/extending.html#using-capsules"><span class="std std-ref">拡張モジュールに C API を提供する</span></a> を参照してください。</p>
<p>Python 2.7 は、様々な拡張モジュール API を提供するためにカプセルを内部的に使うようになりましたが、カプセルを処理するために <code class="xref c c-func docutils literal"><span class="pre">PyCObject_AsVoidPtr()</span></code> が <code class="xref c c-type docutils literal"><span class="pre">CObject</span></code> インタフェースとのコンパイル時互換性は保ったまま変更されました。 <code class="xref c c-func docutils literal"><span class="pre">PyCObject_AsVoidPtr()</span></code> を使うと <a class="reference internal" href="../library/exceptions.html#PendingDeprecationWarning" title="PendingDeprecationWarning"><code class="xref py py-exc docutils literal"><span class="pre">PendingDeprecationWarning</span></code></a> が合図されますが、デフォルトでは言及されません。</p>
<p>Implemented in Python 3.1 and backported to 2.7 by Larry Hastings;
discussed in <a class="reference external" href="https://bugs.python.org/issue5630">bpo-5630</a>.</p>
</div>
<div class="section" id="port-specific-changes-windows">
<h3>ポート特有の変更: Windows<a class="headerlink" href="#port-specific-changes-windows" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../library/msvcrt.html#module-msvcrt" title="msvcrt: Miscellaneous useful routines from the MS VC++ runtime. (Windows)"><code class="xref py py-mod docutils literal"><span class="pre">msvcrt</span></code></a> モジュールは、 <code class="file docutils literal"><span class="pre">crtassem.h</span></code> からのいくつかの定数を追加しました。 <code class="xref py py-data docutils literal"><span class="pre">CRT_ASSEMBLY_VERSION</span></code>, <code class="xref py py-data docutils literal"><span class="pre">VC_ASSEMBLY_PUBLICKEYTOKEN</span></code>, および <code class="xref py py-data docutils literal"><span class="pre">LIBRARIES_ASSEMBLY_NAME_PREFIX</span></code>. (Contributed by David Cournapeau; <a class="reference external" href="https://bugs.python.org/issue4365">bpo-4365</a>.)</li>
<li>レジストリへのアクセスのための <code class="xref py py-mod docutils literal"><span class="pre">_winreg</span></code> モジュールは、以前サポートされていた関数群の引数を増やした拡張版である <code class="xref py py-func docutils literal"><span class="pre">CreateKeyEx()</span></code> および <code class="xref py py-func docutils literal"><span class="pre">DeleteKeyEx()</span></code> を実装しました。 <code class="xref py py-func docutils literal"><span class="pre">DisableReflectionKey()</span></code>, <code class="xref py py-func docutils literal"><span class="pre">EnableReflectionKey()</span></code>, および <code class="xref py py-func docutils literal"><span class="pre">QueryReflectionKey()</span></code> もテストされ、ドキュメント化されました。(Implemented by Brian Curtin: <a class="reference external" href="https://bugs.python.org/issue7347">bpo-7347</a>.)</li>
<li>新しい <code class="xref c c-func docutils literal"><span class="pre">_beginthreadex()</span></code> API がスレッドの開始に使われ、ネイティブのスレッドローカルストレージ間数が使われるようになりました。(Contributed by Kristján Valur Jónsson; <a class="reference external" href="https://bugs.python.org/issue3582">bpo-3582</a>.)</li>
<li><a class="reference internal" href="../library/os.html#os.kill" title="os.kill"><code class="xref py py-func docutils literal"><span class="pre">os.kill()</span></code></a> 関数が Windows で働くようになりました。このシグナル値は定数 <code class="xref py py-const docutils literal"><span class="pre">CTRL_C_EVENT</span></code>, <code class="xref py py-const docutils literal"><span class="pre">CTRL_BREAK_EVENT</span></code>, その他の整数にできます。最初の 2 定数は <code class="kbd docutils literal"><span class="pre">Control-C</span></code> および <code class="kbd docutils literal"><span class="pre">Control-Break</span></code> 打鍵イベントをサブプロセスに送ります。その他の値は、 <code class="xref c c-func docutils literal"><span class="pre">TerminateProcess()</span></code> API を使います。(Contributed by Miki Tebeka; <a class="reference external" href="https://bugs.python.org/issue1220212">bpo-1220212</a>.)</li>
<li><a class="reference internal" href="../library/os.html#os.listdir" title="os.listdir"><code class="xref py py-func docutils literal"><span class="pre">os.listdir()</span></code></a> 関数は、空のパスに対してちゃんと失敗するようになりました。 (Fixed by Hirokazu Yamamoto; <a class="reference external" href="https://bugs.python.org/issue5913">bpo-5913</a>.)</li>
<li><code class="xref py py-mod docutils literal"><span class="pre">mimelib</span></code> モジュールは、初期化の際に Windows レジストリから MIME データベースを正しく読みこむようになりました。 (Patch by Gabriel Genellina; <a class="reference external" href="https://bugs.python.org/issue4969">bpo-4969</a>.)</li>
</ul>
</div>
<div class="section" id="port-specific-changes-mac-os-x">
<h3>ポート特有の変更: Mac OS X<a class="headerlink" href="#port-specific-changes-mac-os-x" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>追加されたパッケージを、システムインストレーションとユーザがインストールした同じバージョンのコピーで共有するために、 <code class="docutils literal"><span class="pre">sys.path</span></code> に <code class="docutils literal"><span class="pre">/Library/Python/2.7/site-packages</span></code> が追加されました。 (Changed by Ronald Oussoren; <a class="reference external" href="https://bugs.python.org/issue4865">bpo-4865</a>.)</li>
</ul>
</div>
<div class="section" id="port-specific-changes-freebsd">
<h3>ポート特有の変更: FreeBSD<a class="headerlink" href="#port-specific-changes-freebsd" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>FreeBSD 7.1 の、他のルーティングテーブルを選択するための <code class="xref py py-func docutils literal"><span class="pre">getsockopt()</span></code>/<code class="xref py py-func docutils literal"><span class="pre">setsockopt()</span></code> で使われている <code class="xref py py-const docutils literal"><span class="pre">SO_SETFIB</span></code> 定数が、 <a class="reference internal" href="../library/socket.html#module-socket" title="socket: Low-level networking interface."><code class="xref py py-mod docutils literal"><span class="pre">socket</span></code></a> モジュールで使えるようになりました。(Added by Kyle VanderBeek; <a class="reference external" href="https://bugs.python.org/issue8235">bpo-8235</a>.)</li>
</ul>
</div>
</div>
<div class="section" id="other-changes-and-fixes">
<h2>その他の変更と修正<a class="headerlink" href="#other-changes-and-fixes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul class="simple">
<li>ベンチマークスクリプトの 2 つ、 <code class="file docutils literal"><span class="pre">iobench</span></code> および <code class="file docutils literal"><span class="pre">ccbench</span></code>, が <code class="file docutils literal"><span class="pre">Tools</span></code> ディレクトリに追加されました。 <code class="file docutils literal"><span class="pre">iobench</span></code> は、様々な演算を実行している間 <a class="reference internal" href="../library/functions.html#open" title="open"><code class="xref py py-func docutils literal"><span class="pre">open()</span></code></a> によって返された組み込みファイル I/O オブジェクトの速度を計測し、 <code class="file docutils literal"><span class="pre">ccbench</span></code> は、変化する数のスレッドを使っていくつかのタスクを処理するときの計算スループット、スレッド切り替えレイテンシ、IO 処理バンド幅の計測を試みる同時実行ベンチマークです。</li>
<li><code class="file docutils literal"><span class="pre">Tools/i18n/msgfmt.py</span></code> スクリプトは、複数の形式の <code class="file docutils literal"><span class="pre">.po</span></code> ファイルを理解できるようになりました。(Fixed by Martin von Löwis; <a class="reference external" href="https://bugs.python.org/issue5464">bpo-5464</a>.)</li>
<li>既存の対応する <code class="file docutils literal"><span class="pre">.py</span></code> が存在する <code class="file docutils literal"><span class="pre">.pyc</span></code> または <code class="file docutils literal"><span class="pre">.pyo</span></code> ファイルからモジュールを import するとき、結果のコードオブジェクトの <code class="xref py py-attr docutils literal"><span class="pre">co_filename</span></code> 属性は、元のファイル名が古くなったとき、上書きされます。これは、ファイルがリネーム、移動、異なるパスを通したアクセスをされたときに起こりえます。(Patch by Ziga Seilnacht and Jean-Paul Calderone; <a class="reference external" href="https://bugs.python.org/issue1180193">bpo-1180193</a>.)</li>
<li><code class="file docutils literal"><span class="pre">regrtest.py</span></code> スクリプトは、テストを乱順に実行する <code class="xref std std-option docutils literal"><span class="pre">-r</span></code> オプションの、ランダムシードに使われる整数を取る <code class="xref std std-option docutils literal"><span class="pre">--randseed=</span></code> スイッチを取るようになりました。 <code class="xref std std-option docutils literal"><span class="pre">-r</span></code> オプションは、使われたシードも報告します。 (Added by Collin Winter.)</li>
<li>もう一つの <code class="file docutils literal"><span class="pre">regrtest.py</span></code> スイッチは <code class="xref std std-option docutils literal"><span class="pre">-j</span></code> で、いくつのテストを並行して実行するかを指定する整数です。これにより、マルチコア機での合計実行時間を短縮できます。このオプションは、実行時間を長くすることで知られている <code class="xref std std-option docutils literal"><span class="pre">-R</span></code> スイッチなど、いくつかの他のオプションと互換です。 (Added by Antoine Pitrou, <a class="reference external" href="https://bugs.python.org/issue6152">bpo-6152</a>.) これはまた、選ばれたテストを失敗するまでループして実行する <code class="xref std std-option docutils literal"><span class="pre">-F</span></code> スイッチとも同時に使えます。(Added by Antoine Pitrou; <a class="reference external" href="https://bugs.python.org/issue7312">bpo-7312</a>.)</li>
<li>スクリプトとして実行されるとき、 <code class="file docutils literal"><span class="pre">py_compile.py</span></code> モジュールは標準入力を読み込んでコンパイルするファイル名のリストとする <code class="docutils literal"><span class="pre">'-'</span></code> を引数として受け付けるようになりました。(Contributed by Piotr Ożarowski; <a class="reference external" href="https://bugs.python.org/issue8233">bpo-8233</a>.)</li>
</ul>
</div>
<div class="section" id="porting-to-python-2-7">
<h2>Python 2.7 への移植<a class="headerlink" href="#porting-to-python-2-7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このセクションでは前述の変更とバグフィックスにより必要となるかもしれないコードの変更を列挙します:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/stdtypes.html#range" title="range"><code class="xref py py-func docutils literal"><span class="pre">range()</span></code></a> 関数は、引数をより一貫して処理するようになりました。浮動小数点数でもなく整数でもない引数が与えられたら、その <a class="reference internal" href="../reference/datamodel.html#object.__int__" title="object.__int__"><code class="xref py py-meth docutils literal"><span class="pre">__int__()</span></code></a> を呼び出すようになりました。(Fixed by Alexander Belopolsky; <a class="reference external" href="https://bugs.python.org/issue1533">bpo-1533</a>.)</li>
<li>文字列 <a class="reference internal" href="../library/functions.html#format" title="format"><code class="xref py py-meth docutils literal"><span class="pre">format()</span></code></a> メソッドは浮動小数点数および複素数に使われるデフォルトの精度を、 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal"><span class="pre">str()</span></code></a> で使われる精度に合わせ、小数第 6 位から 12 位に変更しました。 (Changed by Eric Smith; <a class="reference external" href="https://bugs.python.org/issue5920">bpo-5920</a>.)</li>
<li><a class="reference internal" href="../reference/compound_stmts.html#with"><code class="xref std std-keyword docutils literal"><span class="pre">with</span></code></a> 文の最適化のため、特殊メソッド <a class="reference internal" href="../reference/datamodel.html#object.__enter__" title="object.__enter__"><code class="xref py py-meth docutils literal"><span class="pre">__enter__()</span></code></a> および <a class="reference internal" href="../reference/datamodel.html#object.__exit__" title="object.__exit__"><code class="xref py py-meth docutils literal"><span class="pre">__exit__()</span></code></a> はオブジェクトの型に属さなければならず、オブジェクトのインスタンスには直接取り付けられません。これは (<a class="reference internal" href="../library/functions.html#object" title="object"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a> から導出された) 新スタイルクラスと C 拡張型に影響します。 (<a class="reference external" href="https://bugs.python.org/issue6101">bpo-6101</a>.)</li>
<li>Python 2.6 におけるバグのため、 <a class="reference internal" href="../reference/datamodel.html#object.__exit__" title="object.__exit__"><code class="xref py py-meth docutils literal"><span class="pre">__exit__()</span></code></a> の <em>exc_value</em> パラメタははよく、例外のインスタンスではなく文字列表現になっていました。これは 2.7 では修正され、 <em>exc_value</em> は期待通りインスタンスになります。 (Fixed by Florent Xicluna; <a class="reference external" href="https://bugs.python.org/issue7853">bpo-7853</a>.)</li>
<li><code class="docutils literal"><span class="pre">__slots__</span></code> を利用して属性を制限した場合に、設定されていない属性を del したときに <a class="reference internal" href="../library/exceptions.html#AttributeError" title="AttributeError"><code class="xref py py-exc docutils literal"><span class="pre">AttributeError</span></code></a> にならなかったのを修正しました。 (Fixed by Benjamin Peterson; <a class="reference external" href="https://bugs.python.org/issue7604">bpo-7604</a>.)</li>
</ul>
<p>標準ライブラリでは:</p>
<ul>
<li><p class="first">年がサポートされている範囲外にはみ出るような <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal"><span class="pre">datetime</span></code></a> インスタンスの演算が、 <a class="reference internal" href="../library/exceptions.html#OverflowError" title="OverflowError"><code class="xref py py-exc docutils literal"><span class="pre">OverflowError</span></code></a> を送出しないことがありました。このようなエラーはより注意深く調べられ、例外を送出するようになりました。(Reported by Mark Leander, patch by Anand B. Pillai and Alexander Belopolsky; <a class="reference external" href="https://bugs.python.org/issue7150">bpo-7150</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal"><span class="pre">Decimal</span></code></a> インスタンスを文字列の <a class="reference internal" href="../library/functions.html#format" title="format"><code class="xref py py-meth docutils literal"><span class="pre">format()</span></code></a> メソッドに使うとき、デフォルトの揃えは以前は左揃えでした。これは右揃えに変更され、プログラムの出力が変わるかもしれません。(Changed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue6857">bpo-6857</a>.)</p>
<p>signaling NaN (あるいは <code class="docutils literal"><span class="pre">sNAN</span></code>) との比較は、暗黙に比較演算に応じて真偽値を返すのではなく、 <a class="reference internal" href="../library/decimal.html#decimal.InvalidOperation" title="decimal.InvalidOperation"><code class="xref py py-const docutils literal"><span class="pre">InvalidOperation</span></code></a> 例外を発生させるようになりました。 Quiet NaN (あるいは <code class="docutils literal"><span class="pre">NAN</span></code>) はハッシュ可能になりました。 (Fixed by Mark Dickinson; <a class="reference external" href="https://bugs.python.org/issue7279">bpo-7279</a>.)</p>
</li>
<li><p class="first">ElementTree ライブラリ <code class="xref py py-mod docutils literal"><span class="pre">xml.etree</span></code> は、 (<cite>&lt;?xml-stylesheet href=&quot;#style1&quot;?&gt;</cite> のような) 命令や (<cite>&lt;!– comment –&gt;</cite> のような) コメントを処理する XML を出力するときにアンパサンドおよび角括弧をエスケープしなくなりました。 (Patch by Neil Muller; <a class="reference external" href="https://bugs.python.org/issue2746">bpo-2746</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal"><span class="pre">StringIO</span></code> オブジェクトの <code class="xref py py-meth docutils literal"><span class="pre">readline()</span></code> メソッドは負の長さが要求されたとき、ほかのファイル風オブジェクトと同じように、何もしなくなりました。(<a class="reference external" href="https://bugs.python.org/issue7348">bpo-7348</a>)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/syslog.html#module-syslog" title="syslog: An interface to the Unix syslog library routines. (Unix)"><code class="xref py py-mod docutils literal"><span class="pre">syslog</span></code></a> モジュールは、識別子として、以前デフォルトであった <code class="docutils literal"><span class="pre">'python'</span></code> の値ではなく、 <code class="docutils literal"><span class="pre">sys.argv[0]</span></code> の値を使うようになりました。 (Changed by Sean Reifschneider; <a class="reference external" href="https://bugs.python.org/issue8451">bpo-8451</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal"><span class="pre">tarfile</span></code></a> モジュールのデフォルトエラー処理が変更され、致命的なエラーを抑制しないようになりました。デフォルトのエラーレベルは以前は 0 で、エラーはメッセージとしてデバッグログに書き込まれるだけでしたが、デバッグログはデフォルトでは活性化されていないため、エラーは顧みられませんでした。デフォルトのエラーレベルは 1 になり、エラーがあれば例外が送出されます。 (Changed by Lars Gustäbel; <a class="reference external" href="https://bugs.python.org/issue7357">bpo-7357</a>.)</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal"><span class="pre">urlparse</span></code> モジュールの <code class="xref py py-func docutils literal"><span class="pre">urlsplit()</span></code> は、未知の URL スキームを <span class="target" id="index-47"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3986.html"><strong>RFC 3986</strong></a> に応じた方法で処理します。 URL が <code class="docutils literal"><span class="pre">&quot;&lt;something&gt;://...&quot;</span></code> の形式なら、 <code class="docutils literal"><span class="pre">://</span></code> の前のテキストを、それがモジュールの知らない作り物のスキームであってさえ、スキームとして扱います。この変更は、古い働きを使って動作していたコードを破壊することがあります。例えば、Python 2.6.4 や 2.5 は以下を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlparse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="s1">&#39;invented://host/filename?query&#39;</span><span class="p">)</span>
<span class="go">(&#39;invented&#39;, &#39;&#39;, &#39;//host/filename?query&#39;, &#39;&#39;, &#39;&#39;)</span>
</pre></div>
</div>
<p>Python 2.7 (や Python 2.6.5) は以下を返します:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlparse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="s1">&#39;invented://host/filename?query&#39;</span><span class="p">)</span>
<span class="go">(&#39;invented&#39;, &#39;host&#39;, &#39;/filename?query&#39;, &#39;&#39;, &#39;&#39;)</span>
</pre></div>
</div>
<p>(Python 2.7 では、これは普通のタプルではなく名前付きタプルを返すので、実際は微妙に異なる出力をします。)</p>
</li>
</ul>
<p>C 拡張では:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">PyArg_Parse*</span></code> 系統の関数で整数フォーマットコードを使う C 拡張は、 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></code></a> を引き起こすのではなく、 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal"><span class="pre">TypeError</span></code></a> 例外を送出するようになりました。(<a class="reference external" href="https://bugs.python.org/issue5080">bpo-5080</a>)</li>
<li>非推奨となった古い <code class="xref c c-func docutils literal"><span class="pre">PyOS_ascii_strtod()</span></code> および <code class="xref c c-func docutils literal"><span class="pre">PyOS_ascii_atof()</span></code> 関数の代わりに、新しい <a class="reference internal" href="../c-api/conversion.html#c.PyOS_string_to_double" title="PyOS_string_to_double"><code class="xref c c-func docutils literal"><span class="pre">PyOS_string_to_double()</span></code></a> 関数を使ってください。</li>
</ul>
<p>Python を埋め込んだアプリケーションでは:</p>
<ul class="simple">
<li><a class="reference internal" href="../c-api/init.html#c.PySys_SetArgvEx" title="PySys_SetArgvEx"><code class="xref c c-func docutils literal"><span class="pre">PySys_SetArgvEx()</span></code></a> 関数が追加され、既存の <a class="reference internal" href="../c-api/init.html#c.PySys_SetArgv" title="PySys_SetArgv"><code class="xref c c-func docutils literal"><span class="pre">PySys_SetArgv()</span></code></a> 関数が使われた時のセキュリティホールを塞ぐことができるようになりました。 <a class="reference internal" href="../c-api/init.html#c.PySys_SetArgv" title="PySys_SetArgv"><code class="xref c c-func docutils literal"><span class="pre">PySys_SetArgv()</span></code></a> を呼び出していないか調べ、 <em>updatepath</em> を偽に設定した <a class="reference internal" href="../c-api/init.html#c.PySys_SetArgvEx" title="PySys_SetArgvEx"><code class="xref c c-func docutils literal"><span class="pre">PySys_SetArgvEx()</span></code></a> を使うべきかよく考えてください。</li>
</ul>
</div>
<div class="section" id="new-features-added-to-python-2-7-maintenance-releases">
<span id="py27-maintenance-enhancements"></span><h2>Python 2.7 メンテナンスリリースで追加された新機能<a class="headerlink" href="#new-features-added-to-python-2-7-maintenance-releases" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 2.7 メンテナンスリリースでは、正真正銘それが求められる状況では、新しい機能が追加される場合があります。そのような追加のどんなものでも Python Enhancement Proposal プロセスを通過しなければなりません。Python 3 だけに新しい機能を追加することによっても Python Package Index に公開することによってもいずれでも十分ではないと言えるだけのやむにやまれない理由付けが必要です。</p>
<p>個別の提案は以下にリストしますが、全ての Python 2.7 メンテナンスリリースに追加される新しい <code class="docutils literal"><span class="pre">-3</span></code> 警告は除いています。</p>
<div class="section" id="pep-434-idle-enhancement-exception-for-all-branches">
<h3>PEP 434: IDLE 拡張についての全てのブランチにおける例外的な扱い<a class="headerlink" href="#pep-434-idle-enhancement-exception-for-all-branches" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><span class="target" id="index-48"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0434"><strong>PEP 434</strong></a> は、Pythonと一緒に出荷されるIDLE開発環境に変更を加えるための一般的な免除事項を説明します。これは、IDLE の開発者 が Python 2 と 3 のすべてのサポートされているバージョン間でより一貫したユーザーエクスペリエンスを提供するためのものです。</p>
<p>全ての IDLE の変更についての詳細は、個別のリリースについてのNEWS ファイルを参照してください。</p>
</div>
<div class="section" id="pep-466-network-security-enhancements-for-python-2-7">
<h3>PEP 466: Python 2.7 のためのネットワークセキュリティ拡張<a class="headerlink" href="#pep-466-network-security-enhancements-for-python-2-7" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><span class="target" id="index-49"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0466"><strong>PEP 466</strong></a> は、 Python 2.7 メンテナンスリリースに含めることを認められた数多くのネットワークセキュリティ強化についての提案を記述しています。それら変更の最初のものは Python 2.7.7 に初めて登場しました。</p>
<p>Python 2.7.7 に <span class="target" id="index-50"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0466"><strong>PEP 466</strong></a> 関連で追加された機能:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/hmac.html#hmac.compare_digest" title="hmac.compare_digest"><code class="xref py py-func docutils literal"><span class="pre">hmac.compare_digest()</span></code></a> が Python 3 からバックポートされました。これにより Python 2 アプリケーションで  timing attack resistant comparison operation が利用可能になります (Contributed by Alex Gaynor; <a class="reference external" href="https://bugs.python.org/issue21306">bpo-21306</a>.)</li>
<li>python.org で公開される公式 Windows インストーラのビルドに使う OpenSSL が 1.0.1g にアップグレードされました . (Contributed by Zachary Ware; <a class="reference external" href="https://bugs.python.org/issue21462">bpo-21462</a>.)</li>
</ul>
<p>Python 2.7.8 に <span class="target" id="index-51"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0466"><strong>PEP 466</strong></a> 関連で追加された機能:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/hashlib.html#hashlib.pbkdf2_hmac" title="hashlib.pbkdf2_hmac"><code class="xref py py-func docutils literal"><span class="pre">hashlib.pbkdf2_hmac()</span></code></a> が Python 3 からバックポートされました。これにより Python 2 アプリケーションでも、安全なパスワード格納に広範に使うのに相応しいハッシュアルゴリズムが利用できます (Contributed by Alex Gaynor; <a class="reference external" href="https://bugs.python.org/issue21304">bpo-21304</a>.)</li>
<li>python.org で公開される公式 Windows インストーラのビルドに使う OpenSSL が 1.0.1h にアップグレードされました (contributed by Zachary Ware in <a class="reference external" href="https://bugs.python.org/issue21671">bpo-21671</a> for CVE-2014-0224)</li>
</ul>
<p>Python 2.7.9 に <span class="target" id="index-52"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0466"><strong>PEP 466</strong></a> 関連で追加された機能:</p>
<ul class="simple">
<li>Python 3.4 の <a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal"><span class="pre">ssl</span></code></a> モジュールのほとんどがバックポートされました。つまり <a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal"><span class="pre">ssl</span></code></a> は今や、Server Name Indication, TLS1.x 設定, platform certificate store へのアクセス, <a class="reference internal" href="../library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal"><span class="pre">SSLContext</span></code></a> クラス, その他機能が使えます (Contributed by Alex Gaynor and David Reid; <a class="reference external" href="https://bugs.python.org/issue21308">bpo-21308</a>.)</li>
<li><a class="reference internal" href="../library/os.html#os.urandom" title="os.urandom"><code class="xref py py-func docutils literal"><span class="pre">os.urandom()</span></code></a> は、呼び出しのたびに <code class="docutils literal"><span class="pre">/dev/urandom</span></code> を開きなおす代わりに <code class="docutils literal"><span class="pre">/dev/urandom</span></code> のファイル記述子をキャッシュするように変更されました。(Contributed by Alex Gaynor; <a class="reference external" href="https://bugs.python.org/issue21305">bpo-21305</a>.)</li>
</ul>
</div>
</div>
<div class="section" id="acknowledgements">
<span id="acks27"></span><h2>謝辞<a class="headerlink" href="#acknowledgements" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>著者は、以下の方々がこの記事の多くの草稿に提案、修正、そして助力を差し伸べてくださったことに感謝の意を表したいと思います: Nick Coghlan, Philip Jenvey, Ryan Lovett, R. David Murray, Hugh Secker-Walker.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">What’s New in Python 2.7</a><ul>
<li><a class="reference internal" href="#the-future-for-python-2-x">Python 2.x の今後</a></li>
<li><a class="reference internal" href="#changes-to-the-handling-of-deprecation-warnings">Deprecation Warnings の扱いの変更</a></li>
<li><a class="reference internal" href="#python-3-1-features">Python 3.1 の機能</a></li>
<li><a class="reference internal" href="#pep-372-adding-an-ordered-dictionary-to-collections">PEP 372: collections に順序付き辞書を追加</a></li>
<li><a class="reference internal" href="#pep-378-format-specifier-for-thousands-separator">PEP 378: 1000区切りのための書式指定子</a></li>
<li><a class="reference internal" href="#pep-389-the-argparse-module-for-parsing-command-lines">PEP 389: コマンドライン解析のための argparse モジュール</a></li>
<li><a class="reference internal" href="#pep-391-dictionary-based-configuration-for-logging">PEP 391: logging の辞書ベースの設定</a></li>
<li><a class="reference internal" href="#pep-3106-dictionary-views">PEP 3106: 辞書 View</a></li>
<li><a class="reference internal" href="#pep-3137-the-memoryview-object">PEP 3137: memoryview オブジェクト</a></li>
<li><a class="reference internal" href="#other-language-changes">その他の言語変更</a><ul>
<li><a class="reference internal" href="#interpreter-changes">インタプリタの変更</a></li>
<li><a class="reference internal" href="#optimizations">最適化</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-and-improved-modules">新しいモジュールと改良されたモジュール</a><ul>
<li><a class="reference internal" href="#new-module-importlib">新しいモジュール: importlib</a></li>
<li><a class="reference internal" href="#new-module-sysconfig">新しいモジュール: sysconfig</a></li>
<li><a class="reference internal" href="#ttk-themed-widgets-for-tk">ttk: Tk のテーマ付きウィジェット</a></li>
<li><a class="reference internal" href="#updated-module-unittest">更新されたモジュール: unittest</a></li>
<li><a class="reference internal" href="#updated-module-elementtree-1-3">更新されたモジュール: ElementTree 1.3</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-and-c-api-changes">ビルドならびに C API の変更</a><ul>
<li><a class="reference internal" href="#capsules">カプセル</a></li>
<li><a class="reference internal" href="#port-specific-changes-windows">ポート特有の変更: Windows</a></li>
<li><a class="reference internal" href="#port-specific-changes-mac-os-x">ポート特有の変更: Mac OS X</a></li>
<li><a class="reference internal" href="#port-specific-changes-freebsd">ポート特有の変更: FreeBSD</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-changes-and-fixes">その他の変更と修正</a></li>
<li><a class="reference internal" href="#porting-to-python-2-7">Python 2.7 への移植</a></li>
<li><a class="reference internal" href="#new-features-added-to-python-2-7-maintenance-releases">Python 2.7 メンテナンスリリースで追加された新機能</a><ul>
<li><a class="reference internal" href="#pep-434-idle-enhancement-exception-for-all-branches">PEP 434: IDLE 拡張についての全てのブランチにおける例外的な扱い</a></li>
<li><a class="reference internal" href="#pep-466-network-security-enhancements-for-python-2-7">PEP 466: Python 2.7 のためのネットワークセキュリティ拡張</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgements">謝辞</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="3.0.html"
                        title="前の章へ">What’s New In Python 3.0</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="2.6.html"
                        title="次の章へ">What’s New in Python 2.6</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/3.6/Doc/whatsnew/2.7.rst"
            rel="nofollow">ソースの表示
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="2.6.html" title="What’s New in Python 2.6"
             >次へ</a> |</li>
        <li class="right" >
          <a href="3.0.html" title="What’s New In Python 3.0"
             >前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="version_switcher_placeholder">3.6.3</span>
          <a href="../index.html">ドキュメント</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index.html" >What’s New in Python</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">Copyright</a> 2001-2017, Python Software Foundation.
    <br />
    Python Software Foundation は非営利団体です。
    <a href="https://www.python.org/psf/donations/">寄付</a>
    <br />
    最終更新日時: 11月 16, 2017
    <a href="../bugs.html">バグを見つけたら</a>?
    <br />
    このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.4 を使って作成されました。
    </div>

  </body>
</html>